---
title: "Общие сведения о взаимодействии (руководство по программированию на C#) | Документы Майкрософт"
ms.date: 2015-07-20
ms.prod: .net
ms.technology:
- devlang-csharp
ms.topic: article
dev_langs:
- CSharp
helpviewer_keywords:
- COM interop
- C# language, interoperability
- C++ Interop
- interoperability, about interoperability
- platform invoke
ms.assetid: c025b2e0-2357-4c27-8461-118f0090aeff
caps.latest.revision: 43
author: BillWagner
ms.author: wiwagn
translation.priority.ht:
- cs-cz
- de-de
- es-es
- fr-fr
- it-it
- ja-jp
- ko-kr
- pl-pl
- pt-br
- ru-ru
- tr-tr
- zh-cn
- zh-tw
translationtype: Human Translation
ms.sourcegitcommit: a06bd2a17f1d6c7308fa6337c866c1ca2e7281c0
ms.openlocfilehash: b1b6d5bf9943c5826685b9cc72c79187c7f51364
ms.lasthandoff: 03/13/2017

---
# <a name="interoperability-overview-c-programming-guide"></a>Общие сведения о взаимодействии. (Руководство по программированию в C#)
В этом разделе описываются способы включения взаимодействия между управляемым кодом C# и неуправляемым кодом.  
  
## <a name="platform-invoke"></a>Вызов неуправляемого кода  
 *Вызов неуправляемого кода* — это служба, позволяющая управляемому коду вызывать неуправляемые функции, реализованные в библиотеках динамической компоновки (DLL), например функции библиотек Microsoft Win32 API. Он обнаруживает и вызывает экспортированную функцию и при необходимости маршалирует ее аргументы (целые числа, строки, массивы, структуры и так далее) через границы взаимодействия.  
  
 Дополнительные сведения см. в разделах [Использование неуправляемых функций DLL](http://msdn.microsoft.com/library/eca7606e-ebfb-4f47-b8d9-289903fdc045) и [Практическое руководство. Использование вызова неуправляемого кода для воспроизведения звукового файла](../../../csharp/programming-guide/interop/how-to-use-platform-invoke-to-play-a-wave-file.md).  
  
> [!NOTE]
>  [Среда CLR](http://msdn.microsoft.com/library/059a624e-f7db-4134-ba9f-08b676050482) управляет доступом к системным ресурсам. Вызов неуправляемого кода, который находится вне среды CLR, обходит этот механизм защиты и таким образом представляет угрозу безопасности. Например, неуправляемый код может обращаться к ресурсам в неуправляемом коде напрямую, минуя механизмы обеспечения безопасности среды CLR. Дополнительные сведения см. в разделе [Безопасность .NET Framework](http://go.microsoft.com/fwlink/?LinkId=37122).  
  
## <a name="c-interop"></a>взаимодействие C++  
 Взаимодействие C++, также известное как IJW, можно использовать для создания оболочки для собственного класса C++ для использования в коде, созданном на C# или другом языке .NET Framework. Для этого необходимо написать код C++, создающий оболочку для собственного DLL- или COM-компонента. В отличие от других языков .NET Framework, [!INCLUDE[vcprvc](../../../csharp/programming-guide/interop/includes/vcprvc_md.md)] включает поддержку взаимодействия, что позволяет размещать управляемый и неуправляемый код в одном приложении и даже в одном файле. Затем вы выполняете сборку кода C++ с помощью параметра компилятора **/clr** для создания управляемой сборки. И, наконец, необходимо добавить ссылку на сборку в проекте C# и использовать объекты с оболочкой так же, как другие управляемые классы.  
  
## <a name="exposing-com-components-to-c"></a>Предоставление доступа к COM-компонентам коду C#  
 Вы можете использовать COM-компоненты в проекте C#. Общая процедура следующая.  
  
1.  Найдите нужный COM-компонент и зарегистрируйте его. Используйте regsvr32.exe для регистрации или отмены регистрации библиотеки DLL модели COM.  
  
2.  Добавьте в проект ссылку на COM-компонент или библиотеку типов.  
  
     При добавлении ссылки [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs_md.md)] использует программу [Tlbimp.exe (программа импорта библиотек типов)](http://msdn.microsoft.com/library/ec0a8d63-11b3-4acd-b398-da1e37e97382), принимающую библиотеки типов в качестве входных данных, для вывода сборки взаимодействия .NET Framework. Сборка, также называемая вызываемой оболочкой времени выполнения (RCW), содержит управляемые классы и интерфейсы, которые служат оболочкой для классов и интерфейсов COM в библиотеке типов. [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs_md.md)] добавляет в проект ссылку на созданную сборку.  
  
3.  Создайте экземпляр класса, определенного в вызываемой оболочке времени выполнения. Он, в свою очередь, создает экземпляр COM-объекта.  
  
4.  Используйте объект так же, как другие управляемые объекты. Когда объект удаляется сборщиком мусора, экземпляр COM-объекта также удаляется из памяти.  
  
 Дополнительные сведения см. в статье [Предоставление клиентам .NET Framework доступа к COM-компонентам](http://msdn.microsoft.com/library/e78b14f1-e487-43cd-9c6d-1a07483f1730).  
  
## <a name="exposing-c-to-com"></a>Предоставление C# клиентам COM  
 Клиенты COM могут потреблять типы C#, которые были правильно предоставлены. Ниже приведены основные шаги для предоставления типов C#.  
  
1.  Добавьте атрибуты взаимодействия в проект C#.  
  
     Сборку COM можно сделать видимой, изменив свойства проекта [!INCLUDE[csprcs](../../../csharp/includes/csprcs_md.md)]. Дополнительные сведения см. в разделе [Диалоговое окно "Сведения о сборке"](https://docs.microsoft.com/visualstudio/ide/reference/assembly-information-dialog-box).  
  
2.  Создайте библиотеку типов COM и зарегистрируйте ее для использования моделью COM.  
  
     Можно изменить свойства проекта [!INCLUDE[csprcs](../../../csharp/includes/csprcs_md.md)] для автоматической регистрации сборки C# для COM-взаимодействия. [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs_md.md)] использует программу [Regasm.exe (средство регистрации сборок)](http://msdn.microsoft.com/library/e190e342-36ef-4651-a0b4-0e8c2c0281cb) с помощью параметра командной строки `/tlb`, которая принимает управляемую сборку в качестве входного значения, чтобы создать библиотеку типов. Эта библиотека типов описывает типы `public` в сборке и добавляет записи реестра, чтобы клиенты COM могли создавать управляемые классы.  
  
 Дополнительные сведения см. в разделе [Предоставление COM-клиентам доступа к компонентам .NET Framework](http://msdn.microsoft.com/library/e42a65f7-1e61-411f-b09a-aca1bbce24c6) и [Пример COM-класса](../../../csharp/programming-guide/interop/example-com-class.md).  
  
## <a name="see-also"></a>См. также  
 [Improving Interop Performance](http://go.microsoft.com/fwlink/?LinkId=99564)   
 [Знакомство с COM-взаимодействием](http://go.microsoft.com/fwlink/?LinkId=112406)   
 [Маршалинг данных между управляемым и неуправляемым кодом](http://go.microsoft.com/fwlink/?LinkId=112398)   
 [Взаимодействие с неуправляемым кодом](https://msdn.microsoft.com/library/sd10k43k)   
 [Расширенное COM-взаимодействие](http://msdn.microsoft.com/en-us/3ada36e5-2390-4d70-b490-6ad8de92f2fb)   
 [Руководство по программированию на C#](../../../csharp/programming-guide/index.md)
