---
title: "Группировка потоков в пул (C#) | Документы Майкрософт"
ms.custom: 
ms.date: 2015-07-20
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology:
- devlang-csharp
ms.topic: article
dev_langs:
- CSharp
ms.assetid: 98ae68c1-ace8-44b9-9317-8920ac9ef2b6
caps.latest.revision: 5
author: BillWagner
ms.author: wiwagn
translation.priority.mt:
- cs-cz
- pl-pl
- pt-br
- tr-tr
translationtype: Human Translation
ms.sourcegitcommit: a06bd2a17f1d6c7308fa6337c866c1ca2e7281c0
ms.openlocfilehash: da18d75f5d80cd7ad8a9a974bf0ffda196e7ea86
ms.lasthandoff: 03/13/2017

---
# <a name="thread-pooling-c"></a>Группировка потоков в пул (C#)
*Пул потоков* — это коллекция потоков, которые могут использоваться для выполнения нескольких задач в фоновом режиме. (Базовые сведения см. в разделе [Работа с потоками (C#)](../../../../csharp/programming-guide/concepts/threading/index.md).) Это позволяет разгрузить главный поток для асинхронного выполнения других задач.  
  
 Пулы потоков часто используются в серверных приложениях. Каждый входящий запрос назначается потоку из пула, таким образом запрос может обрабатываться асинхронно без задействования главного потока и задержки обработки последующих запросов.  
  
 Когда поток в пуле завершает выполнение задачи, он возвращается в очередь ожидания, в которой может быть повторно использован. Повторное использование позволяет приложениям избежать дополнительных затрат на создание новых потоков для каждой задачи.  
  
 Обычно пулы имеют максимальное количество потоков. Если все потоки заняты, дополнительные задачи помещаются в очередь, где находятся до тех пор, пока не появятся свободные потоки.  
  
 Можно реализовать собственный пул потоков, но гораздо проще использовать пул потоков, предоставляемых .NET Framework через класс <xref:System.Threading.ThreadPool>.  
  
 Используя группировку потоков в пул, можно вызвать метод <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=fullName> с делегатом для процедуры, которую требуется выполнить, а C# создает поток и выполнит указанную процедуру.  
  
## <a name="thread-pooling-example"></a>Пример группировки потоков в пул  
 В следующем примере показано, как можно использовать группировку потоков в пул для запуска нескольких задач.  
  
```csharp  
public void DoWork()  
{  
    // Queue a task.  
    System.Threading.ThreadPool.QueueUserWorkItem(  
        new System.Threading.WaitCallback(SomeLongTask));  
    // Queue another task.  
    System.Threading.ThreadPool.QueueUserWorkItem(  
        new System.Threading.WaitCallback(AnotherLongTask));  
}  
  
private void SomeLongTask(Object state)  
{  
    // Insert code to perform a long task.  
}  
  
private void AnotherLongTask(Object state)  
{  
    // Insert code to perform a long task.  
}  
```  
  
 Одно из преимуществ группировки потоков заключается в возможности передачи аргументов в процедуру задачи в виде объекта состояния. Если вызываемой процедуре требуется несколько аргументов, можно привести структуру или экземпляр некоторого класса к типу данных `Object`.  
  
## <a name="thread-pool-parameters-and-return-values"></a>Параметры и возвращаемые значения пула потоков  
 Получение возвращаемого значения из пула потоков является не такой простой задачей. Стандартный способ получения возвращаемого значения при вызове функции использовать нельзя, поскольку помещать в очередь на выполнение в пуле потоков можно только процедуры `Sub`. Один из способов обеспечить передачу параметров и возвращения значений — это заключение параметров, возвращаемых значений и методов в класс-оболочку, как описано в разделе [Параметры и возвращаемые значения для многопоточных процедур (C#)](../../../../csharp/programming-guide/concepts/threading/parameters-and-return-values-for-multithreaded-procedures.md).  
  
 Более простым способом передачи параметров и возвращаемых значений является использование необязательной переменной состояния объекта типа `ByVal` метода <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A>. Если эта переменная используется для передачи ссылки на экземпляр класса, члены экземпляра могут быть изменены потоком, входящим в пул потоков, и использоваться в качестве возвращаемых значений.  
  
 На первый взгляд, возможность изменения объекта, на который ссылается переданная по значению переменная, не является очевидной. На самом деле это возможно, потому что по значению передается только ссылка на объект. При изменении членов объекта, указанного в ссылке, изменения применяются к реальному экземпляру класса.  
  
 Структуры, входящие в состав объектов состояния, нельзя использовать для получения возвращаемых значений. Поскольку структуры являются типами, передаваемыми по значению, изменения, вносимые асинхронным процессом, не влияют на члены исходной структуры. Структуры следует использовать для передачи параметров, когда не требуется получать возвращаемые значения.  
  
## <a name="see-also"></a>См. также  
 <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A>   
 <xref:System.Threading>   
 <xref:System.Threading.ThreadPool>   
 [Практическое руководство. Использование пула потоков (C#)](../../../../csharp/programming-guide/concepts/threading/how-to-use-a-thread-pool.md)   
 [Работа с потоками (C#)](../../../../csharp/programming-guide/concepts/threading/index.md)   
 [Многопоточные приложения(C#)](../../../../csharp/programming-guide/concepts/threading/multithreaded-applications.md)   
 [Синхронизация потоков (C#)](../../../../csharp/programming-guide/concepts/threading/thread-synchronization.md)
