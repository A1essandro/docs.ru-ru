---
title: Новые возможности C# 7.1
description: Обзор новых возможностей в C# 7.1.
ms.date: 08/16/2017
ms.openlocfilehash: 00baec45d7582d3ac12c7b0865241f5cd8159246
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
---
# <a name="whats-new-in-c-71"></a>Новые возможности C# 7.1

C# 7.1 — это первая доработанная версия для C#. Это означает, что новые выпуски для этого языка стали выходить чаще. Вы сможете использовать новые возможности раньше. В идеале — как только функция будет готова. В C# 7.1 можно настраивать компилятор в соответствии с указанной версией языка. Это позволяет отделить решение обновить средства от решения обновить версию языка.

В C# 7.1 добавлен элемент конфигурации [выбора версии языка](#language-version-selection), три новые возможности языка и новое поведение компилятора.

Новые языковые функции в этом выпуске

* [`async` метод `Main`](#async-main)
  - Точка входа для приложения может иметь модификатор `async`.
* [Литеральные выражения `default`](#default-literal-expressions)
  - Литеральные выражения по умолчанию можно использовать в выражениях значения по умолчанию, если можно вывести тип целевого объекта.
* [Выводимые имена элементов кортежа](#inferred-tuple-element-names)
  - Имена элементов кортежа часто можно вывести из инициализации кортежа.

Наконец, у компилятора есть два параметра `/refout` и `/refonly`, которые управляют [созданием базовой сборки](#reference-assembly-generation).

## <a name="language-version-selection"></a>Выбор версии языка

Компилятор C# поддерживает C# 7.1 начиная с Visual Studio 2017 версии 15.3 или пакета SDK для .NET Core 2.0. Но компоненты версии 7.1 по умолчанию отключены. Чтобы включить компоненты версии 7.1, необходимо изменить параметр версии языка для проекта.

В Visual Studio щелкните правой кнопкой мыши узел проекта в обозревателе решений и выберите пункт **Свойства**. Откройте вкладку **Сборка** и нажмите на кнопку **Дополнительно**. В раскрывающемся списке выберите **Последняя дополнительная версия C# (последняя)** или конкретную версию **C# 7.1**, как показано ниже. Значение `latest` указывает, что вы хотите использовать последнюю дополнительную версию на текущем компьютере. `C# 7.1` означает, что вы хотите использовать C# 7.1 даже после выпуска новой дополнительной версии.

![Установка версии языка](./media/csharp-7-1/advanced-build-settings.png)

Вы также можете отредактировать CSPROJ-файл и добавить или изменить следующие строки:

```xml
<PropertyGroup>
  <LangVersion>latest</LangVersion>
</PropertyGroup>
```

> [!NOTE]
> Если вы используете интегрированную среду разработки Visual Studio для обновления CSPROJ-файлов, IDE создает отдельные узлы для каждой конфигурации сборки. Как правило, вы устанавливаете одинаковое значение во всех конфигурациях сборки, но необходимо задать его явным образом для каждой конфигурации сборки или выбрать "Все конфигурации" при изменении этого параметра. В CSPROJ-файле вы увидите следующий код:

```xml
<PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|AnyCPU'">
  <LangVersion>latest</LangVersion>
</PropertyGroup>

<PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|AnyCPU'">
  <LangVersion>latest</LangVersion>
</PropertyGroup>
```

Допустимые значения для `LangVersion`:

* `ISO-1`
* `ISO-2`
* `3`
* `4`
* `5`
* `6`
* `7`
* `7.1`
* `default`
* `latest`

В специальных строках `default` и `latest` будет указана соответственно последняя основная и дополнительная версия языка, установленная на компьютере сборки.

Этот параметр разделяет установку новых версий пакета SDK и средств в среде разработки и включение новых возможностей языка в проект. Вы можете установить последнюю версию пакета SDK и средств на компьютер сборки. В каждом проекте можно настроить использование определенной версии языка для сборки.

## <a name="async-main"></a>Async main

Метод *async main* позволяет использовать `await` в методе `Main`.
Раньше пришлось бы написать:

```csharp
static int Main()
{
    return DoAsyncWork().GetAwaiter().GetResult();
}
```

Теперь можно написать:

```csharp
static async Task<int> Main()
{
    // This could also be replaced with the body
    // DoAsyncWork, including its await expressions:
    return await DoAsyncWork();
}
```

Если программа не возвращает код выхода, объявите метод `Main`, возвращающий <xref:System.Threading.Tasks.Task>:

```csharp
static async Task Main()
{
    await SomeAsyncMethod();
}
```

Дополнительные сведения см. в разделе [async main](../programming-guide/main-and-command-args/index.md) в руководстве по программированию.

## <a name="default-literal-expressions"></a>Литеральные выражения по умолчанию

Литеральные выражения по умолчанию — это усовершенствование выражения значения по умолчанию.
Эти выражения инициализируют переменную до значения по умолчанию. Раньше пришлось бы написать:

```csharp
Func<string, bool> whereClause = default(Func<string, bool>);
```

Теперь можно опустить тип с правой стороны инициализации:

```csharp
Func<string, bool> whereClause = default;
```

Дополнительные сведения об этом усовершенствовании см. в разделе о [выражениях значения по умолчанию](../programming-guide/statements-expressions-operators/default-value-expressions.md) в руководстве по программированию на C#.

В этом усовершенствовании также изменены некоторые правила синтаксического анализа для [ключевого слова default](../language-reference/keywords/default.md).

## <a name="inferred-tuple-element-names"></a>Выводимые имена элементов кортежа

Эта возможность улучшает функцию кортежей, представленную в C# 7.0. Очень часто при инициализации кортежа переменные в правой части задания совпадают с именами для элементов кортежа:

```csharp
int count = 5;
string label = "Colors used in the map";
var pair = (count: count, label: label);
```

Имена элементов кортежа можно вывести из переменных, используемых для инициализации кортежа в C# 7.1:

```csharp
int count = 5;
string label = "Colors used in the map";
var pair = (count, label); // element names are "count" and "label"
```

Дополнительные сведения об этой функции см. в разделе [Кортежи](../tuples.md).

## <a name="reference-assembly-generation"></a>Создание базовой сборки

Существует два новых параметра компилятора, которые создают *сборки для справки*: [/refout](../language-reference/compiler-options/refout-compiler-option.md) и [/refonly](../language-reference/compiler-options/refonly-compiler-option.md).
В соответствующих разделах подробно рассматриваются эти параметры и базовые сборки.
