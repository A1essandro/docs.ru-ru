---
title: Кластеризация цветков ириса с помощью задачи машинного обучения по кластеризации — ML.NET
description: Сведения об использовании ML.NET при кластеризации
author: pkulikov
ms.author: johalex
ms.date: 07/02/2018
ms.topic: tutorial
ms.custom: mvc, seodec18
ms.openlocfilehash: 5bd73c774f60466daaf52215c34e7e17b5f5cc9c
ms.sourcegitcommit: ccd8c36b0d74d99291d41aceb14cf98d74dc9d2b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2018
ms.locfileid: "53145637"
---
# <a name="tutorial-cluster-iris-flowers-using-a-clustering-learner-with-mlnet"></a>Кластеризация цветков ириса с помощью задачи машинного обучения по кластеризации в ML.NET

> [!NOTE]
> В этом разделе описано, как использовать платформу ML.NET, которая сейчас доступна в режиме предварительной версии. Этот материал может быть изменен. Дополнительные сведения см. в [обзоре ML.NET](https://www.microsoft.com/net/learn/apps/machine-learning-and-ai/ml-dotnet).

В этом руководстве описано, как с помощью ML.NET создать [модель кластеризации](../resources/tasks.md#clustering) для [набора данных ирисов](https://en.wikipedia.org/wiki/Iris_flower_data_set).

В этом руководстве вы узнаете, как:
> [!div class="checklist"]
> - Определение проблемы
> - Выбор подходящей задачи машинного обучения
> - Подготовка данных
> - Загрузка и преобразование данных
> - Выбор алгоритма обучения
> - Обучение модели
> - Использование модели для прогнозирования

## <a name="prerequisites"></a>Предварительные требования

- [Visual Studio 2017 15.6 или более поздней версии](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017) с установленной рабочей нагрузкой "Кроссплатформенная разработка .NET Core".

## <a name="understand-the-problem"></a>Определение проблемы

Задача — разделить ирисы на группы в зависимости от признаков цветка. Эти признаки — длина и ширина чашелистика и длина и ширина лепестка. В этом руководстве предполагается, что тип каждого цветка неизвестен. Вы научитесь структурировать набор данных по признакам и предсказывать, как экземпляр данных будет вписываться в эту структуру.

## <a name="select-the-appropriate-machine-learning-task"></a>Выбор подходящей задачи машинного обучения

Поскольку вы не знаете, к какой группе принадлежит каждый цветок, вы выбираете задачу [неконтролируемого машинного обучения](../resources/glossary.md#unsupervised-machine-learning). Чтобы разделить набор данных на группы таким образом, чтобы элементы одной группы больше походили друг на друга, чем на элементы из других групп, используйте задачу машинного обучения по [кластеризации](../resources/tasks.md#clustering).

## <a name="create-a-console-application"></a>Создание консольного приложения

1. Откройте Visual Studio 2017. Выберите **Файл** > **Создать** > **Проект** в меню. В диалоговом окне **Новый проект** выберите узел **Visual C#**, а затем — узел **.NET Core**. Выберите шаблон проекта **Консольное приложение (.NET Core)**. В текстовом поле **Имя** введите "IrisClustering", а затем нажмите кнопку **OK**.

1. Создайте каталог с именем *Data* в папке проекта, чтобы хранить в нем наборы данных и файлы модели:

    В **обозревателе решений** щелкните проект правой кнопкой мыши и выберите **Добавить** > **Новая папка**. Введите имя папки Data и нажмите клавишу "ВВОД".

1. Установите пакет NuGet для **Microsoft.ML**:

    В **обозревателе решений** щелкните проект правой кнопкой мыши и выберите **Управление пакетами NuGet**. Выберите nuget.org в качестве источника пакетов, перейдите на вкладку **Обзор**, выполните поиск по фразе **Microsoft.ML**, выберите из списка этот пакет и нажмите кнопку **Установить**. Нажмите кнопку **ОК** в диалоговом окне **Предварительный просмотр изменений**, а затем нажмите кнопку **Принимаю** в диалоговом окне **Принятие условий лицензионного соглашения**, если вы согласны с указанными условиями лицензионного соглашения для выбранных пакетов.

## <a name="prepare-the-data"></a>Подготовка данных

1. Скачайте набор данных [iris.data](https://github.com/dotnet/machinelearning/blob/master/test/data/iris.data) и сохраните его в папке *Data*, созданной на предыдущем шаге. Дополнительные сведения о наборе данных ирисов см. на странице Википедии [Ирисы Фишера](https://en.wikipedia.org/wiki/Iris_flower_data_set) и на странице [Набор данных ирисов](http://archive.ics.uci.edu/ml/datasets/Iris), который является источником набора данных.

1. В **Обозревателе решений** щелкните правой кнопкой мыши файл *iris.data* и выберите **Свойства**. В разделе **Дополнительно** для параметра **Копировать в выходной каталог** установите значение **Копировать более позднюю версию**.

Файл *Iris.data* содержит пять столбцов со следующими данными:

- длина чашелистика в см;
- ширина чашелистика в см;
- длина лепестка в см;
- ширина лепестка в см;
- тип ириса.

В этом примере кластеризации мы не будем учитывать последний столбец.

## <a name="create-data-classes"></a>Создание классов данных

Создайте классы для входных данных и прогнозов:

1. В **обозревателе решений** щелкните проект правой кнопкой мыши и выберите пункты **Добавить** > **Новый элемент**.
1. В диалоговом окне **Добавление нового элемента** выберите **Класс** и измените значение поля **Имя** на *IrisData.cs*. Теперь нажмите кнопку **Добавить**.
1. Добавьте следующую директиву `using` в новый файл:

   [!code-csharp[Add necessary usings](../../../samples/machine-learning/tutorials/IrisClustering/IrisData.cs#1)]

Удалите из файла *IrisData.cs* существующее определение класса и добавьте следующий код, который определяет классы `IrisData` и `ClusterPrediction`:

[!code-csharp[Define data classes](../../../samples/machine-learning/tutorials/IrisClustering/IrisData.cs#2)]

Класс `IrisData` содержит входные данные и определения для каждого признака в наборе данных. Используйте атрибут [Column](xref:Microsoft.ML.Runtime.Api.ColumnAttribute), чтобы указать индексы исходных столбцов в файле набора данных.

Класс `ClusterPrediction` представляет выходные данные модели кластеризации, примененные к экземпляру `IrisData`. Используйте атрибут [ColumnName](xref:Microsoft.ML.Runtime.Api.ColumnNameAttribute), чтобы привязать поля `PredictedClusterId` и `Distances` к столбцам **PredictedLabel** и **Score** соответственно. В случае задачи кластеризации эти столбцы означают следующее:

- Столбец **PredictedLabel** содержит идентификатор прогнозируемого кластера.
- Столбец **Score** содержит массив с квадратом Евклидовых расстояний до центроидов кластера. Длина массива равна числу кластеров.

> [!NOTE]
> Используйте тип `float` для представления значений с плавающей запятой в классах данных ввода и прогнозирования.

## <a name="define-data-and-model-paths"></a>Определение путей к данным и модели

Вернитесь к файлу *Program.cs* и добавьте два поля, которые будут содержать пути к файлу с наборами данных и к файлу для сохранения модели.

- `_dataPath` содержит путь к файлу с набором данных, используемым для обучения модели.
- `_modelPath` содержит путь к файлу для сохранения обучаемой модели.

Добавьте прямо перед методом `Main` следующий код, чтобы указать эти пути.

[!code-csharp[Initialize paths](../../../samples/machine-learning/tutorials/IrisClustering/Program.cs#1)]

Чтобы этот код компилировался, добавьте следующие директивы `using` вверху файла *Program.cs*.

[!code-csharp[Add usings for paths](../../../samples/machine-learning/tutorials/IrisClustering/Program.cs#2)]

## <a name="create-a-learning-pipeline"></a>Создание конвейера обучения

Добавьте дополнительные директивы `using` в начало файла *Program.cs*.

[!code-csharp[Add Microsoft.ML usings](../../../samples/machine-learning/tutorials/IrisClustering/Program.cs#3)]

В методе `Main` замените `Console.WriteLine("Hello World!")` следующим кодом:

[!code-csharp[Call the Train method](../../../samples/machine-learning/tutorials/IrisClustering/Program.cs#4)]

Метод `Train` обучает модель. Создайте этот метод сразу под методом `Main`, используя следующий код:

```csharp
private static PredictionModel<IrisData, ClusterPrediction> Train()
{

}
```

Конвейер обучения загружает все данные и алгоритмы, необходимые для обучения модели. Добавьте в метод `Train` следующий код:

[!code-csharp[Initialize pipeline](../../../samples/machine-learning/tutorials/IrisClustering/Program.cs#5)]

## <a name="load-and-transform-data"></a>Загрузка и преобразование данных

Сначала нужно загрузить набор данных для обучения. В нашем случае набор данных для обучения хранится в текстовом файле, путь к которому задан в поле `_dataPath`. Для разделения столбцов в этом файле используется запятая (","). Добавьте в метод `Train` следующий код:

[!code-csharp[Add step to load data](../../../samples/machine-learning/tutorials/IrisClustering/Program.cs#6)]

Следующий шаг — объединить все столбцы признаков в столбце **Features** с помощью класса преобразования <xref:Microsoft.ML.Legacy.Transforms.ColumnConcatenator>. По умолчанию алгоритм обучения обрабатывает только признаки, представленные в столбце **Features**. Добавьте следующий код:

[!code-csharp[Add step to concatenate columns](../../../samples/machine-learning/tutorials/IrisClustering/Program.cs#7)]

## <a name="choose-a-learning-algorithm"></a>Выбор алгоритма обучения

После добавления данных в конвейер и их преобразования в правильный входной формат выберите алгоритм обучения (**средство обучения**). Алгоритм обучения осуществляет обучение модели. ML.NET предоставляет средство обучения <xref:Microsoft.ML.Legacy.Trainers.KMeansPlusPlusClusterer>, которое реализует [алгоритм k-средних](https://en.wikipedia.org/wiki/K-means_clustering) с улучшенным методом для выбора начальных центроидов кластера.

Добавьте следующий код в метод `Train` после кода обработки данных, который вы добавили на предыдущем шаге:

[!code-csharp[Add a learner step](../../../samples/machine-learning/tutorials/IrisClustering/Program.cs#8)]

Используйте свойство <xref:Microsoft.ML.Legacy.Trainers.KMeansPlusPlusClusterer.K?displayProperty=nameWithType>, чтобы указать число кластеров. В приведенном выше коде указано, что набор данных нужно разделить на три кластера.

## <a name="train-the-model"></a>Обучение модели

Выполнив действия в предыдущих разделах, вы подготовили конвейер для обучения, но пока ничего не было сделано. Метод `pipeline.Train<TInput, TOutput>` создает модель, которая принимает экземпляр типа `TInput` и возвращает экземпляр типа `TOutput`. Добавьте в метод `Train` следующий код:

[!code-csharp[Train the model and return](../../../samples/machine-learning/tutorials/IrisClustering/Program.cs#9)]

### <a name="save-the-model"></a>Сохранение модели

На этом этапе у вас есть модель, которую можно интегрировать с любыми существующими или новыми приложениями .NET. Чтобы сохранить модель в ZIP-файл, добавьте следующий код в метод `Main` под вызовом метода `Train`:

[!code-csharp[Save the model](../../../samples/machine-learning/tutorials/IrisClustering/Program.cs#10)]

Использование `await` в методе `Main` означает, что метод `Main` должен включать модификатор `async` и возвращать `Task`:

[!code-csharp[Make the Main method async](../../../samples/machine-learning/tutorials/IrisClustering/Program.cs#11)]

Также добавьте следующую директиву `using` в самое начало файла *Program.cs*:

[!code-csharp[Add System.Threading.Tasks using](../../../samples/machine-learning/tutorials/IrisClustering/Program.cs#12)]

Так как метод `async Main` реализован только в C# версии 7.1, а для этого проекта по умолчанию устанавливается версия языка C# 7.0, необходимо изменить версию до C# 7.1 или выше. Для этого в **обозревателе решений** щелкните узел проекта правой кнопкой мыши и выберите пункт **Свойства**. Откройте вкладку **Сборка** и нажмите на кнопку **Дополнительно**. В раскрывающемся списке выберите **C# 7.1** (или более позднюю версию). Нажмите кнопку **OK**.

## <a name="use-the-model-for-predictions"></a>Использование модели для прогнозирования

Создание класса `TestIrisData` для размещения тестовых экземпляров данных:

1. В **обозревателе решений** щелкните проект правой кнопкой мыши и выберите пункты **Добавить** > **Новый элемент**.
1. В диалоговом окне **Добавление нового элемента** выберите **Класс** и измените значение поля **Имя** на *TestIrisData.cs*. Теперь нажмите кнопку **Добавить**.
1. Измените класс, чтобы он был статическим, как показано в следующем примере:

   [!code-csharp[Make class static](../../../samples/machine-learning/tutorials/IrisClustering/TestIrisData.cs#1)]

В этом руководстве представлен один экземпляр данных ирисов в этом классе. Вы можете добавить другие сценарии и поэкспериментировать с этой моделью. Добавьте в класс `TestIrisData` следующий код:

[!code-csharp[Test data](../../../samples/machine-learning/tutorials/IrisClustering/TestIrisData.cs#2)]

Чтобы узнать, к какому кластеру принадлежит указанный элемент, вернитесь к файлу *Program.cs* и добавьте следующий код в метод `Main`:

[!code-csharp[Predict and output results](../../../samples/machine-learning/tutorials/IrisClustering/Program.cs#13)]

Запустите программу, чтобы узнать, какой кластер содержит указанный экземпляр данных и квадрат расстояния от этого экземпляра до центроидов кластера. Результаты выполнения должны выглядеть примерно так, как показано ниже. Во время обработки конвейер может вывести предупреждения или сообщения об обработке. Для удобства они удалены из следующих выходных данных.

```text
Cluster: 2
Distances: 0.4192338 0.0008847713 0.9660053
```

Поздравляем! Вы успешно создали модель машинного обучения для кластеризации ирисов и использовали ее для прогнозирования. Исходный код для этого руководства можно найти в репозитории GitHub [dotnet/samples](https://github.com/dotnet/samples/tree/master/machine-learning/tutorials/IrisClustering).

## <a name="next-steps"></a>Следующие шаги

В этом руководстве вы узнали, как:
> [!div class="checklist"]
> - Определение проблемы
> - Выбор подходящей задачи машинного обучения
> - Подготовка данных
> - Загрузка и преобразование данных
> - Выбор алгоритма обучения
> - Обучение модели
> - Использование модели для прогнозирования

Извлеките наш репозиторий GitHub, чтобы продолжить обучение и получить дополнительные примеры.
> [!div class="nextstepaction"]
> [Репозиторий GitHub dotnet/machinelearning](https://github.com/dotnet/machinelearning/)
