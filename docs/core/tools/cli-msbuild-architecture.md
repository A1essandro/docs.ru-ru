---
title: "Архитектура программ командной строки .NET Core"
description: "Дополнительные сведения об уровнях средств .NET Core, а также об изменениях в последних версиях."
keywords: ".NET Core, MSBuild, архитектура"
author: blackdwarf
ms.date: 03/06/2017
ms.topic: article
ms.prod: .net-core
ms.technology: dotnet-cli
ms.devlang: dotnet
ms.assetid: 7fff0f61-ac23-42f0-9661-72a7240a4456
ms.openlocfilehash: ad34faa0c2577bd5e3a0ba339b19a9ad387e015a
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="high-level-overview-of-changes-in-the-net-core-tools"></a><span data-ttu-id="7e94a-104">Краткий обзор изменений в средствах .NET Core</span><span class="sxs-lookup"><span data-stu-id="7e94a-104">High-level overview of changes in the .NET Core tools</span></span>

<span data-ttu-id="7e94a-105">В этом документе описываются изменения, связанные с переходом от использования *project.json* к MSBuild и системе проектов *csproj*, а также содержатся сведения об изменении расположения средств .NET Core и реализации команд интерфейса командной строки.</span><span class="sxs-lookup"><span data-stu-id="7e94a-105">This document describes the changes associated with moving from *project.json* to MSBuild and the *csproj* project system with information on the changes to the layering of the .NET Core tooling and the implementation of the CLI commands.</span></span> <span data-ttu-id="7e94a-106">Эти изменения появились в выпуске SDK для .NET Core версии 1.0 и Visual Studio 2017, который увидел свет 7 марта 2017 г. (см. [объявление](https://blogs.msdn.microsoft.com/dotnet/2017/03/07/announcing-net-core-tools-1-0/)), но изначально были реализованы в выпуске предварительной версии 3 пакета SDK для .NET Core.</span><span class="sxs-lookup"><span data-stu-id="7e94a-106">These changes occurred with the release of .NET Core SDK 1.0 and Visual Studio 2017 on March 7, 2017 (see the [announcement](https://blogs.msdn.microsoft.com/dotnet/2017/03/07/announcing-net-core-tools-1-0/)) but were initially implemented with the release of the .NET Core SDK Preview 3.</span></span>

## <a name="moving-away-from-projectjson"></a><span data-ttu-id="7e94a-107">Переход с использования project.json</span><span class="sxs-lookup"><span data-stu-id="7e94a-107">Moving away from project.json</span></span>
<span data-ttu-id="7e94a-108">Самое значительное изменение в средствах .NET Core — [переход от project.json к CSPROJ-файлу](https://blogs.msdn.microsoft.com/dotnet/2016/05/23/changes-to-project-json/) в качестве системы проектов.</span><span class="sxs-lookup"><span data-stu-id="7e94a-108">The biggest change in the tooling for .NET Core is certainly the [move away from project.json to csproj](https://blogs.msdn.microsoft.com/dotnet/2016/05/23/changes-to-project-json/) as the project system.</span></span> <span data-ttu-id="7e94a-109">Последние версии средств командной строки не поддерживают файлы *project.json*.</span><span class="sxs-lookup"><span data-stu-id="7e94a-109">The latest versions of the command-line tools don't support *project.json* files.</span></span> <span data-ttu-id="7e94a-110">Это означает, что эти средства нельзя использовать для сборки, выполнения или публикации приложений и библиотек на основе project.json.</span><span class="sxs-lookup"><span data-stu-id="7e94a-110">That means that it cannot be used to build, run or publish project.json based applications and libraries.</span></span> <span data-ttu-id="7e94a-111">Чтобы использовать эту версию средств, необходимо переместить имеющиеся проекты или создать новые.</span><span class="sxs-lookup"><span data-stu-id="7e94a-111">In order to use this version of the tools, you will need to migrate your existing projects or start new ones.</span></span> 

<span data-ttu-id="7e94a-112">В рамках этого перемещения настраиваемый обработчик сборки, разработанная для сборки проектов project.json, заменена на полнофункциональный модуль [MSBuild](https://github.com/Microsoft/msbuild).</span><span class="sxs-lookup"><span data-stu-id="7e94a-112">As part of this move, the custom build engine that was developed to build project.json projects was replaced with a mature and fully capable build engine called [MSBuild](https://github.com/Microsoft/msbuild).</span></span> <span data-ttu-id="7e94a-113">Это хорошо известный модуль в сообществе .NET, так как это основная технология с момента первого выпуска платформы.</span><span class="sxs-lookup"><span data-stu-id="7e94a-113">MSBuild is a well-known engine in the .NET community, since it has been a key technology since the platform's first release.</span></span> <span data-ttu-id="7e94a-114">Чтобы этот модуль можно было использовать для сборки приложений .NET Core, MSBuild был перенесен на .NET Core, и теперь его можно использовать на любой платформе, где работает .NET Core.</span><span class="sxs-lookup"><span data-stu-id="7e94a-114">Of course, because it needs to build .NET Core applications, MSBuild has been ported to .NET Core and can be used on any platform that .NET Core runs on.</span></span> <span data-ttu-id="7e94a-115">Мы стремимся превратить .NET Core в кроссплатформенную среду разработки. Этот переход никак не повлияет на работу в этом направлении.</span><span class="sxs-lookup"><span data-stu-id="7e94a-115">One of the main promises of .NET Core is that of a cross-platform development stack, and we have made sure that this move does not break that promise.</span></span>

> [!NOTE]
> <span data-ttu-id="7e94a-116">Если вы только начинаете использовать MSBuild, советуем сначала ознакомиться со статьей [Основные возможности MSBuild](/visualstudio/msbuild/msbuild-concepts).</span><span class="sxs-lookup"><span data-stu-id="7e94a-116">If you are new to MSBuild and would like to learn more about it, you can start by reading the [MSBuild Concepts](/visualstudio/msbuild/msbuild-concepts) article.</span></span> 

## <a name="the-tooling-layers"></a><span data-ttu-id="7e94a-117">Многоуровневая архитектура средств</span><span class="sxs-lookup"><span data-stu-id="7e94a-117">The tooling layers</span></span>
<span data-ttu-id="7e94a-118">В связи с переходом на другую систему проектов и заменой модуля сборки возникает естественный вопрос — повлияют ли какие-либо из этих изменений на общую архитектуру всей экосистемы средств .NET Core?</span><span class="sxs-lookup"><span data-stu-id="7e94a-118">With the move away from the existing project system as well as with building engine switches, the question that naturally follows is do any of these changes change the overall "layering" of the whole .NET Core tooling ecosystem?</span></span> <span data-ttu-id="7e94a-119">Появились ли новые двоичные файлы и компоненты?</span><span class="sxs-lookup"><span data-stu-id="7e94a-119">Are there new bits and components?</span></span>

<span data-ttu-id="7e94a-120">Сначала рассмотрим схему размещения средств по уровням в предварительной версии 2.</span><span class="sxs-lookup"><span data-stu-id="7e94a-120">Let's start with a quick refresher on Preview 2 layering as shown in the following picture:</span></span>

![Высокоуровневая архитектура средств предварительной версии 2](media/cli-msbuild-architecture/p2-arch.png)

<span data-ttu-id="7e94a-122">Расположение средств довольно простое.</span><span class="sxs-lookup"><span data-stu-id="7e94a-122">The layering of the tools is quite simple.</span></span> <span data-ttu-id="7e94a-123">Внизу как основа расположены средства командной строки .NET Core.</span><span class="sxs-lookup"><span data-stu-id="7e94a-123">At the bottom we have the .NET Core Command Line tools as a foundation.</span></span> <span data-ttu-id="7e94a-124">Все другие средства более высокого уровня, например Visual Studio и Visual Studio Code, зависят от интерфейса командной строки для выполнения таких операций, как сборка проектов, восстановление зависимостей и т. д.</span><span class="sxs-lookup"><span data-stu-id="7e94a-124">All other, higher-level tools such as Visual Studio or Visual Studio Code, depend and rely on the CLI to build projects, restore dependencies and so on.</span></span> <span data-ttu-id="7e94a-125">Это означает, например, если Visual Studio необходимо выполнить операцию восстановления, он будет вызван в `dotnet restore` ([см. Примечание](#dotnet-restore-note)) в CLI.</span><span class="sxs-lookup"><span data-stu-id="7e94a-125">This meant that, for example, if Visual Studio wanted to perform a restore operation, it would call into `dotnet restore` ([see note](#dotnet-restore-note)) command in the CLI.</span></span> 

<span data-ttu-id="7e94a-126">В связи с переходом на новую систему проектов предыдущая схема изменилась.</span><span class="sxs-lookup"><span data-stu-id="7e94a-126">With the move to the new project system, the previous diagram changes:</span></span> 

![Высокоуровневая архитектура пакета SDK для .NET Core 1.0.0](media/cli-msbuild-architecture/p3-arch.png)

<span data-ttu-id="7e94a-128">Основное различие заключается в том, что интерфейс командной строки больше не является основным уровнем. Теперь эту роль выполняет общий компонент SDK.</span><span class="sxs-lookup"><span data-stu-id="7e94a-128">The main difference is that the CLI is not the foundational layer anymore; this role is now filled by the "shared SDK component".</span></span> <span data-ttu-id="7e94a-129">Это — набор целевых объектов и связанных задач, которые отвечают за компиляцию и публикацию кода, а также за его упаковку в пакеты NuGet и т. д. Сам пакет SDK с открытым исходным кодом доступен на сайте GitHub в [репозитории SDK](https://github.com/dotnet/sdk).</span><span class="sxs-lookup"><span data-stu-id="7e94a-129">This shared SDK component is a set of targets and associated tasks that are responsible for compiling your code, publishing it, packing NuGet packages etc. The SDK itself is open-source and is available on GitHub on the [SDK repo](https://github.com/dotnet/sdk).</span></span> 

> [!NOTE]
> <span data-ttu-id="7e94a-130">Целевой объект — это термин MSBuild, обозначающий именованную операцию, которую может вызвать MSBuild.</span><span class="sxs-lookup"><span data-stu-id="7e94a-130">A "target" is a MSBuild term that indicates a named operation that MSBuild can invoke.</span></span> <span data-ttu-id="7e94a-131">Обычно она связана с одной или несколькими задачами, выполняющими определенную логику, которую должен реализовать целевой объект.</span><span class="sxs-lookup"><span data-stu-id="7e94a-131">It is usually coupled with one or more tasks that execute some logic that the target is supposed to do.</span></span> <span data-ttu-id="7e94a-132">MSBuild поддерживает множество готовых целевых объектов, таких как `Copy` или `Execute`. Благодаря этому пользователи могут создавать собственные задачи с помощью управляемого кода и определять целевые объекты для их выполнения.</span><span class="sxs-lookup"><span data-stu-id="7e94a-132">MSBuild supports many ready-made targets such as `Copy` or `Execute`; it also allows users to write their own tasks using managed code and define targets to execute those tasks.</span></span> <span data-ttu-id="7e94a-133">Дополнительную информацию см. в статье [Задачи MSBuild](/visualstudio/msbuild/msbuild-tasks).</span><span class="sxs-lookup"><span data-stu-id="7e94a-133">For more information, see [MSBuild tasks](/visualstudio/msbuild/msbuild-tasks).</span></span> 

<span data-ttu-id="7e94a-134">Все наборы инструментов теперь используют общий компонент SDK и его целевые объекты, в том числе интерфейс командной строки.</span><span class="sxs-lookup"><span data-stu-id="7e94a-134">All the toolsets now consume the shared SDK component and its targets, CLI included.</span></span> <span data-ttu-id="7e94a-135">Например, следующей версии Visual Studio не будет вызывать в `dotnet restore` ([см. Примечание](#dotnet-restore-note)) для восстановления зависимостей для проектов .NET Core, он будет использовать целевой объект «Restore» непосредственно.</span><span class="sxs-lookup"><span data-stu-id="7e94a-135">For example, the next version of Visual Studio will not call into `dotnet restore` ([see note](#dotnet-restore-note)) command to restore dependencies for .NET Core projects, it will use the "Restore" target directly.</span></span> <span data-ttu-id="7e94a-136">Так как это целевые объекты MSBuild, их можно выполнить с помощью команды [dotnet msbuild](dotnet-msbuild.md) в самом модуле MSBuild.</span><span class="sxs-lookup"><span data-stu-id="7e94a-136">Since these are MSBuild targets, you can also use raw MSBuild to execute them using the [dotnet msbuild](dotnet-msbuild.md) command.</span></span> 

### <a name="cli-commands"></a><span data-ttu-id="7e94a-137">Команды CLI</span><span class="sxs-lookup"><span data-stu-id="7e94a-137">CLI commands</span></span>
<span data-ttu-id="7e94a-138">Введение общего компонента SDK означает, что большинство существующих команд интерфейса командной строки были заново реализованы как целевые объекты и задачи MSBuild.</span><span class="sxs-lookup"><span data-stu-id="7e94a-138">The shared SDK component means that the majority of existing CLI commands have been re-implemented as MSBuild tasks and targets.</span></span> <span data-ttu-id="7e94a-139">Как это повлияло на команды интерфейса командной строки и использование набора инструментов?</span><span class="sxs-lookup"><span data-stu-id="7e94a-139">What does this mean for the CLI commands and your usage of the toolset?</span></span> 

<span data-ttu-id="7e94a-140">Это не влияет на использование интерфейса командной строки.</span><span class="sxs-lookup"><span data-stu-id="7e94a-140">From an usage perspective, it doesn't change the way you use the CLI.</span></span> <span data-ttu-id="7e94a-141">Он по-прежнему содержит основные команды, существующие в предварительной версии 2:</span><span class="sxs-lookup"><span data-stu-id="7e94a-141">The CLI still has the core commands that exist in Preview 2 release:</span></span>

* `new`
* `restore`
* `run` 
* `build`
* `publish`
* `test`
* `pack` 

<span data-ttu-id="7e94a-142">Эти команды по-прежнему выполняют ожидаемые функции (создание, сборка, публикация, упаковка проекта и т. д.).</span><span class="sxs-lookup"><span data-stu-id="7e94a-142">These commands still do what you expect them to do (new up a project, build it, publish it, pack it and so on).</span></span> <span data-ttu-id="7e94a-143">Большинство параметров не изменились и по-прежнему существуют. Чтобы ознакомиться с изменениями, обратитесь к тексту справки по командам (при помощи `dotnet <command> --help`) или документации на этом сайте.</span><span class="sxs-lookup"><span data-stu-id="7e94a-143">Majority of the options are not changed, and are still there, and you can consult either the commands' help screens (using `dotnet <command> --help`) or documentation on this site to get familiar with any changes.</span></span> 

<span data-ttu-id="7e94a-144">Команды интерфейса командной строки с точки зрения выполнения принимают параметры и отправляют вызов к самому модулю MSBuild, который задает необходимые свойства и запускает нужный целевой объект.</span><span class="sxs-lookup"><span data-stu-id="7e94a-144">From an execution perspective, the CLI commands will take their parameters and construct a call to "raw" MSBuild that will set the needed properties and run the desired target.</span></span> <span data-ttu-id="7e94a-145">Чтобы лучше проиллюстрировать это, рассмотрим следующую команду:</span><span class="sxs-lookup"><span data-stu-id="7e94a-145">To better illustrate this, consider the following command:</span></span> 

   `dotnet publish -o pub -c Release`
    
<span data-ttu-id="7e94a-146">Эта команда публикует приложение в папку `pub` с помощью конфигурации Release.</span><span class="sxs-lookup"><span data-stu-id="7e94a-146">This command is publishing an application into a `pub` folder using the "Release" configuration.</span></span> <span data-ttu-id="7e94a-147">На внутреннем уровне эта команда преобразовывается в следующий вызов MSBuild:</span><span class="sxs-lookup"><span data-stu-id="7e94a-147">Internally, this command gets translated into the following MSBuild invocation:</span></span> 

   `dotnet msbuild /t:Publish /p:OutputPath=pub /p:Configuration=Release`

<span data-ttu-id="7e94a-148">Важным исключением из этого правила являются команды `new` и `run`, так как они были реализованы в качестве целевых объектов MSBuild.</span><span class="sxs-lookup"><span data-stu-id="7e94a-148">The notable exception to this rule are `new` and `run` commands, as they have not been implemented as MSBuild targets.</span></span>

<span data-ttu-id="7e94a-149"><a name="dotnet-restore-note"></a> [!INCLUDE[DotNet Restore Note](~/includes/dotnet-restore-note.md)]</span><span class="sxs-lookup"><span data-stu-id="7e94a-149"><a name="dotnet-restore-note"></a> [!INCLUDE[DotNet Restore Note](~/includes/dotnet-restore-note.md)]</span></span>