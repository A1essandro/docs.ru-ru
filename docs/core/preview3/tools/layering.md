---
title: "Архитектура предварительной версии 4 программ командной строки .NET Core | Microsoft Docs"
description: "Предварительная версия 4 привносит некоторые изменения в общую архитектуру инструментов .NET Core."
keywords: "CLI, расширяемость, пользовательские команды, .NET Core"
author: blackdwarf
ms.date: 11/12/2016
ms.topic: article
ms.prod: .net-core
ms.technology: dotnet-cli
ms.devlang: dotnet
ms.assetid: 7fff0f61-ac23-42f0-9661-72a7240a4456
translationtype: Human Translation
ms.sourcegitcommit: 2ad428dcda9ef213a8487c35a48b33929259abba
ms.openlocfilehash: 261af1368f9966d8f485ab9ba252f15da31e05b2

---

# <a name="high-level-overview-of-changes-in-cli-preview-4"></a>Краткий обзор изменений в предварительной версии 4 программ с интерфейсом командной строки

[!INCLUDE[preview-warning](../../../includes/warning.md)]

Здесь приведены общие сведения об изменениях, которые возникают при переходе с системы проектов `project.json` на MSBuild и `csproj`. Вы узнаете о новой архитектуре средств, новых компонентах и об их месте в общей картине. Прочитав эту статью, вы будете иметь хорошее представление обо всех компонентах, составляющих инструментарий .NET Core после перехода на MSBuild и `csproj`. 

## <a name="moving-away-from-projectjson"></a>Переход с использования project.json
Самое значительное изменение в инструментах .NET Core в предварительной версии 4 — конечно же, [использование CSPROJ-файла, а не project.json](https://blogs.msdn.microsoft.com/dotnet/2016/05/23/changes-to-project-json/) в качестве системы проектов. В предварительной версии 4 программ командной строки .NET Core впервые не реализована поддержка project.json. Это означает, что эти средства нельзя использовать для сборки, выполнения или публикации приложений и библиотек на основе project.json. Чтобы использовать эту версию средств, необходимо переместить имеющиеся проекты или создать новые. 

В рамках этого перемещения настраиваемый обработчик сборки, разработанная для сборки проектов project.json, заменена на полнофункциональный модуль [MSBuild](https://github.com/Microsoft/msbuild). Это хорошо известный модуль в сообществе .NET, так как это основная технология с момента первого выпуска платформы. Чтобы этот модуль можно было использовать для сборки приложений .NET Core, MSBuild был перенесен на .NET Core, и теперь его можно использовать на любой платформе, где работает .NET Core. Мы стремимся превратить .NET Core в кроссплатформенную среду разработки. Этот переход никак не повлияет на работу в этом направлении.

> [!NOTE]
> Если вы только начинаете использовать MSBuild, советуем сначала ознакомиться со статьей [Основные возможности MSBuild](https://docs.microsoft.com/visualstudio/msbuild/msbuild-concepts). 

## <a name="the-tooling-layers"></a>Многоуровневая архитектура средств
В связи с переходом на другую систему проектов и заменой модуля сборки возникает естественный вопрос — повлияют ли какие-либо из этих изменений на общую архитектуру всей экосистемы средств .NET Core? Появились ли новые двоичные файлы и компоненты?

Сначала рассмотрим схему размещения средств по уровням в предварительной версии 2.

![Высокоуровневая архитектура средств предварительной версии 2](media/p2-arch.png)

Расположение средств довольно простое. Внизу как основа расположены средства командной строки .NET Core. Все другие средства более высокого уровня, например Visual Studio и VS Code, зависят от интерфейса командной строки для выполнения таких операций, как сборка проектов, восстановление зависимостей и т. д. Это означает, что, к примеру, для выполнения операции восстановления в Visual Studio требовалось вызвать команду `dotnet restore` в интерфейсе командной строки. 

В связи с переходом на новую систему проектов предыдущая схема изменилась. 

![Обзор архитектуры предварительной версии 4 инструментов](media/p3-arch.png)

Основное различие заключается в том, что интерфейс командной строки больше не является основным уровнем. Теперь эту роль выполняет общий компонент SDK. Это — набор целевых объектов и связанных задач, которые отвечают за компиляцию и публикацию кода, а также за его упаковку в пакеты NuGet и т. д. Сам пакет SDK с открытым исходным кодом доступен на сайте GitHub в [репозитории SDK](https://github.com/dotnet/sdk). 

> [!NOTE]
> Целевой объект — это термин MSBuild, обозначающий именованную операцию, которую может вызвать MSBuild. Обычно она связана с одной или несколькими задачами, выполняющими определенную логику, которую должен реализовать целевой объект. MSBuild поддерживает множество готовых целевых объектов, таких как `Copy` или `Execute`. Благодаря этому пользователи могут создавать собственные задачи с помощью управляемого кода и определять целевые объекты для их выполнения. Дополнительную информацию см. в статье [Задачи MSBuild](https://docs.microsoft.com/visualstudio/msbuild/msbuild-tasks). 

Все наборы инструментов теперь используют общий компонент SDK и его целевые объекты, в том числе интерфейс командной строки. Например, в следующей версии для восстановления зависимостей для проектов .NET Core Visual Studio не будет вызывать команду `dotnet restore`. Вместо этого будет напрямую использоваться операция восстановления. Так как это целевые объекты MSBuild, их можно выполнить с помощью команды [dotnet msbuild](dotnet-msbuild.md) в самом модуле MSBuild. 

### <a name="preview-4-cli-commands"></a>Команды предварительной версии 4 интерфейса командной строки
Введение общего компонента SDK означает, что большинство существующих команд интерфейса командной строки были заново реализованы как целевые объекты и задачи MSBuild. Как это повлияло на команды интерфейса командной строки и использование набора инструментов? 

Это не влияет на использование интерфейса командной строки. Он по-прежнему содержит основные команды, существующие в предварительной версии 2:

* `new`
* `restore`
* `run` 
* `build`
* `publish`
* `test`
* `pack` 

Эти команды по-прежнему выполняют ожидаемые функции (создание, сборка, публикация, упаковка проекта и т. д.). Большинство параметров не изменились и по-прежнему существуют. Чтобы ознакомиться с изменениями, можно обратиться к тексту справки по командам (при помощи `dotent <command> --help`) или документации по предварительной версии 4 на этом сайте. 

Команды интерфейса командной строки с точки зрения выполнения принимают параметры и отправляют вызов к самому модулю MSBuild, который задает необходимые свойства и запускает нужный целевой объект. Чтобы лучше проиллюстрировать это, рассмотрим следующую команду: 

    `dotnet publish -o pub -c Release`
    
Эта команда публикует приложение в папку `pub` с помощью конфигурации Release. На внутреннем уровне эта команда преобразовывается в следующий вызов MSBuild: 

    `dotnet msbuild /t:Publish /p:OutputPath=pub /p:Configuration=Release`

Важным исключением из этого правила являются команды `new` и `run`, так как они были реализованы в качестве целевых объектов MSBuild. 

## <a name="conclusion"></a>Заключение 
Здесь приведен обзор изменений в архитектуре предварительной версии 4 программ с интерфейсом командной строки и их работе, а также рассмотрено понятие общего компонента SDK и функционирование команд интерфейса командной строки с технической точки зрения.


<!--HONumber=Jan17_HO3-->


