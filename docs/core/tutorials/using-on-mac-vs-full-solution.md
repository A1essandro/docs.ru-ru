---
title: "Создание полноценного решения .NET Core на базе macOS с помощью Visual Studio для Mac | Документы Майкрософт"
description: "Этот раздел описывает, как сборку решения .NET Core, включающего многоразовую библиотеку и модульное тестирование."
keywords: .NET, .NET Core, macOS, Mac
author: guardrex
ms.author: mairaw
ms.date: 03/16/2017
ms.topic: article
ms.prod: .net-core
ms.devlang: dotnet
ms.assetid: 6945bedf-5bf3-4955-8588-83fb87511b79
translationtype: Human Translation
ms.sourcegitcommit: ff143583ba62fc1d82561e739a75107e50ebee88
ms.openlocfilehash: c76168d1c9ae65ef0d17c55aab156a4f16ecea52
ms.lasthandoff: 03/20/2017

---

# <a name="building-a-complete-net-core-solution-on-macos-using-visual-studio-for-mac"></a>Создание полноценного решения .NET Core на базе macOS с помощью Visual Studio для Mac

Visual Studio для Mac предоставляет полнофункциональную интегрированную среду для разработки приложений .NET Core. Этот раздел описывает, как сборку решения .NET Core, включающего многоразовую библиотеку и модульное тестирование.

В этом учебнике показано, как создать приложение, которое принимает искомое слово и строку текста от пользователя, с помощью метода из библиотеки классов, подсчитывает, сколько раз искомое слово встречается в строке, и возвращает результат пользователю. Это решение также включает модульное тестирование для библиотеки классов, позволяющее ознакомиться с основными концепциями разработки на основе тестирования (TDD). Если при изучении руководства вы хотите использовать готовый пример, скачайте [его](https://github.com/dotnet/docs/blob/master/samples/core/tutorials/using-on-mac-vs-full-solution/WordCounter).

> [!NOTE]
> Программное обеспечение Visual Studio для Mac находится на этапе предварительной версии. Как и в случае со всеми предварительными версиями продуктов Майкрософт, нам крайне важно узнать ваше мнение. Вы можете отправить отзыв о Visual Studio для Mac команде разработчиков двумя способами:
> * В Visual Studio для Mac выберите пункт **Справка > Сообщить о проблеме** в меню или элемент **Сообщить о проблеме** на экране приветствия. При этом открывается окно для заполнения отчета об ошибках.
> * Чтобы внести предложение, выберите пункт **Справка > Отправить предложение** в меню или элемент **Отправить предложение** на экране приветствия. При этом открывается [веб-страница UserVoice Visual Studio для Mac](https://visualstudio.uservoice.com/forums/563332-visual-studio-for-mac).

## <a name="prerequisites"></a>Предварительные требования

[.NET Core и OpenSSL](https://www.microsoft.com/net/core#macos)

Дополнительные сведения о необходимых компонентах см. в разделе [Необходимые компоненты для .NET Core на Mac](../../core/macos-prerequisites.md).

## <a name="getting-started"></a>Начало работы

Если вы уже установили необходимые компоненты и Visual Studio для Mac, пропустите этот раздел и перейдите к разделу [Создание библиотеки](#building-a-library). Выполните следующие действия, чтобы установить необходимые компоненты и Visual Studio для Mac:

1. Скачайте и установите [.NET Core и OpenSSL](https://www.microsoft.com/net/core#macos).

1. Скачайте [установщик Visual Studio для Mac](https://www.visualstudio.com/vs/visual-studio-mac/). Запустите установщик. Прочитайте и примите условия лицензионного соглашения. Во время установки у вас будет возможность установить Xamarin — технологию разработки кроссплатформенных мобильных приложений. Установка Xamarin и связанных ее компонентов является необязательным шагом для разработки .NET Core. Пошаговые инструкции по установке Visual Studio для Mac см. в разделе [Введение в Visual Studio для Mac](https://developer.xamarin.com/guides/cross-platform/visual-studio-mac/). После завершения установки запустите интегрированную среду разработки Visual Studio для Mac.

## <a name="building-a-library"></a>Создание библиотеки

1. На экране приветствия выберите **Создать проект**. В узле **Multiplatform** (Многоплатформенный) диалогового окна **Создание проекта** выберите шаблон **.NET Standard Library** (Стандартная библиотека .NET). Выберите **Далее**.

   ![Диалоговое окно создания проекта](./media/using-on-mac-vs-full-solution/vsmacfull01.png)

1. Назовите проект "TextUtils" (сокращение от "Text Utilities"), а решение — "WordCounter". Оставьте флажок **Создайте каталог проекта в каталоге решения** установленным. Выберите **Создать**.

   ![Диалоговое окно создания проекта](./media/using-on-mac-vs-full-solution/vsmacfull02.png)

1. На боковой панели **Решение** разверните узел `TextUtils`, чтобы отобразить предоставленный шаблоном файл класса *Class1.cs*. Щелкните файл правой кнопкой мыши, выберите в контекстном меню пункт **Переименовать** и переименуйте файл в *WordCount.cs*. Откройте файл и замените его содержимое на следующий код:

   [!code-csharp[Main](../../../samples/core/tutorials/using-on-mac-vs-full-solution/WordCounter/TextUtils/WordCount.cs)]

1. Сохраните файл с помощью любого из трех способов: используйте сочетание клавиш <kbd>&#8984;</kbd>+<kbd>s</kbd>, выберите **Файл > Сохранить** в меню или щелкните вкладку файла правой кнопкой мыши и выберите пункт **Сохранить** в контекстном меню. На следующем рисунке показано окно интегрированной среды разработки:

   ![Окно интегрированной среды разработки с библиотекой классов TextUtils, файлом класса WordCount, статическим классом WordCount и методом GetWordCount](./media/using-on-mac-vs-full-solution/vsmacfull03.png)

1. Выберите **Ошибки** в нижней части окна интегрированной среды разработки, чтобы открыть панель **Ошибки**. Нажмите кнопку **Выходные данные сборки**.

   ![Нижняя часть окна интегрированной среды разработки с кнопкой "Ошибки"](./media/using-on-mac-vs-full-solution/vsmacfull03b.png)

1. Выберите **Сборка > Собрать все** в меню.

   Выполняется сборка решения. На панели выходных данных отображается сообщение об успешной сборке.

   ![Панель выходных данных сборки на панели "Ошибки", где отображается сообщение об успешной сборке](./media/using-on-mac-vs-full-solution/vsmacfull04.png)

## <a name="creating-a-test-project"></a>Создание тестового проекта

Модульные тесты обеспечивают автоматическое тестирование программного обеспечения во время разработки и публикации. В этом учебнике используется платформа тестирования [xUnit](https://xunit.github.io/).

1. На боковой панели **Решение** щелкните решение `WordCounter` правой кнопкой мыши и выберите пункт **Добавить > Добавить новый проект**.

1. В узле **.NET Core** диалогового окна **Создание проекта** выберите **Тесты**. Выберите **xUnit Test Project** (Тестовый проект xUnit) и нажмите кнопку **Далее**.

   ![Создание тестового проекта xUnit в диалоговом окне "Создание проекта"](./media/using-on-mac-vs-full-solution/vsmacfull05.png)

1. Назовите новый проект "TestLibrary" и выберите **Создать**.

   ![Диалоговое окно "Создание проекта" с именем проекта](./media/using-on-mac-vs-full-solution/vsmacfull06.png)

1. Чтобы библиотека тестов работала с `WordCount`, добавьте ссылку на проект `TextUtils`. На боковой панели **Решение** щелкните правой кнопкой мыши элемент **Зависимости** в области **TestLibrary**. Выберите пункт **Изменить ссылки** в контекстном меню.

1. В диалоговом окне **Изменить ссылки** выберите проект **TextUtils** на вкладке **Проекты**. Нажмите кнопку **ОК**.

   ![Диалоговое окно "Изменить ссылки"](./media/using-on-mac-vs-full-solution/vsmacfull07.png)

1. В проекте **TestLibrary** переименуйте файл *UnitTest1.cs* в *TextUtilsTests.cs*.

1. Откройте файл и замените его содержимое на следующий код:

   ```csharp
   using Xunit;
   using TextUtils;
   using System.Diagnostics;

   namespace TestLibrary
   {
       public class TextUtils_GetWordCountShould
       {
           [Fact]
           public void IgnoreCasing()
           {
               var wordCount = WordCount.GetWordCount("Jack", "Jack jack");
   
               Assert.NotEqual(2, wordCount);
           }
       }
   }
   ```

   На следующем рисунке показана интегрированная среда разработки с кодом модульного тестирования. Обратите внимание на оператор `Assert.NotEquals`.

   ![Начальный модульный тест для проверки GetWordCount в главном окне интегрированной среды разработки](./media/using-on-mac-vs-full-solution/vsmacfull08.png)

   При использовании TDD очень важно однократно выполнить новый тест так, чтобы он завершился со сбоем. Это позволяет проверить правильности его логики тестирования. Метод передает имя "Jack" (с прописной буквы ) и строку, содержащую "Jack" и "jack" (с прописной и строчной буквы). Если метод `GetWordCount` работает правильно, он возвращает два вхождения искомого слова. Чтобы намеренно не пройти этот тест, сначала реализуйте тест, утверждающий, что методом `GetWordCount` не возвращаются два вхождения искомого слова "Jack". После этого перейдите к следующему шагу.

1. Сейчас Visual Studio для Mac не интегрирует тесты xUnit в свое встроенное средство запуска тестов, поэтому тесты выполняются в консоли xUnit. Щелкните проект `TestLibrary` правой кнопкой мыши и выберите **Сервис > Открыть в терминале** в контекстном меню. В командной строке выполните команду `dotnet test`.
   
   Тест завершается неудачно, что соответствует правильному результату. Метод теста утверждает, что два вхождения `inputString` — "Jack" — не возвращаются из строки "Jack jack", предоставленной методом `GetWordCount`. Так как регистр слов не учитывался в методе `GetWordCount`, возвращаются два экземпляра. Утверждение о том, что 2 *не равно* 2, приводит к ошибке. Это правильный результат, а значит логика нашего теста работает корректно. Не закрывайте окно консоли, так как в следующем шаге вам потребуется изменить тест до итоговой версии.

   ![Сбой теста в окне консоли. Всего тестов: 1. Пройдено: 0. Не пройдено: 1. Тестовый запуск не пройден.](./media/using-on-mac-vs-full-solution/vsmacfull09.png)

1. Измените метод теста `IgnoreCasing`, изменив `Assert.NotEqual` на `Assert.Equal`. Сохраните файл, использовав сочетание клавиш <kbd>&#8984;</kbd>+<kbd>s</kbd>, выбрав **Файл > Сохранить** в меню или щелкнув вкладку файла правой кнопкой мыши и выбрав пункт **Сохранить** в контекстном меню.

   Вы ожидаете, что `searchWord` "Jack" возвратит два вхождения при передаче `inputString` "Jack jack" в `GetWordCount`. В окне консоли еще раз выполните `dotnet test`. Тест проходит. Существует два вхождения "Jack" в строке "Jack jack" (без учета регистра), а утверждение теста равно `true`.

   ![Прохождение теста в окне консоли. Всего тестов: 1. Пройдено: 1. Не пройдено: 0. Тестовый запуск пройден.](./media/using-on-mac-vs-full-solution/vsmacfull10.png)

1. Тестирование отдельных возвращаемых значений с помощью `Fact` — это всего лишь азы модульного тестирования. Другая эффективная методика для проверки нескольких значений одновременно заключается в использовании `Theory`. Добавьте следующий метод в свой класс `TextUtils_GetWordCountShould`. Теперь ваш класс содержит два метода:

   ```csharp
   [Theory]
   [InlineData(0, "Ting", "Does not appear in the string.")]
   [InlineData(1, "Ting", "Ting appears once.")]
   [InlineData(2, "Ting", "Ting appears twice with Ting.")]
   public void CountInstancesCorrectly(int count, 
                                       string searchWord, 
                                       string inputString)
   {
       Assert.Equal(count, WordCount.GetWordCount(searchWord,
                                                  inputString));
   }
   ```

   `CountInstancesCorrectly` проверяет, что метод `GetWordCount` ведет подсчет правильно. `InlineData` предоставляет счетчик, искомое слово и входную строку для проверки. Метод теста запускается один раз для каждой строки данных. Отметим еще раз, что сначала вы утверждаете сбой с помощью `Assert.NotEqual`, даже если знаете, что счетчики в данных правильны, а значения будут соответствовать счетчикам, возвращаемым методом `GetWordCount`. Вначале может показаться, что такое намеренное непрохождение теста является пустой тратой времени, но подобная проверка логики тестов очень важна. В конце концов вы, вероятнее всего, столкнетесь с методом теста, который успешно проходит проверку, хотя такого быть не должно, обнаружите ошибку в логике теста. Не стоит пренебрегать этим этапом при создании тестовых методов.
   
1. Сохраните файл и выполните `dotnet test` в окне консоли. Тест регистра проходит успешно, но три теста счетчиков завершаются неудачей. Именно этого мы и ожидаем.

   ![Сбой теста в окне консоли. Всего тестов: 4. Пройдено: 1. Не пройдено: 3. Тестовый запуск не пройден.](./media/using-on-mac-vs-full-solution/vsmacfull11.png)

1. Измените метод теста `CountInstancesCorrectly`, изменив `Assert.NotEqual` на `Assert.Equal`. Сохраните файл. Еще раз выполните `dotnet test` в окне консоли. Все тесты пройдены.

   ![Прохождение теста в окне консоли. Всего тестов: 4. Пройдено: 4. Не пройдено: 0. Тестовый запуск пройден.](./media/using-on-mac-vs-full-solution/vsmacfull12.png)

## <a name="adding-a-console-app"></a>Добавление консольного приложения

1. На боковой панели **Решение** щелкните правой кнопкой мыши решение `WordCounter`. Добавьте новый проект **Консольное приложение**, выбрав шаблон в области **.NET Core > Приложение**. Выберите **Далее**. Присвойте проекту имя **WordCounterApp**. Выберите **Создать**, чтобы создать проект в решении.

1. На боковой панели **Решения** щелкните правой кнопкой мыши узел **Зависимости** нового проекта **WordCounterApp**. В диалоговом окне **Изменить ссылки** установите флажок **TextUtils** и нажмите кнопку **ОК**.

1. Откройте файл *Program.cs*. Замените код следующим кодом:

   [!code-csharp[Main](../../../samples/core/tutorials/using-on-mac-vs-full-solution/WordCounter/WordCounterApp/Program.cs)]

1. Чтобы запустить приложение в окне консоли вместо интегрированной среды разработки, щелкните правой кнопкой мыши проект `WordCounterApp`, выберите пункт **Параметры** и откройте узел **По умолчанию** в области **Конфигурации**. Установите флажок **Выполнить во внешней консоли**. Оставьте флажок **Приостановить вывод на консоль** установленным. Этот параметр приводит к отображению приложения в окне консоли, чтобы вы могли ввести входные данные для операторов `Console.ReadLine`. Если оставить приложение выполняться в интегрированной среде разработки, то отображаются только выходные данные операторов `Console.WriteLine`. Операторы `Console.ReadLine` не работают на панели **Вывод приложения** интегрированной среды разработки.

   ![Окно "Параметры проекта"](./media/using-on-mac-vs-full-solution/vsmacfull13.png)

1. Так как сейчас предварительная версия Visual Studio для Mac не позволяет запускать тесты во время выполнения решения, консольное приложение можно запустить напрямую. Щелкните проект `WordCounterApp` правой кнопкой мыши, затем выберите элемент **Выполнить**. При попытке запустить приложение с помощью кнопки "Воспроизвести" средству запуска тестов и приложению не удается запуститься. Дополнительные сведения о состоянии работы по этому вопросу см. в разделе [xunit/xamarinstudio.xunit (#60)](https://github.com/xunit/xamarinstudio.xunit/issues/60). При запуске приложения укажите значения для искомого слова и входной строки в окне консоли. Приложение указывает количество вхождений искомого слова в строке.

   ![Окно консоли, на котором показан поиск слова "olives" в строке "Iro ate olives by the lake, and the olives were wonderful". Приложение выдает ответ "The search word olives appears 2 times" (Искомое слово olives встречается 2 раза).](./media/using-on-mac-vs-full-solution/vsmacfull14.png)

1. Последней мы рассмотрим функцию отладки в Visual Studio для Mac. Установите точку останова на оператор `Console.WriteLine`: выберите в левый край строки 23, чтобы рядом со строкой кода появился красный кружок. Можно также щелкнуть в любом месте строки кода и выбрать **Выполнить > Перейти к следующей точке останова** в меню.

   ![Точка останова, которая установлена на строке 23, оператор Console.WriteLine](./media/using-on-mac-vs-full-solution/vsmacfull15.png)

1. Щелкните проект `WordCounterApp` правой кнопкой мыши. Выберите пункт **Начать отладку** в контекстном меню. При запуске приложения введите искомое слово "cat", а также "The dog chased the cat, but the cat escaped" в качестве строки для поиска. При достижении оператора `Console.WriteLine` выполнение программы прекращается до выполнения этого оператора. На вкладке **Локальные** вы можете увидеть значения `searchWord`, `inputString`, `wordCount` и `pluralChar`.

   ![Выполнение программы остановлено на операторе Console.WriteLine, при этом в окне "Локальный" отображаются значения, стоящие непосредственно перед выполнением оператора Console.WriteLine.](./media/using-on-mac-vs-full-solution/vsmacfull16.png)

1. В области **Интерпретация** введите "wordCount = 999;" и нажмите клавишу ВВОД. Этим вы присвоите переменной `wordCount` не имеющее смысла значение 999. Таким образом можно изменять значения переменных во время отладки.

   ![Срабатывает наша точка останова. Значение для wordCount в окне интерпретации изменяется на 999.](./media/using-on-mac-vs-full-solution/vsmacfull17.png)

1. Щелкните стрелку *Продолжить* на панели инструментов. Взгляните на выходные данные в окне консоли. Там указано неправильное значение 999, заданное при отладке приложения.

   ![Кнопка "Продолжить" на панели инструментов](./media/using-on-mac-vs-full-solution/vsmacfull18.png)

   ![Значение счетчика искомых слов в выходных данных приложения изменяется на 999.](./media/using-on-mac-vs-full-solution/vsmacfull19.png)

## <a name="next-steps"></a>Следующие шаги

* Ознакомьтесь с дополнительными функциями Visual Studio для Mac в [ознакомительной статье](https://developer.xamarin.com/guides/cross-platform/visual-studio-mac/) на веб-сайте разработчика Xamarin.
* Более подробный обзор функций Visual Studio для Mac приведен в руководстве по [Xamarin Studio](https://developer.xamarin.com/guides/cross-platform/xamarin-studio/ide-tour/).

