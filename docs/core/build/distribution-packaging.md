---
title: Упаковка дистрибутивов .NET Core
description: Узнайте, как создавать пакеты .NET Core, присваивать им имена и управлять их версиями для распространения.
author: bleroy
ms.author: mairaw
ms.date: 06/28/2017
ms.openlocfilehash: 41e8729d3058c2e3e1ea1cab9a8f28b3062bb93c
ms.sourcegitcommit: ccd8c36b0d74d99291d41aceb14cf98d74dc9d2b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2018
ms.locfileid: "53145651"
---
# <a name="net-core-distribution-packaging"></a>Упаковка дистрибутивов .NET Core

Так как .NET Core становится доступным на все большем количестве платформ, полезно знать, как создавать пакеты, присваивать им имена и управлять их версиями. Таким образом издатели пакетов смогут обеспечить согласованную работу независимо от платформы, выбранной пользователями для запуска .NET.

## <a name="disk-layout"></a>Структура диска

После установки .NET Core состоит из нескольких компонентов, которые расположены в файловой системе следующим образом:

```
.
├── dotnet                       (1)
├── LICENSE.txt                  (8)
├── ThirdPartyNotices.txt        (8)
├── host
│   └── fxr
│       └── <fxr version>        (2)
├── sdk
│   ├── <sdk version>            (3)
│   └── NuGetFallbackFolder      (4)
└── shared
    ├── Microsoft.NETCore.App
    │   └── <runtime version>    (5)
    └── Microsoft.AspNetCore.App
        └── <aspnetcore version> (6)
    └── Microsoft.AspNetCore.All
        └── <aspnetcore version> (7)
/
├─usr/share/man/man1
│       └── dotnet.1.gz          (9)
└─usr/bin
        └── dotnet               (10)
```

- (1) **dotnet**: основное приложение (также называется "мультиплексором") выполняет две функции: активирует среду выполнения для запуска приложения и активирует пакет SDK для отправки в него команд. Основное приложение представляет собой исполняемый файл в машинном коде (`dotnet.exe`).

Хотя основное приложение является единственным, большинство других компонентов находятся в каталогах с номерами версий (2, 3, 5, 6). Это означает, что в системе можно параллельно установить несколько версий.

- (2) **host/fxr/\<fxr version>** содержит логику разрешений платформы, используемую основным приложением. Основное приложение использует новейшую установленную версию hostfxr. Hostfxr отвечает за выбор необходимой среды выполнения при запуске приложения .NET Core. Например, приложение, разработанное для .NET Core 2.0.0, будет использовать среду выполнения версии 2.0.5, если она доступна. Аналогично hostfxr выбирает соответствующую версию SDK во время разработки.

- (3) **sdk/\<sdk version>**: пакет SDK (также называется инструментарием) — это набор управляемых средств, которые можно использовать для написания кода и сборки библиотек и приложений .NET Core. Пакет SDK состоит из интерфейса командной строки, компилятора Roslyn, MSBuild, связанных задач сборки и целевых объектов, NuGet, новых шаблонов проектов и т. д.

- (4) **sdk/NuGetFallbackFolder** содержит кэш пакетов NuGet, используемый SDK на шаге `dotnet restore`.

Папка **shared** содержит платформы. Общая платформа предоставляет набор библиотек в центральном расположении таким образом, что они могут использоваться другими приложениями.

- (5) **shared/Microsoft.NETCore.App/\<runtime version>** эта платформа содержит среду выполнения .NET Core и вспомогательные управляемые библиотеки.

- (6,7) **shared/Microsoft.AspNetCore.{App,All}/\<aspnetcore version>** содержит библиотеки ASP.NET Core. Библиотеки в каталоге `Microsoft.AspNetCore.App` разрабатываются и поддерживаются как часть проекта .NET Core. Библиотеки в каталоге `Microsoft.AspNetCore.All` являются расширенным множеством, которое также содержит библиотеки сторонних производителей.

- (8) **LICENSE.txt,ThirdPartyNotices.txt** — тексты лицензий .NET Core и лицензий библиотек сторонних производителей, используемых в .NET Core.

- (9,10) **dotnet.1.gz, dotnet** `dotnet.1.gz` является справочной страницей dotnet. `dotnet` представляет собой символическую ссылку на основное приложение dotnet (1). Эти файлы устанавливаются в типичные расположения для системной интеграции.

## <a name="recommended-packages"></a>Рекомендуемые пакеты

Управление версиями .NET Core основано на номерах версий компонентов среды выполнения вида `[major].[minor]`.
Версия пакета SDK использует тот же самый номер `[major].[minor]` и имеет независимый номер `[patch]`, который объединяет в себе семантику возможностей и номера исправления для SDK.
Например: номер версии 2.2.302 пакета SDK означает 2-й выпуск исправления 3-го выпуска возможности пакета SDK, который поддерживает среду выполнения версии 2.2.

Некоторые пакеты содержат часть номера версии в своем имени. Это позволяет конечному пользователю устанавливать определенную версию.
Оставшаяся часть версии не включается в имя версии. Это позволяет диспетчеру пакетов ОС обновлять пакеты (например, автоматически устанавливать исправления безопасности).

В следующей таблице перечислены рекомендуемые пакеты.

| name                                    | Пример                | Вариант использования: устанавливает...           | Содержит           | Зависимости                                   | Версия            |
|-----------------------------------------|------------------------|---------------------------------|--------------------|------------------------------------------------|--------------------|
| dotnet-sdk-[major]                      | dotnet-sdk-2           | Новейшую версию пакета sdk для основной версии среды выполнения    |                    | dotnet-sdk-[major].[latestminor]               | \<версия sdk>     |
| dotnet-sdk-[major].[minor]              | dotnet-sdk-2.1         | Новейшую версию пакета sdk для конкретной среды выполнения |                    | dotnet-sdk-[major].[minor].[latest sdk feat]xx | \<версия sdk>     |
| dotnet-sdk-[major].[minor].[sdk feat]xx | dotnet-sdk-2.1.3xx     | Конкретный выпуск возможности sdk    | (3),(4)            | aspnetcore-runtime-[major].[minor]             | \<версия sdk>     |
| aspnetcore-runtime-[major].[minor]      | aspnetcore-runtime-2.1 | Конкретную среду выполнения ASP.NET Core   | (6),[(7)]          | dotnet-runtime-[major].[minor]                 | \<версия среды выполнения> |
| dotnet-runtime-[major].[minor]          | dotnet-runtime-2.1     | Конкретную среду выполнения                | (5)                | host-fxr:\<версия среды выполнения>+                   | \<версия среды выполнения> |
| dotnet-host-fxr                         | dotnet-host-fxr        | _зависимость_                    | (2)                | host:\<версия среды выполнения>+                       | \<версия среды выполнения> |
| dotnet-host                             | dotnet-host            | _зависимость_                    | (1),(8),(9),(10)   |                                                | \<версия среды выполнения> |

Большинство дистрибутивов требуют построения из источника всех артефактов. Это определенным образом влияет на пакеты:

- Библиотеки сторонних производителей в `shared/Microsoft.AspNetCore.All` нельзя так просто построить из источника. Поэтому эта папка исключена из пакета `aspnetcore-runtime`.

- Папка `NuGetFallbackFolder` заполняется двоичными артефактами с сайта `nuget.org`. Она должна оставаться пустой.

Несколько пакетов `dotnet-sdk` могут предоставлять одни и те же файлы для каталога `NuGetFallbackFolder`. Чтобы избежать проблем с диспетчером пакетов, эти файлы должны быть идентичны (контрольная сумма, дата изменения, ...).

#### <a name="preview-versions"></a>Предварительные версии

Издатели пакетов могут посчитать нужным выпустить предварительные версии общей платформы и пакета SDK. Предварительные версии можно предоставить с помощью пакетов `dotnet-sdk-[major].[minor].[sdk feat]xx`, `aspnetcore-runtime-[major].[minor]`, `dotnet-runtime-[major].[minor]`. Для предварительных выпусков основной номер версии пакета должен быть равен нулю. Таким образом, окончательная версия установится как обновление пакета.

#### <a name="patch-packages"></a>Пакеты исправлений

Так как версия пакетов с исправлением может привести к критическим изменением, издателю пакета может потребоваться выпустить _пакеты исправлений_. Эти пакеты позволяют устанавливать определенную версию исправления, которая не обновляется автоматически. Пакеты исправлений следует использовать только в редких случаях, так как они не будут обновлены исправлениями (безопасности).

В следующей таблице перечислены рекомендуемые пакеты и **пакеты исправлений**.

| name                                           | Пример                  | Содержит         | Зависимости                                              |
|------------------------------------------------|--------------------------|------------------|-----------------------------------------------------------|
| dotnet-sdk-[major]                             | dotnet-sdk-2             |                  | dotnet-sdk-[major].[latest sdk minor]                     |
| dotnet-sdk-[major].[minor]                     | dotnet-sdk-2.1           |                  | dotnet-sdk-[major].[minor].[latest sdk feat]xx            |
| dotnet-sdk-[major].[minor].[sdk feat]xx        | dotnet-sdk-2.1.3xx       |                  | dotnet-sdk-[major].[minor].[latest sdk patch]             |
| **dotnet-sdk-[major].[minor].[patch]**         | dotnet-sdk-2.1.300       | (3),(4)          | aspnetcore-runtime-[major].[minor].[sdk runtime patch]    |
| aspnetcore-runtime-[major].[minor]             | aspnetcore-runtime-2.1   |                  | aspnetcore-runtime-[major].[minor].[latest runtime patch] |
| **aspnetcore-runtime-[major].[minor].[patch]** | aspnetcore-runtime-2.1.0 | (6),[(7)]        | dotnet-runtime-[major].[minor].[patch]                    |
| dotnet-runtime-[major].[minor]                 | dotnet-runtime-2.1       |                  | dotnet-runtime-[major].[minor].[latest runtime patch]     |
| **dotnet-runtime-[major].[minor].[patch]**     | dotnet-runtime-2.1.0     | (5)              | host-fxr:\<версия среды выполнения>+                              |
| dotnet-host-fxr                                | dotnet-host-fxr          | (2)              | host:\<версия среды выполнения>+                                  |
| dotnet-host                                    | dotnet-host              | (1),(8),(9),(10) |                                                           |

Альтернативой использованию пакетов исправлений является _закрепление_ пакетов на конкретной версии с помощью диспетчера пакетов. Чтобы избежать влияния на другие приложения и пользователей, такие приложения можно построить и развернуть в контейнере.

## <a name="building-packages"></a>Построение пакетов

Репозиторий [dotnet/source-build](https://github.com/dotnet/source-build) содержит инструкции по созданию архива TAR с исходным кодом пакета SDK для .NET Core и всех его компонентов. Выход репозитория, построенного из источника, соответствует виду, описанному в первом разделе этой статьи.
