---
title: "Компиляция и многократное использование в регулярных выражениях"
description: "Компиляция и многократное использование в регулярных выражениях"
keywords: .NET, .NET Core
author: stevehoag
manager: wpickett
ms.date: 07/28/2016
ms.topic: article
ms.prod: .net-core
ms.technology: .net-core-technologies
ms.devlang: dotnet
ms.assetid: 3adea434-e2ed-4023-b4f5-b0608b4cf53f
translationtype: Human Translation
ms.sourcegitcommit: fb00da6505c9edb6a49d2003ae9bcb8e74c11d6c
ms.openlocfilehash: 1832403174276e48dc1857be8ff11fba2b9a250c

---

# <a name="compilation-and-reuse-in-regular-expressions"></a>Компиляция и многократное использование в регулярных выражениях

Производительность приложений, активно использующих регулярные выражения, можно оптимизировать, если понимать, каким образом обработчик регулярных выражений компилирует выражения и как кэшируются регулярные выражения. В этом разделе описаны и компиляция, и кэширование.

## <a name="compiled-regular-expressions"></a>Скомпилированные регулярные выражения

По умолчанию обработчик регулярных выражений компилирует регулярные выражения в последовательность внутренних инструкций (это коды высокого уровня, которые отличаются от языка MSIL). Когда обработчик выполняет регулярное выражение, он преобразовывает внутренние коды.

Если объект [Regex](xref:System.Text.RegularExpressions.Regex) создается с параметром [RegexOptions.Compiled](xref:System.Text.RegularExpressions.RegexOptions.Compiled), то регулярное выражение явно компилируется в язык MSIL вместо внутренних инструкций высокого уровня. Это позволяет JIT-компилятору платформы .NET преобразовывать выражение в изначальный машинный код данного объекта для повышения производительности.

Однако созданный язык MSIL выгрузить невозможно. Выгрузить код можно, только выгрузив весь домен приложения (т. е. выгрузив весь код приложения). Фактически, если регулярное выражение компилируется с параметром [RegexOptions.Compiled](xref:System.Text.RegularExpressions.RegexOptions.Compiled), то платформа .NET никогда не высвобождает ресурсы, использованные скомпилированным выражением, даже если регулярное выражение было создано объектом [Regex](xref:System.Text.RegularExpressions.Regex), который сам готов для сборки мусора.

Необходимо соблюдать осторожность и ограничить число различных регулярных выражений, компилируемых с параметром [RegexOptions.Compiled](xref:System.Text.RegularExpressions.RegexOptions.Compiled), чтобы избежать потребления слишком большого количества ресурсов. Если в приложении необходимо использовать большое или неограниченное число регулярных выражений, их необходимо преобразовывать, а не компилировать. Если же нужно многократно использовать небольшое число регулярных выражений, то их следует компилировать с параметром [RegexOptions.Compiled](xref:System.Text.RegularExpressions.RegexOptions.Compiled) для повышения производительности. 

## <a name="the-regular-expressions-cache"></a>Кэш регулярных выражений

Для повышения производительности обработчик регулярных выражений поддерживает кэш скомпилированных регулярных выражений на уровне приложения. Кэш хранит шаблоны регулярных выражений, которые используются только при вызове статических методов. (Шаблоны регулярных выражений, предоставляемые методами экземпляра, не кэшируются.) Это устраняет потребность в повторном разборе выражения в байт-код высокого уровня при каждом его использовании.

Максимальное число кэшированных регулярных выражений определяется значением `static` (`Shared` в Visual Basic) свойства [Regex.CacheSize](xref:System.Text.RegularExpressions.Regex.CacheSize). По умолчанию обработчик регулярных выражений кэширует до 15 скомпилированных регулярных выражений. Если число скомпилированных регулярных выражений превышает размер кэша, из него удаляется наиболее давнее по использованию регулярное выражение и кэшируется новое регулярное выражение. 

Приложение может воспользоваться преимуществом заранее скомпилированных регулярных выражений одним из указанных далее двух способов.

* Используя статический метод объекта [Regex](xref:System.Text.RegularExpressions.Regex) для определения регулярного выражения. Если используется шаблон регулярного выражения, который уже был определен при вызове другого статического метода, обработчик регулярных выражений будет извлекать его из кэша. Если нет, обработчик скомпилирует регулярное выражение и добавит его в кэш.

* Путем многократного использования существующего объекта [Regex](xref:System.Text.RegularExpressions.Regex) до тех пор, пока необходим шаблон регулярного выражения.


Из-за высоких издержек при создании объектов и компиляции регулярных выражений создание и быстрое уничтожение многочисленных объектов [Regex](xref:System.Text.RegularExpressions.Regex) объектов представляет собой очень ресурсоемкий процесс. Для приложений, использующих большое количество различных регулярных выражений, производительность можно оптимизировать с помощью вызова статических методов [Regex](xref:System.Text.RegularExpressions.Regex), и, возможно, путем увеличения размера кэша регулярных выражений.

## <a name="see-also"></a>См. также

[Регулярные выражения .NET](regular-expressions.md)




<!--HONumber=Nov16_HO1-->


