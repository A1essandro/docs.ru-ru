---
title: "Практическое руководство. Преобразование числовых данных, введенных пользователем в веб-элементах управления, в числа | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-standard"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "преобразование введенных пользователем данных в число"
  - "форматирование [платформа .NET Framework], числа"
  - "форматирование чисел [платформа .NET Framework]"
  - "числа [платформа .NET Framework], преобразование введенных пользователем данных в число"
  - "строки числовых форматов [платформа .NET Framework]"
  - "разбор строк [платформа .NET Framework], числовые строки"
ms.assetid: f27ddfb8-7479-4b79-8879-02a3bd8402d4
caps.latest.revision: 8
author: "rpetrusha"
ms.author: "ronpet"
manager: "wpickett"
caps.handback.revision: 8
---
# Практическое руководство. Преобразование числовых данных, введенных пользователем в веб-элементах управления, в числа
Поскольку веб\-страница может отображаться в любой части мира, пользователи могут вводить числовые данные в элемент управления <xref:System.Web.UI.WebControls.TextBox>, используя почти неограниченное число форматов.  Поэтому очень важно определить языковой стандарт и региональные параметры пользователя веб\-страницы.  При разборе данных, введенных пользователем, можно применить соглашения форматирования, определенные языковым и региональными параметрами пользователя.  
  
### Преобразование входных числовых данных из веб\-элемента управления TextBox в число  
  
1.  Определите, заполняется ли массив строк, возвращаемый свойством <xref:System.Web.HttpRequest.UserLanguages%2A?displayProperty=fullName>.  Если это не так, то перейдите к шагу 6.  
  
2.  Если массив строк, возвращаемый свойством <xref:System.Web.HttpRequest.UserLanguages%2A> заполнен, то извлеките его первый элемент.  Первый элемент указывает на язык и регион по умолчанию или выбранный пользователем.  
  
3.  Создайте объект <xref:System.Globalization.CultureInfo>, представляющий выбранные пользователем региональные параметры, путем вызова конструктора <xref:System.Globalization.CultureInfo.%23ctor%28System.String%2CSystem.Boolean%29?displayProperty=fullName>.  
  
4.  Вызовите метод `TryParse` или метод `Parse` числового типа, к которому требуется преобразовать введенные пользователем данные.  Используйте перегрузку метода `TryParse` или `Parse` с параметром `provider` и передайте ему один из следующих объектов:  
  
    -   Объект <xref:System.Globalization.CultureInfo>, созданный на шаге 3.  
  
    -   Объект <xref:System.Globalization.NumberFormatInfo>, возвращаемый свойством <xref:System.Globalization.CultureInfo.NumberFormat%2A> объекта <xref:System.Globalization.CultureInfo>, созданного на шаге 3.  
  
5.  Если выполнить преобразование не удалось, повторите шаги со второго по четвертый для каждого оставшегося элемента в массиве строк, возвращаемого свойством <xref:System.Web.HttpRequest.UserLanguages%2A>.  
  
6.  Если преобразование по\-прежнему не удается или массив строк, возвращаемый свойством <xref:System.Web.HttpRequest.UserLanguages%2A> пуст, произведите разбор строки с использованием инвариантных региональных параметров, которые возвращаются свойством <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=fullName>.  
  
## Пример  
 Следующий пример представляет собой полную страницу фонового кода для веб\-формы, в которой пользователю предлагается ввести числовое значение в элемент управления <xref:System.Web.UI.WebControls.TextBox>, после чего выполняется его преобразование в число.  Это число затем удваивается и выводится с помощью тех же правил форматирования, что и исходные входные данные.  
  
 [!code-csharp[Formatting.HowTo.ParseNumericInput#1](../../../samples/snippets/csharp/VS_Snippets_CLR/Formatting.HowTo.ParseNumericInput/cs/NumericUserInput1.aspx.cs#1)]
 [!code-vb[Formatting.HowTo.ParseNumericInput#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/Formatting.HowTo.ParseNumericInput/vb/NumericUserInput1.aspx.vb#1)]  
  
 Свойство <xref:System.Web.HttpRequest.UserLanguages%2A?displayProperty=fullName> заполняется на основании имен региональных параметров, содержащихся в заголовках `Accept-Language`, включенных в HTTP\-запрос.  Однако не все браузеры включают заголовки `Accept-Language` в свои запросы, кроме того, пользователи могут полностью запретить заголовки.  В связи с этим при разборе данных, введенных пользователем, возникает необходимость иметь резервный набор региональных параметров.  Обычно, резервный набор региональных параметров является инвариантным и возвращается свойством <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=fullName>.  Пользователи также могут ввести в Internet Explorer название языка и региональных параметров, которое они вводят в текстовое поле, а это создает вероятность того, что такое название может оказаться недопустимым.  Всвязи с этим возникает необходимость обработки исключений при создании объекта <xref:System.Globalization.CultureInfo>.  
  
 При извлечении из HTTP\-запроса, посланного Internet Explorer, массив <xref:System.Web.HttpRequest.UserLanguages%2A?displayProperty=fullName> заполняется в порядке, определенном в пользовательских настройках.  Первый элемент массива содержит название основного национального языка\/региона пользователя.  Если массив содержит другие элементы, то Internet Explorer произвольно назначит им спецификатор качества, который отделяется от имени региональных параметров точкой с запятой.  Например, запись региональных параметров fr\-FR может принять форму `fr-FR;q=0.7`.  
  
 В примере вызывается конструктор <xref:System.Globalization.CultureInfo.%23ctor%2A> с параметром `useUserOverride` с настройкой `false`для создания нового объекта <xref:System.Globalization.CultureInfo>.  В этом случае, если региональные параметры по умолчанию используются на сервере, то новый объект <xref:System.Globalization.CultureInfo>, созданный конструктором класса, содержит все региональные параметры по умолчанию и не зависит от настроек, заданных при помощи серверного приложения **Язык и региональные параметры**.  Значения всех скорректированных настроек на сервере вряд ли появятся на компьютере пользователя или отразятся в данных, введенных пользователем.  
  
 Код может вызвать метод `Parse` или метод `TryParse` числового типа, к которому требуется преобразовать данные, введенные пользователем.  Для отдельной операции разбора может потребоваться повторный вызов метода синтаксического анализа.  В результате метод `TryParse` является более эффективным, поскольку он возвращает `false` при отказе операции синтаксического анализа.  Напротив, обработка повторяющихся исключений, которые могут посылаться методом `Parse`, может быть слишком затратной для веб\-приложений.  
  
## Компиляция кода  
 Чтобы скомпилировать код, скопируйте его в страницу фонового кода [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] таким образом, чтобы он заменил весь существующий код.  Веб\-страница [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] должна содержать следующие элементы управления:  
  
-   Элемент управления <xref:System.Web.UI.WebControls.Label>, который не указан в коде.  Присвойте его свойству <xref:System.Web.UI.WebControls.TextBox.Text%2A> значение "Введите число:".  
  
-   Элемент управления <xref:System.Web.UI.WebControls.TextBox> с именем `NumericString`.  
  
-   Элемент управления <xref:System.Web.UI.WebControls.Button> с именем `OKButton`.  Присвойте его свойству <xref:System.Web.UI.WebControls.Button.Text%2A> значение "ОК".  
  
 Измените имя класса с `NumericUserInput` на имя класса, который определен атрибутом `Inherits` директивы `Page` страницы [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].  Измените имя ссылки на объект `NumericInput` на имя, определенное атрибутом `id` тега `form` страницы [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].  
  
## Безопасность платформы .NET Framework  
 Чтобы предостеречь пользователя от добавления скрипта в поток HTML, вводимые пользователем данные никогда не должны непосредственно передаваться обратно в ответе сервера.  Вместо этого они должны быть зашифрованы с помощью метода <xref:System.Web.HttpServerUtility.HtmlEncode%2A?displayProperty=fullName>.  
  
## См. также  
 [Выполнение операций форматирования](../../../docs/standard/base-types/performing-formatting-operations.md)   
 [Разбор числовых строк](../../../docs/standard/base-types/parsing-numeric.md)