---
title: "Компиляция и многократное использование в регулярных выражениях | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-standard"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "регулярные выражения .NET Framework, компиляция"
  - "регулярные выражения .NET Framework, обработчики"
  - "компиляция, регулярные выражения"
  - "разбор текста с регулярными выражениями, компиляция"
  - "синтаксис соответствия шаблону с регулярными выражениями, компиляция"
  - "регулярные выражения, компиляция"
  - "регулярные выражения, обработчики"
  - "поиск с регулярными выражениями, компиляция"
ms.assetid: 182ec76d-5a01-4d73-996c-0b0d14fcea18
caps.latest.revision: 11
author: "rpetrusha"
ms.author: "ronpet"
manager: "wpickett"
caps.handback.revision: 11
---
# Компиляция и многократное использование в регулярных выражениях
Производительность приложений, активно использующих регулярные выражения можно оптимизировать, если понимать, каким образом обработчик регулярных выражений компилирует выражения и каким образом кэшируются регулярные выражения.  В этом разделе описаны и компиляция, и кэширование.  
  
## скомпилированные регулярные выражения  
 По умолчанию обработчик регулярных выражений компилирует регулярные выражения в последовательность внутренних инструкций \(это коды высокого уровня, которые отличаются от языка MSIL\).  Когда обработчик выполняет регулярное выражение, он преобразовывает внутренние коды.  
  
 Если объект <xref:System.Text.RegularExpressions.Regex> создается с параметром <xref:System.Text.RegularExpressions.RegexOptions?displayProperty=fullName>, то регулярное выражение явно компилируется в язык MSIL вместо внутренних инструкций высокого уровня.  Это позволяет JIT\-компилятору платформы .NET Framework преобразовывать выражение в изначальный машинный код данного объекта для повышения производительности.  
  
 Однако созданный язык MSIL выгрузить невозможно.  Выгрузить код можно, только выгрузив весь домен приложения \(т.е. выгрузив весь код приложения\).  Фактически если регулярное выражение компилируется с параметром <xref:System.Text.RegularExpressions.RegexOptions?displayProperty=fullName>, то платформа .NET Framework никогда не высвобождает ресурсы, использованные скомпилированным выражением, даже если регулярное выражение было создано объектом <xref:System.Text.RegularExpressions.Regex>, который сам готов для сборки мусора.  
  
 Необходимо соблюдать осторожность и ограничить число различных регулярных выражений, компилируемых с параметром <xref:System.Text.RegularExpressions.RegexOptions?displayProperty=fullName>, чтобы избежать потребления слишком большого количества ресурсов.  Если в приложении необходимо использовать большое или неограниченное число регулярных выражений, то необходимо их преобразовывать, а не компилировать.  Если же нужно многократно использовать небольшое число регулярных выражений, то их следует компилировать с параметром <xref:System.Text.RegularExpressions.RegexOptions?displayProperty=fullName> для повышения производительности.  Альтернативой является предварительная компиляция регулярных выражений.  Можно скомпилировать все выражения в многократно используемую библиотеку DLL с помощью метода <xref:System.Text.RegularExpressions.Regex.CompileToAssembly%2A>.  Это устранит необходимость компиляции в режиме выполнения и сохранит скорость как преимущество скомпилированных регулярных выражений.  
  
## Кэш регулярных выражений  
 Для повышения производительности обработчик регулярных выражений поддерживает кэш скомпилированных регулярных выражений на уровне приложения.  Кэш хранит шаблоны регулярных выражений, которые используются только при вызове статических методов \(шаблоны регулярных выражений, предоставляемые методами экземпляра, не кэшируются\). Это устраняет потребность в повторном разборе выражения в байт\-код высокого уровня при каждом его использовании.  
  
 Максимальное число кэшированных регулярных выражений определяется значением `static` \(`Shared` в Visual Basic\) свойства <xref:System.Text.RegularExpressions.Regex.CacheSize%2A?displayProperty=fullName>.  По умолчанию обработчик регулярных выражений кэширует до 15 скомпилированных регулярных выражений.  Если число скомпилированных регулярных выражений превышает размер кэша, то из него удаляется наиболее давнее по использованию регулярное выражение и кэшируется новое регулярное выражение.  
  
> [!IMPORTANT]
>  Принцип кэширования регулярных выражений в .NET Framework версии 2.0 значительно отличается от принципов, применявшихся в версиях 1.0 и 1.1.  В .NET Framework версий 1.0 и 1.1 кэшировались все регулярные выражения, вызываемые как статическими методами, так и методами экземпляров.  Кэш автоматически расширялся для хранения новых регулярных выражений.  В платформе .NET Framework 2.0 кэшируются только регулярные выражения, используемые в вызовах статических методов.  По умолчанию кэшируются последние 15 регулярных выражений, хотя размер кэша может быть задан значением свойства <xref:System.Text.RegularExpressions.Regex.CacheSize%2A>.  
  
 Приложение может воспользоваться преимуществом заранее скомпилированных регулярных выражений одним из следующих двух способов:  
  
-   Используя статический метод объекта <xref:System.Text.RegularExpressions.Regex> для определения регулярного выражения.  Если используется шаблон регулярного выражения, который уже был определен при вызове другого статического метода, то обработчик регулярных выражений будет извлекать его из кэша.  Если нет, то обработчик скомпилирует регулярное выражение и добавит его в кэш.  
  
-   Путем многократного использования существующих объектов <xref:System.Text.RegularExpressions.Regex> до тех пор, пока необходим шаблон регулярного выражения.  
  
 Из\-за высоких издержек при создании объектов и компиляции регулярных выражений создание и быстрое уничтожение многочисленных объектов <xref:System.Text.RegularExpressions.Regex> представляет собой очень ресурсоемкий процесс.  Для приложений, использующих большое количество различных регулярных выражений, производительность можно оптимизировать с помощью вызова статических методов `Regex` и, возможно, путем увеличения размера кэша регулярных выражений.  
  
## См. также  
 [Регулярные выражения в .NET Framework](../../../docs/standard/base-types/regular-expressions.md)