---
title: "Обработка и создание исключений | Документация Майкрософт"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework-4.6
ms.reviewer: 
ms.suite: 
ms.technology:
- dotnet-bcl
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- exceptions [.NET Framework], handling
- runtime, exceptions
- filtering exceptions
- errors [.NET Framework], exceptions
- exceptions [.NET Framework], throwing
- exceptions [.NET Framework]
- common language runtime, exceptions
ms.assetid: f99a1d29-a2a8-47af-9707-9909f9010735
caps.latest.revision: 16
author: mairaw
ms.author: mairaw
manager: wpickett
translationtype: Human Translation
ms.sourcegitcommit: c50b3e328998b65ec47efe6d7457b36116813c77
ms.openlocfilehash: c3b47e61da914ebbe1106fcf45465a13b0521bb4
ms.lasthandoff: 04/08/2017

---
# <a name="handling-and-throwing-exceptions"></a>Обработка и создание исключений
<a name="top"></a> Необходимо реализовать возможность согласованной обработки приложениями ошибок, происходящих во время выполнения. Среда CLR предоставляет модель для единообразного уведомления приложений об ошибках. При выполнении любых операций .NET Framework сбой обозначается созданием исключений.  
  
 В этом разделе содержатся следующие подразделы.  
  
-   [Исключения в .NET Framework](#exceptions_in_the_net_framework)  
  
-   [Исключения и традиционные методы обработки ошибок](#exceptions_vs_traditional_errorhandling_methods)  
  
-   [Как среда выполнения управляет исключениями](#how_the_runtime_manages_exceptions)  
  
-   [Фильтрация исключений среды выполнения](#filtering_runtime_exceptions)  
  
-   [См. также](#related_topics)  
  
-   [Ссылки](#reference)  
  
<a name="exceptions_in_the_net_framework"></a>   
## <a name="exceptions-in-the-net-framework"></a>Исключения в .NET Framework  
 Исключение — это любое состояние ошибки или непредвиденное поведение, возникающее при выполнении программы. Исключения могут возникать из-за сбоя в вашем или вызываемом коде (например, в общей библиотеке), недоступности ресурсов ОС, неожиданных состояний, возникающих в среде CLR (например, код, который невозможно проверить), и так далее. После некоторых из этих состояний приложение может восстановиться, после других — нет. Несмотря на то что можно выполнить восстановление после большинства исключений приложения, выполнить восстановление после большинства исключений среды выполнения невозможно.  
  
 В платформе .NET Framework исключение — это объект, который наследуется от класса <xref:System.Exception?displayProperty=fullName>. Исключение создается из области кода, где произошла проблема. Исключение передается вверх по стеку до тех пор, пока его не обработает приложение либо программа не завершится.  
  
 [К началу](#top)  
  
<a name="exceptions_vs_traditional_errorhandling_methods"></a>   
## <a name="exceptions-vs-traditional-error-handling-methods"></a>Исключения и традиционные методы обработки ошибок  
 Традиционно модель обработки ошибок языка основывалась на уникальном способе языка обнаруживать ошибки и находить для них обработчики или на механизме обработки ошибок, предоставляемом ОС. Среда выполнения реализует обработку исключений следующим образом.  
  
-   Обработка исключений без учета языка, который создает исключение, или языка, который обрабатывает исключение.  
  
-   Не требует определенного синтаксиса языка для обработки исключений, а позволяет каждому языку определить свой собственный синтаксис.  
  
-   Разрешает создавать исключения, невзирая на границы процесса и даже на разных компьютерах.  
  
 Исключения обеспечивают ряд преимуществ по сравнению с другими методами уведомления об ошибках, например кодами возврата. Сбои не проходят незамеченными. Недопустимые значения перестают распространяться по системе. Не требуется проверять коды возврата. Код обработки исключений легко добавить для повышения надежности программы. Наконец, обработка исключений в среде выполнения, осуществляется быстрее, чем обработка ошибок C++ в Windows.  
  
 Поскольку потоки выполнения, как правило, проходят по управляемым и неуправляемым блокам кода, среда выполнения может создавать или перехватывать исключения в управляемом и неуправляемом коде. Неуправляемый код может включать исключения SEH в стиле С++ и значения HRESULTS из COM.  
  
<a name="how_the_runtime_manages_exceptions"></a>   
## <a name="how-the-runtime-manages-exceptions"></a>Управление исключениями среды выполнения  
 Среда выполнения использует модель обработки исключений на основе объектов исключений и защищенных блоков кода. Создается объект <xref:System.Exception>, который представляет исключение, когда оно возникает.  
  
 Среда выполнения создает таблицу сведений об исключениях для каждого исполняемого файла. Каждый метод исполняемого файла имеет связанный с ним массив сведений об обработке исключений (который может быть пустым) в таблице сведений об исключении. Каждая запись массива описывает защищенный блок кода, любые фильтры исключений, связанные с этим кодом, и все обработчики исключений (операторы `catch`). Эта таблица исключений весьма эффективна и не вызывает снижения производительности системы (времени процессора или использования памяти) при отсутствии исключений. Ресурсы используются, только когда происходит исключение.  
  
 Таблица сведений об исключении предоставляет четыре типа обработчиков исключений для защищенных блоков.  
  
-   Обработчик `finally`, который выполняется всякий раз при выходе из блока независимо от того, происходит это в нормальном потоке управления или случается в результате необработанного исключения.  
  
-   Обработчик сбоев, который должен выполняться при возникновении исключения, но не выполняется по завершении нормального потока управления.  
  
-   Обработчик с фильтрацией по типу, который обрабатывает любое исключение заданного класса или любых из его производных классов.  
  
-   Отфильтрованный пользователем обработчик, который запускает заданный пользователем код, чтобы определить, должно ли исключение обрабатываться связанным обработчиком или передаваться в следующий защищенный блок.  
  
 Каждый язык реализует такие обработчики исключений в соответствии со своей спецификацией. Например, Visual Basic предоставляет доступ к обработчику с пользовательской фильтрацией посредством сравнения переменных (с помощью ключевого слова `When`) в операторе `catch`. В C# обработчик с пользовательской фильтрацией не реализован.  
  
 При возникновении исключения среда выполнения начинает двухэтапный процесс.  
  
1.  Среда выполнения ищет массив для первого защищенного блока, который выполняет следующие действия.  
  
    -   Защищает область с выполняющейся в настоящее время инструкцией.  
  
    -   Содержит обработчик исключений или фильтр, обрабатывающий исключение.  
  
2.  Если они совпадают, среда выполнения создает объект <xref:System.Exception> с описанием исключения. Затем среда выполнения выполняет все операторы `finally` или fault между оператором, где произошло исключение, и оператором, где оно обрабатывается. Обратите внимание, что важен порядок размещения обработчиков исключений; самый внутренний разработчик исключений оценивается первым. Также обратите внимание, что у обработчиков исключений имеется доступ к локальным переменным и локальной памяти подпрограммы, перехватывающей исключение, однако промежуточные значения, получаемые во время создания исключения, теряются.  
  
     Если в текущем методе соответствий не найдено, среда выполнения выполняет поиск в каждом вызывающем объекте текущего метода и продолжает идти по этому пути вплоть до стека. Если вызывающий объект имеет соответствие, среда выполнения позволяет отладчику выполнить доступ к исключению. Если отладчик не присоединяется к исключению, среда выполнения вызывает событие <xref:System.AppDomain.UnhandledException?displayProperty=fullName>. Если отсутствуют прослушиватели для данного события, среда выполнения удаляет трассировку стека и завершает работу приложения.  
  
 [К началу](#top)  
  
<a name="filtering_runtime_exceptions"></a>   
## <a name="filtering-runtime-exceptions"></a>Фильтрация исключений среды выполнения  
 Можно выполнить фильтрацию перехватываемых исключений и обработать их по типу или любым другим определенным пользователем критериям.  
  
 Обработчики с фильтрацией по типу управляют определенным типом исключения (или производными от него классами). В следующем примере показан обработчик с фильтрацией по типу, который предназначен для перехвата определенного исключения, в нашем случае это <xref:System.IO.FileNotFoundException>.  
  
 [!code-cpp[CatchException#5](../../../samples/snippets/cpp/VS_Snippets_CLR/CatchException/CPP/catchexception3.cpp#5)]
 [!code-csharp[CatchException#5](../../../samples/snippets/csharp/VS_Snippets_CLR/CatchException/CS/catchexception3.cs#5)]
 [!code-vb[CatchException#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/CatchException/VB/catchexception3.vb#5)]  
  
 Обработчики исключений с пользовательской фильтрацией перехватывают и обрабатывают исключения с учетом определенных для исключения требований. См. дополнительные сведения о фильтрации исключений при [использовании определенных исключений в блоке перехвата](../../../docs/standard/exceptions/how-to-use-specific-exceptions-in-a-catch-block.md).  
  
 [К началу](#top)  
  
<a name="related_topics"></a>   
## <a name="related-topics"></a>Связанные разделы  
  
|Заголовок|Описание|  
|-----------|-----------------|  
|[Класс Exception и его свойства](../../../docs/standard/exceptions/exception-class-and-properties.md)|Описывает элементы объекта исключения.|  
|[Иерархия исключений](../../../docs/standard/exceptions/exception-hierarchy.md)|Описывает исключения, от которых происходит большинство исключений.|  
|[Основы обработки исключений](../../../docs/standard/exceptions/exception-handling-fundamentals.md)|Описание способов обработки исключений с использованием операторов catch, throw и finally|  
|[Рекомендации по обработке исключений](../../../docs/standard/exceptions/best-practices-for-exceptions.md)|Описывает рекомендованные методы обработки исключений.|  
|[Обработка исключений COM-взаимодействия](../../../docs/standard/exceptions/handling-com-interop-exceptions.md)|Описывает способы обработки исключений, созданных и перехваченных в неуправляемом коде.|  
|[Практическое руководство. Сопоставление значений HRESULT и исключений](../../../docs/framework/interop/how-to-map-hresults-and-exceptions.md)|Описывает сопоставление исключений в управляемом и неуправляемом коде.|  
  
<a name="reference"></a>   
## <a name="reference"></a>Ссылка  
 <xref:System.Exception?displayProperty=fullName>  
  
 <xref:System.ApplicationException?displayProperty=fullName>  
  
 <xref:System.SystemException?displayProperty=fullName>
