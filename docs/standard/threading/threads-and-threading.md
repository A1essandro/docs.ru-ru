---
title: "Потоки и работа с потоками"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- multiple threads
- threading [.NET Framework]
- threading [.NET Framework], multiple threads
ms.assetid: 5baac3aa-e603-4fa6-9f89-0f2c1084e6b1
caps.latest.revision: "14"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: b57cac34009e13c27c6d34a0ab402f9ecbe08305
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2017
---
# <a name="threads-and-threading"></a>Потоки и работа с потоками
Операционные системы используют процессы для разделения разных приложений, которые они выполняются. Потоки являются основными единицами, к которой операционная система выделяет время процессора, а более чем один поток может выполняться код внутри этого процесса. Каждый поток поддерживает обработчики исключений, планируемый приоритет и набор структур, используемых системой для сохранения контекста потока во время его планирования. Контекст потока содержит все сведения, необходимые потока для возобновления выполнения, включая набор регистров Процессора и стек в адресном пространстве процесса потока узлов.  
  
 .NET Framework разделения задачи процесс операционной системы на облегченные управляемые подпроцессы, домены приложений, представленные <xref:System.AppDomain?displayProperty=nameWithType>. Один или несколько управляемых потоков (представленного <xref:System.Threading.Thread?displayProperty=nameWithType>) могут выполняться в один или несколько доменов приложений в одном управляемом процессе. Несмотря на то, что каждый домен приложения запускается с одним потоком, код в этом домене приложения можно создать дополнительные домены приложений и потоки. Результатом является этому управляемый поток может свободно перемещаться между доменами приложения внутри одного управляемого процесса; может иметь только один поток, перемещение между несколькими доменами приложения.  
  
 Операционная система, поддерживающая приоритетную многозадачность создает эффект одновременного выполнения нескольких потоков из нескольких процессов. Это делается путем деления доступного времени процессора между потоками, которым она необходима, выделение отрезок времени процессора для каждого потока, один за другим. Текущий выполняемый поток приостанавливается в том случае, если его время, прошедшее среза и другой поток возобновляет выполнение. При переключении из одного потока в другой, он сохраняет контекст потока, работа которого и перезагружает контекст сохраняется следующему потоку в очереди потока.  
  
 Длина интервала времени зависит от операционной системы и процессора. Так как каждый временной срез мал, нескольких потоков будет выполняться одновременно, даже если имеется только один процессор. Это действительно так в многопроцессорных системах, где выполняемые потоки распределяются между доступными процессорами.  
  
## <a name="when-to-use-multiple-threads"></a>Когда следует использовать несколько потоков  
 Программное обеспечение, требующее вмешательства пользователя необходимо как можно выполнять в многофункциональном пользовательском интерфейсе быстрее реагировать на действия пользователя. В то же время его должен выполнять вычисления, необходимые для представления данных с максимально возможной скоростью пользователем. Если приложение использует только один поток выполнения, можно объединить [асинхронного программирования](../../../docs/standard/asynchronous-programming-patterns/calling-synchronous-methods-asynchronously.md) с[удаленного взаимодействия .NET Framework](http://msdn.microsoft.com/en-us/eccb1d31-0a22-417a-97fd-f4f1f3aa4462) или [веб-служб XML](http://msdn.microsoft.com/en-us/1e64af78-d705-4384-b08d-591a45f4379c) создан с помощью ASP .NET Framework, в которых будет производиться время обработки других компьютеров в дополнение к этому, свои собственные, чтобы увеличить время отклика для пользователя и уменьшить время обработки данных приложения. При выполнении вычислительных операций ввода вывода, можно также использовать порты завершения ввода-вывода для увеличения скорости реагирования приложения.  
  
### <a name="advantages-of-multiple-threads"></a>Преимуществами нескольких потоков  
 Тем не менее, использование более одного потока, является наиболее мощным средством для повышения скорости отклика для пользователя и обработки данных, необходимых для выполнения работы в почти то же время. На компьютере с одним процессором нескольких потоков можно создать этот эффект преимуществами небольшие периоды времени между событиями пользователя для обработки данных в фоновом режиме. Например пользователь может редактировать электронную таблицу, пока другой поток выполняет повторное вычисление другие части таблицы внутри одного приложения.  
  
 Без изменений то же приложение может значительно повысить удовлетворенность пользователей при запуске на компьютере с несколькими процессорами. В одном домене приложения необходимо использовать несколько потоков для выполнения следующих задач:  
  
-   Связи по сети, на веб-сервере и в базе данных.  
  
-   Выполнение операций, которые занимают много времени.  
  
-   Разделение задач по приоритетам. Например поток с высоким приоритетом управляет срочные задачи и низкого приоритета поток выполняет другие задачи.  
  
-   Разрешить пользовательский интерфейс продолжает отвечать на запросы, при выделении времени для фоновой задачи.  
  
### <a name="disadvantages-of-multiple-threads"></a>Недостатки многопоточности  
 Рекомендуется использовать как можно меньшее число потоков, возможно, тем самым сводя к минимуму использование ресурсов операционной системы и повышение производительности. Работа с потоками также имеет потребление ресурсов и потенциальных конфликтов, которые нужно учитывать при разработке приложения. Ниже приведены требования к ресурсам.  
  
-   Система память, используемая для контекстные данные, необходимые процессами, **AppDomain** объектов и потоков. Таким образом, число процессов, **AppDomain** объекты и потоки, которые могут быть созданы, ограничен объемом доступной памяти.  
  
-   Позволяет отслеживать их большое число потоков потребляет значительное количество времени процессора. Если слишком много потоков, большинство из них не будет выполнять очень много. Если большинство текущих потоков в одном процессе, потоки других процессов планируются реже.  
  
-   Контроль выполнения кода с многими потоками является сложной и может быть источником многочисленных ошибок.  
  
-   Уничтожение потоков необходимо учитывать возможные и обработки таких проблем.  
  
 Предоставление общего доступа к ресурсам может привести к конфликтам. Во избежание конфликтов синхронизации или управлять доступом к общим ресурсам. Ошибка синхронизации доступа (в одной или разных доменах приложения) может привести к зависанию (поток перестает отвечать на запросы во время каждого ожидания завершения операции другим) и состояния гонки (при возникновении непредвиденных результатов из-за неверной зависимости между временем двух событий). Система предоставляет объектов синхронизации, которые могут использоваться для управления распределением ресурсов между несколькими потоками. Уменьшение числа потоков упрощает синхронизации ресурсов.  
  
 Следующие ресурсы, которые требуется синхронизация.  
  
-   Ресурсы системы (например, номера портов).  
  
-   Ресурсы, используемые несколькими процессами (дескрипторы файлов).  
  
-   Ресурсы одним доменом приложения (такие как глобальные, статические или поля экземпляров) доступно для нескольких потоков.  
  
### <a name="threading-and-application-design"></a>Разработка потоков и приложений  
 В целом, использование <xref:System.Threading.ThreadPool> класса является самым простым способом для обработки нескольких потоков для относительно простых задач, не будет блокировать другие потоки и при отсутствии планирования задач. Однако существует ряд причин для создания собственных потоков.  
  
-   Если вам требуется задачу, которая будет иметь определенный приоритет.  
  
-   Если задача, которая может занять много времени (и поэтому блокируются другие задачи).  
  
-   Если необходимо поместить потоки в однопотоковое подразделение (все **ThreadPool** потоки находятся в многопотоковом подразделении).  
  
-   Если вам требуется постоянное удостоверение, сопоставленное с потоком. Например следует использовать по одному выделенному потоку для отмены этого потока, приостановки или обнаружить его по имени.  
  
-   Если необходимо выполнять фоновые потоки, которые взаимодействуют с пользовательским интерфейсом, платформа .NET Framework версии 2.0 предоставляет <xref:System.ComponentModel.BackgroundWorker> компонент, который работает с помощью событий, используя маршалинг между потоками в поток пользовательского интерфейса.  
  
### <a name="threading-and-exceptions"></a>Потоки и исключений  
 Обработка исключений в потоках. Необработанные исключения в потоках, даже в фоновых потоках, обычно завершает процесс. Существует три исключения из этого правила.  
  
-   Объект <xref:System.Threading.ThreadAbortException> создается исключение в потоке, так как <xref:System.Threading.Thread.Abort%2A> был вызван.  
  
-   <xref:System.AppDomainUnloadedException> Исключение в потоке, так как домен приложения выгружается.  
  
-   Среда CLR или процесс ведущего приложения прерывает выполнение потока.  
  
 Дополнительные сведения см. в разделе [исключения в управляемых потоках](../../../docs/standard/threading/exceptions-in-managed-threads.md).  
  
> [!NOTE]
>  В .NET Framework версий 1.0 и 1.1 среда без уведомления перехватывает некоторые исключения, например в потоках из пула потоков. Это может привести к повреждению состояния приложения и в итоге привести к зависанию приложений, которые могут быть очень трудно отлаживать.  
  
## <a name="see-also"></a>См. также  
 <xref:System.Threading.ThreadPool>  
 <xref:System.ComponentModel.BackgroundWorker>  
 [Синхронизация данных для многопоточности](../../../docs/standard/threading/synchronizing-data-for-multithreading.md)  
 [Пул управляемых потоков](../../../docs/standard/threading/the-managed-thread-pool.md)
