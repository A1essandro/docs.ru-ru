---
title: "Пошаговое руководство. Создание конвейера потока данных"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- dataflow pipelines, creating with TPL
- Task Parallel Library, dataflows
- TPL dataflow library, creating dataflow pipeline
ms.assetid: 69308f82-aa22-4ac5-833d-e748533b58e8
caps.latest.revision: "11"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: d63fb872382bfc0a3ba3b8637c7357ab65c58fbf
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="walkthrough-creating-a-dataflow-pipeline"></a><span data-ttu-id="475b7-102">Пошаговое руководство. Создание конвейера потока данных</span><span class="sxs-lookup"><span data-stu-id="475b7-102">Walkthrough: Creating a Dataflow Pipeline</span></span>
<span data-ttu-id="475b7-103">Несмотря на то, что можно использовать <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A?displayProperty=nameWithType>, и <xref:System.Threading.Tasks.Dataflow.DataflowBlock.TryReceive%2A?displayProperty=nameWithType> для получения сообщений от блоков источника, можно также соединять блоки сообщений для формы *конвейера потока данных*.</span><span class="sxs-lookup"><span data-stu-id="475b7-103">Although you can use the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A?displayProperty=nameWithType>, and <xref:System.Threading.Tasks.Dataflow.DataflowBlock.TryReceive%2A?displayProperty=nameWithType> methods to receive messages from source blocks, you can also connect message blocks to form a *dataflow pipeline*.</span></span> <span data-ttu-id="475b7-104">Конвейер потока данных — это ряд компонентов, или *блоков потока данных*, каждый из которых выполняет конкретную задачу в более крупной цели.</span><span class="sxs-lookup"><span data-stu-id="475b7-104">A dataflow pipeline is a series of components, or *dataflow blocks*, each of which performs a specific task that contributes to a larger goal.</span></span> <span data-ttu-id="475b7-105">Каждый блок потока данных в конвейере потока данных выполняет работу, когда получает сообщение от другого блока потока данных.</span><span class="sxs-lookup"><span data-stu-id="475b7-105">Every dataflow block in a dataflow pipeline performs work when it receives a message from another dataflow block.</span></span> <span data-ttu-id="475b7-106">Можно сравнить это с линией сборки автомобилей.</span><span class="sxs-lookup"><span data-stu-id="475b7-106">An analogy to this is an assembly line for automobile manufacturing.</span></span> <span data-ttu-id="475b7-107">Как при продвижении автомобиля по сборочной линии одна станция собирает раму, следующая — устанавливает двигатель и так далее.</span><span class="sxs-lookup"><span data-stu-id="475b7-107">As each vehicle passes through the assembly line, one station assembles the frame, the next one installs the engine, and so on.</span></span> <span data-ttu-id="475b7-108">Так как при этом можно собирать одновременно много автомобилей, линия сборки обеспечивает большую производительность, чем полная сборка автомобилей по одному.</span><span class="sxs-lookup"><span data-stu-id="475b7-108">Because an assembly line enables multiple vehicles to be assembled at the same time, it provides better throughput than assembling complete vehicles one at a time.</span></span>  
  
> [!TIP]
>  <span data-ttu-id="475b7-109">Библиотека потоков данных TPL (пространство имен <xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType>) не поставляется с [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span><span class="sxs-lookup"><span data-stu-id="475b7-109">The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span></span> <span data-ttu-id="475b7-110">Чтобы установить <xref:System.Threading.Tasks.Dataflow> пространства имен, откройте проект в [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], выберите **управление пакетами NuGet** меню проекта и выполните поиск в Интернете `Microsoft.Tpl.Dataflow` пакета.</span><span class="sxs-lookup"><span data-stu-id="475b7-110">To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package.</span></span>  
  
 <span data-ttu-id="475b7-111">В этом документе демонстрируется конвейер потока данных, который загружает книгу *Илиада Гомера* с веб-сайта и выполняет поиск в тексте для сопоставления отдельных слов со словами, в которых переставлены первые символы слова.</span><span class="sxs-lookup"><span data-stu-id="475b7-111">This document demonstrates a dataflow pipeline that downloads the book *The Iliad of Homer* from a website and searches the text to match individual words with words that reverse the first word's characters.</span></span> <span data-ttu-id="475b7-112">Формирование конвейера потока данных в этом документе состоит из следующих шагов.</span><span class="sxs-lookup"><span data-stu-id="475b7-112">The formation of the dataflow pipeline in this document consists of the following steps:</span></span>  
  
1.  <span data-ttu-id="475b7-113">Создание блоков потока данных, которые участвуют в конвейере.</span><span class="sxs-lookup"><span data-stu-id="475b7-113">Create the dataflow blocks that participate in the pipeline.</span></span>  
  
2.  <span data-ttu-id="475b7-114">Подсоединение каждого блока потока данных к следующему блоку в конвейере.</span><span class="sxs-lookup"><span data-stu-id="475b7-114">Connect each dataflow block to the next block in the pipeline.</span></span> <span data-ttu-id="475b7-115">Каждый блок получает в качестве входных данных выходные данные предыдущего блока в конвейере.</span><span class="sxs-lookup"><span data-stu-id="475b7-115">Each block receives as input the output of the previous block in the pipeline.</span></span>  
  
3.  <span data-ttu-id="475b7-116">Для каждого блока потока данных создайте задачу продолжения, которая переводит следующий блок в завершенное состояние, после того как заканчивается выполнение предыдущего блока.</span><span class="sxs-lookup"><span data-stu-id="475b7-116">For each dataflow block, create a continuation task that sets the next block to the completed state after the previous block finishes.</span></span>  
  
4.  <span data-ttu-id="475b7-117">Отправьте данные в начало конвейера.</span><span class="sxs-lookup"><span data-stu-id="475b7-117">Post data to the head of the pipeline.</span></span>  
  
5.  <span data-ttu-id="475b7-118">Пометьте начало конвейера как завершенное.</span><span class="sxs-lookup"><span data-stu-id="475b7-118">Mark the head of the pipeline as completed.</span></span>  
  
6.  <span data-ttu-id="475b7-119">Подождите, пока конвейер не завершит всю работу.</span><span class="sxs-lookup"><span data-stu-id="475b7-119">Wait for the pipeline to complete all work.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="475b7-120">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="475b7-120">Prerequisites</span></span>  
 <span data-ttu-id="475b7-121">Прежде чем начать выполнение этого пошагового руководства, ознакомьтесь с документом [Поток данных](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="475b7-121">Read [Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) before you start this walkthrough.</span></span>  
  
## <a name="creating-a-console-application"></a><span data-ttu-id="475b7-122">Создание консольного приложения</span><span class="sxs-lookup"><span data-stu-id="475b7-122">Creating a Console Application</span></span>  
 <span data-ttu-id="475b7-123">В [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] создайте новый проект консольного приложения [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] или [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)].</span><span class="sxs-lookup"><span data-stu-id="475b7-123">In [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], create a [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] or [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] Console Application project.</span></span> <span data-ttu-id="475b7-124">Добавьте ссылку на System.Threading.Tasks.Dataflow.dll.</span><span class="sxs-lookup"><span data-stu-id="475b7-124">Add a reference to System.Threading.Tasks.Dataflow.dll.</span></span>  
  
 <span data-ttu-id="475b7-125">Кроме того, создайте файл и назовите его `ReverseWords.cs` (`ReverseWords.vb` для [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), а затем запустите следующую команду в окне командной строки Visual Studio, чтобы скомпилировать проект.</span><span class="sxs-lookup"><span data-stu-id="475b7-125">Alternatively, create a file and name it `ReverseWords.cs` (`ReverseWords.vb` for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), and then run the following command in a Visual Studio Command Prompt window to compile the project.</span></span>  
  
 [!INCLUDE[csprcs](../../../includes/csprcs-md.md)]  
  
 <span data-ttu-id="475b7-126">**CSC.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.cs**</span><span class="sxs-lookup"><span data-stu-id="475b7-126">**csc.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.cs**</span></span>  
  
 [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]  
  
 <span data-ttu-id="475b7-127">**vbc.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.vb**</span><span class="sxs-lookup"><span data-stu-id="475b7-127">**vbc.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.vb**</span></span>  
  
 <span data-ttu-id="475b7-128">Добавьте следующий код в проект для создания простого приложения.</span><span class="sxs-lookup"><span data-stu-id="475b7-128">Add the following code to your project to create the basic application.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#2)]
 [!code-vb[TPLDataflow_Palindromes#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#2)]  
  
## <a name="creating-the-dataflow-blocks"></a><span data-ttu-id="475b7-129">Создание блоков потоков данных</span><span class="sxs-lookup"><span data-stu-id="475b7-129">Creating the Dataflow Blocks</span></span>  
 <span data-ttu-id="475b7-130">Добавьте следующий код в метод `Main` для создания блоков потока данных, которые участвуют в конвейере.</span><span class="sxs-lookup"><span data-stu-id="475b7-130">Add the following code to the `Main` method to create the dataflow blocks that participate in the pipeline.</span></span> <span data-ttu-id="475b7-131">Таблица ниже описывает роль каждой части конвейера.</span><span class="sxs-lookup"><span data-stu-id="475b7-131">The table that follows summarizes the role of each member of the pipeline.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#3)]
 [!code-vb[TPLDataflow_Palindromes#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#3)]  
  
|<span data-ttu-id="475b7-132">Член</span><span class="sxs-lookup"><span data-stu-id="475b7-132">Member</span></span>|<span data-ttu-id="475b7-133">Тип</span><span class="sxs-lookup"><span data-stu-id="475b7-133">Type</span></span>|<span data-ttu-id="475b7-134">Описание</span><span class="sxs-lookup"><span data-stu-id="475b7-134">Description</span></span>|  
|------------|----------|-----------------|  
|`downloadString`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="475b7-135">Загружает текст книги из Интернета.</span><span class="sxs-lookup"><span data-stu-id="475b7-135">Downloads the book text from the Web.</span></span>|  
|`createWordList`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="475b7-136">Разбивает текст книги на массив слов.</span><span class="sxs-lookup"><span data-stu-id="475b7-136">Separates the book text into an array of words.</span></span>|  
|`filterWordList`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="475b7-137">Удаляет короткие слова из массива слов, упорядочивает оставшиеся слова в алфавитном порядке и удаляет дубликаты.</span><span class="sxs-lookup"><span data-stu-id="475b7-137">Removes short words from the word array, orders the resulting words alphabetically, and remove duplicates.</span></span>|  
|`findReversedWords`|<xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>|<span data-ttu-id="475b7-138">Находит все слова в отфильтрованной коллекции массива слов, которые также встречаются в массиве слов с обратным порядком символов.</span><span class="sxs-lookup"><span data-stu-id="475b7-138">Finds all words in the filtered word array collection whose reverse also occurs in the word array.</span></span>|  
|`printReversedWords`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="475b7-139">Выводит на консоль слова и соответствующие обратные слова.</span><span class="sxs-lookup"><span data-stu-id="475b7-139">Displays words and the corresponding reverse words to the console.</span></span>|  
  
 <span data-ttu-id="475b7-140">Хотя можно объединить несколько шагов конвейера потока данных в этом примере в один шаг, на примере демонстрируется концепция создания нескольких независимых задач потока данных для выполнения более крупной задачи.</span><span class="sxs-lookup"><span data-stu-id="475b7-140">Although you could combine multiple steps in the dataflow pipeline in this example into one step, the example illustrates the concept of composing multiple independent dataflow tasks to perform a larger task.</span></span> <span data-ttu-id="475b7-141">В примере используется <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>, чтобы позволить каждой части конвейера выполнить операцию с ее входными данными и отправить результат на следующий этап конвейера.</span><span class="sxs-lookup"><span data-stu-id="475b7-141">The example uses <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> to enable each member of the pipeline to perform an operation on its input data and send the results to the next step in the pipeline.</span></span> <span data-ttu-id="475b7-142">Часть конвейера `findReversedWords` — это объект <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>, поскольку он создает несколько независимых выходных данных для каждого входного значения.</span><span class="sxs-lookup"><span data-stu-id="475b7-142">The `findReversedWords` member of the pipeline is a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object because it produces multiple independent outputs for each input.</span></span> <span data-ttu-id="475b7-143">Конец конвейера, `printReversedWords`, — это объект <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, так как он выполняет действие со входными данными и не создает выходных данных.</span><span class="sxs-lookup"><span data-stu-id="475b7-143">The tail of the pipeline, `printReversedWords`, is a <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object because it performs an action on its input, and does not produce a result.</span></span>  
  
## <a name="forming-the-pipeline"></a><span data-ttu-id="475b7-144">Формирование конвейера</span><span class="sxs-lookup"><span data-stu-id="475b7-144">Forming the Pipeline</span></span>  
 <span data-ttu-id="475b7-145">Добавьте следующий код, чтобы подсоединить каждый блок к следующему блоку конвейера.</span><span class="sxs-lookup"><span data-stu-id="475b7-145">Add the following code to connect each block to the next block in the pipeline.</span></span>  
  
 <span data-ttu-id="475b7-146">При вызове метода <xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A> для подсоединения блока потока данных источника к блоку потока данных целевого объекта, блок потока данных источника передает данные блокам целевых объектов, как только данные становятся доступны.</span><span class="sxs-lookup"><span data-stu-id="475b7-146">When you call the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A> method to connect a source dataflow block to a target dataflow block, the source dataflow block propagates data to the target block as data becomes available.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#4)]
 [!code-vb[TPLDataflow_Palindromes#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#4)]  
  
## <a name="creating-the-completion-tasks"></a><span data-ttu-id="475b7-147">Создание задач завершения</span><span class="sxs-lookup"><span data-stu-id="475b7-147">Creating the Completion Tasks</span></span>  
 <span data-ttu-id="475b7-148">Добавьте следующий код, чтобы каждый блок потока данных мог выполнять заключительное действие после обработки всех данных.</span><span class="sxs-lookup"><span data-stu-id="475b7-148">Add the following code to enable each dataflow block to perform a final action after it processes all data.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#5)]
 [!code-vb[TPLDataflow_Palindromes#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#5)]  
  
 <span data-ttu-id="475b7-149">Для передачи информации о завершении по конвейеру каждая задача завершения переводит следующий блок потока данных в завершенное состояние.</span><span class="sxs-lookup"><span data-stu-id="475b7-149">To propagate completion through the pipeline, each completion task sets the next dataflow block to the completed state.</span></span> <span data-ttu-id="475b7-150">Например, если начало конвейера переводится в состояние завершения, оно обрабатывает все оставшиеся буферизованные сообщения и запускает задачу завершения, которая переводит вторую часть конвейера в состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="475b7-150">For example, when the head of the pipeline is set to the completed state, it processes any remaining buffered messages and then runs its completion task, which sets the second member of the pipeline to the completed state.</span></span> <span data-ttu-id="475b7-151">Вторая часть конвейера, в свою очередь, обрабатывает все оставшиеся буферизованные сообщение и запускает задачу завершения, которая переводит третью часть конвейера в состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="475b7-151">The second member of the pipeline in turn processes any remaining buffered messages and then runs its completion task, which sets the third member of the pipeline to the completed state.</span></span> <span data-ttu-id="475b7-152">Этот процесс продолжается до тех пор, пока все части конвейера не завершат работу.</span><span class="sxs-lookup"><span data-stu-id="475b7-152">This process continues until all members of the pipeline finish.</span></span> <span data-ttu-id="475b7-153">В этом примере используется ключевое слово `delegate` (`Function` в [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) для определения задач продолжения.</span><span class="sxs-lookup"><span data-stu-id="475b7-153">This example uses the `delegate` keyword (`Function` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) to define the continuation tasks.</span></span>  
  
## <a name="posting-data-to-the-pipeline"></a><span data-ttu-id="475b7-154">Передача данных в конвейере</span><span class="sxs-lookup"><span data-stu-id="475b7-154">Posting Data to the Pipeline</span></span>  
 <span data-ttu-id="475b7-155">Добавьте следующий код для помещения URL-адрес книги *Илиада Гомера* в начало конвейера потока данных.</span><span class="sxs-lookup"><span data-stu-id="475b7-155">Add the following code to post the URL of the book *The Iliad of Homer* to the head of the dataflow pipeline.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#6)]
 [!code-vb[TPLDataflow_Palindromes#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#6)]  
  
 <span data-ttu-id="475b7-156">В этом примере используется <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A?displayProperty=nameWithType> для синхронной отправки данных в начало конвейера.</span><span class="sxs-lookup"><span data-stu-id="475b7-156">This example uses <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A?displayProperty=nameWithType> to synchronously send data to the head of the pipeline.</span></span> <span data-ttu-id="475b7-157">Используйте метод <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A?displayProperty=nameWithType> при необходимости асинхронной отправки данных в узел потока данных.</span><span class="sxs-lookup"><span data-stu-id="475b7-157">Use the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A?displayProperty=nameWithType> method when you must asynchronously send data to a dataflow node.</span></span>  
  
## <a name="completing-pipeline-activity"></a><span data-ttu-id="475b7-158">Завершение работы конвейера</span><span class="sxs-lookup"><span data-stu-id="475b7-158">Completing Pipeline Activity</span></span>  
 <span data-ttu-id="475b7-159">Добавьте следующий код, чтобы пометить начало конвейера как завершенное.</span><span class="sxs-lookup"><span data-stu-id="475b7-159">Add the following code to mark the head of the pipeline as completed.</span></span> <span data-ttu-id="475b7-160">Начало конвейера выполняет свою задачу продолжения после обработки всех буферизованных сообщений.</span><span class="sxs-lookup"><span data-stu-id="475b7-160">The head of the pipeline runs its continuation task after it processes all buffered messages.</span></span> <span data-ttu-id="475b7-161">Эта задача продолжения передает состояние завершения по конвейеру.</span><span class="sxs-lookup"><span data-stu-id="475b7-161">This continuation task propagates the completed state through the pipeline.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#7)]
 [!code-vb[TPLDataflow_Palindromes#7](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#7)]  
  
 <span data-ttu-id="475b7-162">Этот пример отправляет один url-адрес через конвейер потока данных для обработки.</span><span class="sxs-lookup"><span data-stu-id="475b7-162">This example sends one URL through the dataflow pipeline to be processed.</span></span> <span data-ttu-id="475b7-163">Если на вход подается более одного элемента данных, вызовите метод <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A?displayProperty=nameWithType> после передачи всех входных данных.</span><span class="sxs-lookup"><span data-stu-id="475b7-163">If you send more than one input through a pipeline, call the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A?displayProperty=nameWithType> method after you submit all the input.</span></span> <span data-ttu-id="475b7-164">Этот шаг можно пропустить, если в вашем приложении нет определенной точки, в которой данные более недоступны или приложение не должно ожидать завершения работы конвейера.</span><span class="sxs-lookup"><span data-stu-id="475b7-164">You can omit this step if your application has no well-defined point at which data is no longer available or the application does not have to wait for the pipeline to finish.</span></span>  
  
## <a name="waiting-for-the-pipeline-to-finish"></a><span data-ttu-id="475b7-165">Ожидание завершения работы конвейера</span><span class="sxs-lookup"><span data-stu-id="475b7-165">Waiting for the Pipeline to Finish</span></span>  
 <span data-ttu-id="475b7-166">Добавьте следующий код, чтобы ожидать завершения работы конвейера.</span><span class="sxs-lookup"><span data-stu-id="475b7-166">Add the following code to wait for the pipeline to finish.</span></span> <span data-ttu-id="475b7-167">Поскольку в этом примере используются задачи продолжения для передачи состояния завершения по конвейеру, общая операция завершится, когда завершит работу конец конвейера.</span><span class="sxs-lookup"><span data-stu-id="475b7-167">Because this example uses continuation tasks to propagate completion through the pipeline, the overall operation is finished when the tail of the pipeline finishes.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#8](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#8)]
 [!code-vb[TPLDataflow_Palindromes#8](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#8)]  
  
 <span data-ttu-id="475b7-168">Можно ожидать завершения потока данных из любого потока или из нескольких потоков одновременно.</span><span class="sxs-lookup"><span data-stu-id="475b7-168">You can wait for dataflow completion from any thread or from multiple threads at the same time.</span></span>  
  
## <a name="the-complete-example"></a><span data-ttu-id="475b7-169">Полный пример</span><span class="sxs-lookup"><span data-stu-id="475b7-169">The Complete Example</span></span>  
 <span data-ttu-id="475b7-170">В следующем примере приведен полный код для этого руководства.</span><span class="sxs-lookup"><span data-stu-id="475b7-170">The following example shows the complete code for this walkthrough.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#1)]
 [!code-vb[TPLDataflow_Palindromes#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#1)]  
  
## <a name="next-steps"></a><span data-ttu-id="475b7-171">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="475b7-171">Next Steps</span></span>  
 <span data-ttu-id="475b7-172">В этом примере один url-адрес отправляется на обработку через конвейер потока данных.</span><span class="sxs-lookup"><span data-stu-id="475b7-172">This example sends one URL to process through the dataflow pipeline.</span></span> <span data-ttu-id="475b7-173">Если через конвейер отправляется более одного входного значения, можно внедрить в приложении форму параллелизма, которая напоминает перемещение деталей по автомобильному заводу.</span><span class="sxs-lookup"><span data-stu-id="475b7-173">If you send more than one input value through a pipeline, you can introduce a form of parallelism into your application that resembles how parts might move through an automobile factory.</span></span> <span data-ttu-id="475b7-174">Когда первая часть конвейера отправляет свой результат второй части, она может обрабатывать другой элемент параллельно с тем, как вторая часть обрабатывает первый результат.</span><span class="sxs-lookup"><span data-stu-id="475b7-174">When the first member of the pipeline sends its result to the second member, it can process another item in parallel as the second member processes the first result.</span></span>  
  
 <span data-ttu-id="475b7-175">Параллелизм, достигается с помощью конвейеров потока данных называется *грубый параллелизм* , так как он обычно состоит из небольшого количества крупных задач.</span><span class="sxs-lookup"><span data-stu-id="475b7-175">The parallelism that is achieved by using dataflow pipelines is known as *coarse-grained parallelism* because it typically consists of fewer, larger tasks.</span></span> <span data-ttu-id="475b7-176">Можно также использовать более *точного параллелизма* из меньших быстро выполняемых задач в конвейере потока данных.</span><span class="sxs-lookup"><span data-stu-id="475b7-176">You can also use a more *fine-grained parallelism* of smaller, short-running tasks in a dataflow pipeline.</span></span> <span data-ttu-id="475b7-177">В этом примере часть конвейера `findReversedWords` использует метод <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> для параллельной обработки нескольких элементов в списке работ.</span><span class="sxs-lookup"><span data-stu-id="475b7-177">In this example, the `findReversedWords` member of the pipeline uses the <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> method to process multiple items in the work list in parallel.</span></span> <span data-ttu-id="475b7-178">Использование точного параллелизма в конвейере с несколькими крупными функциями может повысить общую пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="475b7-178">The use of fine-grained parallelism in a coarse-grained pipeline can improve overall throughput.</span></span>  
  
 <span data-ttu-id="475b7-179">Блок потока данных источника можно также подключиться к нескольким целевым блокам для создания *сети потока данных*.</span><span class="sxs-lookup"><span data-stu-id="475b7-179">You can also connect a source dataflow block to multiple target blocks to create a *dataflow network*.</span></span> <span data-ttu-id="475b7-180">Перегруженная версия метода <xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A> принимает объект <xref:System.Predicate%601>, который определяет, примет ли целевой объект сообщение, основываясь на его значении.</span><span class="sxs-lookup"><span data-stu-id="475b7-180">The overloaded version of the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A> method takes a <xref:System.Predicate%601> object that defines whether the target block accepts each message based on its value.</span></span> <span data-ttu-id="475b7-181">Большинство типов блоков потока данных, выполняющих роль источников, предлагают сообщения всем подключенным целевым блокам в порядке их подсоединения, пока один из блоков не примет это сообщение.</span><span class="sxs-lookup"><span data-stu-id="475b7-181">Most dataflow block types that act as sources offer messages to all connected target blocks, in the order in which they were connected, until one of the blocks accepts that message.</span></span> <span data-ttu-id="475b7-182">С помощью этого механизма фильтрации можно создавать системы связанных блоков потока данных, которые будут направлять определенные по одному пути, а другие данные — по другому пути.</span><span class="sxs-lookup"><span data-stu-id="475b7-182">By using this filtering mechanism, you can create systems of connected dataflow blocks that direct certain data through one path and other data through another path.</span></span> <span data-ttu-id="475b7-183">Пример использования фильтрации для создания сети потока данных см. в разделе [Пошаговое руководство: использование потока данных в приложении Windows Forms](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md).</span><span class="sxs-lookup"><span data-stu-id="475b7-183">For an example that uses filtering to create a dataflow network, see [Walkthrough: Using Dataflow in a Windows Forms Application](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="475b7-184">См. также</span><span class="sxs-lookup"><span data-stu-id="475b7-184">See Also</span></span>  
 [<span data-ttu-id="475b7-185">Поток данных</span><span class="sxs-lookup"><span data-stu-id="475b7-185">Dataflow</span></span>](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)
