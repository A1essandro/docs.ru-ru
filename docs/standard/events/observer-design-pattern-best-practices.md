---
title: "Рекомендации по шаблону разработки Observer | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-standard"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "рекомендации [платформа .NET Framework], шаблон разработки наблюдателя"
  - "шаблон разработки наблюдателя [платформа .NET Framework], рекомендации"
ms.assetid: c834760f-ddd4-417f-abb7-a059679d5b8c
caps.latest.revision: 9
author: "rpetrusha"
ms.author: "ronpet"
manager: "wpickett"
caps.handback.revision: 9
---
# Рекомендации по шаблону разработки Observer
На платформе .NET Framework шаблон разработки наблюдателя реализован в виде набора интерфейсов.  Интерфейс <xref:System.IObservable%601?displayProperty=fullName> представляет поставщик данных, который также отвечает за предоставление реализации <xref:System.IDisposable>, позволяющей наблюдателям отменять подписку на уведомления.  Интерфейс <xref:System.IObserver%601?displayProperty=fullName> представляет наблюдателя.  В этом разделе содержатся рекомендации, которым должны следовать разработчики при реализации шаблона разработки наблюдателя с помощью этих интерфейсов.  
  
## Потоки  
 Как правило, поставщик реализует метод <xref:System.IObservable%601.Subscribe%2A?displayProperty=fullName> путем добавления определенного наблюдателя в список подписчиков, представленный неким объектом коллекции, и он реализует метод <xref:System.IDisposable.Dispose%2A?displayProperty=fullName> путем удаления определенного наблюдателя из списка подписчиков.  Наблюдатель может вызвать эти методы в любое время.  Кроме того, поскольку в контракте поставщика и наблюдателя не указано, кто несет ответственность за отмену подписки после реализации метода обратного вызова <xref:System.IObserver%601.OnCompleted%2A?displayProperty=fullName>, попытаться удалить тот же самый элемент из списка может как поставщик, так и наблюдатель.  В связи с этим методы <xref:System.IObservable%601.Subscribe%2A> и <xref:System.IDisposable.Dispose%2A> должны быть потокобезопасными.  Как правило, в этом случае предполагается использование [параллельной сборки](../../../docs/standard/parallel-programming/data-structures-for-parallel-programming.md) или блокировки.  Реализации, которые не являются потокобезопасными, должны явным образом сообщать об этом.  
  
 Любые дополнительные гарантии должны быть указаны на уровне выше контракта поставщика и наблюдателя.  Чтобы избежать недоразумений, связанных с контрактом наблюдателя, разработчики должны четко сообщать о введении дополнительных требований.  
  
## Обработка исключений  
 Из\-за слабой связи между поставщиком данных и наблюдателем исключения в шаблоне разработки наблюдателя носят информативный характер.  Это оказывает влияние на процесс обработки исключений поставщиками и наблюдателями в шаблоне разработки наблюдателя.  
  
### Поставщик — вызов метода OnError  
 Метод <xref:System.IObserver%601.OnError%2A> предназначен для использования в качестве информационного сообщения для наблюдателей и очень похож на метод <xref:System.IObserver%601.OnNext%2A?displayProperty=fullName>.  Однако метод <xref:System.IObserver%601.OnNext%2A> позволяет предоставлять наблюдателю текущие или обновленные данных, тогда как метод <xref:System.IObserver%601.OnError%2A> указывает на то, что поставщик не может предоставлять допустимые денные.  
  
 При обработке исключений и вызове метода <xref:System.IObserver%601.OnError%2A> поставщику следует придерживаться приведенных ниже рекомендаций.  
  
-   Поставщик должен обрабатывать свои собственные исключения при наличии конкретных требований.  
  
-   Поставщик не должен ожидать или требовать, чтобы наблюдатели обрабатывали исключения каким\-либо определенным образом.  
  
-   При обработке исключения, подвергающего риску его возможности по предоставлению обновлений, поставщику следует вызывать метод <xref:System.IObserver%601.OnError%2A>.  Информацию по таким исключениям можно передать наблюдателю.  В других случаях уведомлять наблюдателей об исключении не нужно.  
  
 После того, как поставщик вызовет метод <xref:System.IObserver%601.OnError%2A> или <xref:System.IObserver%601.OnCompleted%2A?displayProperty=fullName>, дальнейшие уведомления поступать не должны, и поставщик может отменить подписку для своих наблюдателей.  Однако наблюдатели также могут отменить свою подписку в любой момент — до или после получения уведомления <xref:System.IObserver%601.OnError%2A> или <xref:System.IObserver%601.OnCompleted%2A?displayProperty=fullName>.  В шаблоне разработки наблюдателя не указывается, кто несет ответственность за отмену подписки. Таким образом, есть вероятность, что отменить подписку попытается и поставщик, и наблюдатель.  Обычно наблюдатель, отменяющий подписку, удаляется из коллекции подписчиков.  В однопоточном приложении перед удалением объекта реализация <xref:System.IDisposable.Dispose%2A?displayProperty=fullName> должна гарантировать, что ссылка на объект является действительной и объект входит в коллекцию подписчиков.  В многопоточном приложении следует использовать объект потокобезопасной коллекций, такой как <xref:System.Collections.Concurrent.BlockingCollection%601?displayProperty=fullName>.  
  
### Наблюдатель — реализация метода OnError  
 Когда наблюдатель получает от поставщика уведомление об ошибке, он должен рассматривать исключение как информационное и не обязан выполнять никаких конкретных действий.  
  
 При ответе на вызов метода <xref:System.IObserver%601.OnError%2A> от поставщика наблюдателю следует придерживаться приведенных ниже рекомендаций.  
  
-   Наблюдатель не должен вызывать исключения из своих реализаций интерфейса, таких как <xref:System.IObserver%601.OnNext%2A> или <xref:System.IObserver%601.OnError%2A>.  Однако если наблюдатель не создает исключения, следует ожидать, что исключения останутся необработанными.  
  
-   Чтобы сохранить стек вызовов, наблюдатель, желающий создать объект <xref:System.Exception>, который был передан в его метод <xref:System.IObserver%601.OnError%2A>, должен упаковать исключение до его создания.  Для этой цели можно использовать стандартный объект исключения.  
  
## Дополнительные рекомендации  
 Результатом попытки отмены регистрации в методе <xref:System.IObservable%601.Subscribe%2A?displayProperty=fullName> может быть пустая ссылка.  Поэтому рекомендуется воздержаться от таких действий.  
  
 Несмотря на наличие возможности прикрепить наблюдателя к нескольким поставщикам, рекомендуется присоединить экземпляр <xref:System.IObserver%601> только к одному экземпляру <xref:System.IObservable%601>.  
  
## См. также  
 [Шаблон разработки Observer](../../../docs/standard/events/observer-design-pattern.md)   
 [Практическое руководство. Реализация объекта Observer](../../../docs/standard/events/how-to-implement-an-observer.md)   
 [Практическое руководство. Реализация поставщика](../../../docs/standard/events/how-to-implement-a-provider.md)