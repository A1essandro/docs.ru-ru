---
title: "Практическое руководство. Использование часовых поясов в арифметических операциях с датами и временем | Microsoft Docs"
ms.custom: ""
ms.date: "04/10/2017"
ms.prod: ".net"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-standard"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "арифметические операции [платформа .NET Framework], дата и время"
  - "даты [платформа .NET Framework], сложение и вычитание"
  - "часовые пояса [платформа .NET Framework], арифметические операции"
ms.assetid: 83dd898d-1338-415d-8cd6-445377ab7871
caps.latest.revision: 10
author: "rpetrusha"
ms.author: "ronpet"
manager: "wpickett"
caps.handback.revision: 10
---
# Практическое руководство. Использование часовых поясов в арифметических операциях с датами и временем
Обычно при выполнении арифметических действий над датами и временем с помощью значений <xref:System.DateTime> или <xref:System.DateTimeOffset> правила коррекции часовых поясов не учитываются в результате.  Это верно даже в том случае, когда часовой пояс даты и времени четко определен \(например, если свойству <xref:System.DateTime.Kind%2A> присвоено значение <xref:System.DateTimeKind>\).  В этом разделе описывается порядок выполнения арифметических операций над значениями даты и времени, относящимися к определенному часовому поясу.  Результаты арифметических операций при этом будут учитывать правила коррекции часовых поясов.  
  
### Чтобы учесть правила коррекции в вычислениях с датами и временем, необходимо выполнить следующие действия.  
  
1.  Необходимо каким\-либо способом осуществить тесное связывание значения даты и времени с соответствующим часовым поясом.  К примеру, можно объявить структуру, которая будет содержать значение даты и времени вместе с данными о часовом поясе.  В следующем примере для связывания значения <xref:System.DateTime> с соответствующим ему часовым поясом используется именно этот подход.  
  
     [!code-csharp[System.DateTimeOffset.Conceptual#6](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/cs/Conceptual6.cs#6)]
     [!code-vb[System.DateTimeOffset.Conceptual#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/vb/Conceptual6.vb#6)]  
  
2.  Значение времени необходимо преобразовать во время в формате UTC с помощью вызова метода <xref:System.TimeZoneInfo.ConvertTimeToUtc%2A> или <xref:System.TimeZoneInfo.ConvertTime%2A>.  
  
3.  Далее следует выполнить необходимые арифметические действия над временем UTC.  
  
4.  Время из формата UTC необходимо преобразовать в часовой пояс, соответствующий исходному времени, с помощью метода <xref:System.TimeZoneInfo.ConvertTime%28System.DateTime%2CSystem.TimeZoneInfo%29?displayProperty=fullName>.  
  
## Пример  
 В следующем примере к 9 марта 2008 г., 1:30 центрального стандартного времени прибавляется два часа и тридцать минут.  Переход на летнее время в этом часовом поясе происходит на 30 минут позже, в 2:00 9 марта 2008 г.  Поскольку в этом примере выполнены четыре шага, описанные в предыдущем разделе, он правильно возвращает итоговое время, равное 5:00 9 марта 2008 г.  
  
 [!code-csharp[System.DateTimeOffset.Conceptual#8](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/cs/Conceptual8.cs#8)]
 [!code-vb[System.DateTimeOffset.Conceptual#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/vb/Conceptual8.vb#8)]  
  
 Значения <xref:System.DateTime> и <xref:System.DateTimeOffset> не имеют связи с часовыми поясами, к которым они могут относиться.  Для того, чтобы арифметические действия с датами и временем выполнялись таким образом, что правила коррекции часовых поясов учитывались бы автоматически, сведения о часовом поясе, к которому относятся значения даты и времени, должны быть известны и непосредственно доступны.  Это означает, что значения даты и времени должны быть тесно связаны с часовым поясом.  Для того, чтобы этого добиться, существует целый ряд способов, некоторые из них перечислены ниже.  
  
-   Предположим, что все значения времени, используемые в приложении, принадлежат к определенному часовому поясу.  Хотя этот подход вполне применим во многих случаях, его гибкость и, возможно, переносимость имеют ограничения.  
  
-   Следует определить тип, в котором значение даты и времени тесно связано с часовым поясом, включив эти данные в состав типа в качестве полей.  Этот подход используется в примере кода — в нем определяется структура для хранения даты, времени и часового пояса в двух полях структуры.  
  
 В примере показано, как следует выполнять арифметические действия над значениями <xref:System.DateTime> таким образом, чтобы при получении результата учитывались правила коррекции часовых поясов.  Впрочем, с тем же успехом можно использовать значения <xref:System.DateTimeOffset>.  В следующем примере показано, как можно изменить код из исходного примера так, чтобы вместо значений <xref:System.DateTime> в нем использовались значения <xref:System.DateTimeOffset>.  
  
 [!code-csharp[System.DateTimeOffset.Conceptual#7](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/cs/Conceptual6.cs#7)]
 [!code-vb[System.DateTimeOffset.Conceptual#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/vb/Conceptual6.vb#7)]  
  
 Обратите внимание, что в случае, если эта операция выполняется над значениями <xref:System.DateTimeOffset> без предварительного их преобразования в формат UTC, то результат будет соответствовать правильному моменту времени, но его смещение не будет отражать этот факт по отношению к часовому поясу, к которому принадлежит это время.  
  
## Компиляция кода  
 Для этого примера необходимо следующее.  
  
-   Чтобы ссылка на System.Core.dll была добавлена в проект.  
  
-   Чтобы пространство имен <xref:System> было импортировано с помощью оператора `using` \(обязательно в коде C\#\).  
  
## См. также  
 [Даты, время и часовые пояса](../../../docs/standard/datetime/index.md)   
 [Выполнение арифметических операций с датами и временем](../../../docs/standard/datetime/performing-arithmetic-operations.md)