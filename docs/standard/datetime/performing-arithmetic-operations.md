---
title: "Выполнение арифметических операций с датами и временем | Microsoft Docs"
ms.custom: ""
ms.date: "04/10/2017"
ms.prod: ".net"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-standard"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "арифметические операции [платформа .NET Framework], дата и время"
  - "даты [платформа .NET Framework], арифметические операции"
  - "даты [платформа .NET Framework], сравнение"
  - "DateTime - структура, арифметические операции"
  - "DateTimeOffset - структура, арифметические операции"
  - "часовые пояса [платформа .NET Framework], арифметические операции"
  - "времена [платформа .NET Framework], арифметические операции"
ms.assetid: 87c7ddf2-f15e-48af-8602-b3642237e6d0
caps.latest.revision: 9
author: "rpetrusha"
ms.author: "ronpet"
manager: "wpickett"
caps.handback.revision: 9
---
# Выполнение арифметических операций с датами и временем
Несмотря на то, что структуры <xref:System.DateTime> и <xref:System.DateTimeOffset> предоставляют члены, выполняющие арифметические действия над их значениями, результаты арифметических операций очень различаются.  В данном разделе эти различия описываются в контексте различных уровней представленности сведений о часовом поясе во временных данных, а также рассматриваются способы выполнения операций над датами и временем с полным учетом сведений о часовых поясах.  
  
## Сравнения и арифметические операции со значениями даты и времени  
 Начиная с платформы .NET Framework версии 2.0, в значениях <xref:System.DateTime> присутствуют ограниченные сведения о часовом поясе.  Свойство <xref:System.DateTime.Kind%2A?displayProperty=fullName> позволяет присваивать значению даты и времени значение <xref:System.DateTimeKind>, чтобы указать, представляет ли оно местное время, время в формате UTC или время в неопределенном часовом поясе.  Тем не менее, эти ограниченные сведения о часовом поясе игнорируются при сравнении или выполнении арифметических операций со значениями <xref:System.DateTime>.  Это демонстрируется в следующем примере, где текущее местное время сравнивается с текущим временем в формате UTC.  
  
 [!code-csharp[System.DateTimeOffset.Conceptual#2](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/cs/Conceptual2.cs#2)]
 [!code-vb[System.DateTimeOffset.Conceptual#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/vb/Conceptual2.vb#2)]  
  
 Метод <xref:System.DateTime.CompareTo%28System.DateTime%29> показывает, что местное время предшествует \(меньше\) времени в формате UTC, а операция вычитания свидетельствует о том, что разница между временем в формате UTC и местным временем для систем в тихоокеанском стандартном часовом поясе США составляет семь часов.  Тем не менее, поскольку эти значения дают различные представления одного и того же момента времени, в данном случае очевидно, что причина этого различия целиком кроется в смещении местного часового пояса относительно времени в формате UTC.  
  
 В общем случае свойство <xref:System.DateTime.Kind%2A?displayProperty=fullName> не влияет на результаты, возвращаемые методами сравнения и арифметическими операциями \(как показывает результат сравнения двух идентичных моментов времени\) с <xref:System.DateTime>, хотя оно может повлиять на интерпретацию этих результатов.  Примеры.  
  
-   Результат любой арифметической операции над парой значений даты и времени, свойства <xref:System.DateTime.Kind%2A?displayProperty=fullName> которых имеют значение <xref:System.DateTimeKind>, отражает фактический интервал времени между этими двумя значениями.  Аналогичным образом результат сравнения двух таких значений даты и времени будет точно отражать соотношение между временами.  
  
-   Результат любой арифметической операции или операции сравнения над двумя значениями даты и времени, свойства <xref:System.DateTime.Kind%2A?displayProperty=fullName> которых имеют значение <xref:System.DateTimeKind>, или над двумя значениями даты и времени с различными значениями свойства <xref:System.DateTime.Kind%2A?displayProperty=fullName> будет отражать временную разницу между этими значениями.  
  
-   Арифметические операции или операции сравнения, выполняемые над местными значениями даты и времени, не учитывают допустимость или недопустимость конкретных значений; не учитывают они и какие\-либо правила коррекции, необходимые при переводе местного часового пояса на зимнее или летнее время.  
  
-   В результат любой операции, сравнивающей или вычисляющей разницу между временем в формате UTC и местным временем, входит временной интервал, равный смещению местного часового пояса относительно времени в формате UTC.  
  
-   Любая операция, которая сравнивает или вычисляет разницу между неуказанным временем и временем в формате UTC или местным временем, соответствует простому времени.  Различия между часовыми поясами не учитываются, и в результате не отражено применение правил коррекции часовых поясов.  
  
-   Любая операция, которая сравнивает или вычисляет разницу между двумя неуказанными значениями времени, может включать неизвестный интервал, который отражает временную разницу между двумя различными часовыми поясами.  
  
 Существует множество сценариев, в которых различие часовых поясов не влияет на вычисления с датами и временем \(обзор некоторых из них см. в разделе [Выбор между типами DateTime, DateTimeOffset, TimeSpan и TimeZoneInfo](../../../docs/standard/datetime/choosing-between-datetime.md)\), или же контекст данных даты и времени определяет суть операций сравнения или арифметических операций.  
  
## Сравнения и арифметические операции со значениями DateTimeOffset  
 Значение <xref:System.DateTimeOffset> содержит не только дату и время, но также и смещение, которое однозначно задает его соотношение с временем в формате UTC.  Это дает возможность определить равенство несколько иначе, чем для значений <xref:System.DateTime>.  Если значения <xref:System.DateTime> считаются равными в случае, когда они имеют одинаковое значение даты и времени, то значения <xref:System.DateTimeOffset> считаются равными тогда, когда они ссылаются на один момент времени.  Это делает значение <xref:System.DateTimeOffset> более точным и менее контекстно\-зависимым при использовании в сравнении и в большинстве арифметических операций, которые определяют интервал между двумя значениями даты и времени.  Различия в поведении <xref:System.DateTimeOffset> демонстрирует следующий пример, который является аналогом предыдущего примера, в котором сравнивались значения <xref:System.DateTime> для местного времени и времени в формате UTC.  
  
 [!code-csharp[System.DateTimeOffset.Conceptual#3](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/cs/Conceptual3.cs#3)]
 [!code-vb[System.DateTimeOffset.Conceptual#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/vb/Conceptual3.vb#3)]  
  
 В этом примере метод <xref:System.DateTimeOffset.CompareTo%2A> показывает, что текущее местное время равно текущему времени в формате UTC, а вычитание значений <xref:System.DateTimeOffset> показывает, что разница между двумя значениями времени равна <xref:System.TimeSpan.Zero?displayProperty=fullName>.  
  
 Главным препятствием для использования значений <xref:System.DateTimeOffset> в арифметике дат и времени является то, что значения <xref:System.DateTimeOffset> отражают сведения о часовых поясах не полностью, хоть и содержат некоторую информацию о часовом поясе.  Несмотря на то, что при первом присваивании значения переменной типа <xref:System.DateTimeOffset> смещение <xref:System.DateTimeOffset> соответствует смещению часового пояса относительно времени в формате UTC, впоследствии оно рассогласовывается с часовым поясом.  Поскольку оно больше не связано напрямую с распознаваемым временем, правила коррекции часовых поясов больше не будут учитываться при сложении и вычитании интервалов даты и времени.  
  
 Пример: переход на летнее время в зоне центрального стандартного времени США происходит в 2:00 утра 9 марта, 2008.  Это означает, что при прибавлении двух с половиной часов к 1:30 утра 9 марта 2008 г. центрального стандартного времени США должно получиться 5:00 утра 9 марта 2008 г.  Однако, как показано в следующем примере, результатом сложения является 4:00 9 марта, 2008 г.  Обратите внимание, что такой результат данной операции представляет правильный момент времени, хотя и не является временем в искомом часовом поясе \(в результате не содержится ожидаемое смещение часового пояса\).  
  
 [!code-csharp[System.DateTimeOffset.Conceptual#4](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/cs/Conceptual4.cs#4)]
 [!code-vb[System.DateTimeOffset.Conceptual#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/vb/Conceptual4.vb#4)]  
  
## Арифметические операции со временем в часовых поясах  
 Класс <xref:System.TimeZoneInfo> содержит несколько методов преобразования, которые автоматически применяют правила коррекции при переводе значения времени из одного часового пояса в другой.  Ниже перечислены некоторые из них:  
  
-   методы <xref:System.TimeZoneInfo.ConvertTime%2A> и <xref:System.TimeZoneInfo.ConvertTimeBySystemTimeZoneId%2A>, которые преобразуют значения времени между любыми двумя часовыми поясами;  
  
-   методы <xref:System.TimeZoneInfo.ConvertTimeFromUtc%2A> и <xref:System.TimeZoneInfo.ConvertTimeToUtc%2A>, которые преобразуют время определенного часового пояса во время в формате UTC или время в формате UTC во время определенного часового пояса.  
  
 Дополнительные сведения см. в разделе [Преобразование времени из одного часового пояса в другой](../../../docs/standard/datetime/converting-between-time-zones.md).  
  
 В классе <xref:System.TimeZoneInfo> отсутствуют методы, которые бы автоматически применяли правила коррекции при выполнении арифметических действий с датами и временем.  Тем не менее, этого можно добиться, преобразовав время в часовом поясе во время в формате UTC, выполнив арифметическую операцию и преобразовав время UTC обратно во время в часовом поясе.  Дополнительные сведения см. в разделе [Практическое руководство. Использование часовых поясов в арифметических операциях с датами и временем](../../../docs/standard/datetime/use-time-zones-in-arithmetic.md).  
  
 Например, следующий код аналогичен предыдущему коду, в котором 2,5 часа добавлялись к 2:00 утра 9 марта 2008 г.  Тем не менее, поскольку в этом примере перед выполнением арифметических действий над датой и временем центральное стандартное время преобразуется во время в формате UTC, а затем результат преобразуется из времени UTC обратно в центральное стандартное время, полученное время соответствует переходу центрального стандартного часового пояса на летнее время.  
  
 [!code-csharp[System.DateTimeOffset.Conceptual#5](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/cs/Conceptual5.cs#5)]
 [!code-vb[System.DateTimeOffset.Conceptual#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/vb/Conceptual5.vb#5)]  
  
## См. также  
 [Даты, время и часовые пояса](../../../docs/standard/datetime/index.md)   
 [Практическое руководство. Использование часовых поясов в арифметических операциях с датами и временем](../../../docs/standard/datetime/use-time-zones-in-arithmetic.md)