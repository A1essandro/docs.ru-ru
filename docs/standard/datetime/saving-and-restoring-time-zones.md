---
title: "Сохранение и восстановление часовых поясов"
ms.custom: 
ms.date: 04/10/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- restoring time zones
- deserialization [.NET Framework], time zones
- serialization [.NET Framework], time zones
- time zone objects [.NET Framework], restoring
- saving time zones
- time zone objects [.NET Framework], deserializing
- time zones [.NET Framework], saving
- time zones [.NET Framework], restoring
- time zone objects [.NET Framework], serializing
- time zone objects [.NET Framework], saving
ms.assetid: 4028b310-e7ce-49d4-a646-1e83bfaf6f9d
caps.latest.revision: "9"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: d9451b1b0ff41f32c31ef3574b5684ae5a02e252
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/23/2017
---
# <a name="saving-and-restoring-time-zones"></a>Сохранение и восстановление часовых поясов

<xref:System.TimeZoneInfo> Класс использует данные о предопределенных часовых поясах из реестра. Тем не менее реестр является динамической структурой. Кроме того данные часового пояса, в реестре используется главным образом для проведения коррекции и преобразования времени за текущий год операционной системой. Это имеет два основных последствия для приложений, которые зависят от точных данных часовых поясов.

* Часовой пояс, который является обязательным для приложения не может быть определено в реестре или был переименован или удален из реестра.

* Часовой пояс, который определен в реестре может не иметь сведений о конкретных правилах коррекции, необходимых для преобразований исторических часовых поясов.

<xref:System.TimeZoneInfo> Класс обходит эти ограничения с помощью поддержки сериализации (сохранения) и десериализации (восстановления) данных часового пояса.

## <a name="time-zone-serialization-and-deserialization"></a>Часовой пояс сериализации и десериализации

Сохранение и восстановление часового пояса с помощью сериализации и десериализации данных часового пояса включает только два вызова метода.

* Можно сериализовать <xref:System.TimeZoneInfo> путем вызова метода объекта <xref:System.TimeZoneInfo.ToSerializedString%2A> метод. Метод не принимает никаких параметров и возвращает строку, содержащую сведения о часовом поясе.

* Может выполнить десериализацию <xref:System.TimeZoneInfo> объекта из сериализованной строки, передав эту строку `static` (`Shared` в Visual Basic) <xref:System.TimeZoneInfo.FromSerializedString%2A?displayProperty=nameWithType> метод.

## <a name="serialization-and-deserialization-scenarios"></a>Сценарии сериализации и десериализации

Возможность сохранения (или сериализации) <xref:System.TimeZoneInfo> объекта в строку, а также для восстановления (или десериализации) его для последующего использования повышает эффективность и гибкость <xref:System.TimeZoneInfo> класса. В этом разделе рассматриваются некоторые из ситуаций, в которых сериализация и десериализация наиболее полезны.

### <a name="serializing-and-deserializing-time-zone-data-in-an-application"></a>Сериализация и десериализация данных часового пояса в приложении

Сериализованный часовой пояс может быть восстановлена из строки, когда он необходим. Приложение может сделать это, если часовой пояс, полученный из реестра не удалось правильно преобразовать дату и время в пределах диапазона определенной даты. Например данные о часовом поясе в реестре Windows XP поддерживает единственное правило коррекции, часовые пояса, определенные в реестре Windows Vista, обычно предоставляют сведения о двух правил коррекции. Это означает, что преобразования исторического времени может быть неточной. Это ограничение можно обойти сериализации и десериализации данных часового пояса.

В следующем примере настраиваемый <xref:System.TimeZoneInfo> класса без правил коррекции, определен для представления США. Восточное время зоны с 1883 по 1917 год до введения летнего времени в США. Пользовательский часовой пояс сериализуется в переменной, которая имеет глобальную область. Метод преобразования часового пояса `ConvertUtcTime`, передается универсальное синхронизированное время (UTC) время для преобразования. Если дата и время происходит 1917 года или более ранней версии, пользовательский часовой пояс восточного времени восстанавливается из сериализованной строки и заменяет часовой пояс, полученный из реестра.

[!code-csharp[System.TimeZone2.Serialization.1#1](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.TimeZone2.Serialization.1/cs/Serialization.cs#1)]
[!code-vb[System.TimeZone2.Serialization.1#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.TimeZone2.Serialization.1/vb/Serialization.vb#1)]

### <a name="handling-time-zone-exceptions"></a>Обработка исключений часовых поясов

Поскольку реестра — это динамическая структура, его содержимое подвержены изменения случайно или преднамеренно. Это означает, что часовой пояс, который должен быть определен в реестре и необходим для успешного выполнения приложения может отсутствовать. Не поддерживается для часового пояса сериализации и десериализации, имеется единственная обрабатывать итоговый возможность <xref:System.TimeZoneNotFoundException> , завершив работу приложения. Тем не менее, используя часовой пояс сериализации и десериализации, можно обрабатывать непредвиденные <xref:System.TimeZoneNotFoundException> , восстановив требуемый часовой пояс из сериализованной строки и приложение продолжит работу.

В следующем примере создается и сериализует стандартного центрального пользовательского часового пояса. Затем производится попытка получить часовой пояс стандартного центрального из реестра. Если операция получения создает исключение, либо <xref:System.TimeZoneNotFoundException> или <xref:System.InvalidTimeZoneException>, то обработчик исключений десериализует часовой пояс.

[!code-csharp[System.TimeZone2.Serialization.2#1](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.TimeZone2.Serialization.2/cs/Serialization2.cs#1)]
[!code-vb[System.TimeZone2.Serialization.2#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.TimeZone2.Serialization.2/vb/Serialization2.vb#1)]

### <a name="storing-a-serialized-string-and-restoring-it-when-needed"></a>Хранение сериализованной строки и восстановление при необходимости

Приведенные выше примеры хранятся сведения о часовом поясе строковой переменной и восстановить его при необходимости. Тем не менее строка, содержащая сериализованный раз, когда сведения о зоне сама может быть сохранена в некотором носителе, такие как внешний файл, файл ресурсов, внедренных в приложение или в реестре. (Обратите внимание, что сведения о настраиваемых часовых поясов должны храниться отдельно от системы ключи часового пояса в реестре).

Хранение строк сериализованных часовых поясов таким образом отделяет процедуру создания часового пояса от самого приложения. Например процедура создания часового пояса можно выполнить и создать файл данных, который содержит исторические данные о часовом поясе, приложение может использовать. Файл данных может быть, а затем установить с приложением и ее можно открыть, и один или несколько его часовых поясов могут быть десериализованы, когда приложению требуется их.

Пример, который использует внедренный ресурс для хранения сериализованных данных часового пояса см. в разделе [как: сохранение часовых поясов во внедренный ресурс](../../../docs/standard/datetime/save-time-zones-to-an-embedded-resource.md) и [как: восстановление часовых поясов из внедренного ресурса](../../../docs/standard/datetime/restore-time-zones-from-an-embedded-resource.md).

## <a name="see-also"></a>См. также

[Даты, время и часовые пояса](../../../docs/standard/datetime/index.md)
