---
title: "Сохранение и восстановление часовых поясов | Microsoft Docs"
ms.custom: ""
ms.date: "04/10/2017"
ms.prod: ".net"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-standard"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "десериализация [платформа .NET Framework], часовые пояса"
  - "восстановление часовых поясов"
  - "сохранение часовых поясов"
  - "сериализация [платформа .NET Framework], часовые пояса"
  - "объекты часовых поясов [платформа .NET Framework], десериализация"
  - "объекты часовых поясов [платформа .NET Framework], восстановление"
  - "объекты часовых поясов [платформа .NET Framework], сохранение"
  - "объекты часовых поясов [платформа .NET Framework], сериализация"
  - "часовые пояса [платформа .NET Framework], восстановление"
  - "часовые пояса [платформа .NET Framework], сохранение"
ms.assetid: 4028b310-e7ce-49d4-a646-1e83bfaf6f9d
caps.latest.revision: 9
author: "rpetrusha"
ms.author: "ronpet"
manager: "wpickett"
caps.handback.revision: 9
---
# Сохранение и восстановление часовых поясов
Для извлечения данных стандартных часовых поясов класс <xref:System.TimeZoneInfo> основывается на реестре.  Однако реестр представляет собой динамическую структуру.  Кроме того, сведения часового пояса, которые содержит реестр, используются операционной системой главным образом для проведения коррекции и преобразования времени текущего года.  Этот факт вызывает два основных последствия для приложений, зависящих от точных данных часовых поясов:  
  
-   Часовой пояс, который необходим приложению, может быть неопределен в реестре, переименован или удален из реестра.  
  
-   Часовой пояс, который определен в реестре, может не иметь сведений о конкретных правилах коррекции, необходимых для преобразований исторических часовых поясов.  
  
 Класс <xref:System.TimeZoneInfo> обходит эти ограничения с помощью поддержки сериализации \(сохранения\) и десериализации \(восстановления\) данных часового пояса.  
  
## Сериализация и десериализация часовых поясов  
 Сохранение и восстановление часового пояса с помощью сериализации и десериализации данных часового пояса включает в себя вызовы двух методов:  
  
-   Можно сериализовать объект <xref:System.TimeZoneInfo>, вызвав метод <xref:System.TimeZoneInfo.ToSerializedString%2A>.  Этот метод не принимает никаких параметров и возвращает строку, содержащую сведения о часовом поясе.  
  
-   Можно десериализовать объект <xref:System.TimeZoneInfo> из сериализованной строки, передав эту строку `static` \(`Shared` в Visual Basic\) методу <xref:System.TimeZoneInfo.FromSerializedString%2A?displayProperty=fullName>.  
  
## Сценарии сериализации и десериализации  
 Возможность сохранения \(или сериализации\) объекта <xref:System.TimeZoneInfo> в строку и возможность восстановления \(или десериализации\) его для последующего использования увеличивает эффективность и гибкость класса <xref:System.TimeZoneInfo>.  В данном разделе рассматриваются некоторые из ситуаций, в которых сериализация и десериализация наиболее полезны.  
  
### Сериализация и десериализация данных часового пояса в приложении  
 Сериализованный часовой пояс может быть восстановлен из строки, когда это потребуется.  Приложение может сделать это в случае, если часовой пояс, извлекаемый из реестра, не удается правильно преобразовать в дату и время в определенном промежутке времени.  Например, данные часового пояса в реестре Windows XP поддерживают одно правило коррекции, в то время как часовые пояса, определенные в реестре Windows Vista, обычно содержат сведения о двух правилах коррекции.  Это означает, что преобразования исторического времени могут быть неточными.  Это ограничение можно обойти с помощью сериализации и десериализации данных часового пояса.  
  
 В следующем примере определен пользовательский класс <xref:System.TimeZoneInfo> без правил корректировки, представляющий стандартное восточное время США в период с 1883 по 1917 годы до введения перехода на летнее время в США.  Пользовательский часовой пояс сериализуется в переменную с глобальными границами.  Методу преобразования часового пояса `ConvertUtcTime` передается универсальное синхронизированное время \(UTC\) для выполнения преобразования.  Если встречаются даты и время ранее 1917 года, то пользовательский часовой пояс стандартного восточного времени восстанавливается из сериализованной строки и заменяет часовой пояс, полученный из реестра.  
  
 [!code-csharp[System.TimeZone2.Serialization.1#1](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.TimeZone2.Serialization.1/cs/Serialization.cs#1)]
 [!code-vb[System.TimeZone2.Serialization.1#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.TimeZone2.Serialization.1/vb/Serialization.vb#1)]  
  
### Обработка исключений часовых поясов  
 Поскольку реестр является динамической структурой, его содержимое подвержено случайным или намеренным изменениям.  Это означает, что часовой пояс, который должен быть определен в реестре и необходим для успешного выполнения приложения, может отсутствовать.  Без поддержки сериализации и десериализации часовых поясов, остается единственная возможность – обработать результирующее исключение <xref:System.TimeZoneNotFoundException>, завершив работу приложения.  Однако с помощью сериализации и десериализации часовых поясов можно обработать внезапно возникшее исключение <xref:System.TimeZoneNotFoundException>, восстановив требуемый часовой пояс из сериализованной строки, и приложение продолжит работу.  
  
 В следующем примере создается и сериализуется пользовательский часовой пояс стандартного центрального времени.  Затем производится попытка получить часовой пояс стандартного центрального времени из реестра.  Если операция извлечения создает исключение <xref:System.TimeZoneNotFoundException> или исключение <xref:System.InvalidTimeZoneException>, то обработчик исключений десериализует часовой пояс.  
  
 [!code-csharp[System.TimeZone2.Serialization.2#1](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.TimeZone2.Serialization.2/cs/Serialization2.cs#1)]
 [!code-vb[System.TimeZone2.Serialization.2#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.TimeZone2.Serialization.2/vb/Serialization2.vb#1)]  
  
### Сохранение сериализованных строк и их восстановление при необходимости  
 Предыдущие примеры сохраняли сведения о часовых поясах в строковую переменную и восстанавливали их при необходимости.  Однако строка, содержащая сериализованные сведения о часовом поясе, сама может быть сохранена в некотором носителе, таком как внешний файл, файл ресурсов, внедренный в приложение, или в реестре. \(Обратите внимание, что сведения о пользовательских часовых поясах следует сохранять отдельно от системных разделов часовых поясов в реестре.\)  
  
 Хранение строк сериализованных часовых поясов таким образом отделяет процедуру создания часового пояса от самого приложения.  Например, процедура создания часового пояса может выполнять и создавать файл данных, содержащий сведения об исторических часовых поясах, которые может использовать приложение.  Затем файл данных может быть установлен в приложение и открыт, а один или несколько его часовых поясов могут быть десериализованы в тот момент, когда приложение запросит их.  
  
 Примеры, где используется внедренный ресурс для хранения сериализованных данных часового пояса, содержатся в разделах [Практическое руководство. Сохранение часовых поясов во внедренном ресурсе](../../../docs/standard/datetime/save-time-zones-to-an-embedded-resource.md) и [Практическое руководство. Восстановление часовых поясов из внедренного ресурса](../../../docs/standard/datetime/restore-time-zones-from-an-embedded-resource.md).  
  
## См. также  
 [Даты, время и часовые пояса](../../../docs/standard/datetime/index.md)