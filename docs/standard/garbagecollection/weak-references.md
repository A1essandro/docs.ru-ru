---
title: "Слабые ссылки"
description: "Слабые ссылки"
keywords: .NET, .NET Core
author: stevehoag
manager: wpickett
ms.date: 08/19/2016
ms.topic: article
ms.prod: .net-core
ms.technology: .net-core-technologies
ms.devlang: dotnet
ms.assetid: 22319f2f-0008-4ace-815e-545892a0512a
translationtype: Human Translation
ms.sourcegitcommit: 213ce098bcc2b5e31c55e759d895254d5ca33caa
ms.openlocfilehash: cc43c319f2ec8055073da4749cbfb7c56b825df9

---

# <a name="weak-references"></a>Слабые ссылки

Сборщик мусора не может собрать объект, используемый приложением, пока код приложения взаимодействует с этим объектом. Говорят, что приложение имеет строгую ссылку на объект. 

Слабая ссылка дает сборщику мусора возможность удалить объект, но в то же время обеспечивает приложению доступ к этому объекту. Слабая ссылка допустима только в течение неопределенного количества времени до сборки объекта при отсутствии строгих ссылок. При использовании слабой ссылки приложение все еще может получить строгую ссылку в объекте, что предотвратит удаление последнего. Однако всегда существует вероятность удаления объекта сборщиком мусора до повторного создания строгой ссылки.

Слабые ссылки полезны для объектов, которые используют большой объем памяти, но могут быть созданы повторно без особых усилий, если они были удалены сборщиком мусора. 

Предположим, что в представлении дерева пользователь видит разветвленную иерархическую структуру различных решений. Если базовые данные большие по объему, хранение этого дерева в памяти является неэффективным, особенно если пользователь делает в этом приложении что-либо еще. 

Если пользователь переключается в другую часть приложения, можно использовать класс [WeakReference](xref:System.WeakReference) или [WeakReference&lt;T&gt;](xref:System.WeakReference%601) для создания слабой ссылки на дерево и удалить все строгие ссылки. Когда пользователь переключится обратно к этому дереву, приложение попытается получить строгую ссылку на дерево и, при успешном выполнении этой операции, избежать повторного создания дерева.

Чтобы установить слабую ссылку на объект, следует создать [WeakReference](xref:System.WeakReference), используя экземпляр объекта, который необходимо отслеживать. Затем следует присвоить свойству [Target](xref:System.WeakReference.Target) этот объект и задать значение null для исходной ссылки на объект. 

## <a name="short-and-long-weak-references"></a>Краткие и длинные слабые ссылки

Можно создать краткую слабую ссылку или длинную слабую ссылку: 

* Short

  Назначением краткой ссылки становится `null`, если объект удален сборщиком мусора. Сама по себе слабая ссылка является управляемым объектом и подлежит сборке мусора, как и любые другие управляемые объекты. Краткая слабая ссылка является конструктором по умолчанию для [WeakReference](xref:System.WeakReference). 

* Long

  Длинная слабая ссылка сохраняется после вызова метода [Finalize](xref:System.Object.Finalize) объекта. Это позволяет повторно создавать объект, однако состояние объекта остается непредсказуемым. Чтобы использовать длинную ссылку, укажите значение `true` в конструкторе [WeakReference](xref:System.WeakReference). 

  Если тип объекта не имеет метода [Finalize](xref:System.Object.Finalize), используется функциональность краткой слабой ссылки, а сама слабая ссылка становится допустимой только до сборки цели, что может произойти в любое время после запуска метода завершения.

Чтобы установить строгую ссылку и повторно использовать объект, приведите свойство [Target](xref:System.WeakReference.Target) объекта [WeakReference](xref:System.WeakReference) к типу объекта. Если свойство [Target](xref:System.WeakReference.Target) возвращает значение `null`, объект был удален сборщиком; в противном случае можно продолжить использование объекта, так как приложение восстановило строгую ссылку на этот объект.

## <a name="guidelines-for-using-weak-references"></a>Правила использования слабых ссылок

Используйте длинные слабые ссылки только при необходимости, так как состояние объекта после выполнения завершения становится непредсказуемым. 

Избегайте использования слабых ссылок на небольшие объекты, потому что сам указатель может быть таким же по объему или даже больше. 

Избегайте использования слабых ссылок в качестве автоматического решения проблем, связанных с управлением памятью. Вместо этого разработайте эффективную политику кэширования для обработки объектов приложения. 

## <a name="see-also"></a>См. также

[Сборка мусора в .NET](index.md)



<!--HONumber=Nov16_HO1-->


