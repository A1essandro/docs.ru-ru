---
title: Асинхронная модель программирования (APM)
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- ending asynchronous operations
- starting asynchronous operations
- beginning asynchronous operations
- asynchronous programming, ending operations
- asynchronous programming
- stopping asynchronous operations
- asynchronous programming, beginning operations
ms.assetid: c9b3501e-6bc6-40f9-8efd-4b6d9e39ccf0
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 992cc1f60ee3f08131b478d2336321bf87d7ef89
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
ms.locfileid: "33573793"
---
# <a name="asynchronous-programming-model-apm"></a><span data-ttu-id="e2f81-102">Асинхронная модель программирования (APM)</span><span class="sxs-lookup"><span data-stu-id="e2f81-102">Asynchronous Programming Model (APM)</span></span>
<span data-ttu-id="e2f81-103">Асинхронная операция, использующая шаблон разработки <xref:System.IAsyncResult>, реализуется в виде двух методов с именами **Begin***Имя_операции* и **End***Имя_операции*, которые соответственно начинают и завершают асинхронную операцию *Имя_операции*.</span><span class="sxs-lookup"><span data-stu-id="e2f81-103">An asynchronous operation that uses the <xref:System.IAsyncResult> design pattern is implemented as two methods named **Begin***OperationName* and **End***OperationName* that begin and end the asynchronous operation *OperationName* respectively.</span></span> <span data-ttu-id="e2f81-104">Например, класс <xref:System.IO.FileStream> предоставляет методы <xref:System.IO.FileStream.BeginRead%2A> и <xref:System.IO.FileStream.EndRead%2A> для асинхронного считывания байтов из файла.</span><span class="sxs-lookup"><span data-stu-id="e2f81-104">For example, the <xref:System.IO.FileStream> class provides the <xref:System.IO.FileStream.BeginRead%2A> and <xref:System.IO.FileStream.EndRead%2A> methods to asynchronously read bytes from a file.</span></span> <span data-ttu-id="e2f81-105">Эти методы реализуют асинхронную версию метода <xref:System.IO.FileStream.Read%2A> .</span><span class="sxs-lookup"><span data-stu-id="e2f81-105">These methods implement the asynchronous version of the <xref:System.IO.FileStream.Read%2A> method.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e2f81-106">Начиная с версии .NET Framework 4 библиотека параллельных задач предоставляет новую модель для асинхронного и параллельного программирования.</span><span class="sxs-lookup"><span data-stu-id="e2f81-106">Starting with the .NET Framework 4, the Task Parallel Library provides a new model for asynchronous and parallel programming.</span></span> <span data-ttu-id="e2f81-107">Дополнительные сведения см. в разделах [Task Parallel Library (TPL)](../../../docs/standard/parallel-programming/task-parallel-library-tpl.md) и [Task-based Asynchronous Pattern (TAP)](../../../docs/standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap.md).)</span><span class="sxs-lookup"><span data-stu-id="e2f81-107">For more information, see [Task Parallel Library (TPL)](../../../docs/standard/parallel-programming/task-parallel-library-tpl.md) and [Task-based Asynchronous Pattern (TAP)](../../../docs/standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap.md)).</span></span>  
  
 <span data-ttu-id="e2f81-108">После вызова метода **Begin***Имя_операции* приложение может продолжить выполнение инструкций в вызывающем потоке, пока асинхронная операция выполняется в другом потоке.</span><span class="sxs-lookup"><span data-stu-id="e2f81-108">After calling **Begin***OperationName*, an application can continue executing instructions on the calling thread while the asynchronous operation takes place on a different thread.</span></span> <span data-ttu-id="e2f81-109">Для каждого вызова метода *Begin\*\*\*Имя_операции* в приложении также должен присутствовать вызов метода \**End\*\*\*Имя_операции* для получения результатов операции.</span><span class="sxs-lookup"><span data-stu-id="e2f81-109">For each call to **Begin***OperationName*, the application should also call **End***OperationName* to get the results of the operation.</span></span>  
  
## <a name="beginning-an-asynchronous-operation"></a><span data-ttu-id="e2f81-110">Начало асинхронной операции</span><span class="sxs-lookup"><span data-stu-id="e2f81-110">Beginning an Asynchronous Operation</span></span>  
 <span data-ttu-id="e2f81-111">Метод **Begin***Имя_операции* начинает асинхронную операцию *Имя_операции* и возвращает объект, реализующий интерфейс <xref:System.IAsyncResult>.</span><span class="sxs-lookup"><span data-stu-id="e2f81-111">The **Begin***OperationName* method begins asynchronous operation *OperationName* and returns an object that implements the <xref:System.IAsyncResult> interface.</span></span> <span data-ttu-id="e2f81-112">В объектах<xref:System.IAsyncResult> хранятся сведения об асинхронных операциях.</span><span class="sxs-lookup"><span data-stu-id="e2f81-112"><xref:System.IAsyncResult> objects store information about an asynchronous operation.</span></span> <span data-ttu-id="e2f81-113">В таблице ниже приведены сведения об асинхронной операции.</span><span class="sxs-lookup"><span data-stu-id="e2f81-113">The following table shows information about an asynchronous operation.</span></span>  
  
|<span data-ttu-id="e2f81-114">Член</span><span class="sxs-lookup"><span data-stu-id="e2f81-114">Member</span></span>|<span data-ttu-id="e2f81-115">Описание:</span><span class="sxs-lookup"><span data-stu-id="e2f81-115">Description</span></span>|  
|------------|-----------------|  
|<xref:System.IAsyncResult.AsyncState%2A>|<span data-ttu-id="e2f81-116">Относящийся к необязательному приложению объект, содержащий сведения об асинхронной операции.</span><span class="sxs-lookup"><span data-stu-id="e2f81-116">An optional application-specific object that contains information about the asynchronous operation.</span></span>|  
|<xref:System.IAsyncResult.AsyncWaitHandle%2A>|<span data-ttu-id="e2f81-117">Объект <xref:System.Threading.WaitHandle> , который можно использовать, чтобы заблокировать выполнение приложения до завершения асинхронной операции.</span><span class="sxs-lookup"><span data-stu-id="e2f81-117">A <xref:System.Threading.WaitHandle> that can be used to block application execution until the asynchronous operation completes.</span></span>|  
|<xref:System.IAsyncResult.CompletedSynchronously%2A>|<span data-ttu-id="e2f81-118">Значение, показывающее, что асинхронная операция выполнена в потоке, который использовался для вызова метода **Begin***Имя_операции*, а не в отдельном потоке <xref:System.Threading.ThreadPool>.</span><span class="sxs-lookup"><span data-stu-id="e2f81-118">A value that indicates whether the asynchronous operation completed on the thread used to call **Begin***OperationName* instead of completing on a separate <xref:System.Threading.ThreadPool> thread.</span></span>|  
|<xref:System.IAsyncResult.IsCompleted%2A>|<span data-ttu-id="e2f81-119">Значение, показывающее, выполнена ли асинхронная операция.</span><span class="sxs-lookup"><span data-stu-id="e2f81-119">A value that indicates whether the asynchronous operation has completed.</span></span>|  
  
 <span data-ttu-id="e2f81-120">Метод **Begin***Имя_операции* принимает любые параметры, объявленные в сигнатуре синхронной версии метода, которые передаются по значению или по ссылке.</span><span class="sxs-lookup"><span data-stu-id="e2f81-120">A **Begin***OperationName* method takes any parameters declared in the signature of the synchronous version of the method that are passed by value or by reference.</span></span> <span data-ttu-id="e2f81-121">Выходные параметры не входят в сигнатуру метода **Begin***Имя_операции*.</span><span class="sxs-lookup"><span data-stu-id="e2f81-121">Any out parameters are not part of the **Begin***OperationName* method signature.</span></span> <span data-ttu-id="e2f81-122">В сигнатуру метода **Begin***Имя_операции* также входят два дополнительных параметра.</span><span class="sxs-lookup"><span data-stu-id="e2f81-122">The **Begin***OperationName* method signature also includes two additional parameters.</span></span> <span data-ttu-id="e2f81-123">Первый из них определяет делегат <xref:System.AsyncCallback> , который ссылается на метод, вызываемый при завершении асинхронной операции.</span><span class="sxs-lookup"><span data-stu-id="e2f81-123">The first of these defines an <xref:System.AsyncCallback> delegate that references a method that is called when the asynchronous operation completes.</span></span> <span data-ttu-id="e2f81-124">Вызывающий объект может указать значение `null` (`Nothing` в Visual Basic), если не нужно вызывать метод при завершении операции.</span><span class="sxs-lookup"><span data-stu-id="e2f81-124">The caller can specify `null` (`Nothing` in Visual Basic) if it does not want a method invoked when the operation completes.</span></span> <span data-ttu-id="e2f81-125">Вторым дополнительным параметром является определяемый пользователем объект.</span><span class="sxs-lookup"><span data-stu-id="e2f81-125">The second additional parameter is a user-defined object.</span></span> <span data-ttu-id="e2f81-126">Этот объект можно использовать для передачи сведений о состоянии, относящихся к приложению, в метод, который вызывается при завершении асинхронной операции.</span><span class="sxs-lookup"><span data-stu-id="e2f81-126">This object can be used to pass application-specific state information to the method invoked when the asynchronous operation completes.</span></span> <span data-ttu-id="e2f81-127">Если метод **Begin***Имя_операции* принимает дополнительные параметры, относящиеся к операции, например массив байтов для хранения байтов, считанных из файла, объект <xref:System.AsyncCallback> и объект состояния приложения являются последними параметрами в сигнатуре метода **Begin***Имя_операции*.</span><span class="sxs-lookup"><span data-stu-id="e2f81-127">If a **Begin***OperationName* method takes additional operation-specific parameters, such as a byte array to store bytes read from a file, the <xref:System.AsyncCallback> and application state object are the last parameters in the **Begin***OperationName* method signature.</span></span>  
  
 <span data-ttu-id="e2f81-128">**Begin***Имя_операции* немедленно возвращает управление в вызывающий поток.</span><span class="sxs-lookup"><span data-stu-id="e2f81-128">**Begin***OperationName* returns control to the calling thread immediately.</span></span> <span data-ttu-id="e2f81-129">Если метод **Begin***Имя_операции* создает исключения, это происходит до запуска асинхронной операции.</span><span class="sxs-lookup"><span data-stu-id="e2f81-129">If the **Begin***OperationName* method throws exceptions, the exceptions are thrown before the asynchronous operation is started.</span></span> <span data-ttu-id="e2f81-130">Если метод **Begin***Имя_операции* создает исключения, метод обратного вызова не вызывается.</span><span class="sxs-lookup"><span data-stu-id="e2f81-130">If the **Begin***OperationName* method throws exceptions, the callback method is not invoked.</span></span>  
  
## <a name="ending-an-asynchronous-operation"></a><span data-ttu-id="e2f81-131">Завершение асинхронной операции</span><span class="sxs-lookup"><span data-stu-id="e2f81-131">Ending an Asynchronous Operation</span></span>  
 <span data-ttu-id="e2f81-132">Метод **End***Имя_операции* завершает асинхронную операцию *Имя_операции*.</span><span class="sxs-lookup"><span data-stu-id="e2f81-132">The **End***OperationName* method ends asynchronous operation *OperationName*.</span></span> <span data-ttu-id="e2f81-133">Возвращаемое значение метода **End***Имя_операции* имеет тот же тип, что и значение его синхронной версии, и определяется асинхронной операцией.</span><span class="sxs-lookup"><span data-stu-id="e2f81-133">The return value of the **End***OperationName* method is the same type returned by its synchronous counterpart and is specific to the asynchronous operation.</span></span> <span data-ttu-id="e2f81-134">Например, метод <xref:System.IO.FileStream.EndRead%2A> возвращает число байтов, считанных из потока <xref:System.IO.FileStream> , а метод <xref:System.Net.Dns.EndGetHostByName%2A> возвращает объект <xref:System.Net.IPHostEntry> , содержащий сведения о сервере.</span><span class="sxs-lookup"><span data-stu-id="e2f81-134">For example, the <xref:System.IO.FileStream.EndRead%2A> method returns the number of bytes read from a <xref:System.IO.FileStream> and the <xref:System.Net.Dns.EndGetHostByName%2A> method returns an <xref:System.Net.IPHostEntry> object that contains information about a host computer.</span></span> <span data-ttu-id="e2f81-135">Метод **End***Имя_операции* принимает любые параметры out или ref, объявленные в сигнатуре синхронной версии метода.</span><span class="sxs-lookup"><span data-stu-id="e2f81-135">The **End***OperationName* method takes any out or ref parameters declared in the signature of the synchronous version of the method.</span></span> <span data-ttu-id="e2f81-136">В дополнение к параметрам из синхронного метода метод **End***Имя_операции* также включает параметр <xref:System.IAsyncResult>.</span><span class="sxs-lookup"><span data-stu-id="e2f81-136">In addition to the parameters from the synchronous method, the **End***OperationName* method also includes an <xref:System.IAsyncResult> parameter.</span></span> <span data-ttu-id="e2f81-137">Вызывающие объекты должны передавать экземпляр, возвращаемый соответствующим вызовом метода **Begin***Имя_операции*.</span><span class="sxs-lookup"><span data-stu-id="e2f81-137">Callers must pass the instance returned by the corresponding call to **Begin***OperationName*.</span></span>  
  
 <span data-ttu-id="e2f81-138">Если асинхронная операция, представленная объектом <xref:System.IAsyncResult>, не завершилась к моменту вызова метода **End***Имя_операции*, метод **End***Имя_операции* блокирует выполнение вызывающего потока до момента завершения асинхронной операции.</span><span class="sxs-lookup"><span data-stu-id="e2f81-138">If the asynchronous operation represented by the <xref:System.IAsyncResult> object has not completed when **End***OperationName* is called, **End***OperationName* blocks the calling thread until the asynchronous operation is complete.</span></span> <span data-ttu-id="e2f81-139">Исключения, создаваемые асинхронной операцией, возникают из метода **End***Имя_операции*.</span><span class="sxs-lookup"><span data-stu-id="e2f81-139">Exceptions thrown by the asynchronous operation are thrown from the **End***OperationName* method.</span></span> <span data-ttu-id="e2f81-140">Результат многократного вызова метода **End***Имя_операции* с одним экземпляром <xref:System.IAsyncResult> не определен.</span><span class="sxs-lookup"><span data-stu-id="e2f81-140">The effect of calling the **End***OperationName* method multiple times with the same <xref:System.IAsyncResult> is not defined.</span></span> <span data-ttu-id="e2f81-141">Аналогично, вызов метода **End***Имя_операции* с объектом <xref:System.IAsyncResult>, который не был возвращен соответствующим методом Begin, также не определен.</span><span class="sxs-lookup"><span data-stu-id="e2f81-141">Likewise, calling the **End***OperationName* method with an <xref:System.IAsyncResult> that was not returned by the related Begin method is also not defined.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e2f81-142">В случае реализации этих неопределенных сценариев рекомендуется вызывать исключение <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="e2f81-142">For either of the undefined scenarios, implementers should consider throwing <xref:System.InvalidOperationException>.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e2f81-143">В случае реализации этого шаблона разработки необходимо уведомить вызывающий объект о завершении асинхронной операции, установив свойство <xref:System.IAsyncResult.IsCompleted%2A> в значение true, вызвав асинхронный метод обратного вызова (если он указан) и отправив сигнал <xref:System.IAsyncResult.AsyncWaitHandle%2A>.</span><span class="sxs-lookup"><span data-stu-id="e2f81-143">Implementers of this design pattern should notify the caller that the asynchronous operation completed by setting <xref:System.IAsyncResult.IsCompleted%2A> to true, calling the asynchronous callback method (if one was specified) and signaling the <xref:System.IAsyncResult.AsyncWaitHandle%2A>.</span></span>  
  
 <span data-ttu-id="e2f81-144">Разработчики приложений имеют выбор способов доступа к результатам асинхронной операции.</span><span class="sxs-lookup"><span data-stu-id="e2f81-144">Application developers have several design choices for accessing the results of the asynchronous operation.</span></span> <span data-ttu-id="e2f81-145">Правильный выбор зависит от того, содержит ли приложение инструкции, которые могут выполняться, пока не завершена операция.</span><span class="sxs-lookup"><span data-stu-id="e2f81-145">The correct choice depends on whether the application has instructions that can execute while the operation completes.</span></span> <span data-ttu-id="e2f81-146">Если приложение не может выполнять дополнительную работу, пока не получены результаты асинхронной операции, его необходимо заблокировать до момента, когда станут доступны результаты.</span><span class="sxs-lookup"><span data-stu-id="e2f81-146">If an application cannot perform any additional work until it receives the results of the asynchronous operation, the application must block until the results are available.</span></span> <span data-ttu-id="e2f81-147">Чтобы заблокировать работу до завершения асинхронной операции, используйте один из описанных ниже способов.</span><span class="sxs-lookup"><span data-stu-id="e2f81-147">To block until an asynchronous operation completes, you can use one of the following approaches:</span></span>  
  
-   <span data-ttu-id="e2f81-148">Вызов метода **End***Имя_операции* из главного потока приложения блокирует выполнение приложения до завершения операции.</span><span class="sxs-lookup"><span data-stu-id="e2f81-148">Call **End***OperationName* from the application’s main thread, blocking application execution until the operation is complete.</span></span> <span data-ttu-id="e2f81-149">Пример с демонстрацией этого способа см. в статье [Блокировка выполнения приложения путем завершения асинхронной операции](../../../docs/standard/asynchronous-programming-patterns/blocking-application-execution-by-ending-an-async-operation.md).</span><span class="sxs-lookup"><span data-stu-id="e2f81-149">For an example that illustrates this technique, see [Blocking Application Execution by Ending an Async Operation](../../../docs/standard/asynchronous-programming-patterns/blocking-application-execution-by-ending-an-async-operation.md).</span></span>  
  
-   <span data-ttu-id="e2f81-150">Используйте свойство <xref:System.IAsyncResult.AsyncWaitHandle%2A> , чтобы заблокировать выполнение приложения до завершения одной или нескольких операций.</span><span class="sxs-lookup"><span data-stu-id="e2f81-150">Use the <xref:System.IAsyncResult.AsyncWaitHandle%2A> to block application execution until one or more operations are complete.</span></span> <span data-ttu-id="e2f81-151">Пример, демонстрирующий этот способ, см. в разделе [Blocking Application Execution Using an AsyncWaitHandle](../../../docs/standard/asynchronous-programming-patterns/blocking-application-execution-using-an-asyncwaithandle.md).</span><span class="sxs-lookup"><span data-stu-id="e2f81-151">For an example that illustrates this technique, see [Blocking Application Execution Using an AsyncWaitHandle](../../../docs/standard/asynchronous-programming-patterns/blocking-application-execution-using-an-asyncwaithandle.md).</span></span>  
  
 <span data-ttu-id="e2f81-152">В приложениях, которые не нужно блокировать до завершения асинхронной операции, можно использовать один из описанных ниже способов.</span><span class="sxs-lookup"><span data-stu-id="e2f81-152">Applications that do not need to block while the asynchronous operation completes can use one of the following approaches:</span></span>  
  
-   <span data-ttu-id="e2f81-153">Запрашивайте состояние выполнения операции, периодически проверяя свойство <xref:System.IAsyncResult.IsCompleted%2A>, и вызовите метод **End***Имя_операции*, когда операция будет завершена.</span><span class="sxs-lookup"><span data-stu-id="e2f81-153">Poll for operation completion status by checking the <xref:System.IAsyncResult.IsCompleted%2A> property periodically and calling **End***OperationName* when the operation is complete.</span></span> <span data-ttu-id="e2f81-154">Пример, демонстрирующий этот способ, см. в разделе [Polling for the Status of an Asynchronous Operation](../../../docs/standard/asynchronous-programming-patterns/polling-for-the-status-of-an-asynchronous-operation.md).</span><span class="sxs-lookup"><span data-stu-id="e2f81-154">For an example that illustrates this technique, see [Polling for the Status of an Asynchronous Operation](../../../docs/standard/asynchronous-programming-patterns/polling-for-the-status-of-an-asynchronous-operation.md).</span></span>  
  
-   <span data-ttu-id="e2f81-155">Используйте делегат <xref:System.AsyncCallback> для указания метода, который должен вызываться при завершении операции.</span><span class="sxs-lookup"><span data-stu-id="e2f81-155">Use an <xref:System.AsyncCallback> delegate to specify a method to be invoked when the operation is complete.</span></span> <span data-ttu-id="e2f81-156">Пример, демонстрирующий этот способ, см. в разделе [Using an AsyncCallback Delegate to End an Asynchronous Operation](../../../docs/standard/asynchronous-programming-patterns/using-an-asynccallback-delegate-to-end-an-asynchronous-operation.md).</span><span class="sxs-lookup"><span data-stu-id="e2f81-156">For an example that illustrates this technique, see [Using an AsyncCallback Delegate to End an Asynchronous Operation](../../../docs/standard/asynchronous-programming-patterns/using-an-asynccallback-delegate-to-end-an-asynchronous-operation.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e2f81-157">См. также</span><span class="sxs-lookup"><span data-stu-id="e2f81-157">See Also</span></span>  
 [<span data-ttu-id="e2f81-158">Асинхронная модель на основе событий (EAP)</span><span class="sxs-lookup"><span data-stu-id="e2f81-158">Event-based Asynchronous Pattern (EAP)</span></span>](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-eap.md)  
 [<span data-ttu-id="e2f81-159">Асинхронный вызов синхронных методов</span><span class="sxs-lookup"><span data-stu-id="e2f81-159">Calling Synchronous Methods Asynchronously</span></span>](../../../docs/standard/asynchronous-programming-patterns/calling-synchronous-methods-asynchronously.md)  
 [<span data-ttu-id="e2f81-160">Использование делегата AsyncCallback и объекта состояния</span><span class="sxs-lookup"><span data-stu-id="e2f81-160">Using an AsyncCallback Delegate and State Object</span></span>](../../../docs/standard/asynchronous-programming-patterns/using-an-asynccallback-delegate-and-state-object.md)
