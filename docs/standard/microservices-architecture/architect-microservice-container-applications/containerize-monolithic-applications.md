---
title: "Контейнеризация монолитных приложений"
description: "Архитектура микрослужб .NET для упакованных в контейнеры приложений .NET | Контейнеризация монолитных приложений"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: fc01054e4352a711d2203e694001a1204dedadf9
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/23/2017
---
# <a name="containerizing-monolithic-applications"></a><span data-ttu-id="042a3-104">Контейнеризация монолитных приложений</span><span class="sxs-lookup"><span data-stu-id="042a3-104">Containerizing monolithic applications</span></span>

<span data-ttu-id="042a3-105">Вы можете создать одно монолитное веб-приложение или службу и развернуть их как контейнер.</span><span class="sxs-lookup"><span data-stu-id="042a3-105">You might want to build a single, monolithically deployed web application or service and deploy it as a container.</span></span> <span data-ttu-id="042a3-106">Само приложение может не иметь монолитную внутреннюю структуру и состоять из нескольких библиотек, компонентов или даже уровней (прикладной уровень, уровень домена, уровень доступа к данным и т. д.).</span><span class="sxs-lookup"><span data-stu-id="042a3-106">The application itself might not be internally monolithic, but structured as several libraries, components, or even layers (application layer, domain layer, data-access layer, etc.).</span></span> <span data-ttu-id="042a3-107">Но внешне оно будет представлять собой единый контейнер — единый процесс, единое веб-приложение или единую службу.</span><span class="sxs-lookup"><span data-stu-id="042a3-107">Externally, however, it is a single container—a single process, a single web application, or a single service.</span></span>

<span data-ttu-id="042a3-108">Для управления этой моделью вы развертываете один контейнер, представляющий собой приложение.</span><span class="sxs-lookup"><span data-stu-id="042a3-108">To manage this model, you deploy a single container to represent the application.</span></span> <span data-ttu-id="042a3-109">Для увеличения масштаба просто добавьте дополнительные копии с подсистемой балансировки нагрузки спереди.</span><span class="sxs-lookup"><span data-stu-id="042a3-109">To scale up, you just add more copies with a load balancer in front.</span></span> <span data-ttu-id="042a3-110">Управлять одним развертыванием в одном контейнере или виртуальной машине гораздо проще.</span><span class="sxs-lookup"><span data-stu-id="042a3-110">The simplicity comes from managing a single deployment in a single container or VM.</span></span>

![](./media/image1.png)

<span data-ttu-id="042a3-111">**Рис. 4-1**.</span><span class="sxs-lookup"><span data-stu-id="042a3-111">**Figure 4-1**.</span></span> <span data-ttu-id="042a3-112">Пример архитектуры монолитного приложения в контейнере</span><span class="sxs-lookup"><span data-stu-id="042a3-112">Example of the architecture of a containerized monolithic application</span></span>

<span data-ttu-id="042a3-113">Вы можете включить в один контейнер несколько компонентов, библиотек или внутренних уровней, как показано на рисунке 4-1.</span><span class="sxs-lookup"><span data-stu-id="042a3-113">You can include multiple components, libraries, or internal layers in each container, as illustrated in Figure 4-1.</span></span> <span data-ttu-id="042a3-114">Такой монолитный шаблон может конфликтовать с принципом контейнера: "контейнер выполняет одно дело и в одном процессе", — но в некоторых случаях это не проблема.</span><span class="sxs-lookup"><span data-stu-id="042a3-114">However, this monolithic pattern might conflict with the container principle “a container does one thing, and does it in one process”, but might be ok for some cases.</span></span>

<span data-ttu-id="042a3-115">Недостаток этого подхода становится очевидным, когда приложение разрастается и его необходимо масштабировать.</span><span class="sxs-lookup"><span data-stu-id="042a3-115">The downside of this approach becomes evident if the application grows, requiring it to scale.</span></span> <span data-ttu-id="042a3-116">Если можно масштабировать приложение целиком, все получится.</span><span class="sxs-lookup"><span data-stu-id="042a3-116">If the entire application can scale, it is not really a problem.</span></span> <span data-ttu-id="042a3-117">Но в большинстве случаев необходимо масштабировать всего несколько частей приложения, пока другие компоненты работают нормально.</span><span class="sxs-lookup"><span data-stu-id="042a3-117">However, in most cases, just a few parts of the application are the choke points that requiring scaling, while other components are used less.</span></span>

<span data-ttu-id="042a3-118">Например, в типичном приложении для электронной коммерции, скорее всего, придется масштабировать подсистему сведений о продуктах, поскольку клиенты чаще просматривают продукты, чем покупают.</span><span class="sxs-lookup"><span data-stu-id="042a3-118">For example, in a typical e-commerce application, you likely need to scale the product information subsystem, because many more customers browse products than purchase them.</span></span> <span data-ttu-id="042a3-119">Клиенты чаще складывают товары в корзину, чем оплачивают их.</span><span class="sxs-lookup"><span data-stu-id="042a3-119">More customers use their basket than use the payment pipeline.</span></span> <span data-ttu-id="042a3-120">Не так много клиентов пишут комментарии или просматривают историю покупок.</span><span class="sxs-lookup"><span data-stu-id="042a3-120">Fewer customers add comments or view their purchase history.</span></span> <span data-ttu-id="042a3-121">И у вас может быть всего несколько сотрудников, которые управляют контентом и маркетинговыми кампаниями.</span><span class="sxs-lookup"><span data-stu-id="042a3-121">And you might have only a handful of employees, that need to manage the content and marketing campaigns.</span></span> <span data-ttu-id="042a3-122">При масштабировании монолитной конструкции весь код для различных задач развертывается несколько раз и масштабируется в одинаковой степени.</span><span class="sxs-lookup"><span data-stu-id="042a3-122">If you scale the monolithic design, all the code for these different tasks is deployed multiple times and scaled at the same grade.</span></span>

<span data-ttu-id="042a3-123">Существует несколько способов масштабирования приложения — горизонтальное копирование, разделение различных областей приложения и секционирование схожих бизнес-концепций или данных.</span><span class="sxs-lookup"><span data-stu-id="042a3-123">There are multiple ways to scale an application—horizontal duplication, splitting different areas of the application, and partitioning similar business concepts or data.</span></span> <span data-ttu-id="042a3-124">Но, во первых, необходимо масштабировать все компоненты, а во-вторых, изменения в одном компоненте требуют полного повторного тестирования всего приложения и полного повторного развертывания всех экземпляров.</span><span class="sxs-lookup"><span data-stu-id="042a3-124">But, in addition to the problem of scaling all components, changes to a single component require complete retesting of the entire application, and a complete redeployment of all the instances.</span></span>

<span data-ttu-id="042a3-125">Все же монолитная конструкция широко распространена, поскольку на начальном этапе разрабатывать такое приложение проще, чем использовать микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="042a3-125">However, the monolithic approach is common, because the development of the application is initially easier than for microservices approaches.</span></span> <span data-ttu-id="042a3-126">Поэтому такой архитектурный подход используется во многих организациях.</span><span class="sxs-lookup"><span data-stu-id="042a3-126">Thus, many organizations develop using this architectural approach.</span></span> <span data-ttu-id="042a3-127">И хотя некоторым удалось достичь достаточно хороших результатов, другие сталкиваются с серьезными ограничениями.</span><span class="sxs-lookup"><span data-stu-id="042a3-127">While some organizations have had good enough results, others are hitting limits.</span></span> <span data-ttu-id="042a3-128">Во многих организациях приложения строились по такой модели, поскольку несколько лет назад с помощью существующих инструментов и инфраструктуры слишком сложно было создавать архитектуры, ориентированные на службы (SOA), и проблем не возникало, пока приложение не начинало разрастаться.</span><span class="sxs-lookup"><span data-stu-id="042a3-128">Many organizations designed their applications using this model because tools and infrastructure made it too difficult to build service oriented architectures (SOA) years ago, and they did not see the need—until the application grew.</span></span>

<span data-ttu-id="042a3-129">С точки зрения инфраструктуры, каждый сервер может выполнять множество приложений в одном узле и применять допустимое соотношение эффективности использования ресурсов, как показано на рисунке 4-2.</span><span class="sxs-lookup"><span data-stu-id="042a3-129">From an infrastructure perspective, each server can run many applications within the same host and have an acceptable ratio of efficiency in resources usage, as shown in Figure 4-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="042a3-130">**Рис. 4-2**.</span><span class="sxs-lookup"><span data-stu-id="042a3-130">**Figure 4-2**.</span></span> <span data-ttu-id="042a3-131">Монолитная конструкция: узел выполняет несколько приложений, каждое приложение выполняется как контейнер</span><span class="sxs-lookup"><span data-stu-id="042a3-131">Monolithic approach: Host running multiple apps, each app running as a container</span></span>

<span data-ttu-id="042a3-132">Монолитные приложения в Microsoft Azure можно развертывать с использованием выделенных виртуальных машин для каждого экземпляра.</span><span class="sxs-lookup"><span data-stu-id="042a3-132">Monolithic applications in Microsoft Azure can be deployed using dedicated VMs for each instance.</span></span> <span data-ttu-id="042a3-133">Кроме того, с помощью [масштабируемых наборов виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machine-scale-sets/) можно легко масштабировать виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="042a3-133">Additionally, using [Azure VM Scale Sets](https://docs.microsoft.com/azure/virtual-machine-scale-sets/), you can easily scale the VMs.</span></span> <span data-ttu-id="042a3-134">[Служба приложений Azure](https://azure.microsoft.com/services/app-service/) также может выполнять монолитные приложения и легко масштабировать экземпляры, и вам не придется управлять виртуальными машинами.</span><span class="sxs-lookup"><span data-stu-id="042a3-134">[Azure App Service](https://azure.microsoft.com/services/app-service/) can also run monolithic applications and easily scale instances without requiring you to manage the VMs.</span></span> <span data-ttu-id="042a3-135">С 2016 года службы приложений Azure также могут выполнять отдельные экземпляры контейнеров Docker, упрощая развертывание.</span><span class="sxs-lookup"><span data-stu-id="042a3-135">Since 2016, Azure App Services can run single instances of Docker containers as well, simplifying deployment.</span></span>

<span data-ttu-id="042a3-136">В качестве среды контроля качества или ограниченной рабочей среды можно развертывать несколько виртуальных машин с Docker и распределять нагрузку с помощью средства балансировки Azure, как показано на рисунке 4-3.</span><span class="sxs-lookup"><span data-stu-id="042a3-136">As a QA environment or a limited production environment, you can deploy multiple Docker host VMs and balance them using the Azure balancer, as shown in Figure 4-3.</span></span> <span data-ttu-id="042a3-137">Так вы сможете управлять масштабированием, не используя крупные элементы, поскольку все приложение размещено в одном контейнере.</span><span class="sxs-lookup"><span data-stu-id="042a3-137">This lets you manage scaling with a coarse-grain approach, because the whole application lives within a single container.</span></span>

![](./media/image3.png)

<span data-ttu-id="042a3-138">**Рис. 4-3**.</span><span class="sxs-lookup"><span data-stu-id="042a3-138">**Figure 4-3**.</span></span> <span data-ttu-id="042a3-139">Пример масштабирования приложения в одном контейнере с помощью нескольких узлов</span><span class="sxs-lookup"><span data-stu-id="042a3-139">Example of multiple hosts scaling up a single container application</span></span>

<span data-ttu-id="042a3-140">Развертыванием на различных узлах можно управлять с помощью традиционных методов развертывания.</span><span class="sxs-lookup"><span data-stu-id="042a3-140">Deployment to the various hosts can be managed with traditional deployment techniques.</span></span> <span data-ttu-id="042a3-141">Узлами Docker можно управлять с помощью вводимых вручную команд `docker run` или `docker-compose` или автоматизированно, например с помощью конвейеров непрерывной поставки (CD).</span><span class="sxs-lookup"><span data-stu-id="042a3-141">Docker hosts can be managed with commands like `docker run` or `docker-compose` performed manually, or through automation such as continuous delivery (CD) pipelines.</span></span>

## <a name="deploying-a-monolithic-application-as-a-container"></a><span data-ttu-id="042a3-142">Развертывание монолитного приложения в контейнере</span><span class="sxs-lookup"><span data-stu-id="042a3-142">Deploying a monolithic application as a container</span></span>

<span data-ttu-id="042a3-143">Использование контейнеров для управления развертываниями монолитных приложений имеет свои преимущества.</span><span class="sxs-lookup"><span data-stu-id="042a3-143">There are benefits to using containers to manage monolithic application deployments.</span></span> <span data-ttu-id="042a3-144">Масштабировать экземпляры контейнера гораздо быстрее и проще, чем развертывать дополнительные виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="042a3-144">Scaling container instances is far faster and easier than deploying additional VMs.</span></span> <span data-ttu-id="042a3-145">Даже при использовании масштабируемых наборов виртуальных машин им необходимо время на запуск.</span><span class="sxs-lookup"><span data-stu-id="042a3-145">Even if you use VM Scale Sets, VMs take time to start.</span></span> <span data-ttu-id="042a3-146">При развертывании в виде традиционных экземпляров приложений вместо контейнеров настройками приложения приходится управлять в рамках виртуальной машины, и это не лучшее решение.</span><span class="sxs-lookup"><span data-stu-id="042a3-146">When deployed as traditional application instances instead of containers, the configuration of the application is managed as part of the VM, which is not ideal.</span></span>

<span data-ttu-id="042a3-147">Развертывание обновлений в виде образов Docker выполняется гораздо быстрее и эффективнее с точки зрения использования сети.</span><span class="sxs-lookup"><span data-stu-id="042a3-147">Deploying updates as Docker images is far faster and network efficient.</span></span> <span data-ttu-id="042a3-148">Образы Docker обычно запускаются за считанные секунды, что позволяет ускорить выпуск.</span><span class="sxs-lookup"><span data-stu-id="042a3-148">Docker images typically start in seconds, which speeds rollouts.</span></span> <span data-ttu-id="042a3-149">Остановить образ Docker можно с помощью команды `docker stop`, и обычно это происходит моментально.</span><span class="sxs-lookup"><span data-stu-id="042a3-149">Tearing down a Docker image instance is as easy as issuing a `docker stop` command, and typically completes in less than a second.</span></span>

<span data-ttu-id="042a3-150">Поскольку контейнеры неизменны по своей природе, вам не придется беспокоиться о поврежденных виртуальных машинах.</span><span class="sxs-lookup"><span data-stu-id="042a3-150">Because containers are immutable by design, you never need to worry about corrupted VMs.</span></span> <span data-ttu-id="042a3-151">Напротив, скрипты обновления для виртуальной машины могут не учесть определенную конфигурацию или забыть файл на диске.</span><span class="sxs-lookup"><span data-stu-id="042a3-151">In contrast, update scripts for a VM might forget to account for some specific configuration or file left on disk.</span></span>

<span data-ttu-id="042a3-152">Docker имеет много плюсов для монолитных приложений, но это еще не полный список преимуществ.</span><span class="sxs-lookup"><span data-stu-id="042a3-152">While monolithic applications can benefit from Docker, we are touching only on the benefits.</span></span> <span data-ttu-id="042a3-153">Дополнительные возможности при управлении контейнерами открываются благодаря развертыванию с помощью оркестраторов контейнеров, которые управляют различными экземплярами и жизненным циклом каждого экземпляра контейнера.</span><span class="sxs-lookup"><span data-stu-id="042a3-153">Additional benefits of managing containers come from deploying with container orchestrators, which manage the various instances and lifecycle of each container instance.</span></span> <span data-ttu-id="042a3-154">Когда вы разбиваете монолитное приложение на подсистемы, которые затем можно масштабировать, разрабатывать и развертывать по отдельности, вы переходите на уровень микрослужб.</span><span class="sxs-lookup"><span data-stu-id="042a3-154">Breaking up the monolithic application into subsystems that can be scaled, developed, and deployed individually is your entry point into the realm of microservices.</span></span>

## <a name="publishing-a-single-container-based-application-to-azure-app-service"></a><span data-ttu-id="042a3-155">Публикация приложения в одном контейнере в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="042a3-155">Publishing a single-container-based application to Azure App Service</span></span>

<span data-ttu-id="042a3-156">Когда вы хотите проверить контейнер, развернутый в Azure, или когда приложение содержится в одном контейнере, вы можете воспользоваться удобными службами масштабирования контейнеров в службе приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="042a3-156">Whether you want to get validation of a container deployed to Azure or when an application is simply a single-container application, Azure App Service provides a great way to provide scalable single-container-based services.</span></span> <span data-ttu-id="042a3-157">Использовать службу приложений Azure очень просто.</span><span class="sxs-lookup"><span data-stu-id="042a3-157">Using Azure App Service is simple.</span></span> <span data-ttu-id="042a3-158">Она прекрасно интегрируется с Git, так что вы можете взять свой код, скомпилировать его в Visual Studio и развернуть прямо в Azure.</span><span class="sxs-lookup"><span data-stu-id="042a3-158">It provides great integration with Git to make it easy to take your code, build it in Visual Studio, and deploy it directly to Azure.</span></span>

![](./media/image4.png)

<span data-ttu-id="042a3-159">**Рис. 4-4**.</span><span class="sxs-lookup"><span data-stu-id="042a3-159">**Figure 4-4**.</span></span> <span data-ttu-id="042a3-160">Публикация приложения в одном контейнере в службе приложений Azure из Visual Studio</span><span class="sxs-lookup"><span data-stu-id="042a3-160">Publishing a single-container application to Azure App Service from Visual Studio</span></span>

<span data-ttu-id="042a3-161">Если вам понадобятся другие возможности, платформы или зависимости, не поддерживаемые службой приложений Azure, без Docker пришлось бы ждать, пока команда Azure обновит эти зависимости в службе приложений.</span><span class="sxs-lookup"><span data-stu-id="042a3-161">Without Docker, if you needed other capabilities, frameworks, or dependencies that are not supported in Azure App Service, you had to wait until the Azure team updated those dependencies in App Service.</span></span> <span data-ttu-id="042a3-162">Или пришлось бы переключиться на другие службы, например Azure Service Fabric, или даже виртуальные машины, где у вас было бы больше возможностей и можно было бы установить необходимый компонент или платформу для приложения.</span><span class="sxs-lookup"><span data-stu-id="042a3-162">Or you had to switch to other services like Azure Service Fabric, Azure Cloud Services, or even VMs, where you had further control and you could install a required component or framework for your application.</span></span>

<span data-ttu-id="042a3-163">Благодаря поддержке контейнеров в Visual Studio 2017 вы можете включать в среду приложения любые компоненты, как показано на рисунке 4-4.</span><span class="sxs-lookup"><span data-stu-id="042a3-163">Container support in Visual Studio 2017 gives you the ability to include whatever you want in your application environment, as shown in Figure 4-4.</span></span> <span data-ttu-id="042a3-164">Поскольку приложение выполняется в контейнере, при добавлении зависимости можно включить ее в Dockerfile или образ Docker.</span><span class="sxs-lookup"><span data-stu-id="042a3-164">Since you are running it in a container, if you add a dependency to your application, you can include the dependency in your Dockerfile or Docker image.</span></span>

<span data-ttu-id="042a3-165">На рисунке 4-4 также показано, что поток публикации отправляет образ через реестр контейнеров.</span><span class="sxs-lookup"><span data-stu-id="042a3-165">As also shown in Figure 4-4, the publish flow pushes an image through a container registry.</span></span> <span data-ttu-id="042a3-166">Это может быть реестр контейнеров Azure (реестр, близкий к вашим развертываниям в Azure и защищенный группами и учетными записями в Azure Active Directory) или другой реестр Docker, например центр Docker или локальный реестр.</span><span class="sxs-lookup"><span data-stu-id="042a3-166">This can be the Azure Container Registry (a registry close to your deployments in Azure and secured by Azure Active Directory groups and accounts), or any other Docker registry, like Docker Hub or an on-premises registry.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="042a3-167">[Назад] (index.md) [Далее] (docker-application-state-data.md)</span><span class="sxs-lookup"><span data-stu-id="042a3-167">[Previous] (index.md) [Next] (docker-application-state-data.md)</span></span>
