---
title: "Containerizing монолитные приложения"
description: "Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Containerizing монолитные приложения"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 11e2c24403b9b61584e424696c844e00e5d34b03
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2017
---
# <a name="containerizing-monolithic-applications"></a><span data-ttu-id="71af4-104">Containerizing монолитные приложения</span><span class="sxs-lookup"><span data-stu-id="71af4-104">Containerizing monolithic applications</span></span>

<span data-ttu-id="71af4-105">Можно создавать один monolithically развернутого веб-приложения или службы и разверните его как контейнер.</span><span class="sxs-lookup"><span data-stu-id="71af4-105">You might want to build a single, monolithically deployed web application or service and deploy it as a container.</span></span> <span data-ttu-id="71af4-106">Само приложение не может быть внутренне монолитные, но структурированные в виде нескольких библиотек, компонентов или даже слои (уровня приложения, уровня домена, уровень доступа к данным, и т. д.).</span><span class="sxs-lookup"><span data-stu-id="71af4-106">The application itself might not be internally monolithic, but structured as several libraries, components, or even layers (application layer, domain layer, data-access layer, etc.).</span></span> <span data-ttu-id="71af4-107">Извне, однако это один контейнер — один процесс, одного веб-приложения или одной службы.</span><span class="sxs-lookup"><span data-stu-id="71af4-107">Externally, however, it is a single container—a single process, a single web application, or a single service.</span></span>

<span data-ttu-id="71af4-108">Для управления этой модели, развернуть один контейнер для представления приложения.</span><span class="sxs-lookup"><span data-stu-id="71af4-108">To manage this model, you deploy a single container to represent the application.</span></span> <span data-ttu-id="71af4-109">Для увеличения масштаба, просто добавьте дополнительные копии с балансировкой нагрузки на переднем плане.</span><span class="sxs-lookup"><span data-stu-id="71af4-109">To scale up, you just add more copies with a load balancer in front.</span></span> <span data-ttu-id="71af4-110">Простота поступает из управления одно развертывание в одном контейнере или виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="71af4-110">The simplicity comes from managing a single deployment in a single container or VM.</span></span>

![](./media/image1.png)

<span data-ttu-id="71af4-111">**Рис. 4-1**.</span><span class="sxs-lookup"><span data-stu-id="71af4-111">**Figure 4-1**.</span></span> <span data-ttu-id="71af4-112">Пример архитектуры объединенный контейнерного приложения</span><span class="sxs-lookup"><span data-stu-id="71af4-112">Example of the architecture of a containerized monolithic application</span></span>

<span data-ttu-id="71af4-113">Может включать несколько компонентов, библиотеки или внутренней уровней в каждом контейнере, как показано на рисунке 4-1.</span><span class="sxs-lookup"><span data-stu-id="71af4-113">You can include multiple components, libraries, or internal layers in each container, as illustrated in Figure 4-1.</span></span> <span data-ttu-id="71af4-114">Однако этот объединенный шаблон может конфликтовать с принципом контейнер «контейнер выполняет один и делает это в одном процессе», но может быть ОК в некоторых случаях.</span><span class="sxs-lookup"><span data-stu-id="71af4-114">However, this monolithic pattern might conflict with the container principle “a container does one thing, and does it in one process”, but might be ok for some cases.</span></span>

<span data-ttu-id="71af4-115">Недостаток этого подхода становится очевидным, если приложение становится запрашивать ее для масштабирования.</span><span class="sxs-lookup"><span data-stu-id="71af4-115">The downside of this approach becomes evident if the application grows, requiring it to scale.</span></span> <span data-ttu-id="71af4-116">Если всего приложения можно масштабировать, это не действительно проблемы.</span><span class="sxs-lookup"><span data-stu-id="71af4-116">If the entire application can scale, it is not really a problem.</span></span> <span data-ttu-id="71af4-117">Однако в большинстве случаев всего несколько частей приложения являются стягиванием точки, требующие масштабирование, пока другие компоненты находятся в используется реже.</span><span class="sxs-lookup"><span data-stu-id="71af4-117">However, in most cases, just a few parts of the application are the choke points that requiring scaling, while other components are used less.</span></span>

<span data-ttu-id="71af4-118">Например в приложении обычно электронной коммерции, скорее всего необходимо масштабирование подсистемы сведения продукта, так как многие дополнительные клиенты просматривать продукты, чем их приобретение.</span><span class="sxs-lookup"><span data-stu-id="71af4-118">For example, in a typical e-commerce application, you likely need to scale the product information subsystem, because many more customers browse products than purchase them.</span></span> <span data-ttu-id="71af4-119">Дополнительные клиенты использовать свою корзину не использовать конвейер оплаты.</span><span class="sxs-lookup"><span data-stu-id="71af4-119">More customers use their basket than use the payment pipeline.</span></span> <span data-ttu-id="71af4-120">Меньшее количество клиентов, добавить комментарии или Просмотр истории покупок.</span><span class="sxs-lookup"><span data-stu-id="71af4-120">Fewer customers add comments or view their purchase history.</span></span> <span data-ttu-id="71af4-121">И может быть лишь небольшое число сотрудников, которым требуется осуществлять управление содержимым и маркетинговых кампаний.</span><span class="sxs-lookup"><span data-stu-id="71af4-121">And you might have only a handful of employees, that need to manage the content and marketing campaigns.</span></span> <span data-ttu-id="71af4-122">При масштабировании монолитные конструкции, весь код для этих различных задач развертывается несколько раз и масштабом того же уровня.</span><span class="sxs-lookup"><span data-stu-id="71af4-122">If you scale the monolithic design, all the code for these different tasks is deployed multiple times and scaled at the same grade.</span></span>

<span data-ttu-id="71af4-123">Существует несколько способов для масштабирования приложения-горизонтальной копирование, разбиение разные области приложения и секционирования как бизнес-концепции или данных.</span><span class="sxs-lookup"><span data-stu-id="71af4-123">There are multiple ways to scale an application—horizontal duplication, splitting different areas of the application, and partitioning similar business concepts or data.</span></span> <span data-ttu-id="71af4-124">Однако помимо проблемы масштабирования все компоненты, изменения к одному компоненту требуется полное повторное тестирование всего приложения и завершить повторное развертывание всех экземпляров.</span><span class="sxs-lookup"><span data-stu-id="71af4-124">But, in addition to the problem of scaling all components, changes to a single component require complete retesting of the entire application, and a complete redeployment of all the instances.</span></span>

<span data-ttu-id="71af4-125">Тем не менее объединенный подход является типичным, поскольку изначально проще, чем для микрослужбами подходов разработки приложения.</span><span class="sxs-lookup"><span data-stu-id="71af4-125">However, the monolithic approach is common, because the development of the application is initially easier than for microservices approaches.</span></span> <span data-ttu-id="71af4-126">Таким образом во многих организациях разрабатывать с помощью этого архитектурный подход.</span><span class="sxs-lookup"><span data-stu-id="71af4-126">Thus, many organizations develop using this architectural approach.</span></span> <span data-ttu-id="71af4-127">Хотя в некоторых организациях уже есть работающий достаточное количество результатов, другим пользователям, достигнуты ограничения.</span><span class="sxs-lookup"><span data-stu-id="71af4-127">While some organizations have had good enough results, others are hitting limits.</span></span> <span data-ttu-id="71af4-128">Во многих организациях предназначены свои приложения с помощью этой модели, так как средства и инфраструктура затрудняет слишком построение службы архитектур, ориентированных на (SOA) лет назад и отсутствует необходимость, пока его размер увеличивается.</span><span class="sxs-lookup"><span data-stu-id="71af4-128">Many organizations designed their applications using this model because tools and infrastructure made it too difficult to build service oriented architectures (SOA) years ago, and they did not see the need—until the application grew.</span></span>

<span data-ttu-id="71af4-129">С точки зрения инфраструктуры каждого сервера можно выполнять многие приложения, в том же узле и имеют допустимые доля эффективность использования ресурсов, как показано на рисунке 4-2.</span><span class="sxs-lookup"><span data-stu-id="71af4-129">From an infrastructure perspective, each server can run many applications within the same host and have an acceptable ratio of efficiency in resources usage, as shown in Figure 4-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="71af4-130">**Рис. 4-2**.</span><span class="sxs-lookup"><span data-stu-id="71af4-130">**Figure 4-2**.</span></span> <span data-ttu-id="71af4-131">Объединенный подход: размещать несколько приложений под управлением каждое приложение, работа в качестве контейнера</span><span class="sxs-lookup"><span data-stu-id="71af4-131">Monolithic approach: Host running multiple apps, each app running as a container</span></span>

<span data-ttu-id="71af4-132">Монолитные приложений в Microsoft Azure можно развернуть с помощью выделенных виртуальных машин для каждого экземпляра.</span><span class="sxs-lookup"><span data-stu-id="71af4-132">Monolithic applications in Microsoft Azure can be deployed using dedicated VMs for each instance.</span></span> <span data-ttu-id="71af4-133">Кроме того, с помощью [набора масштабирования виртуальных Машин Azure](https://docs.microsoft.com/azure/virtual-machine-scale-sets/), можно легко масштабировать виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="71af4-133">Additionally, using [Azure VM Scale Sets](https://docs.microsoft.com/azure/virtual-machine-scale-sets/), you can easily scale the VMs.</span></span> <span data-ttu-id="71af4-134">[Служба приложений Azure](https://azure.microsoft.com/services/app-service/) можно также запускать монолитные приложения и легко масштабировать экземпляры без необходимости управления виртуальными машинами.</span><span class="sxs-lookup"><span data-stu-id="71af4-134">[Azure App Service](https://azure.microsoft.com/services/app-service/) can also run monolithic applications and easily scale instances without requiring you to manage the VMs.</span></span> <span data-ttu-id="71af4-135">С момента 2016 г. службы приложений Azure можно запустить отдельные экземпляры контейнеры Docker, упрощая развертывание.</span><span class="sxs-lookup"><span data-stu-id="71af4-135">Since 2016, Azure App Services can run single instances of Docker containers as well, simplifying deployment.</span></span>

<span data-ttu-id="71af4-136">Как в среде QA или ограниченной рабочей среде можно развернуть несколько Docker узлов виртуальных машин и распределения их с помощью балансировки Azure, как показано на рисунке 4-3.</span><span class="sxs-lookup"><span data-stu-id="71af4-136">As a QA environment or a limited production environment, you can deploy multiple Docker host VMs and balance them using the Azure balancer, as shown in Figure 4-3.</span></span> <span data-ttu-id="71af4-137">Это позволяет управлять с помощью подход более крупных фрагментов данных, так как все приложение размещается в одном контейнере.</span><span class="sxs-lookup"><span data-stu-id="71af4-137">This lets you manage scaling with a coarse-grain approach, because the whole application lives within a single container.</span></span>

![](./media/image3.png)

<span data-ttu-id="71af4-138">**Рис. 4-3**.</span><span class="sxs-lookup"><span data-stu-id="71af4-138">**Figure 4-3**.</span></span> <span data-ttu-id="71af4-139">Пример несколько узлов, вертикальное масштабирование приложения одного контейнера</span><span class="sxs-lookup"><span data-stu-id="71af4-139">Example of multiple hosts scaling up a single container application</span></span>

<span data-ttu-id="71af4-140">Развертывание на различных узлах осуществляется с помощью традиционные методы.</span><span class="sxs-lookup"><span data-stu-id="71af4-140">Deployment to the various hosts can be managed with traditional deployment techniques.</span></span> <span data-ttu-id="71af4-141">Можно было управлять узлами docker с помощью команды `docker run` или `docker-compose` выполнить вручную или с помощью автоматизации, такие как конвейеры непрерывной поставки (CD).</span><span class="sxs-lookup"><span data-stu-id="71af4-141">Docker hosts can be managed with commands like `docker run` or `docker-compose` performed manually, or through automation such as continuous delivery (CD) pipelines.</span></span>

## <a name="deploying-a-monolithic-application-as-a-container"></a><span data-ttu-id="71af4-142">Развертывание монолитные приложения как контейнер</span><span class="sxs-lookup"><span data-stu-id="71af4-142">Deploying a monolithic application as a container</span></span>

<span data-ttu-id="71af4-143">Существуют преимущества при использовании контейнеров для управления развертываниями монолитные приложения.</span><span class="sxs-lookup"><span data-stu-id="71af4-143">There are benefits to using containers to manage monolithic application deployments.</span></span> <span data-ttu-id="71af4-144">Масштабирование экземпляров контейнера гораздо быстрее и проще, чем развертывание дополнительных виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="71af4-144">Scaling container instances is far faster and easier than deploying additional VMs.</span></span> <span data-ttu-id="71af4-145">Даже при использовании набора масштабирования виртуальных Машин, виртуальные машины занять время запуска.</span><span class="sxs-lookup"><span data-stu-id="71af4-145">Even if you use VM Scale Sets, VMs take time to start.</span></span> <span data-ttu-id="71af4-146">При развертывании в качестве экземпляров традиционное приложение вместо контейнеры, настройки приложения осуществляется в рамках виртуальной машины, которой не идеальное решение.</span><span class="sxs-lookup"><span data-stu-id="71af4-146">When deployed as traditional application instances instead of containers, the configuration of the application is managed as part of the VM, which is not ideal.</span></span>

<span data-ttu-id="71af4-147">Развертывание обновлений, как образы Docker гораздо быстрее и эффективно сети.</span><span class="sxs-lookup"><span data-stu-id="71af4-147">Deploying updates as Docker images is far faster and network efficient.</span></span> <span data-ttu-id="71af4-148">Образы docker обычно начинается в секундах, что увеличивает развертываний.</span><span class="sxs-lookup"><span data-stu-id="71af4-148">Docker images typically start in seconds, which speeds rollouts.</span></span> <span data-ttu-id="71af4-149">То закрытие экземпляр образа Docker можно так же легко, как выдача `docker stop` команды и обычно занимает менее чем за секунду.</span><span class="sxs-lookup"><span data-stu-id="71af4-149">Tearing down a Docker image instance is as easy as issuing a `docker stop` command, and typically completes in less than a second.</span></span>

<span data-ttu-id="71af4-150">Поскольку контейнеры являются неизменяемыми намеренно, необходимо никогда не беспокоиться о поврежденных виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="71af4-150">Because containers are immutable by design, you never need to worry about corrupted VMs.</span></span> <span data-ttu-id="71af4-151">Напротив скрипты обновления для виртуальной Машины может отложить с учетом некоторых определенной конфигурации или файл, оставшегося на диске.</span><span class="sxs-lookup"><span data-stu-id="71af4-151">In contrast, update scripts for a VM might forget to account for some specific configuration or file left on disk.</span></span>

<span data-ttu-id="71af4-152">Пока монолитные приложения могут использовать Docker, мы касаются только на преимущества.</span><span class="sxs-lookup"><span data-stu-id="71af4-152">While monolithic applications can benefit from Docker, we are touching only on the benefits.</span></span> <span data-ttu-id="71af4-153">Дополнительные преимущества управления контейнерами берутся из развертывание с помощью orchestrators контейнера, в которых управление различных экземпляров и жизненным циклом каждый экземпляр контейнера.</span><span class="sxs-lookup"><span data-stu-id="71af4-153">Additional benefits of managing containers come from deploying with container orchestrators, which manage the various instances and lifecycle of each container instance.</span></span> <span data-ttu-id="71af4-154">Разделить монолитные приложение в подсистемам, которые можно масштабировать, разработки и развертывания по отдельности представляет точку входа в область микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="71af4-154">Breaking up the monolithic application into subsystems that can be scaled, developed, and deployed individually is your entry point into the realm of microservices.</span></span>

## <a name="publishing-a-single-container-based-application-to-azure-app-service"></a><span data-ttu-id="71af4-155">Публикация одного контейнера на основе приложения в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="71af4-155">Publishing a single-container-based application to Azure App Service</span></span>

<span data-ttu-id="71af4-156">Хотите ли вы получить проверку контейнера развертывания в Azure или когда приложение просто приложения-контейнера с одним службе приложений Azure предоставляет отличный способ предоставления масштабируемой одного контейнера на основе служб.</span><span class="sxs-lookup"><span data-stu-id="71af4-156">Whether you want to get validation of a container deployed to Azure or when an application is simply a single-container application, Azure App Service provides a great way to provide scalable single-container-based services.</span></span> <span data-ttu-id="71af4-157">С помощью службы приложения Azure является простым.</span><span class="sxs-lookup"><span data-stu-id="71af4-157">Using Azure App Service is simple.</span></span> <span data-ttu-id="71af4-158">Он обеспечивает значительные интеграцию с Git для упрощения использования вашего кода, построить его в Visual Studio и разверните его непосредственно в Azure.</span><span class="sxs-lookup"><span data-stu-id="71af4-158">It provides great integration with Git to make it easy to take your code, build it in Visual Studio, and deploy it directly to Azure.</span></span>

![](./media/image4.png)

<span data-ttu-id="71af4-159">**Рис. 4-4**.</span><span class="sxs-lookup"><span data-stu-id="71af4-159">**Figure 4-4**.</span></span> <span data-ttu-id="71af4-160">Публикация приложения одного контейнера в службе приложений Azure из Visual Studio</span><span class="sxs-lookup"><span data-stu-id="71af4-160">Publishing a single-container application to Azure App Service from Visual Studio</span></span>

<span data-ttu-id="71af4-161">При необходимости других возможностей, платформах и зависимости, которые не поддерживаются в службе приложений Azure, без Docker, приходилось подождать, пока команда Azure обновить эти зависимости в службе приложений.</span><span class="sxs-lookup"><span data-stu-id="71af4-161">Without Docker, if you needed other capabilities, frameworks, or dependencies that are not supported in Azure App Service, you had to wait until the Azure team updated those dependencies in App Service.</span></span> <span data-ttu-id="71af4-162">Или можно переключиться на других служб, таких как Azure Service Fabric, облачных служб Azure или даже виртуальных машин, где было дальнейшего управления и удалось установить необходимый компонент или framework для приложения.</span><span class="sxs-lookup"><span data-stu-id="71af4-162">Or you had to switch to other services like Azure Service Fabric, Azure Cloud Services, or even VMs, where you had further control and you could install a required component or framework for your application.</span></span>

<span data-ttu-id="71af4-163">Поддержка контейнера в Visual Studio 2017 г дает возможность включать любые необходимые в вашей среде приложения, как показано на рисунке 4-4.</span><span class="sxs-lookup"><span data-stu-id="71af4-163">Container support in Visual Studio 2017 gives you the ability to include whatever you want in your application environment, as shown in Figure 4-4.</span></span> <span data-ttu-id="71af4-164">Так как она запущена в контейнере, если добавить зависимости в приложение, можно включить зависимость в образ файла Dockerfile или Docker.</span><span class="sxs-lookup"><span data-stu-id="71af4-164">Since you are running it in a container, if you add a dependency to your application, you can include the dependency in your Dockerfile or Docker image.</span></span>

<span data-ttu-id="71af4-165">Как также показано на рисунке 4-4 поток публикации помещает изображение через реестр контейнера.</span><span class="sxs-lookup"><span data-stu-id="71af4-165">As also shown in Figure 4-4, the publish flow pushes an image through a container registry.</span></span> <span data-ttu-id="71af4-166">Это может быть Azure реестра контейнера (реестра закрыть к развертываниям в Azure и защищены учетные записи и группы Azure Active Directory) или любые другие реестра Docker, такие как центр Docker или в реестре локального.</span><span class="sxs-lookup"><span data-stu-id="71af4-166">This can be the Azure Container Registry (a registry close to your deployments in Azure and secured by Azure Active Directory groups and accounts), or any other Docker registry, like Docker Hub or an on-premises registry.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="71af4-167">[Предыдущие] (index.md) [Далее] (docker приложения состояние data.md)</span><span class="sxs-lookup"><span data-stu-id="71af4-167">[Previous] (index.md) [Next] (docker-application-state-data.md)</span></span>
