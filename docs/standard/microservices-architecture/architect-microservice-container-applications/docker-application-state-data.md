---
title: Состояние и данные в приложениях Docker
description: Архитектура микрослужб .NET для упакованных в контейнеры приложений .NET | Состояние и данные в приложениях Docker
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 10/18/2017
ms.openlocfilehash: c5cfe617335d8150d069149ac87f79206b1b5eca
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
ms.locfileid: "33578659"
---
# <a name="state-and-data-in-docker-applications"></a>Состояние и данные в приложениях Docker

Представьте себе контейнер как экземпляр процесса. Процесс не находится в неизменном состоянии. И хотя контейнер может записывать данные в локальное хранилище, предполагать, что экземпляр всегда будет на месте — это все равно, что надеяться на постоянство одной ячейки памяти. Следует считать, что образы контейнеров, как и процессы, имеют несколько экземпляров или в конечном итоге будут завершены. Если они управляются с помощью оркестратора контейнеров, они могут перемещаться между узлами или виртуальными машинами.

Docker имеет функцию под названием *оверлейная файловая система*. Она выполняет копирование при записи, при котором обновленная информация сохраняется в корневой файловой системе контейнера. Эта информация добавляется к изначальному образу, на котором базируется контейнер. Если удалить контейнер из системы, эти изменения будут утеряны. Поэтому, хоть и возможно сохранить состояние контейнера в его локальном хранилище, создание системы по такой модели будет противоречить конструкции контейнера, состояние которого по умолчанию не отслеживается.

Для управления постоянными данными в приложениях Docker используются следующие решения:

-   [Тома данных](https://docs.docker.com/engine/tutorials/dockervolumes/), которые подключаются к узлу.

-   [Контейнеры томов данных](https://docs.docker.com/engine/tutorials/dockervolumes/#creating-and-mounting-a-data-volume-container), обеспечивающие общее хранилище для контейнеров с помощью внешнего контейнера.

-   [Подключаемые модули томов](https://docs.docker.com/engine/tutorials/dockervolumes/), которые подключают тома к удаленным службам, обеспечивая долгосрочное хранение.

-   [Служба хранилища Azure](https://docs.microsoft.com/azure/storage/), предоставляющая геораспределенное хранилище для долгосрочного хранения данных контейнеров.

-   Удаленные реляционные базы данных, например [базы данных SQL Azure](https://azure.microsoft.com/services/sql-database/) или базы данных NoSQL, такие как [Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/introduction), или службы кэша, такие как [Redis](https://redis.io/).

Ниже подробно описаны эти решения.

**Тома данных** — это каталоги из ОС узла, сопоставленные с каталогами в контейнерах. Если код в контейнере имеет доступ к каталогу, на самом деле он обращается к каталогу на ОС узла. Этот каталог не привязан к времени существования самого контейнера, и к каталогу может иметь доступ код, выполняемый непосредственно в ОС узла, или другой контейнер, сопоставляющийся с тем же каталогом узла. Поэтому тома данных хранят данные независимо от контейнера. Если удалить контейнер или образ из узла Docker, данные из томов данных не будут удалены. Доступ к данным в томе можно также получить из ОС узла.

**Контейнеры томов данных** — это усовершенствованная версия обычных томов данных. Контейнер томов данных — это простой контейнер, содержащий один или несколько томов данных. Контейнер томов данных предоставляет контейнерам доступ из центральной точки подключения. Это удобный метод доступа к данным, поскольку не учитывается расположение исходных данных. В остальном он почти не отличается от обычного тома данных, и данные хранятся в отдельном контейнере независимо от жизненного цикла контейнеров приложений.

Как показано на рисунке 4-5, обычные тома Docker могут храниться за пределами самих контейнерами, но в физических границах сервера узла или виртуальной машины. Тем не менее контейнеры Docker с одного сервера узла или виртуальной машины не могут обращаться к тому на другом сервере узла или виртуальной машине. Другими словами, при использовании этих томов невозможно управлять данными контейнеров, расположенных на разных узлах Docker

![](./media/image5.png)

**Рис. 4-5**. Тома данных и внешние источники данных для приложений на основе контейнера

Кроме того, когда контейнеры Docker управляются оркестратором, контейнеры могут "перемещаться" между узлами в рамках оптимизации, выполняемой кластером. Поэтому не рекомендуется использовать тома данных для бизнес-данных. Но это хороший инструмент для работы с файлами трассировки, временными файлами или подобными элементами, которые не влияют на целостность бизнес-данных.

**Подключаемые модули томов**, например [Flocker](https://clusterhq.com/flocker/), предоставляют доступ к данным на всех узлах в кластере. Не все подключаемые модули томов создаются одинаково, но обычно являются надежным внешним хранилищем данных для неизменных контейнеров.

**Удаленные источники данных и инструменты кэширования**, такие как база данных Azure SQL, Azure Cosmos DB или служба кэша, например Redis, можно использовать в упакованных в контейнеры приложениях так же, как они используются при разработке без контейнеров. Это проверенный способ хранения данных бизнес-приложений.

**Служба хранилища Azure** Бизнес-данные, как правило, необходимо хранить во внешних ресурсах или базах данных, например в службе хранилища Azure. Служба хранилища Azure предоставляет следующие службы в облаке:

-   Хранилище BLOB-объектов хранит неструктурированные данные объектов. Большой двоичный объект может представлять собой текстовые или двоичные данные любого типа, например документ или файл мультимедиа (файлы с изображением, аудио и видео). Хранилище BLOB-объектов также называют хранилищем объектов.

-   Хранилище файлов обеспечивает хранение приложений прежних версий по стандартному протоколу SMB. Виртуальные машины Azure и облачные службы могут совместно использовать данные файлов в компонентах приложений через подключенный общий ресурс. Локальные приложения могут обращаться к данным файлов в общем ресурсе через файловую службу REST API.

-   Хранилище таблиц содержит структурированные наборы данных. Хранилище таблиц — это хранилище данных NoSQL типа "ключ-значение", обеспечивающее быструю разработку и доступ к большим объемам данных.

**Реляционные базы данных и базы данных NoSQL.** Существует множество вариантов внешних баз данных — реляционные базы данных, такие как SQL Server, PostgreSQL, Oracle или базы данных NoSQL, например Azure Cosmos DB, MongoDB и т. д. Эти базы данных являются отдельной темой и не будут описываться в данном руководстве.


>[!div class="step-by-step"]
[Назад] (containerize-monolithic-applications.md) [Далее] (service-oriented-architecture.md)
