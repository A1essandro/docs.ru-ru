---
title: "Состояния и данных в приложениях Docker"
description: "Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Состояния и данных в приложениях Docker"
keywords: "Docker, Микрослужбами, ASP.NET, контейнер, SQL, CosmosDB, Docker"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 10/18/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 36d0fb9f27ef56b36c380e2fc972c79cff77003e
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2017
---
# <a name="state-and-data-in-docker-applications"></a><span data-ttu-id="13dc3-104">Состояния и данных в приложениях Docker</span><span class="sxs-lookup"><span data-stu-id="13dc3-104">State and data in Docker applications</span></span>

<span data-ttu-id="13dc3-105">В большинстве случаев можно представить контейнера в качестве экземпляра процесса.</span><span class="sxs-lookup"><span data-stu-id="13dc3-105">In most cases, you can think of a container as an instance of a process.</span></span> <span data-ttu-id="13dc3-106">Процесс не поддерживают постоянное состояние.</span><span class="sxs-lookup"><span data-stu-id="13dc3-106">A process does not maintain persistent state.</span></span> <span data-ttu-id="13dc3-107">Пока контейнер можно записать на его локальное хранилище, при условии, что экземпляр будет происходить вокруг бесконечно бы как при условии, что место в памяти будет устойчивой.</span><span class="sxs-lookup"><span data-stu-id="13dc3-107">While a container can write to its local storage, assuming that an instance will be around indefinitely would be like assuming that a single location in memory will be durable.</span></span> <span data-ttu-id="13dc3-108">Образы контейнеров, таких как процессы, следует предположить, что существует несколько экземпляров, или они в конечном итоге будет завершен; Если они выполняется под управлением с orchestrator контейнера, следует полагать, что они могут получить перемещать из одного узла или виртуальной Машины в другую.</span><span class="sxs-lookup"><span data-stu-id="13dc3-108">Container images, like processes, should be assumed to have multiple instances or that they will eventually be killed; if they’re managed with a container orchestrator, it should be assumed that they might get moved from one node or VM to another.</span></span>

<span data-ttu-id="13dc3-109">Docker обеспечивает функции с именем *наложения файловой системы*.</span><span class="sxs-lookup"><span data-stu-id="13dc3-109">Docker provides a feature named the *overlay file system*.</span></span> <span data-ttu-id="13dc3-110">Это реализуется задачу копирования при записи сохраняет обновленные сведения о файловой системе корневого контейнера.</span><span class="sxs-lookup"><span data-stu-id="13dc3-110">This implements a copy-on-write task that stores updated information to the root file system of the container.</span></span> <span data-ttu-id="13dc3-111">Эти сведения будут в дополнение к исходному изображению, лежащие в основе контейнера.</span><span class="sxs-lookup"><span data-stu-id="13dc3-111">That information is in addition to the original image on which the container is based.</span></span> <span data-ttu-id="13dc3-112">Если контейнер удаляется из системы, эти изменения будут потеряны.</span><span class="sxs-lookup"><span data-stu-id="13dc3-112">If the container is deleted from the system, those changes are lost.</span></span> <span data-ttu-id="13dc3-113">Таким образом хотя и существует возможность сохранения состояния контейнер в локальном хранилище разработки системы этой противоречит предположения проектирования контейнера, который по умолчанию без сохранения состояния.</span><span class="sxs-lookup"><span data-stu-id="13dc3-113">Therefore, while it is possible to save the state of a container within its local storage, designing a system around this would conflict with the premise of container design, which by default is stateless.</span></span>

<span data-ttu-id="13dc3-114">Следующие решения, используемые для управления постоянных данных в приложениях Docker.</span><span class="sxs-lookup"><span data-stu-id="13dc3-114">The following solutions are used to manage persistent data in Docker applications:</span></span>

-   <span data-ttu-id="13dc3-115">[Тома данных](https://docs.docker.com/engine/tutorials/dockervolumes/) , подключения к узлу.</span><span class="sxs-lookup"><span data-stu-id="13dc3-115">[Data volumes](https://docs.docker.com/engine/tutorials/dockervolumes/) that mount to the host.</span></span>

-   <span data-ttu-id="13dc3-116">[Контейнеры томов данных](https://docs.docker.com/engine/tutorials/dockervolumes/#creating-and-mounting-a-data-volume-container) , обеспечивающие общее хранилище для контейнеров с помощью внешнего контейнера.</span><span class="sxs-lookup"><span data-stu-id="13dc3-116">[Data volume containers](https://docs.docker.com/engine/tutorials/dockervolumes/#creating-and-mounting-a-data-volume-container) that provide shared storage across containers using an external container.</span></span>

-   <span data-ttu-id="13dc3-117">[Подключаемые модули тома](https://docs.docker.com/engine/tutorials/dockervolumes/) , подключите тома для удаленных служб, предоставляя долгосрочной сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="13dc3-117">[Volume plugins](https://docs.docker.com/engine/tutorials/dockervolumes/) that mount volumes to remote services, providing long-term persistence.</span></span>

-   <span data-ttu-id="13dc3-118">[Хранилище Azure](https://docs.microsoft.com/azure/storage/), предоставляющее распространяемый geo хранилищам хорошо долговременное сохраняемости для контейнеров.</span><span class="sxs-lookup"><span data-stu-id="13dc3-118">[Azure Storage](https://docs.microsoft.com/azure/storage/), which provides geo-distributable storage, providing a good long-term persistence solution for containers.</span></span>

-   <span data-ttu-id="13dc3-119">Удаленный реляционных баз данных, например [базы данных SQL Azure](https://azure.microsoft.com/services/sql-database/) или базах данных NoSQL, такие как [Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/introduction), или кэшировать служб, таких как [Redis](https://redis.io/).</span><span class="sxs-lookup"><span data-stu-id="13dc3-119">Remote relational databases like [Azure SQL Database](https://azure.microsoft.com/services/sql-database/) or NoSQL databases like [Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/introduction), or cache services like [Redis](https://redis.io/).</span></span>

<span data-ttu-id="13dc3-120">В этом разделе представлены дополнительные сведения об этих параметрах.</span><span class="sxs-lookup"><span data-stu-id="13dc3-120">The following provides more detail about these options.</span></span>

<span data-ttu-id="13dc3-121">**Тома данных** , каталогов, сопоставленных с ОС узла каталоги в контейнерах.</span><span class="sxs-lookup"><span data-stu-id="13dc3-121">**Data volumes** are directories mapped from the host OS to directories in containers.</span></span> <span data-ttu-id="13dc3-122">Если код в контейнере есть доступ к каталогу, каталог на ОС узла имеет доступ.</span><span class="sxs-lookup"><span data-stu-id="13dc3-122">When code in the container has access to the directory, that access is actually to a directory on the host OS.</span></span> <span data-ttu-id="13dc3-123">Этот каталог не привязан к времени существования контейнера и каталог может осуществляться из кода непосредственно в операционной системе сервера или по другой контейнер, сопоставляется один и тот же каталог узла к самому себе.</span><span class="sxs-lookup"><span data-stu-id="13dc3-123">This directory is not tied to the lifetime of the container itself, and the directory can be accessed from code running directly on the host OS or by another container that maps the same host directory to itself.</span></span> <span data-ttu-id="13dc3-124">Таким образом тома данных предназначены для хранения данных, независимо от существования контейнера.</span><span class="sxs-lookup"><span data-stu-id="13dc3-124">Thus, data volumes are designed to persist data independently of the life of the container.</span></span> <span data-ttu-id="13dc3-125">Если удалить контейнер или образа из узла Docker, данные сохраняются в том данных не удаляется.</span><span class="sxs-lookup"><span data-stu-id="13dc3-125">If you delete a container or an image from the Docker host, the data persisted in the data volume is not deleted.</span></span> <span data-ttu-id="13dc3-126">Данные в томе может осуществляться из ОС также.</span><span class="sxs-lookup"><span data-stu-id="13dc3-126">The data in a volume can be accessed from the host OS as well.</span></span>

<span data-ttu-id="13dc3-127">**Контейнеры томов данных** являются развитием обычных данных тома.</span><span class="sxs-lookup"><span data-stu-id="13dc3-127">**Data volume containers** are an evolution of regular data volumes.</span></span> <span data-ttu-id="13dc3-128">Контейнер томов данных является простой контейнер, имеющий один или несколько томов данных внутри него.</span><span class="sxs-lookup"><span data-stu-id="13dc3-128">A data volume container is a simple container that has one or more data volumes within it.</span></span> <span data-ttu-id="13dc3-129">Контейнер томов данных предоставляет доступ к контейнерам из точки центра подключения.</span><span class="sxs-lookup"><span data-stu-id="13dc3-129">The data volume container provides access to containers from a central mount point.</span></span> <span data-ttu-id="13dc3-130">Этот метод доступа к данным удобно, так как она создает уровень абстракции расположение исходных данных.</span><span class="sxs-lookup"><span data-stu-id="13dc3-130">This method of data access is convenient because it abstracts the location of the original data.</span></span> <span data-ttu-id="13dc3-131">За исключением этого его поведение аналогично томом обычных данных, данные сохраняются в этом контейнере выделенный независимо от жизненного цикла приложения контейнеров.</span><span class="sxs-lookup"><span data-stu-id="13dc3-131">Other than that, its behavior is similar to that of a regular data volume, so data is persisted in this dedicated container independently of the lifecycle of the application’s containers.</span></span>

<span data-ttu-id="13dc3-132">Как показано на рисунке 4-5, регулярного тома Docker могут храниться за пределами самим контейнерами, но в пределах физического сервера узла или виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="13dc3-132">As shown in Figure 4-5, regular Docker volumes can be stored outside of the containers themselves but within the physical boundaries of the host server or VM.</span></span> <span data-ttu-id="13dc3-133">Тем не менее контейнеры Docker не может обращаться к тому с одного узла сервера или виртуальной Машины на другой.</span><span class="sxs-lookup"><span data-stu-id="13dc3-133">However, Docker containers cannot access a volume from one host server or VM to another.</span></span> <span data-ttu-id="13dc3-134">Другими словами с этих томов, он не поддерживается для управления данными, общим для контейнеров, выполняющихся на разных узлах Docker</span><span class="sxs-lookup"><span data-stu-id="13dc3-134">In other words, with these volumes, it is not possible to manage data shared between containers that run on different Docker hosts</span></span>

![](./media/image5.png)

<span data-ttu-id="13dc3-135">**Рис. 4-5**.</span><span class="sxs-lookup"><span data-stu-id="13dc3-135">**Figure 4-5**.</span></span> <span data-ttu-id="13dc3-136">Объемы данных и внешние источники данных для приложений на основе контейнера</span><span class="sxs-lookup"><span data-stu-id="13dc3-136">Data volumes and external data sources for container-based applications</span></span>

<span data-ttu-id="13dc3-137">Кроме того когда контейнеры Docker управляются orchestrator, контейнеры могут «переместить» между узлами в зависимости от оптимизацию, выполняемую в кластере.</span><span class="sxs-lookup"><span data-stu-id="13dc3-137">In addition, when Docker containers are managed by an orchestrator, containers might “move” between hosts, depending on the optimizations performed by the cluster.</span></span> <span data-ttu-id="13dc3-138">Таким образом не рекомендуется использовать тома данных для бизнес-данных.</span><span class="sxs-lookup"><span data-stu-id="13dc3-138">Therefore, it is not recommended that you use data volumes for business data.</span></span> <span data-ttu-id="13dc3-139">Однако, они хороший механизм для работы с файлами трассировки, временных файлов или аналогичные, не повлияет на согласованность данных business.</span><span class="sxs-lookup"><span data-stu-id="13dc3-139">But they are a good mechanism to work with trace files, temporal files, or similar that will not impact business data consistency.</span></span>

<span data-ttu-id="13dc3-140">**Подключаемые модули тома** как [Flocker](https://clusterhq.com/flocker/) предоставляют доступ к данным на всех узлах в кластере.</span><span class="sxs-lookup"><span data-stu-id="13dc3-140">**Volume plugins** like [Flocker](https://clusterhq.com/flocker/) provide data access across all hosts in a cluster.</span></span> <span data-ttu-id="13dc3-141">Не все подключаемые модули тома создаются одинаково, подключаемые модули тома обычно предоставляют во внешних хранилищах постоянного надежного хранилища из неизменяемого контейнеров.</span><span class="sxs-lookup"><span data-stu-id="13dc3-141">While not all volume plugins are created equally, volume plugins typically provide externalized persistent reliable storage from immutable containers.</span></span>

<span data-ttu-id="13dc3-142">**Удаленные источники данных и кэш** средств, таких как базы данных SQL Azure, Azure Cosmos DB или удаленного кэша Redis может использоваться в like контейнерных приложений так же, как они используются при разработке без контейнеров.</span><span class="sxs-lookup"><span data-stu-id="13dc3-142">**Remote data sources and cache** tools like Azure SQL Database, Azure Cosmos DB, or a remote cache like Redis can be used in containerized applications the same way they are used when developing without containers.</span></span> <span data-ttu-id="13dc3-143">Это проверенные способ хранения данных бизнес-приложения.</span><span class="sxs-lookup"><span data-stu-id="13dc3-143">This is a proven way to store business application data.</span></span>

<span data-ttu-id="13dc3-144">**Хранилище Azure.**</span><span class="sxs-lookup"><span data-stu-id="13dc3-144">**Azure Storage.**</span></span> <span data-ttu-id="13dc3-145">Бизнес-данных обычно будет должны быть помещены в внешние ресурсы или базах данных, таких как хранилище Azure.</span><span class="sxs-lookup"><span data-stu-id="13dc3-145">Business data usually will need to be placed in external resources or databases, like Azure Storage.</span></span> <span data-ttu-id="13dc3-146">Служба хранилища Azure, в конкретный, предоставляет следующие службы в облаке.</span><span class="sxs-lookup"><span data-stu-id="13dc3-146">Azure Storage, in concrete, provides the following services in the cloud:</span></span>

-   <span data-ttu-id="13dc3-147">Хранилище BLOB-объектов хранит объекта неструктурированных данных.</span><span class="sxs-lookup"><span data-stu-id="13dc3-147">Blob storage stores unstructured object data.</span></span> <span data-ttu-id="13dc3-148">Большой двоичный объект может быть любым типом текстовых или двоичных данных, например документов или носителя файлы (изображения, аудио и видео).</span><span class="sxs-lookup"><span data-stu-id="13dc3-148">A blob can be any type of text or binary data, such as document or media files (images, audio, and video files).</span></span> <span data-ttu-id="13dc3-149">Хранилище больших двоичных объектов также называют хранения объектов.</span><span class="sxs-lookup"><span data-stu-id="13dc3-149">Blob storage is also referred to as Object storage.</span></span>

-   <span data-ttu-id="13dc3-150">Файл хранилища предоставляет общее хранилище для прежних версий приложений с помощью стандартного протокола SMB.</span><span class="sxs-lookup"><span data-stu-id="13dc3-150">File storage offers shared storage for legacy applications using standard SMB protocol.</span></span> <span data-ttu-id="13dc3-151">Виртуальные машины Azure и облачных служб могут обмениваться данными файлов между компонентами приложения с помощью монтируемых хранилищ.</span><span class="sxs-lookup"><span data-stu-id="13dc3-151">Azure virtual machines and cloud services can share file data across application components via mounted shares.</span></span> <span data-ttu-id="13dc3-152">Данные файла в общей папке посредством REST API файловой службы доступны локальных приложений.</span><span class="sxs-lookup"><span data-stu-id="13dc3-152">On-premises applications can access file data in a share via the File service REST API.</span></span>

-   <span data-ttu-id="13dc3-153">Хранилище таблиц содержит структурированные наборы данных.</span><span class="sxs-lookup"><span data-stu-id="13dc3-153">Table storage stores structured datasets.</span></span> <span data-ttu-id="13dc3-154">Табличное хранилище является хранилищем данных ключевым атрибутом NoSQL, что позволяет ускорить разработку и быстрый доступ к большим объемам данных.</span><span class="sxs-lookup"><span data-stu-id="13dc3-154">Table storage is a NoSQL key-attribute data store, which allows rapid development and fast access to large quantities of data.</span></span>

<span data-ttu-id="13dc3-155">**Реляционные базы данных и базах данных NoSQL.**</span><span class="sxs-lookup"><span data-stu-id="13dc3-155">**Relational databases and NoSQL databases.**</span></span> <span data-ttu-id="13dc3-156">Существует множество вариантов для внешних баз данных из реляционных баз данных, например баз данных SQL Server, PostgreSQL, Oracle или NoSQL Azure Cosmos DB, MongoDB, и т. д. Эти базы данных не будет описано в рамках данного руководства, поскольку они находятся в совершенно разных субъекта.</span><span class="sxs-lookup"><span data-stu-id="13dc3-156">There are many choices for external databases, from relational databases like SQL Server, PostgreSQL, Oracle, or NoSQL databases like Azure Cosmos DB, MongoDB, etc. These databases are not going to be explained as part of this guide since they are in a completely different subject.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="13dc3-157">[Предыдущие] (упаковываете монолитно applications.md) [Далее] (service ориентированного architecture.md)</span><span class="sxs-lookup"><span data-stu-id="13dc3-157">[Previous] (containerize-monolithic-applications.md) [Next] (service-oriented-architecture.md)</span></span>
