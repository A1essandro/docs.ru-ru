---
title: Прямое взаимодействие клиента и микрослужбы по сравнению с использованием шаблона службы API
description: Архитектура микрослужб .NET для контейнерных приложений .NET | Прямое взаимодействие клиента и микрослужбы по сравнению с использованием шаблона службы API
keywords: Docker, микрослужбы, ASP.NET, контейнер, шлюз API
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 10/18/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: fa3f4bb97cf942ee7698b1efa1dcd09b3f2ca571
ms.sourcegitcommit: 2e8acae16ae802f2d6d04e3ce0a6dbf04e476513
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2018
---
# <a name="direct-client-to-microservice-communication-versus-the-api-gateway-pattern"></a><span data-ttu-id="28d92-104">Прямое взаимодействие клиента и микрослужбы по сравнению с использованием шаблона службы API</span><span class="sxs-lookup"><span data-stu-id="28d92-104">Direct client-to-microservice communication versus the API Gateway pattern</span></span>

<span data-ttu-id="28d92-105">В архитектуре микрослужб каждая микрослужба обычно предоставляет набор специализированных конечных точек.</span><span class="sxs-lookup"><span data-stu-id="28d92-105">In a microservices architecture, each microservice exposes a set of (typically) fine‑grained endpoints.</span></span> <span data-ttu-id="28d92-106">Этот факт может повлиять на взаимодействие между клиентом и микрослужбой, как описано в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="28d92-106">This fact can impact the client‑to‑microservice communication, as explained in this section.</span></span>

## <a name="direct-client-to-microservice-communication"></a><span data-ttu-id="28d92-107">Прямое взаимодействие между клиентом и микрослужбой</span><span class="sxs-lookup"><span data-stu-id="28d92-107">Direct client-to-microservice communication</span></span>

<span data-ttu-id="28d92-108">Возможный подход — использование архитектуры с прямым взаимодействием между клиентом и микрослужбой.</span><span class="sxs-lookup"><span data-stu-id="28d92-108">A possible approach is to use a direct client-to-microservice communication architecture.</span></span> <span data-ttu-id="28d92-109">При таком подходе клиентские приложения могут отправлять запросы к некоторым микрослужбам напрямую, как показано на рис. 4-12.</span><span class="sxs-lookup"><span data-stu-id="28d92-109">In this approach, a client app can make requests directly to some of the microservices, as shown in Figure 4-12.</span></span>

![](./media/image12.png)

<span data-ttu-id="28d92-110">**Рис. 4-12**.</span><span class="sxs-lookup"><span data-stu-id="28d92-110">**Figure 4-12**.</span></span> <span data-ttu-id="28d92-111">Использование архитектуры с прямым взаимодействием клиента и микрослужбы</span><span class="sxs-lookup"><span data-stu-id="28d92-111">Using a direct client-to-microservice communication architecture</span></span>

<span data-ttu-id="28d92-112">При использовании этого подхода</span><span class="sxs-lookup"><span data-stu-id="28d92-112">In this approach.</span></span> <span data-ttu-id="28d92-113">у каждой микрослужбы есть общедоступная конечная точка, иногда с отдельным портом TCP для каждой микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="28d92-113">each microservice has a public endpoint, sometimes with a different TCP port for each microservice.</span></span> <span data-ttu-id="28d92-114">Например, определенная служба может иметь следующий URL-адрес в Azure:</span><span class="sxs-lookup"><span data-stu-id="28d92-114">An example of a URL for a particular service could be the following URL in Azure:</span></span>

<http://eshoponcontainers.westus.cloudapp.azure.com:88/>

<span data-ttu-id="28d92-115">В рабочей среде на основе кластера этот URL-адрес будет указывать на подсистему балансировки нагрузки кластера, которая, в свою очередь, распределяет запросы между микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="28d92-115">In a production environment based on a cluster, that URL would map to the load balancer used in the cluster, which in turn distributes the requests across the microservices.</span></span> <span data-ttu-id="28d92-116">В производственной среде можно использовать контроллер доставки приложений, например [шлюз приложения Azure](https://docs.microsoft.com/azure/application-gateway/application-gateway-introduction) между вашими микрослужбами и Интернетом.</span><span class="sxs-lookup"><span data-stu-id="28d92-116">In production environments, you could have an Application Delivery Controller (ADC) like [Azure Application Gateway](https://docs.microsoft.com/azure/application-gateway/application-gateway-introduction) between your microservices and the Internet.</span></span> <span data-ttu-id="28d92-117">Он выступает как прозрачный уровень, который не только выполняет балансировку нагрузки, но и защищает службы благодаря завершению SSL-запросов.</span><span class="sxs-lookup"><span data-stu-id="28d92-117">This acts as a transparent tier that not only performs load balancing, but secures your services by offering SSL termination.</span></span> <span data-ttu-id="28d92-118">Это уменьшает нагрузку на узлах за счет разгрузки завершения SSL-запросов и других задач, активно использующих ЦП, в шлюз приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="28d92-118">This improves the load of your hosts by offloading CPU-intensive SSL termination and other routing duties to the Azure Application Gateway.</span></span> <span data-ttu-id="28d92-119">В любом случае подсистема балансировки нагрузки и контроллер доставки приложений прозрачны с точки зрения логической архитектуры приложения.</span><span class="sxs-lookup"><span data-stu-id="28d92-119">In any case, a load balancer and ADC are transparent from a logical application architecture point of view.</span></span>

<span data-ttu-id="28d92-120">Архитектура прямого взаимодействия клиента и микрослужбы достаточно хорошо подходит для небольших приложений на основе микрослужб, особенно если клиентское приложение представляет собой веб-приложение на стороне сервера, например приложение MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="28d92-120">A direct client-to-microservice communication architecture could be good enough for a small microservice-based application, especially if the client app is a server-side web application like an ASP.NET MVC app.</span></span> <span data-ttu-id="28d92-121">Однако при создании больших и сложных приложений на основе микрослужб (например, при обработке десятков типов микрослужб) и особенно в том случае, если клиентские приложения представляют собой удаленные мобильные приложения или одностраничные веб-приложения, этот подход приводит к появлению нескольких проблем.</span><span class="sxs-lookup"><span data-stu-id="28d92-121">However, when you build large and complex microservice-based applications (for example, when handling dozens of microservice types), and especially when the client apps are remote mobile apps or SPA web applications, that approach faces a few issues.</span></span>

<span data-ttu-id="28d92-122">При разработке крупного приложения на основе микрослужб ответьте на следующие вопросы:</span><span class="sxs-lookup"><span data-stu-id="28d92-122">Consider the following questions when developing a large application based on microservices:</span></span>

-   <span data-ttu-id="28d92-123">*Как клиентские приложения могут свести к минимуму число запросов к серверной части и уменьшить частоту обмена данными с несколькими микрослужбами?*</span><span class="sxs-lookup"><span data-stu-id="28d92-123">*How can client apps minimize the number of requests to the backend and reduce chatty communication to multiple microservices?*</span></span>

<span data-ttu-id="28d92-124">Взаимодействие с несколькими микрослужбами для создания пользовательского интерфейса одного окна увеличивает количество обращений через Интернет.</span><span class="sxs-lookup"><span data-stu-id="28d92-124">Interacting with multiple microservices to build a single UI screen increases the number of roundtrips across the Internet.</span></span> <span data-ttu-id="28d92-125">Это увеличивает задержку и сложности на стороне пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="28d92-125">This increases latency and complexity on the UI side.</span></span> <span data-ttu-id="28d92-126">В идеальном случае ответы должны эффективно агрегироваться на стороне сервера — это сокращает задержки, так как можно возвращать несколько фрагментов данных в параллельном режиме, и в некоторых пользовательских интерфейсах данные можно отобразить сразу же после их появления.</span><span class="sxs-lookup"><span data-stu-id="28d92-126">Ideally, responses should be efficiently aggregated in the server side—this reduces latency, since multiple pieces of data come back in parallel and some UI can show data as soon as it is ready.</span></span>

-   <span data-ttu-id="28d92-127">*Как вы можете обрабатывать сквозную функциональность, например проверку подлинности, преобразование данных и динамическую диспетчеризацию запросов?*</span><span class="sxs-lookup"><span data-stu-id="28d92-127">*How can you handle cross-cutting concerns such as authorization, data transformations, and dynamic request dispatching?*</span></span>

<span data-ttu-id="28d92-128">Реализация вопросов безопасности и сквозной функциональности, например реализация безопасности и проверки подлинности на каждой микрослужбе, может потребовать значительных усилий.</span><span class="sxs-lookup"><span data-stu-id="28d92-128">Implementing security and cross-cutting concerns like security and authorization on every microservice can require significant development effort.</span></span> <span data-ttu-id="28d92-129">Один из возможных подходов состоит в том, чтобы разместить эти службы на узле Docker или во внутреннем кластере, чтобы предотвратить прямой доступ к ним извне и реализовать сквозную функциональность в централизованном месте, например в шлюзе API.</span><span class="sxs-lookup"><span data-stu-id="28d92-129">A possible approach is to have those services within the Docker host or internal cluster, in order to restrict direct access to them from the outside, and to implement those cross-cutting concerns in a centralized place, like an API Gateway.</span></span>

-   <span data-ttu-id="28d92-130">*Как клиентские приложения взаимодействуют со службами, использующими не поддерживаемые в Интернете протоколы?*</span><span class="sxs-lookup"><span data-stu-id="28d92-130">*How can client apps communicate with services that use non-Internet-friendly protocols?*</span></span>

<span data-ttu-id="28d92-131">Протоколы, используемые на стороне сервера (например, AMQP или двоичные протоколы), обычно не поддерживаются в клиентских приложениях.</span><span class="sxs-lookup"><span data-stu-id="28d92-131">Protocols used on the server side (like AMQP or binary protocols) are usually not supported in client apps.</span></span> <span data-ttu-id="28d92-132">Поэтому запросы необходимо выполнять через такие протоколы, как HTTP или HTTPS, а затем преобразовывать в другие протоколы.</span><span class="sxs-lookup"><span data-stu-id="28d92-132">Therefore, requests must be performed through protocols like HTTP/HTTPS and translated to the other protocols afterwards.</span></span> <span data-ttu-id="28d92-133">Подход *человек посередине* может помочь в этой ситуации.</span><span class="sxs-lookup"><span data-stu-id="28d92-133">A *man-in-the-middle* approach can help in this situation.</span></span>

-   <span data-ttu-id="28d92-134">*Как создать интерфейс, специально предназначенный для мобильных приложений?*</span><span class="sxs-lookup"><span data-stu-id="28d92-134">*How can you shape a façade especially made for mobile apps?*</span></span>

<span data-ttu-id="28d92-135">API нескольких микрослужб может быть не слишком хорошо приспособлено для удовлетворения потребностей различных клиентских приложений.</span><span class="sxs-lookup"><span data-stu-id="28d92-135">The API of multiple microservices might not be well designed for the needs of different client applications.</span></span> <span data-ttu-id="28d92-136">Например, потребности мобильного приложения могут отличаться от потребностей веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="28d92-136">For instance, the needs of a mobile app might be different than the needs of a web app.</span></span> <span data-ttu-id="28d92-137">Для мобильных приложений может потребоваться дополнительная оптимизация, чтобы повысить эффективность данных ответов.</span><span class="sxs-lookup"><span data-stu-id="28d92-137">For mobile apps, you might need to optimize even further so that data responses can be more efficient.</span></span> <span data-ttu-id="28d92-138">Это можно сделать, агрегировав данные из нескольких микрослужб и возвращая один набор данных. Также иногда можно исключить из ответа все данные, которые не требуются мобильному приложению.</span><span class="sxs-lookup"><span data-stu-id="28d92-138">You might do this by aggregating data from multiple microservices and returning a single set of data, and sometimes eliminating any data in the response that is not needed by the mobile app.</span></span> <span data-ttu-id="28d92-139">И, конечно же, эти данные можно сжать.</span><span class="sxs-lookup"><span data-stu-id="28d92-139">And, of course, you might compress that data.</span></span> <span data-ttu-id="28d92-140">Опять же, можно предусмотреть удобный интерфейс или API между микрослужбами и мобильным приложением для этого сценария.</span><span class="sxs-lookup"><span data-stu-id="28d92-140">Again, a façade or API in between the mobile app and the microservices can be convenient for this scenario.</span></span>

## <a name="using-an-api-gateway"></a><span data-ttu-id="28d92-141">Использование шлюза API</span><span class="sxs-lookup"><span data-stu-id="28d92-141">Using an API Gateway</span></span>

<span data-ttu-id="28d92-142">При проектировании и разработке крупных или сложных приложений на основе микрослужб с несколькими клиентскими приложениями рекомендуется использовать [шлюз API](https://microservices.io/patterns/apigateway.html).</span><span class="sxs-lookup"><span data-stu-id="28d92-142">When you design and build large or complex microservice-based applications with multiple client apps, a good approach to consider can be an [API Gateway](https://microservices.io/patterns/apigateway.html).</span></span> <span data-ttu-id="28d92-143">Это служба, предоставляющая единую точку входа для определенных групп микрослужб.</span><span class="sxs-lookup"><span data-stu-id="28d92-143">This is a service that provides a single entry point for certain groups of microservices.</span></span> <span data-ttu-id="28d92-144">Эта служба похожа на [шаблон интерфейса](https://en.wikipedia.org/wiki/Facade_pattern) из объектно-ориентированного проектирования, но в этом случае она является частью распределенной системы.</span><span class="sxs-lookup"><span data-stu-id="28d92-144">It is similar to the [Facade pattern](https://en.wikipedia.org/wiki/Facade_pattern) from object‑oriented design, but in this case, it is part of a distributed system.</span></span> <span data-ttu-id="28d92-145">Шаблон шлюза API также иногда называют "серверной частью для клиентской части" [(BFF)](https://samnewman.io/patterns/architectural/bff/), так как она создается с учетом потребностей клиентского приложения.</span><span class="sxs-lookup"><span data-stu-id="28d92-145">The API Gateway pattern is also sometimes known as the “backend for frontend” [(BFF)](https://samnewman.io/patterns/architectural/bff/) because you build it while thinking about the needs of the client app.</span></span>

<span data-ttu-id="28d92-146">На рисунке 4-13 показано, как пользовательский шлюз API можно использовать в архитектуре на основе микрослужб.</span><span class="sxs-lookup"><span data-stu-id="28d92-146">Figure 4-13 shows how a custom API Gateway can fit into a microservice-based architecture.</span></span>
<span data-ttu-id="28d92-147">Важно отметить, что на этой схеме вы использовали бы одну пользовательскую службу шлюза API, взаимодействующую с несколькими и различными клиентскими приложениями.</span><span class="sxs-lookup"><span data-stu-id="28d92-147">It is important to highlight that in that diagram, you would be using a single custom API Gateway service facing multiple and different client apps.</span></span> <span data-ttu-id="28d92-148">Этот факт может привести к заметному риску, так как служба шлюза API будет расти и развиваться на основе множества различных требований от клиентских приложений.</span><span class="sxs-lookup"><span data-stu-id="28d92-148">That fact can be an important risk because your API Gateway service will be growing and evolving based on many different requirements from the client apps.</span></span> <span data-ttu-id="28d92-149">Со временем служба шлюза API окажется перегруженной из-за различных требований и по сути окажется похожей на монолитное приложение или монолитную службу.</span><span class="sxs-lookup"><span data-stu-id="28d92-149">Eventually, it will be bloated because of those different needs and effectively it could be pretty similar to a monolithic application or monolithic service.</span></span> <span data-ttu-id="28d92-150">Поэтому настоятельно рекомендуется разделять шлюз API между различными службами или между более мелкими шлюзами API, например по одному шлюзу для каждого типа форм-фактора.</span><span class="sxs-lookup"><span data-stu-id="28d92-150">That is why it is very much recommended to split the API Gateway in multiple services or multiple smaller API Gateways, one per form-factor type, for instance.</span></span>

![](./media/image13.png)

<span data-ttu-id="28d92-151">**Рис. 4-13**.</span><span class="sxs-lookup"><span data-stu-id="28d92-151">**Figure 4-13**.</span></span> <span data-ttu-id="28d92-152">Использование шлюза API, реализованного как пользовательская служба веб-API</span><span class="sxs-lookup"><span data-stu-id="28d92-152">Using an API Gateway implemented as a custom Web API service</span></span>

<span data-ttu-id="28d92-153">В этом примере шлюз API будет реализован в виде пользовательской службы веб-API, запущенной в виде контейнера.</span><span class="sxs-lookup"><span data-stu-id="28d92-153">In this example, the API Gateway would be implemented as a custom Web API service running as a container.</span></span>

<span data-ttu-id="28d92-154">Как уже упоминалось, следует реализовать несколько шлюзов API, чтобы у каждого из них был отдельный интерфейс для удовлетворения потребностей каждого клиентского приложения.</span><span class="sxs-lookup"><span data-stu-id="28d92-154">As mentioned, you should implement several API Gateways so that you can have a different façade for the needs of each client app.</span></span> <span data-ttu-id="28d92-155">Каждый шлюз API может предоставлять различное API с учетом потребностей каждого клиентского приложения, возможно, даже на основе форм-фактора клиента с помощью реализации специального кода адаптера, который вызывает несколько внутренних микрослужб.</span><span class="sxs-lookup"><span data-stu-id="28d92-155">Each API Gateway can provide a different API tailored for each client app, possibly even based on the client form factor by implementing specific adapter code which underneath calls multiple internal microservices.</span></span>

<span data-ttu-id="28d92-156">Так как пользовательский шлюз API обычно представляет собой агрегатор данных, будьте внимательны при работе с ним.</span><span class="sxs-lookup"><span data-stu-id="28d92-156">Since a custom API Gateway is usually a data aggregator, you need to be careful with it.</span></span> <span data-ttu-id="28d92-157">Обычно не рекомендуется иметь один шлюз API, который агрегирует все внутренние микрослужбы вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="28d92-157">Usually it isn't a good idea to have a single API Gateway aggregating all the internal microservices of your application.</span></span> <span data-ttu-id="28d92-158">Такой шлюз выступает в качестве монолитного агрегатора или оркестратора и нарушает автономность микрослужб, связывая все микрослужбы друг с другом.</span><span class="sxs-lookup"><span data-stu-id="28d92-158">If it does, it acts as a monolithic aggregator or orchestrator and violates microservice autonomy by coupling all the microservices.</span></span> <span data-ttu-id="28d92-159">Поэтому шлюзы API должны быть разделены на основе бизнес-границ и не должны выступать в качестве агрегатора для всего приложения.</span><span class="sxs-lookup"><span data-stu-id="28d92-159">Therefore, the API Gateways should be segregated based on business boundaries and not act as an aggregator for the whole application.</span></span>

<span data-ttu-id="28d92-160">Иногда специализированный API шлюза также может представлять собой микрослужбу и даже иметь домен или бизнес-имя и соответствующие данные.</span><span class="sxs-lookup"><span data-stu-id="28d92-160">Sometimes a granular API Gateway can also be a microservice by itself, and even have a domain or business name and related data.</span></span> <span data-ttu-id="28d92-161">Наличие границ шлюза API, определяемых бизнес-требованиями или доменом, поможет лучше спроектировать шлюз.</span><span class="sxs-lookup"><span data-stu-id="28d92-161">Having the API Gateway’s boundaries dictated by the business or domain will help you to get a better design.</span></span>

<span data-ttu-id="28d92-162">Степень детализации для уровня шлюза API может быть особенно удобной для более сложных приложений с составным пользовательским интерфейсом на основе микрослужб, так как концепция детализированного шлюза API похожа на службу с составным пользовательским интерфейсом.</span><span class="sxs-lookup"><span data-stu-id="28d92-162">Granularity in the API Gateway tier can be especially useful for more advanced composite UI applications based on microservices, because the concept of a fine-grained API Gateway is similar to a UI composition service.</span></span> <span data-ttu-id="28d92-163">Этот вопрос будет рассмотрен позже в разделе [Создание составного пользовательского интерфейса на основе микрослужб](#creating-composite-ui-based-on-microservices-including-visual-ui-shape-and-layout-generated-by-multiple-microservices).</span><span class="sxs-lookup"><span data-stu-id="28d92-163">We discuss this later in the [Creating composite UI based on microservices](#creating-composite-ui-based-on-microservices-including-visual-ui-shape-and-layout-generated-by-multiple-microservices).</span></span>

<span data-ttu-id="28d92-164">Таким образом, для многих средних и крупных приложений пользовательский API шлюза обычно является хорошим решением, но не в качестве единого монолитного агрегатора или уникального централизованного пользовательского шлюза API.</span><span class="sxs-lookup"><span data-stu-id="28d92-164">Therefore, for many medium- and large-size applications, using a custom-built API Gateway is usually a good approach, but not as a single monolithic aggregator or unique central custom API Gateway.</span></span>

<span data-ttu-id="28d92-165">Другой вариант — использовать такой продукт как [Управление API Azure](https://azure.microsoft.com/services/api-management/), как показано на рис. 4-14.</span><span class="sxs-lookup"><span data-stu-id="28d92-165">Another approach is to use a product like [Azure API Management](https://azure.microsoft.com/services/api-management/) as shown in Figure 4-14.</span></span> <span data-ttu-id="28d92-166">Такой подход не только позволяет удовлетворить потребности шлюза API, но и предоставляет такие функции, как сбор аналитических данных с ваших интерфейсов API.</span><span class="sxs-lookup"><span data-stu-id="28d92-166">This approach not only solves your API Gateway needs, but provides features like gathering insights from your APIs.</span></span> <span data-ttu-id="28d92-167">Если вы используете решение для управления API, шлюз API является только компонентом в рамках полного решения по управлению API.</span><span class="sxs-lookup"><span data-stu-id="28d92-167">If you are using an API management solution, an API Gateway is only a component within that full API management solution.</span></span>

![](./media/image14.png)

<span data-ttu-id="28d92-168">**Рис. 4-14**.</span><span class="sxs-lookup"><span data-stu-id="28d92-168">**Figure 4-14**.</span></span> <span data-ttu-id="28d92-169">Использование управления API Azure для шлюза API</span><span class="sxs-lookup"><span data-stu-id="28d92-169">Using Azure API Management for your API Gateway</span></span>

<span data-ttu-id="28d92-170">В этом случае при использовании такого продукта, как управление API Azure, наличие одного шлюза API не так рискованно, так как такие виды шлюзов API "тоньше". Это означает, что вы не сможете реализовать пользовательский код C#, который сможет развиваться в сторону монолитного компонента.</span><span class="sxs-lookup"><span data-stu-id="28d92-170">In this case, when using a product like Azure API Management, the fact that you might have a single API Gateway is not so risky because these kinds of API Gateways are "thinner", meaning that you don't implement custom C# code that could evolve towards a monolithic component.</span></span> 

<span data-ttu-id="28d92-171">Такой продукт, скорее, выступает в роли обратного прокси для приема данных, при котором также можно фильтровать API от внутренних микрослужб, а также применять авторизацию к опубликованным API на этом уровне.</span><span class="sxs-lookup"><span data-stu-id="28d92-171">This type of product acts more like a reverse proxy for ingress communication, where you can also filter the APIs from the internal microservices plus apply authorization to the published APIs in this single tier.</span></span>

<span data-ttu-id="28d92-172">Аналитические сведения, доступные из системы управления API, помогут вам понять, как используются ваши API и насколько эффективно они работают.</span><span class="sxs-lookup"><span data-stu-id="28d92-172">The insights available from an API Management system help you get an understanding of how your APIs are being used and how they are performing.</span></span> <span data-ttu-id="28d92-173">Для этого вы можете просматривать отчеты практически в режиме реального времени и выявлять тенденции, которые могут повлиять на ваш бизнес.</span><span class="sxs-lookup"><span data-stu-id="28d92-173">They do this by letting you view near real-time analytics reports and identifying trends that might impact your business.</span></span> <span data-ttu-id="28d92-174">Кроме того, вы можете вести журналы запросов и ответов как для интерактивного, так и для автономного анализа.</span><span class="sxs-lookup"><span data-stu-id="28d92-174">Plus, you can have logs about request and response activity for further online and offline analysis.</span></span>

<span data-ttu-id="28d92-175">С помощью управления API Azure вы можете защитить свои интерфейсы API с помощью ключей, маркеров и фильтрации IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="28d92-175">With Azure API Management, you can secure your APIs using a key, a token, and IP filtering.</span></span> <span data-ttu-id="28d92-176">Эти возможности позволяют обеспечить гибкие и точные квоты и ограничения скорости, изменить форму и поведение ваших API с помощью политик и улучшить производительность с помощью кэширования ответов.</span><span class="sxs-lookup"><span data-stu-id="28d92-176">These features let you enforce flexible and fine-grained quotas and rate limits, modify the shape and behavior of your APIs using policies, and improve performance with response caching.</span></span>

<span data-ttu-id="28d92-177">В этом руководстве и в примере приложения (eShopOnContainers) мы ограничиваем архитектуру до более простой пользовательской контейнерной архитектуры, чтобы сосредоточиться только на контейнерах без использования продуктов PaaS, таких как управление API Azure.</span><span class="sxs-lookup"><span data-stu-id="28d92-177">In this guide and the reference sample application (eShopOnContainers), we are limiting the architecture to a simpler and custom-made containerized architecture in order to focus on plain containers without using PaaS products like Azure API Management.</span></span> <span data-ttu-id="28d92-178">Однако для крупных приложений на основе микрослужб, развернутых в Microsoft Azure, мы рекомендуем изучить и адаптировать API управления Azure в качестве основы для шлюзов API.</span><span class="sxs-lookup"><span data-stu-id="28d92-178">But for large microservice-based applications that are deployed into Microsoft Azure, we encourage you to review and adopt Azure API Management as the base for your API Gateways.</span></span>

## <a name="drawbacks-of-the-api-gateway-pattern"></a><span data-ttu-id="28d92-179">Недостатки шаблона шлюза API</span><span class="sxs-lookup"><span data-stu-id="28d92-179">Drawbacks of the API Gateway pattern</span></span>

-   <span data-ttu-id="28d92-180">Наиболее важный недостаток заключается в том, что при реализации шлюза API вы связываете этот уровень с внутренними микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="28d92-180">The most important drawback is that when you implement an API Gateway, you are coupling that tier with the internal microservices.</span></span> <span data-ttu-id="28d92-181">Такое связывание может привести к серьезным проблемам для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="28d92-181">Coupling like this might introduce serious difficulties for your application.</span></span> <span data-ttu-id="28d92-182">Клеменс Вастер, архитектор команды по разработке служебной шины Azure, называет эту потенциальную трудность "новой служебной шиной предприятия (ESB)" в своем выступлении "[Обмен сообщениями и микрослужбы](https://www.youtube.com/watch?v=rXi5CLjIQ9k)" на GOTO 2016.</span><span class="sxs-lookup"><span data-stu-id="28d92-182">Clemens Vaster, architect at the Azure Service Bus team, refers to this potential difficulty as “the new ESB” in his "[Messaging and Microservices](https://www.youtube.com/watch?v=rXi5CLjIQ9k)" session at GOTO 2016.</span></span>

-   <span data-ttu-id="28d92-183">Использование шлюза API микрослужб создает возможную дополнительную единую точку отказа.</span><span class="sxs-lookup"><span data-stu-id="28d92-183">Using a microservices API Gateway creates an additional possible single point of failure.</span></span>

-   <span data-ttu-id="28d92-184">Шлюз API может привести к увеличению времени ответа из-за дополнительного сетевого вызова.</span><span class="sxs-lookup"><span data-stu-id="28d92-184">An API Gateway can introduce increased response time due to the additional network call.</span></span> <span data-ttu-id="28d92-185">Однако этот дополнительный вызов обычно оказывает меньшее влияние, чем целый клиентский интерфейс, который постоянно взаимодействует с внутренними микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="28d92-185">However, this extra call usually has less impact than having a client interface that is too chatty directly calling the internal microservices.</span></span>

-   <span data-ttu-id="28d92-186">При отсутствии должного масштабирования шлюз API может стать узким местом.</span><span class="sxs-lookup"><span data-stu-id="28d92-186">If not scaled out properly, the API Gateway can become a bottleneck.</span></span>

-   <span data-ttu-id="28d92-187">Шлюз API требует дополнительных затрат на разработку и последующее обслуживание, если он включает пользовательскую логику и агрегирование данных.</span><span class="sxs-lookup"><span data-stu-id="28d92-187">An API Gateway requires additional development cost and future maintenance if it includes custom logic and data aggregation.</span></span> <span data-ttu-id="28d92-188">Чтобы предоставить конечные точки каждой микрослужбы, разработчикам необходимо обновить шлюз API.</span><span class="sxs-lookup"><span data-stu-id="28d92-188">Developers must update the API Gateway in order to expose each microservice’s endpoints.</span></span> <span data-ttu-id="28d92-189">Кроме того, изменения в реализации внутренних микрослужб могут вызвать изменения кода на уровне API шлюза.</span><span class="sxs-lookup"><span data-stu-id="28d92-189">Moreover, implementation changes in the internal microservices might cause code changes at the API Gateway level.</span></span> <span data-ttu-id="28d92-190">Тем не менее, если в шлюзе API просто применяется безопасность, ведение журналов и управление версиями (как при использовании управления API Azure), эти затраты на разработку могут отсутствовать.</span><span class="sxs-lookup"><span data-stu-id="28d92-190">However, if the API Gateway is just applying security, logging, and versioning (as when using Azure API Management), this additional development cost might not apply.</span></span>

-   <span data-ttu-id="28d92-191">Если шлюз API разрабатывается одной командой, это может быть узким местом разработки.</span><span class="sxs-lookup"><span data-stu-id="28d92-191">If the API Gateway is developed by a single team, there can be a development bottleneck.</span></span> <span data-ttu-id="28d92-192">Это еще одна причина, по которой лучше использовать несколько специализированных шлюзов API, которые реализуют различные потребности клиента.</span><span class="sxs-lookup"><span data-stu-id="28d92-192">This is another reason why a better approach is to have several fined-grained API Gateways that respond to different client needs.</span></span> <span data-ttu-id="28d92-193">Также можно внутренне разделить шлюз API на несколько областей или уровней, которые принадлежат другим командам, работающим над внутренними микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="28d92-193">You could also segregate the API Gateway internally into multiple areas or layers that are owned by the different teams working on the internal microservices.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="28d92-194">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="28d92-194">Additional resources</span></span>

-   <span data-ttu-id="28d92-195">**Чарльз Ричардсон (Charles Richardson). Шаблон: шлюз API, серверная часть для внешнего интерфейса**
    [*https://microservices.io/patterns/apigateway.html*](https://microservices.io/patterns/apigateway.html)</span><span class="sxs-lookup"><span data-stu-id="28d92-195">**Charles Richardson. Pattern: API Gateway / Backend for Front-End**
[*https://microservices.io/patterns/apigateway.html*](https://microservices.io/patterns/apigateway.html)</span></span>

-   <span data-ttu-id="28d92-196">**Управление API Azure**
    [*https://azure.microsoft.com/services/api-management/*](https://azure.microsoft.com/services/api-management/)</span><span class="sxs-lookup"><span data-stu-id="28d92-196">**Azure API Management**
[*https://azure.microsoft.com/services/api-management/*](https://azure.microsoft.com/services/api-management/)</span></span>

-   <span data-ttu-id="28d92-197">**Уди Дахан (Udi Dahan). Объединение на основе служб**\\</span><span class="sxs-lookup"><span data-stu-id="28d92-197">**Udi Dahan. Service Oriented Composition**\\</span></span>
    [*http://udidahan.com/2014/07/30/service-oriented-composition-with-video/*](http://udidahan.com/2014/07/30/service-oriented-composition-with-video/)

-   <span data-ttu-id="28d92-198">**Клеменс Вастерс (Clemens Vasters). Обмен сообщениями и микрослужбы на GOTO 2016** (видео) [*https://www.youtube.com/watch?v=rXi5CLjIQ9k*](https://www.youtube.com/watch?v=rXi5CLjIQ9k)</span><span class="sxs-lookup"><span data-stu-id="28d92-198">**Clemens Vasters. Messaging and Microservices at GOTO 2016** (video) [*https://www.youtube.com/watch?v=rXi5CLjIQ9k*](https://www.youtube.com/watch?v=rXi5CLjIQ9k)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="28d92-199">[Назад] (identify-microservice-domain-model-boundaries.md) [Далее] (communication-in-microservice-architecture.md)</span><span class="sxs-lookup"><span data-stu-id="28d92-199">[Previous] (identify-microservice-domain-model-boundaries.md) [Next] (communication-in-microservice-architecture.md)</span></span>
