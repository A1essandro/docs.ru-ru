---
title: "Управление микрослужбами и многоконтейнерными приложениями для обеспечения высокого уровня масштабируемости и доступности"
description: "Архитектура микрослужб .NET для упакованных в контейнеры приложений .NET | Управление микрослужбами и многоконтейнерными приложениями для обеспечения высокого уровня масштабируемости и доступности"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 10/18/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: ff524c6d61c6ce51a1a3e831cd666a3b61ac849e
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/23/2017
---
# <a name="orchestrating-microservices-and-multi-container-applications-for-high-scalability-and-availability"></a>Управление микрослужбами и многоконтейнерными приложениями для обеспечения высокого уровня масштабируемости и доступности

Использование оркестраторов для приложений, готовых к развертыванию в рабочей среде, крайне важно, если приложение основано на микрослужбах или просто разнесено по нескольким контейнерам. Как было сказано ранее, в рамках подхода на основе микрослужб каждая микрослужба имеет собственную модель и данные, поэтому она является автономной с точки зрения разработки и развертывания. Но если у вас есть более традиционное бизнес-приложение, состоящее из нескольких служб (например, SOA) и требующее распределенного развертывания, оно также будет включать в себя несколько контейнеров или служб. Такие системы сложны в масштабировании и управлении, поэтому для создания масштабируемого многоконтейнерного приложения, готового к развертыванию в рабочей среде, оркестратор абсолютно необходим.

На рис. 4-23 показано развертывание приложения, состоящего из нескольких микрослужб (контейнеров) в кластере.

![](./media/image23.PNG)

**Рис. 4-23**. Кластер контейнеров

Такой подход выглядит логичным. Однако как обеспечить балансировку нагрузки, маршрутизацию и оркестрацию для таких составных приложений?

Обычная подсистема Docker в узлах Docker позволяет управлять экземплярами образов в отдельных узлах, но ее недостаточно, если требуется управлять множеством контейнеров, развернутых в нескольких узлах, в рамках более сложного распределенного приложения. В большинстве случаев необходима платформа управления, которая будет автоматически запускать контейнеры, масштабировать контейнеры с несколькими экземплярами в каждом образе, а также при необходимости приостанавливать или завершать их работу. В идеале она также должна контролировать доступ к ресурсам, таким как сеть и хранилище данных.

Чтобы перейти от управления отдельными контейнерами или очень простыми составными приложениями к управлению крупными корпоративными приложениями с микрослужбами, следует прибегнуть к платформам оркестрации и кластеризации.

С точки зрения архитектуры и разработки, если вы создаете крупные корпоративные приложения на основе микрослужб, важно знать следующие платформы и продукты, которые поддерживают сложные сценарии:

**Кластеры и оркестраторы**. Если вам нужно масштабировать приложения на множестве узлов Docker, как в случае с крупным приложением на основе микрослужб, крайне важно иметь возможность управлять всеми этими узлами как единым кластером, абстрагируясь от сложности базовой платформы. Именно такую возможность предоставляют кластеры контейнеров и оркестраторы. Примерами оркестраторов могут служить Azure Service Fabric, Kubernetes, Docker Swarm и Mesosphere DC/OS. Последние три оркестратора с открытым кодом доступны в Azure в рамках службы контейнеров Azure.

**Планировщики**. *Планировщик* дает администратору возможность запускать контейнеры в кластере посредством пользовательского интерфейса. Планировщик кластера имеет несколько функций: обеспечение эффективного использования ресурсов в кластере, применение заданных пользователем ограничений, эффективная балансировка нагрузки контейнеров между узлами, а также обеспечение устойчивости к ошибкам и высокой доступности.

Понятия кластера и планировщика тесно связаны друг с другом, поэтому продукты, предоставляемые разными поставщиками, часто включают в себя оба набора возможностей. Ниже приведен список наиболее важных платформ и программного обеспечения, предоставляющих возможности управления кластерами и планирования. Эти оркестраторы, как правило, предлагаются в составе публичных облачных платформ, таких как Azure.

## <a name="software-platforms-for-container-clustering-orchestration-and-scheduling"></a>Программные платформы для кластеризации контейнеров, оркестрации и планирования

Kubernetes

![https://pbs.twimg.com/media/Bt\_pEfqCAAAiVyz.png](./media/image24.png)

> Kubernetes — это решение с открытым кодом, которое предоставляет широкий ряд возможностей: от организации инфраструктуры кластера и планирования контейнеров до оркестрации. Оно позволяет автоматизировать развертывание, масштабирование и выполнение операций с контейнерами приложений в кластерах узлов.
>
> Kubernetes предоставляет ориентированную на контейнеры инфраструктуру, которая объединяет контейнеры приложений в логические блоки, чтобы упростить управление и обнаружение.
>
> Решение Kubernetes является зрелым в Linux и менее зрелым в Windows.

Docker Swarm

![http://rancher.com/wp-content/themes/rancher-2016/assets/images/swarm.png?v=2016-07-10-am](./media/image25.png)

> Docker Swarm позволяет объединять контейнеры Docker в кластеры и планировать их работу. С помощью Swarm можно превратить пул узлов Docker в единый виртуальный узел Docker. Клиенты могут выполнять запросы API к Swarm так же, как к узлам, благодаря чему Swarm упрощает масштабирование приложений в нескольких узлах.
>
> Решение Docker Swarm предоставляется компанией Docker.
>
> В Docker 1.12 или более поздней версии имеется встроенный режим Swarm.

Mesosphere DC/OS

![https://mesosphere.com/wp-content/uploads/2016/04/logo-horizontal-styled.png](./media/image26.png)

> Mesosphere Enterprise DC/OS (на основе Apache Mesos) — это готовая к использованию в рабочей среде платформа для выполнения контейнеров и распределенных приложений.
>
> DC/OS абстрагирует коллекцию ресурсов, доступных в кластере, и предоставляет доступ к ним компонентам, построенным на базе платформы. В качестве планировщика, интегрированного с DC/OS, обычно используется Marathon.
>
> Решение DC/OS является зрелым в Linux и менее зрелым в Windows.

Azure Service Fabric

![https://azure.microsoft.com/svghandler/service-fabric?width=600&height=315](./media/image27.png)

> [Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview) — это платформа микрослужб от корпорации Майкрософт, которая предназначена для создания приложений. Она позволяет [оркестрировать](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-resource-manager-introduction) службы и создавать кластеры компьютеров. Службы в Service Fabric могут развертываться как контейнеры или как обычные процессы. Кроме того, в рамках одного приложения или кластера можно сочетать службы в процессах и службы в контейнерах.
>
> Service Fabric предоставляет дополнительные перспективные [модели программирования Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-choose-framework), такие как [службы с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction) и [Reliable Actors](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-actors-introduction).
>
> Решение Service Fabric является зрелым в Windows (годы развития) и менее зрелым в Linux. 
> С 2017 года в Service Fabric поддерживаются как контейнеры Linux, так и контейнеры Windows.

## <a name="using-container-based-orchestrators-in-microsoft-azure"></a>Использование оркестраторов на основе контейнеров в Microsoft Azure

Ряд поставщиков облачных служб, включая Microsoft Azure, Amazon EC2 Container Service и Google Container Engine, предлагают поддержку контейнеров Docker, а также кластеров Docker и оркестрации. Microsoft Azure предоставляет поддержку кластеров Docker и оркестратора посредством Службы контейнеров Azure (ACS), как описано в следующем разделе.

Другим вариантом является использование платформы микрослужб Microsoft Azure Service, которая также поддерживает Docker на основе контейнеров Linux и Windows. Service Fabric может выполняться в Azure, любом другом облаке или в [локальной среде](https://docs.microsoft.com/azure/service-fabric/service-fabric-deploy-anywhere).

## <a name="using-azure-container-service"></a>Использование службы контейнеров Azure

Кластер Docker объединяет несколько узлов Docker в пул и предоставляет доступ к ним как к единому виртуальному узлу Docker, что позволяет развертывать несколько узлов в кластере. Кластер отвечает за выполнение всех сложных задач управления, включая масштабирование, обеспечение работоспособности и т. д. На рис. 4-24 показано, как кластер Docker для составных приложений соотносится со службой контейнеров Azure (ACS).

Служба ACS позволяет упростить создание и настройку кластера виртуальных машин, предварительно настроенных для выполнения упакованных в контейнеры приложений, а также управление им. Благодаря оптимизированной конфигурации популярных средств планирования и оркестрации с открытым кодом служба ACS дает возможность развертывать приложения на основе контейнеров в Microsoft Azure и управлять ими, используя имеющиеся навыки или прибегая к знаниям большого и продолжающего расширяться сообщества.

Служба контейнеров Azure оптимизирует настройку популярных средств и технологий кластеризации Docker с открытым кодом для Azure. Вы получаете открытое решение, которое обеспечивает переносимость как контейнеров, так и конфигурации приложения. Вы выбираете размер, число узлов и средства оркестрации, а служба контейнеров делает все остальное.

![](./media/image28.png)

**Рис. 4-24**. Варианты кластеризации в службе контейнеров Azure

Служба ACS использует образы Docker, чтобы гарантировать полную переносимость контейнеров приложений. Вы можете выбрать понравившуюся вам платформу оркестрации с открытым кодом, например DC/OS (на основе Apache Mesos), Kubernetes (изначально разработанную компанией Google) или Docker Swarm, чтобы обеспечить масштабирование приложений до тысяч или даже десятков тысяч контейнеров.

Служба контейнеров Azure позволяет пользоваться функциями Azure корпоративного уровня, сохраняя при этом переносимость приложений, в том числе на уровнях оркестрации.

![](./media/image29.png)

**Рис. 4-25**. Оркестраторы в ACS

Как показано на рис. 4-25, служба контейнеров Azure — это просто инфраструктура, предоставляемая Azure для развертывания DC/OS, Kubernetes или Docker Swarm. В ACS не реализован собственный оркестратор. Таким образом, служба ACS сама по себе является не оркестратором, а лишь инфраструктурой, которая использует существующие оркестраторы с открытым кодом для контейнеров.

Назначением службы контейнеров Azure является предоставление среды размещения контейнеров посредством популярных средств и технологий с открытым кодом. С этой целью она предоставляет стандартные конечные точки API для выбранного оркестратора. Вы можете использовать любое программное обеспечение, которое способно взаимодействовать с этими конечными точками. Например, в случае с конечной точкой Docker Swarm можно выбрать интерфейс командной строки (CLI) Docker. Для DC/OS можно выбрать интерфейс командной строки DC/OS.

### <a name="getting-started-with-azure-container-service"></a>Начало работы со службой контейнеров Azure 

Чтобы приступить к работе со службой контейнеров Azure, необходимо развернуть кластер службы контейнеров Azure с портала Azure с помощью шаблона Azure Resource Manager или [интерфейса командной строки](https://docs.microsoft.com/cli/azure/install-azure-cli). Доступные шаблоны включают в себя [Docker Swarm](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-swarm), [Kubernetes](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-kubernetes) и [DC/OS](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-dcos). Шаблон можно изменить, чтобы дополнить или расширить конфигурацию Azure. Дополнительные сведения о развертывании кластера службы контейнеров Azure см. в статье [Развертывание кластера Службы контейнеров Azure](https://docs.microsoft.com/azure/container-service/container-service-deployment) на веб-сайте Azure.

За программное обеспечение, устанавливаемое по умолчанию в составе службы ACS, плата не взимается. Все возможности по умолчанию реализуются с помощью ПО с открытым кодом.

Служба ACS в настоящее время доступна для виртуальных машин Linux серий Standard A, D, DS, G и GS в Azure. Плата взимается только за выбранные вычислительные операции, а также за другие используемые ресурсы базовой инфраструктуры, такие как хранилище и сеть. За саму службу ACS вы дополнительно не платите.

## <a name="additional-resources"></a>Дополнительные ресурсы

-   **Общие сведения о решениях для размещения контейнеров Docker в службе контейнеров Azure**
    [*https://docs.microsoft.com/azure/container-service/container-service-intro*](https://docs.microsoft.com/azure/container-service/container-service-intro)

-   **Обзор Docker Swarm**
    [*https://docs.docker.com/swarm/overview/*](https://docs.docker.com/swarm/overview/)

-   **Обзор режима Swarm**
    [*https://docs.docker.com/engine/swarm/*](https://docs.docker.com/engine/swarm/)

-   **Обзор Mesosphere DC/OS**
    [*https://docs.mesosphere.com/1.7/overview/*](https://docs.mesosphere.com/1.7/overview/)

-   **Kubernetes.** Официальный сайт.\
    [*http://kubernetes.io/*](http://kubernetes.io/)


>[!div class="step-by-step"]
[Назад] (resilient-high-availability-microservices.md) [Далее] (using-azure-service-fabric.md)
