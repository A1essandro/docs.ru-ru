---
title: "Устойчивость и высокий уровень доступности в микрослужбами"
description: "Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Устойчивость и высокий уровень доступности в микрослужбами"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 149e28ac7bd7383e4e960ed8a226943e2b9bdaa1
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2017
---
# <a name="resiliency-and-high-availability-in-microservices"></a>Устойчивость и высокий уровень доступности в микрослужбами

Работа с непредвиденными сбоями является одной из сложных проблем, чтобы решить, особенно в распределенной системе. Код, создаваемый разработчиком состоит в основном обработки исключений, а это также расходуется больше всего времени во время тестирования. Проблема заключается в сложнее, чем написание кода для обработки сбоев. Что происходит при сбое на компьютере, где работает микрослужбу? Не только необходимо определить этот сбой микрослужбу (сложная проблема сам по себе), но вам также нужно что-то перезапуск вашей микрослужбы.

Микрослужбу должен быть устойчивы к сбоям и получить возможность перезапуска часто на другом компьютере для обеспечения доступности. Это устойчивости также зависит от состояния, сохраненного от имени микрослужбу, где микрослужбу можно восстановить этот состояние и успешно перезапущена микрослужбы. Другими словами необходимо поддерживать устойчивость в функцию вычислений (процесс можно перезапустить в любой момент) а также устойчивость состояния или данные (без потери данных и данных остается согласованной).

Проблемы, устойчивости сочетаются во время других сценариях, например при возникновении ошибки во время обновления приложения. Микрослужбу, работа с системой развертывания, необходимо определить ли он может продолжать переход к более новой версии или вместо отката к предыдущей версии поддерживать согласованное состояние. Например, доступны ли достаточно компьютеров для продолжения вперед, а также для восстановления предыдущих версий микрослужбу следует учитывать. Для этого необходимо микрослужбу для передачи информации о состоянии, чтобы всего приложения и orchestrator может принимать эти решения.

Кроме того, связанные с устойчивости для систем на основе облака должны вести себя. Как уже упоминалось, систем на основе облака должен учесть сбоев и должен попытаться автоматически восстановить их. Для экземпляра в случае сбоев сети или контейнера, клиентские приложения или службы клиента должен иметь стратегию повторите отправку сообщений или повторить попытку запросов, так как во многих случаях сбои в облаке, частичная. [Реализации гибкие приложения](#implementing_resilient_apps) данного руководства показано, как обрабатывать частичный сбой. Он описывает методы, как повторные попытки с экспоненциально растущим или шаблон Размыкатель цепи в .NET Core с помощью библиотек, таких как [Polly](https://github.com/App-vNext/Polly), который предоставляет обширный набор политик для обработки этой теме.

## <a name="health-management-and-diagnostics-in-microservices"></a>Управление устойчивостью и диагностике в микрослужбами

Он может казаться очевидным и часто забывают, но микрослужбу должны сообщить его работоспособность и диагностика. В противном случае есть сведения о с точки зрения операций. Сопоставление событий диагностики во множестве независимые службы и работе с асимметрию часы компьютера понять порядок событий является сложной задачей. Таким же образом, взаимодействующих с микрослужбу через согласованный протоколов и форматов данных нет необходимости для стандартизации в том, как работоспособности и диагностические события, которые в конечном итоге оказываются в хранилище событий для запросов и просмотра журнала. При использовании подхода микрослужбами это ключ разными командами согласовать формат одного файла журнала. Должен быть целостный подход при просмотре диагностических событий в приложении.

### <a name="health-checks"></a>Проверку работоспособности

Работоспособность отличается от диагностики. Состояние — о микрослужбу, сообщение о текущем состоянии для выполнения соответствующих действий. Хороший пример работает с механизмами обновления и развертывания для обеспечения доступности. Несмотря на то, что службы в настоящее время может иметь неработоспособное вследствие сбоя процесса или перезагрузки компьютера, служба может по-прежнему работать. Самое последнее, что нужно — сделать это хуже, выполнив обновление. Оптимальный подход заключается в осуществлении расследования сначала или подождите микрослужбу для восстановления. События работоспособности из микрослужбу помогают принимать обоснованные решения и, по сути, помогают создать самовосстановление служб.

В реализации работоспособности проверяет ASP.NET Core services раздела этого руководства рассматривается, как использовать новую библиотеку ASP.NET HealthChecks в вашей микрослужбами, может передавать свое состояние службы мониторинга для выполнения соответствующих действий.

### <a name="using-diagnostics-and-logs-event-streams"></a>С помощью потоков диагностики и журналы событий

Журналы содержат сведения о том, как приложение или служба запущена, включая исключения, предупреждения и информационные сообщения, простой. Как правило каждый журнал имеет текстовый формат с одной строкой на событие, несмотря на то, что исключения часто также отображает трассировку стека в несколько строк.

В объединенный серверных приложений можно просто записывает журналы в файл на диске (файл журнала) и затем проанализировать его с помощью любого средства. Так как выполнение приложения ограничена основного сервера или виртуальной Машине, он обычно не слишком сложен для анализа потока событий. Тем не менее в распределенном приложении, где выполняются несколько служб для многих узлов кластера orchestrator, не сможет сопоставить распределенных события может вызвать затруднения.

Приложения на основе микрослужбу необходимо для хранения выходного потока событий или файлы журнала сам по себе не повторите и даже попытаться управлять маршрутизацией событий в центральное расположение. Оно должно быть прозрачным, это означает, что каждый процесс просто должен записывать его поток событий в стандартный выходной поток, будут собраны с помощью инфраструктуры среды выполнения которой она выполняется под. Примером маршрутизаторам потока событий является [Microsoft.Diagnostic.EventFlow](https://github.com/Azure/diagnostics-eventflow), который собирает потоков событий из нескольких источников и публикует его в выходной систем. К ним могут относиться простой стандартный поток вывода для среды разработки и облачные системы, такие как [Application Insights](https://azure.microsoft.com/services/application-insights/), [OMS](https://github.com/Azure/diagnostics-eventflow#oms-operations-management-suite) (для локальных приложений), и [службыдиагностикиAzure](https://docs.microsoft.com/azure/monitoring-and-diagnostics/azure-diagnostics). Существуют также сторонних журнала анализа платформы и средства, которые можно найти предупреждения, отчет, и журналы монитора, даже в режиме реального времени, например [Splunk](http://www.splunk.com/goto/Splunk_Log_Management?ac=ga_usa_log_analysis_phrase_Mar17&_kk=logs%20analysis&gclid=CNzkzIrex9MCFYGHfgodW5YOtA).

### <a name="orchestrators-managing-health-and-diagnostics-information"></a>Управление сведениями о работоспособности и диагностика orchestrators

При создании приложения на основе микрослужбу необходимо сложность. Конечно легко работать с одной микрослужбу, но десятки и сотни типов и тысячи экземпляров микрослужбами является сложной задачей. Он практически не построен микрослужбу архитектуры, необходимо также высокого уровня доступности, возможность адресации, устойчивости, работоспособности и диагностики, если хотите иметь высокую стабильность и целостного системы.

![](./media/image22.png)

**На рисунке 4-22**. Платформа Микрослужбу — это основа для управления работоспособности приложения

Сложности, показанные на рисунке 4-22 очень сложно решить самостоятельно. Группы разработчиков следует сосредоточиться на решении бизнес-задач и разработке пользовательских приложений с использованием подхода на основе микрослужбы. Они не следует сосредоточиться на решении сложных проблем инфраструктуры; в противном случае стоимость любого приложения микрослужбу бы огромным. Таким образом есть микрослужбу ориентированного платформ называется orchestrators или микрослужбу кластеры, служащие для решения сложных проблем построения и запуска службы и эффективное использование ресурсов инфраструктуры. Это уменьшает построения приложения, использующие подход микрослужбами сложности.

Различные orchestrators может показаться аналогичный, но диагностики и проверки работоспособности, предлагаемые каждым из них отличаются по возможности и состояние готовности, иногда, в зависимости от платформы операционной системы, как описано в следующем разделе.

## <a name="additional-resources"></a>Дополнительные ресурсы

-   **Приложение 12 фактора. XI. Журналы: Считать журналы потоков событий**
    [*https://12factor.net/logs*](https://12factor.net/logs)

-   **Библиотека Microsoft Diagnostic EventFlow.** В репозитории GitHub.

    [*https://github.com/Azure/Diagnostics-eventflow*](https://github.com/Azure/diagnostics-eventflow)

-   **Что такое Azure Diagnostics**
    [*https://docs.microsoft.com/azure/azure-diagnostics*](https://docs.microsoft.com/azure/azure-diagnostics)

-   **Подключение компьютеров Windows в службе анализа журналов в Azure**
    [*https://docs.microsoft.com/azure/log-analytics/log-analytics-windows-agents*](https://docs.microsoft.com/azure/log-analytics/log-analytics-windows-agents)

-   **Ведение журнала теми, которые означают: С помощью блока приложения семантической ведения журнала**
    [*https://msdn.microsoft.com/library/dn440729 (v=pandp.60).aspx*](https://msdn.microsoft.com/library/dn440729(v=pandp.60).aspx)

-   **Splunk.** Официальный сайт
    [*http://www.splunk.com*](http://www.splunk.com)

-   **Класс EventSource**. API-Интерфейс для событий трассировки для Windows (ETW) [ *https://docs.microsoft.com/dotnet/api/system.diagnostics.tracing.eventsource*](https://docs.microsoft.com/dotnet/api/system.diagnostics.tracing.eventsource)




>[!div class="step-by-step"]
[Предыдущие] (microservice-based-composite-ui-shape-layout.md) [Далее] (scalable-available-multi-container-microservice-applications.md)
