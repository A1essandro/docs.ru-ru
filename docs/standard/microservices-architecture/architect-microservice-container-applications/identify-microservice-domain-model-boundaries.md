---
title: "Определение границ модель домена для каждого микрослужбу"
description: "Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Определение границ модель домена для каждого микрослужбу"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 6fef11e5718706701abb29149c4c4a23ba39bde0
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2017
---
# <a name="identify-domain-model-boundaries-for-each-microservice"></a><span data-ttu-id="1a6aa-104">Определения границ модель домена для каждого микрослужбу</span><span class="sxs-lookup"><span data-stu-id="1a6aa-104">Identify domain-model boundaries for each microservice</span></span>

<span data-ttu-id="1a6aa-105">При определении границ модели и размер для каждой микрослужбу предназначена не для того, чтобы перейти на самом детальном разделении возможно, несмотря на то, что следует по возможности обычно сторону небольшой микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-105">The goal when identifying model boundaries and size for each microservice is not to get to the most granular separation possible, although you should tend toward small microservices if possible.</span></span> <span data-ttu-id="1a6aa-106">Вместо этого необходимо определить протестировав для получения наиболее значимые разделение по ведома пользователя домена.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-106">Instead, your goal should be to get to the most meaningful separation guided by your domain knowledge.</span></span> <span data-ttu-id="1a6aa-107">Основное внимание уделяется не на размер, а на деловые возможности.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-107">The emphasis is not on the size, but instead on business capabilities.</span></span> <span data-ttu-id="1a6aa-108">Кроме того Если очистить связности, необходимые для области приложения, основанного на большое количество зависимостей, указывает потребность в одном микрослужбу, слишком.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-108">In addition, if there is clear cohesion needed for a certain area of the application based on a high number of dependencies, that indicates the need for a single microservice, too.</span></span> <span data-ttu-id="1a6aa-109">Связности является способ определения того, как прервать друг от друга или микрослужбами вместе группы.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-109">Cohesion is a way to identify how to break apart or group together microservices.</span></span> <span data-ttu-id="1a6aa-110">В конечном счете хотя можно получить дополнительные сведения о домене, размер вашей микрослужбу необходимо адаптировать итеративно.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-110">Ultimately, while you gain more knowledge about the domain, you should adapt the size of your microservice, iteratively.</span></span> <span data-ttu-id="1a6aa-111">Поиск нужного размера не одноступенчатая процесса.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-111">Finding the right size is not a one-shot process.</span></span>

<span data-ttu-id="1a6aa-112">[SAM Newman](http://samnewman.io/), распознаваемым активатором микрослужбами и автор книги [Микрослужбами построение](http://samnewman.io/books/building_microservices/), выделяет, следует разрабатывать вашей микрослужбами на основе шаблона, ограниченное контекста (BC) (часть домен разработки на основе), как представленный ранее.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-112">[Sam Newman](http://samnewman.io/), a recognized promoter of microservices and author of the book [Building Microservices](http://samnewman.io/books/building_microservices/), highlights that you should design your microservices based on the Bounded Context (BC) pattern (part of domain-driven design), as introduced earlier.</span></span> <span data-ttu-id="1a6aa-113">В некоторых случаях BC может состоять из нескольких физических служб, но не наоборот.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-113">Sometimes, a BC could be composed of several physical services, but not vice versa.</span></span>

<span data-ttu-id="1a6aa-114">Модель домена с сущностями в определенном домене применения в конкретных BC или микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-114">A domain model with specific domain entities applies within a concrete BC or microservice.</span></span> <span data-ttu-id="1a6aa-115">BC разделяет применимость модели домена и позволяет разработчику ясное и общего понимания каким должен быть целостного и что разработаны независимо, члены команды.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-115">A BC delimits the applicability of a domain model and gives developer team members a clear and shared understanding of what must be cohesive and what can be developed independently.</span></span> <span data-ttu-id="1a6aa-116">Это же цели для микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-116">These are the same goals for microservices.</span></span>

<span data-ttu-id="1a6aa-117">Другое средство, которое сообщает Выбор конструктора является [конвея](https://en.wikipedia.org/wiki/Conway%27s_law), том, что приложение будет отражать социальных границы организации, который его создал.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-117">Another tool that informs your design choice is [Conway’s law](https://en.wikipedia.org/wiki/Conway%27s_law), which states that an application will reflect the social boundaries of the organization that produced it.</span></span> <span data-ttu-id="1a6aa-118">Но иногда верно обратное — сформированное программное обеспечение предприятия.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-118">But sometimes the opposite is true—the company’s organization is formed by the software.</span></span> <span data-ttu-id="1a6aa-119">Может потребоваться для отката закона Конвея и построения границы способ упорядочить, компания перекосу к журналу процесса бизнеса.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-119">You might need to reverse Conway’s law and build the boundaries the way you want the company to be organized, leaning toward business process consulting.</span></span>

<span data-ttu-id="1a6aa-120">Для определения ограниченных контекстах, является DDD шаблон, который может использоваться для этого [контекст сопоставления шаблона](https://www.infoq.com/articles/ddd-contextmapping).</span><span class="sxs-lookup"><span data-stu-id="1a6aa-120">In order to identify bounded contexts, a DDD pattern that can be used for this is the [Context Mapping pattern](https://www.infoq.com/articles/ddd-contextmapping).</span></span> <span data-ttu-id="1a6aa-121">С сопоставлением контекста идентификации различных контекстах в приложении и их границы.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-121">With Context Mapping, you identify the various contexts in the application and their boundaries.</span></span> <span data-ttu-id="1a6aa-122">Это часто используются для экземпляра другого контекста и границ для каждой небольшой подсистемы.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-122">It is common to have a different context and boundary for each small subsystem, for instance.</span></span> <span data-ttu-id="1a6aa-123">Карта контекста является способом для определения и явно объявить эти границы между доменами.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-123">The Context Map is a way to define and make explicit those boundaries between domains.</span></span> <span data-ttu-id="1a6aa-124">BC является автономным и содержит сведения об одном домене — такие сведения, как сущности домена и определяет контракты интеграции с другими BCs.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-124">A BC is autonomous and includes the details of a single domain—details like the domain entities—and defines integration contracts with other BCs.</span></span> <span data-ttu-id="1a6aa-125">Это похоже на определение микрослужбу: он является автономным, он реализует некоторые возможности домена и он должен предоставлять интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-125">This is similar to the definition of a microservice: it is autonomous, it implements certain domain capability, and it must provide interfaces.</span></span> <span data-ttu-id="1a6aa-126">Именно поэтому сопоставление контекста и шаблон ограниченного контекста являются хорошим подходы для определения границ модели домена вашей микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-126">This is why Context Mapping and the Bounded Context pattern are good approaches for identifying the domain model boundaries of your microservices.</span></span>

<span data-ttu-id="1a6aa-127">При проектировании крупного приложения, вы увидите, как его модели домена может фрагментированным — эксперта из каталога домена будет имя сущности по-разному, в доменах каталога и инвентаризации, чем доставка специалистом, для экземпляра.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-127">When designing a large application, you will see how its domain model can be fragmented — a domain expert from the catalog domain will name entities differently in the catalog and inventory domains than a shipping domain expert, for instance.</span></span> <span data-ttu-id="1a6aa-128">Или сущность домена пользователя может отличаться размер и количество атрибутов, при работе с expert CRM кто хочет сохранить все сведения о клиента, чем для упорядочивания эксперта домена, который требуется только части данных о клиенте.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-128">Or the user domain entity might be different in size and number of attributes when dealing with a CRM expert who wants to store every detail about the customer than for an ordering domain expert who just needs partial data about the customer.</span></span> <span data-ttu-id="1a6aa-129">Очень трудно устранить неоднозначность все термины домена для всех доменов, связанных с большого приложения.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-129">It is very hard to disambiguate all domain terms across all the domains related to a large application.</span></span> <span data-ttu-id="1a6aa-130">Наиболее важные дело в том, что не рекомендуется для объединения условий; Вместо этого примите различия набора операторов, предоставляемые в каждом домене.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-130">But the most important thing is that you should not try to unify the terms; instead, accept the differences and richness provided by each domain.</span></span> <span data-ttu-id="1a6aa-131">При попытке единой базы данных для всего приложения попыток единой словарь будет неуклюжим и не будут звучать вправо, чтобы любой из нескольких специалистами в предметной области.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-131">If you try to have a unified database for the whole application, attempts at a unified vocabulary will be awkward and will not sound right to any of the multiple domain experts.</span></span> <span data-ttu-id="1a6aa-132">Таким образом BCs (реализованный как микрослужбами) поможет уточняется, где можно использовать определенные терминами домена и где требуется разделить системы и создать дополнительные BCs с разных доменах.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-132">Therefore, BCs (implemented as microservices) will help you to clarify where you can use certain domain terms and where you will need to split the system and create additional BCs with different domains.</span></span>

<span data-ttu-id="1a6aa-133">Вы будете знать, что вы получили правой границы и размер каждой BC и модель домена, если имеется несколько строгого связи между моделей домена, и вам обычно не нужно объединить данные из нескольких моделей домена, при выполнении приложений обычно операции.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-133">You will know that you got the right boundaries and sizes of each BC and domain model if you have few strong relationships between domain models, and you do not usually need to merge information from multiple domain models when performing typical application operations.</span></span>

<span data-ttu-id="1a6aa-134">Возможно лучший ответ на вопрос размер должен быть модель домена для каждого микрослужбу находится в следующем: должны быть автономными BC как изолированное, возможно, что позволяет работать без необходимости постоянно переключитесь в других контекстах (другие модели микрослужбу).</span><span class="sxs-lookup"><span data-stu-id="1a6aa-134">Perhaps the best answer to the question of how big a domain model for each microservice should be is the following: it should have an autonomous BC, as isolated as possible, that enables you to work without having to constantly switch to other contexts (other microservice’s models).</span></span> <span data-ttu-id="1a6aa-135">На рисунке 4-10 можно увидеть несколько микрослужбами (несколько BCs) каждого существуют свои собственные модели и как их сущностей можно определить, в зависимости от конкретных требований для каждого из указанных доменов приложения.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-135">In Figure 4-10 you can see how multiple microservices (multiple BCs) each have their own model and how their entities can be defined, depending on the specific requirements for each of the identified domains in your application.</span></span>

![](./media/image10.png)

<span data-ttu-id="1a6aa-136">**Рис. 4-10**.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-136">**Figure 4-10**.</span></span> <span data-ttu-id="1a6aa-137">Идентификация сущностей и границы микрослужбу модели</span><span class="sxs-lookup"><span data-stu-id="1a6aa-137">Identifying entities and microservice model boundaries</span></span>

<span data-ttu-id="1a6aa-138">Рис. 4-10 показан пример сценария, относящихся к системе управления сетевых конференций.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-138">Figure 4-10 illustrates a sample scenario related to an online conference management system.</span></span> <span data-ttu-id="1a6aa-139">Вы определили несколько BCs, которые могут быть реализованы как микрослужбами, именам доменов, определенных для вас специалистами в предметной области.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-139">You have identified several BCs that could be implemented as microservices, based on domains that domain experts defined for you.</span></span> <span data-ttu-id="1a6aa-140">Как видно, существуют объекты, присутствующие только в одной микрослужбу модели как платежей в микрослужбу оплаты.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-140">As you can see, there are entities that are present just in a single microservice model, like Payments in the Payment microservice.</span></span> <span data-ttu-id="1a6aa-141">Те, будет легко реализовать.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-141">Those will be easy to implement.</span></span>

<span data-ttu-id="1a6aa-142">Тем не менее может также потребоваться сущностей, которые имеют другую форму, но используют одно удостоверение через несколько моделей домена из нескольких микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-142">However, you might also have entities that have a different shape but share the same identity across the multiple domain models from the multiple microservices.</span></span> <span data-ttu-id="1a6aa-143">Например сущность пользователя определяется в микрослужбу конференции управления.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-143">For example, the User entity is identified in the Conferences Management microservice.</span></span> <span data-ttu-id="1a6aa-144">Этот же пользователь, с тем же идентификатором — один с именем покупателей в микрослужбу упорядочения элементов или один с именем плательщика в микрослужбу оплаты и даже одного именованного клиента в микрослужбу обслуживания клиентов.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-144">That same user, with the same identity, is the one named Buyers in the Ordering microservice, or the one named Payer in the Payment microservice, and even the one named Customer in the Customer Service microservice.</span></span> <span data-ttu-id="1a6aa-145">Это происходит потому, что в зависимости от [единый язык](https://martinfowler.com/bliki/UbiquitousLanguage.html) , используя expert каждого домена, пользователь может использовать другую перспективу, даже с разными атрибутами.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-145">This is because, depending on the [ubiquitous language](https://martinfowler.com/bliki/UbiquitousLanguage.html) that each domain expert is using, a user might have a different perspective even with different attributes.</span></span> <span data-ttu-id="1a6aa-146">Пользователь сущности в модели микрослужбу, с именем конференции управления возможно, большая часть его атрибуты персональные данные.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-146">The user entity in the microservice model named Conferences Management might have most of its personal data attributes.</span></span> <span data-ttu-id="1a6aa-147">Тем не менее этого же пользователя в форму плательщика в микрослужбу оплаты или в форму клиента в микрослужбу обслуживание клиентов не требуются один и тот же список атрибутов.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-147">However, that same user in the shape of Payer in the microservice Payment or in the shape of Customer in the microservice Customer Service might not need the same list of attributes.</span></span>

<span data-ttu-id="1a6aa-148">Аналогичный подход показан на рисунке 4-11.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-148">A similar approach is illustrated in Figure 4-11.</span></span>

![](./media/image11.png)

<span data-ttu-id="1a6aa-149">**Рис. 4-11**.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-149">**Figure 4-11**.</span></span> <span data-ttu-id="1a6aa-150">Разбиение моделей традиционных данных нескольких моделей домена</span><span class="sxs-lookup"><span data-stu-id="1a6aa-150">Decomposing traditional data models into multiple domain models</span></span>

<span data-ttu-id="1a6aa-151">Вы увидите, как пользователь присутствует в модели микрослужбу конференции управления как сущность пользователя и присутствует также в виде сущности покупателей в микрослужбу цены, альтернативный attributes или сведения о пользователе, когда это действительно покупатель.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-151">You can see how the user is present in the Conferences Management microservice model as the User entity and is also present in the form of the Buyer entity in the Pricing microservice, with alternate attributes or details about the user when it is actually a buyer.</span></span> <span data-ttu-id="1a6aa-152">Каждый микрослужбу или BC не требуются все данные, относящиеся к сущности пользователя, только его часть, в зависимости от того, чтобы решить проблему или контексте.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-152">Each microservice or BC might not need all the data related to a User entity, just part of it, depending on the problem to solve or the context.</span></span> <span data-ttu-id="1a6aa-153">Например в модели ценообразования микрослужбу необязательно адрес или идентификатор пользователя, просто код (удостоверение) и состояния, которая может повлиять на скидки при цены мест на покупателя.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-153">For instance, in the Pricing microservice model, you do not need the address or the ID of the user, just ID (as identity) and Status, which will have an impact on discounts when pricing the seats per buyer.</span></span>

<span data-ttu-id="1a6aa-154">Рабочее место сущность имеет те же имя, но с разными атрибутами в каждой модели домена.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-154">The Seat entity has the same name but different attributes in each domain model.</span></span> <span data-ttu-id="1a6aa-155">Тем не менее, рабочее место использует удостоверение, основанное на тот же идентификатор, как происходит с именем пользователя и покупателей.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-155">However, Seat shares identity based on the same ID, as happens with User and Buyer.</span></span>

<span data-ttu-id="1a6aa-156">По сути является общей концепции пользователя, который существует в нескольких служб (домены), которые используют удостоверение пользователя.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-156">Basically, there is a shared concept of a user that exists in multiple services (domains), which all share the identity of that user.</span></span> <span data-ttu-id="1a6aa-157">Но в каждой модели домена могут существовать дополнительные или другие сведения о сущности пользователя.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-157">But in each domain model there might be additional or different details about the user entity.</span></span> <span data-ttu-id="1a6aa-158">Таким образом необходимо, чтобы сопоставить пользователя сущность из одного домена (микрослужбу) в другую.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-158">Therefore, there needs to be a way to map a user entity from one domain (microservice) to another.</span></span>

<span data-ttu-id="1a6aa-159">Есть несколько преимуществ для не совместного использования одной и той же сущности пользователя с тем же номером атрибутов между доменами.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-159">There are several benefits to not sharing the same user entity with the same number of attributes across domains.</span></span> <span data-ttu-id="1a6aa-160">Одно из преимуществ является целью снижения дублирования, таким образом, что микрослужбу моделей не все данные, не обязательно.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-160">One benefit is to reduce duplication, so that microservice models do not have any data that they do not need.</span></span> <span data-ttu-id="1a6aa-161">Еще одним преимуществом является хранение master микрослужбу, которому принадлежит тип данных каждой сущности, чтобы обновление и отправлять запросы для этого типа данных определяются только что микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="1a6aa-161">Another benefit is having a master microservice that owns a certain type of data per entity so that updates and queries for that type of data are driven only by that microservice.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="1a6aa-162">[Предыдущие] (распределенных данные management.md) [Далее] (direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span><span class="sxs-lookup"><span data-stu-id="1a6aa-162">[Previous] (distributed-data-management.md) [Next] (direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span></span>
