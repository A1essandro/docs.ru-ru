---
title: "Независимости данных на микрослужбу"
description: "Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Независимости данных на микрослужбу"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: c51daae04215cfa6f5b5b8d2158a8ed1a8949652
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2017
---
# <a name="data-sovereignty-per-microservice"></a><span data-ttu-id="ae4bd-104">Независимости данных на микрослужбу</span><span class="sxs-lookup"><span data-stu-id="ae4bd-104">Data sovereignty per microservice</span></span>

<span data-ttu-id="ae4bd-105">Правило для архитектуры микрослужбами является то, что каждого микрослужбу должен быть владельцем домена данных и логику.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-105">An important rule for microservices architecture is that each microservice must own its domain data and logic.</span></span> <span data-ttu-id="ae4bd-106">Так же, как завершенное приложение, которому принадлежит его логику и данные, поэтому необходимо каждого микрослужбу владельцем его логику и данные в группе автономных жизненного цикла, с помощью развертывания на микрослужбу независимо.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-106">Just as a full application owns its logic and data, so must each microservice own its logic and data under an autonomous lifecycle, with independent deployment per microservice.</span></span>

<span data-ttu-id="ae4bd-107">Это означает, что концептуальной модели домена будет отличаться от подсистем или микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-107">This means that the conceptual model of the domain will differ between subsystems or microservices.</span></span> <span data-ttu-id="ae4bd-108">Рассмотрим корпоративных приложений, где клиента приложения управления взаимоотношениями (CRM), транзакций приобрести подсистемы и подсистемы поддержки клиентов в атрибуты сущностей уникального клиента и данные каждого вызова, а каждый использует другой Связывает контекст (BC).</span><span class="sxs-lookup"><span data-stu-id="ae4bd-108">Consider enterprise applications, where customer relationship management (CRM) applications, transactional purchase subsystems, and customer support subsystems each call on unique customer entity attributes and data, and where each employs a different Bounded Context (BC).</span></span>

<span data-ttu-id="ae4bd-109">Этот принцип аналогичен [разработки на основе домена (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design), где каждый [ограниченного контекста](https://martinfowler.com/bliki/BoundedContext.html) или автономной подсистемы или службы должен быть владельцем его модели домена (данные плюс логику и поведение).</span><span class="sxs-lookup"><span data-stu-id="ae4bd-109">This principle is similar in [Domain-driven design (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design), where each [Bounded Context](https://martinfowler.com/bliki/BoundedContext.html) or autonomous subsystem or service must own its domain model (data plus logic and behavior).</span></span> <span data-ttu-id="ae4bd-110">В каждом контексте DDD ограниченного сопоставляется с одной бизнес микрослужбу (одну или несколько служб).</span><span class="sxs-lookup"><span data-stu-id="ae4bd-110">Each DDD Bounded Context correlates to one business microservice (one or several services).</span></span> <span data-ttu-id="ae4bd-111">(Мы расширяются на эту точку о шаблон ограниченного контекста в следующем разделе).</span><span class="sxs-lookup"><span data-stu-id="ae4bd-111">(We expand on this point about the Bounded Context pattern in the next section.)</span></span>

<span data-ttu-id="ae4bd-112">С другой стороны этот подход традиционных (монолитные данных), используется во многих приложениях — централизованной базе данных или несколько баз данных.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-112">On the other hand, the traditional (monolithic data) approach used in many applications is to have a single centralized database or just a few databases.</span></span> <span data-ttu-id="ae4bd-113">Часто это нормализованной базы данных SQL, используемый для всего приложения и всех внутренних подсистем, как показано на рисунке 4-7.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-113">This is often a normalized SQL database that is used for the whole application and all its internal subsystems, as shown in Figure 4-7.</span></span>

![](./media/image7.png)

<span data-ttu-id="ae4bd-114">**Рис. 4-7**.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-114">**Figure 4-7**.</span></span> <span data-ttu-id="ae4bd-115">Сравнение данных независимости: монолитные базы данных ее микрослужбами</span><span class="sxs-lookup"><span data-stu-id="ae4bd-115">Data sovereignty comparison: monolithic database versus microservices</span></span>

<span data-ttu-id="ae4bd-116">Подход централизованную базу данных изначально выглядит более простой кажется, обеспечивая повторное использование сущностей в разные подсистемы, чтобы все согласованное.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-116">The centralized database approach initially looks simpler and seems to enable reuse of entities in different subsystems to make everything consistent.</span></span> <span data-ttu-id="ae4bd-117">Но в действительности, вы получаете большой таблицы, которые обслуживают множество разные подсистемы и включать атрибуты и столбцы, которые не требуются в большинстве случаев.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-117">But the reality is you end up with huge tables that serve many different subsystems, and that include attributes and columns that are not needed in most cases.</span></span> <span data-ttu-id="ae4bd-118">Он аналогичен пытается использовать то же сопоставление физических Туризм короткий следа, занимает trip car длительностью в день и обучения geography.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-118">it is like trying to use the same physical map for hiking a short trail, taking a day-long car trip, and learning geography.</span></span>

<span data-ttu-id="ae4bd-119">Монолитные приложения с обычно одну реляционную базу данных имеет два важных преимущества: [ACID-транзакции](https://en.wikipedia.org/wiki/ACID) и языка SQL, оба работы для всех таблиц и данных, связанных с приложением.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-119">A monolithic application with typically a single relational database has two important benefits: [ACID transactions](https://en.wikipedia.org/wiki/ACID) and the SQL language, both working across all the tables and data related to your application.</span></span> <span data-ttu-id="ae4bd-120">Такой подход позволяет легко создавать запросы, объединяющий данные из нескольких таблиц.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-120">This approach provides a way to easily write a query that combines data from multiple tables.</span></span>

<span data-ttu-id="ae4bd-121">Тем не менее при перемещении к архитектуре микрослужбами доступа к данным становится гораздо более сложной.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-121">However, data access becomes much more complex when you move to a microservices architecture.</span></span> <span data-ttu-id="ae4bd-122">Но даже в том случае, когда ACID-транзакции может или должен использоваться внутри микрослужбу или ограниченного контекста, данных, владельцем каждого микрослужбу является закрытым для этого микрослужбу и может осуществляться только через API-интерфейса микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-122">But even when ACID transactions can or should be used within a microservice or Bounded Context, the data owned by each microservice is private to that microservice and can only be accessed via its microservice API.</span></span> <span data-ttu-id="ae4bd-123">Инкапсуляция данных гарантирует, что микрослужбами слабо связаны и могут изменяться независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-123">Encapsulating the data ensures that the microservices are loosely coupled and can evolve independently of one another.</span></span> <span data-ttu-id="ae4bd-124">Если несколько служб доступ к тем же данным, обновления схемы потребует скоординированного обновлений ко всем службам.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-124">If multiple services were accessing the same data, schema updates would require coordinated updates to all the services.</span></span> <span data-ttu-id="ae4bd-125">Это нарушит автономность микрослужбу жизненного цикла.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-125">This would break the microservice lifecycle autonomy.</span></span> <span data-ttu-id="ae4bd-126">Но структуры распределенных данных означает через микрослужбами вносить одной транзакции ACID.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-126">But distributed data structures mean that you cannot make a single ACID transaction across microservices.</span></span> <span data-ttu-id="ae4bd-127">В свою очередь означает, что необходимо использовать окончательной согласованности, если бизнес-процесс охватывает несколько микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-127">This in turn means you must use eventual consistency when a business process spans multiple microservices.</span></span> <span data-ttu-id="ae4bd-128">Это намного труднее реализации, чем простой соединения SQL; Аналогично многие другие возможности реляционной базы данных недоступны через несколько микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-128">This is much harder to implement than simple SQL joins; similarly, many other relational database features are not available across multiple microservices.</span></span>

<span data-ttu-id="ae4bd-129">Даже продолжив, другой микрослужбами часто используют разные *типов* баз данных.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-129">Going even further, different microservices often use different *kinds* of databases.</span></span> <span data-ttu-id="ae4bd-130">Современных приложений для магазина и процесс различных типов данных и реляционной базы данных не всегда лучший выбор.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-130">Modern applications store and process diverse kinds of data, and a relational database is not always the best choice.</span></span> <span data-ttu-id="ae4bd-131">Для некоторых вариантов использования, баз данных NoSQL, таких как Azure DocumentDB или MongoDB может быть более удобным модель данных и обеспечивают более высокую производительность и масштабируемость, чем в базе данных SQL как SQL Server или база данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-131">For some use cases, a NoSQL database such as Azure DocumentDB or MongoDB might have a more convenient data model and offer better performance and scalability than a SQL database like SQL Server or Azure SQL Database.</span></span> <span data-ttu-id="ae4bd-132">В других случаях реляционной базы данных по-прежнему является лучшим подходом.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-132">In other cases, a relational database is still the best approach.</span></span> <span data-ttu-id="ae4bd-133">Таким образом, приложения на основе микрослужбами часто используют сочетание баз данных SQL и NoSQL, который иногда называют [polyglot сохраняемости](http://martinfowler.com/bliki/PolyglotPersistence.html) подход.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-133">Therefore, microservices-based applications often use a mixture of SQL and NoSQL databases, which is sometimes called the [polyglot persistence](http://martinfowler.com/bliki/PolyglotPersistence.html) approach.</span></span>

<span data-ttu-id="ae4bd-134">Секционированные постоянные полиглот архитектуры для хранения данных имеет множество преимуществ.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-134">A partitioned, polyglot-persistent architecture for data storage has many benefits.</span></span> <span data-ttu-id="ae4bd-135">К ним относятся слабо связанных служб и более высокую производительность, масштабируемость, затраты и управляемость.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-135">These include loosely coupled services and better performance, scalability, costs, and manageability.</span></span> <span data-ttu-id="ae4bd-136">Тем не менее, может вызвать некоторые проблемы управления распределенными данными, как будет описано в «[определение границ модели домена](#identifying-domain-model-boundaries-for-each-microservice)» далее в этой главе.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-136">However, it can introduce some distributed data management challenges, as we will explain in “[Identifying domain-model boundaries](#identifying-domain-model-boundaries-for-each-microservice)” later in this chapter.</span></span>

## <a name="the-relationship-between-microservices-and-the-bounded-context-pattern"></a><span data-ttu-id="ae4bd-137">Связь между микрослужбами и шаблон ограниченного контекста</span><span class="sxs-lookup"><span data-stu-id="ae4bd-137">The relationship between microservices and the Bounded Context pattern</span></span>

<span data-ttu-id="ae4bd-138">Понятие микрослужбу является производным от [шаблона, ограниченное контекста (BC)](http://martinfowler.com/bliki/BoundedContext.html) в [разработки на основе домена (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design).</span><span class="sxs-lookup"><span data-stu-id="ae4bd-138">The concept of microservice derives from the [Bounded Context (BC) pattern](http://martinfowler.com/bliki/BoundedContext.html) in [domain-driven design (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design).</span></span> <span data-ttu-id="ae4bd-139">DDD имеет дело с большими моделями, разбивая их на несколько BCs и выполняется явно их границы.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-139">DDD deals with large models by dividing them into multiple BCs and being explicit about their boundaries.</span></span> <span data-ttu-id="ae4bd-140">Каждый BC должен иметь собственную модель и база данных; Аналогичным образом каждый микрослужбу владеет соответствующими данными.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-140">Each BC must have its own model and database; likewise, each microservice owns its related data.</span></span> <span data-ttu-id="ae4bd-141">Кроме того, каждый BC обычно имеет свой собственный [единый язык](http://martinfowler.com/bliki/UbiquitousLanguage.html) для взаимодействия между разработчиками и специалистами в предметной области.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-141">In addition, each BC usually has its own [ubiquitous language](http://martinfowler.com/bliki/UbiquitousLanguage.html) to help communication between software developers and domain experts.</span></span>

<span data-ttu-id="ae4bd-142">Эти термины (главным образом сущности домена), в единый язык может иметь разные имена в различных контекстах ограниченных, даже в том случае, когда разные домена сущности используют одно удостоверение (то есть уникальный идентификатор, используемый для чтения объекта из хранилища).</span><span class="sxs-lookup"><span data-stu-id="ae4bd-142">Those terms (mainly domain entities) in the ubiquitous language can have different names in different Bounded Contexts, even when different domain entities share the same identity (that is, the unique ID that is used to read the entity from storage).</span></span> <span data-ttu-id="ae4bd-143">Для экземпляра в контексте ограниченных профиля пользователя, сущности пользователя домена может используют удостоверение с сущностью домена покупателей в контексте упорядочивания ограниченного.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-143">For instance, in a user-profile Bounded Context, the User domain entity might share identity with the Buyer domain entity in the ordering Bounded Context.</span></span>

<span data-ttu-id="ae4bd-144">Микрослужбу таким образом подобно ограниченного контекста, но также указывает, что это распределенная служба.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-144">A microservice is therefore like a Bounded Context, but it also specifies that it is a distributed service.</span></span> <span data-ttu-id="ae4bd-145">Создается как отдельный процесс для каждого контекста ограниченных и он должен использовать распределенные протоколы, уже отмечалось ранее, например HTTP или HTTPS, WebSockets, или [AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol).</span><span class="sxs-lookup"><span data-stu-id="ae4bd-145">It is built as a separate process for each Bounded Context, and it must use the distributed protocols noted earlier, like HTTP/HTTPS, WebSockets, or [AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol).</span></span> <span data-ttu-id="ae4bd-146">Шаблон ограниченного контекста, однако указывает ли контекст ограниченных — это распределенная служба, или это просто логическими границами (например, универсальный подсистемы) в рамках монолитные развертывания приложения.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-146">The Bounded Context pattern, however, does not specify whether the Bounded Context is a distributed service or if it is simply a logical boundary (such as a generic subsystem) within a monolithic-deployment application.</span></span>

<span data-ttu-id="ae4bd-147">Это важно обратить внимание, что определения службы для каждого контекста ограниченных является удобным инструментом для начала.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-147">It is important to highlight that defining a service for each Bounded Context is a good place to start.</span></span> <span data-ttu-id="ae4bd-148">Однако нет необходимости ограничивать его структуру.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-148">But you do not have to constrain your design to it.</span></span> <span data-ttu-id="ae4bd-149">Иногда необходимо создать контекст ограниченных или микрослужбу бизнеса, состоящие из нескольких физических служб.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-149">Sometimes you must design a Bounded Context or business microservice composed of several physical services.</span></span> <span data-ttu-id="ae4bd-150">Но в конечном счете, для обоих шаблонов — связывает контекст и микрослужбу — тесно связаны.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-150">But ultimately, both patterns—Bounded Context and microservice—are closely related.</span></span>

<span data-ttu-id="ae4bd-151">Преимущества микрослужбами путем получения реальных границы в виде распределенных микрослужбами ддд.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-151">DDD benefits from microservices by getting real boundaries in the form of distributed microservices.</span></span> <span data-ttu-id="ae4bd-152">Но идеи, такими как не совместное использование модели между микрослужбами также выберите в контексте ограниченных.</span><span class="sxs-lookup"><span data-stu-id="ae4bd-152">But ideas like not sharing the model between microservices are what you also want in a Bounded Context.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="ae4bd-153">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="ae4bd-153">Additional resources</span></span>

-   <span data-ttu-id="ae4bd-154">**Крис Ричардсон. Шаблон: Базы данных каждой службы**
    [*http://microservices.io/patterns/data/database-per-service.html*](http://microservices.io/patterns/data/database-per-service.html)</span><span class="sxs-lookup"><span data-stu-id="ae4bd-154">**Chris Richardson. Pattern: Database per service**
[*http://microservices.io/patterns/data/database-per-service.html*](http://microservices.io/patterns/data/database-per-service.html)</span></span>

-   <span data-ttu-id="ae4bd-155">**Мартин Фоулер (Martin Fowler). BoundedContext**
    [*http://martinfowler.com/bliki/BoundedContext.html*](http://martinfowler.com/bliki/BoundedContext.html)</span><span class="sxs-lookup"><span data-stu-id="ae4bd-155">**Martin Fowler. BoundedContext**
[*http://martinfowler.com/bliki/BoundedContext.html*](http://martinfowler.com/bliki/BoundedContext.html)</span></span>

-   <span data-ttu-id="ae4bd-156">**Мартин Фоулер (Martin Fowler). PolyglotPersistence**
    [*http://martinfowler.com/bliki/PolyglotPersistence.html*](http://martinfowler.com/bliki/PolyglotPersistence.html)</span><span class="sxs-lookup"><span data-stu-id="ae4bd-156">**Martin Fowler. PolyglotPersistence**
[*http://martinfowler.com/bliki/PolyglotPersistence.html*](http://martinfowler.com/bliki/PolyglotPersistence.html)</span></span>

-   <span data-ttu-id="ae4bd-157">**Alberto Brandolini. Стратегическое домена Driven Design с сопоставлением контекста**
    [*https://www.infoq.com/articles/ddd-contextmapping*](https://www.infoq.com/articles/ddd-contextmapping)</span><span class="sxs-lookup"><span data-stu-id="ae4bd-157">**Alberto Brandolini. Strategic Domain Driven Design with Context Mapping**
[*https://www.infoq.com/articles/ddd-contextmapping*](https://www.infoq.com/articles/ddd-contextmapping)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="ae4bd-158">[Предыдущие] микрослужбами (architecture.md) [Далее] (логического и физического architecture.md)</span><span class="sxs-lookup"><span data-stu-id="ae4bd-158">[Previous] (microservices-architecture.md) [Next] (logical-versus-physical-architecture.md)</span></span>
