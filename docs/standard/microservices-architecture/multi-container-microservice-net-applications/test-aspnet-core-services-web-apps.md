---
title: "Проверка служб ASP.NET Core и веб-приложений"
description: "Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Проверка служб ASP.NET Core и веб-приложений"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: f756a679befee676db2bf6d402fd7e34b1621b9d
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="testing-aspnet-core-services-and-web-apps"></a>Проверка служб ASP.NET Core и веб-приложений

Контроллеры являются центральным элементом любого службы основному API ASP.NET и MVC веб-приложения ASP.NET. Таким образом должны иметь достоверности они ведут себя так, как для вашего приложения. Автоматические тесты можно получить у этого достоверности и выявить ошибки, прежде чем они достигнут рабочей.

Необходимо протестировать поведение контроллера в зависимости от входных данных допустимое или недопустимое и на основе результатов бизнес-операции, выполняемые ею ответы контроллера тестирования. Однако эти типы тестов необходимо иметь вашей микрослужбами:

-   Модульные тесты. Эти убедитесь, что компоненты приложения работают должным образом. Утверждения проверки компонента API.

-   Интеграционные тесты. Эти убедитесь, что взаимодействие компонентов работать, как ожидалось в отношении внешние устройства, например баз данных. Утверждения можно проверить компонент API, пользовательского интерфейса или побочные эффекты действий, таких как базы данных операций ввода-вывода, ведение журнала и т. д.

-   Функциональных тестов для каждого микрослужбы. Это обеспечивает, что приложение работает с точки зрения пользователя.

-   Проверка службы. Это обеспечивает, были протестированы вариантов использования службы начала до конца, включая тестирование нескольких служб в то же время. Этот тип проверки необходимо сначала подготовить среду. В данном случае означает запуск служб (например, с помощью docker составления вверх).

### <a name="implementing-unit-tests-for-aspnet-core-web-apis"></a>Реализация модульных тестов для веб-API ASP.NET Core

Модульное тестирование включает в себя проверку частью приложения отдельно от инфраструктуры и зависимости. При модульного тестирования логику контроллера, содержимое только одно действие или метод проверяется, не поведение из ее зависимостей или сам платформы. Модульные тесты, не обнаруживают проблемы во взаимодействии между компонентами — то есть назначение интеграционного тестирования.

Как модульного тестирования ваши действия контроллера, убедитесь, что сосредоточиться только на их работу. Модульный тест контроллер позволяет избежать таких вещей, как фильтры маршрутизации и привязки модели. Так как они сосредоточиться на тестировании только одно, модульные тесты — обычно просто для записи и быстро выполнять. Грамотно сконструированные набор модульные тесты могут выполняться без большой нагрузки часто.

Модульные тесты реализуются в зависимости от платформы тестирования как xUnit.net MSTest, заказа и NUnit. Для примера приложения eShopOnContainers мы используем XUnit.

При создании модульного теста для контроллера веб-API, можно создать экземпляр класса контроллера, непосредственно с помощью ключевого слова new в языке C\#таким образом, тест будет запускаться максимально возможной скоростью. Следующий пример показывает, как это сделать при использовании [XUnit](https://xunit.github.io/) как платформы тестирования.

```csharp
[Fact]
public void Add_new_Order_raises_new_event()
{
    // Arrange
    var street = " FakeStreet ";
    var city = "FakeCity";
    // Other variables omitted for brevity ...
    // Act
    var fakeOrder = new Order(new Address(street, city, state, country, zipcode),
        cardTypeId, cardNumber,
        cardSecurityNumber, cardHolderName,
        cardExpiration);
    // Assert
    Assert.Equal(fakeOrder.DomainEvents.Count, expectedResult);
}
```

### <a name="implementing-integration-and-functional-tests-for-each-microservice"></a>Реализация интеграции и функциональных тестов для каждого микрослужбу

Как уже отмечалось, тесты интеграции и функциональных тестов имеют различные предназначения и целей. Тем не менее можно реализовывать при тестировании контроллеры ASP.NET Core способ аналогичен, в этом разделе мы сосредоточиться на тесты интеграции.

Интеграционного тестирования гарантирует, что компоненты приложения работать должным образом, относительно. ASP.NET Core предоставляет возможности интеграции тестирования с помощью платформы модульного тестирования и встроенных тестов веб-узел, который может использоваться для обработки запросов без нагрузки на сеть.

В отличие от модульного тестирования тесты интеграции часто включают проблемы инфраструктуры приложения, такие как базы данных, файловая система, сетевые ресурсы, или веб-запросов и ответов. Модульные тесты использовать fakes или создания объектов вместо этих проблем. Но интеграционные тесты предназначен для убедитесь, что система работает должным образом с этими системами, поэтому для тестирования интеграции не использовать fakes и создания объектов. Вместо этого можно включить инфраструктуры, таких как базы данных access или служба вызова от других служб.

Поскольку тесты интеграции использовать больший сегменты кода, чем модульные тесты и тесты интеграции зависит от инфраструктуры элементов, они обычно бывают порядков медленнее, чем модульные тесты. Таким образом рекомендуется ограничить количество тестов интеграции написание и запуск.

ASP.NET Core включает встроенных тестов веб-узел, можно использовать для обработки HTTP-запросы без нагрузки на сеть, это означает, что можно запускать эти тесты быстрее при использовании с реальными веб-узла. Тест веб-узел доступен в компоненте NuGet как Microsoft.AspNetCore.TestHost. Его можно добавить к интеграции тестовые проекты и используется для узла ASP.NET Core приложений.

Как видно в следующем коде при создании интеграционных тестов для ASP.NET Core контроллеров, создайте экземпляр контроллеров путем тестового узла. Это можно сравнить с HTTP-запроса, но он выполняется быстрее.

```csharp
public class PrimeWebDefaultRequestShould
{
    private readonly TestServer _server;
    private readonly HttpClient _client;

    public PrimeWebDefaultRequestShould()
    {
        // Arrange
        _server = new TestServer(new WebHostBuilder()
           .UseStartup<Startup>());
           _client = _server.CreateClient();
    }

    [Fact]
    public async Task ReturnHelloWorld()
    {
        // Act
        var response = await _client.GetAsync("/");
        response.EnsureSuccessStatusCode();
        var responseString = await response.Content.ReadAsStringAsync();
        // Assert
        Assert.Equal("Hello World!", responseString);
    }
}
```

#### <a name="additional-resources"></a>Дополнительные ресурсы

-   **Стив Смит. Контроллеры тестирования** (ASP.NET Core) [ *https://docs.microsoft.com/aspnet/core/mvc/controllers/testing*](https://docs.microsoft.com/aspnet/core/mvc/controllers/testing)

-   **Стив Смит. Интеграционного тестирования** (ASP.NET Core) [ *https://docs.microsoft.com/aspnet/core/testing/integration-testing*](https://docs.microsoft.com/aspnet/core/testing/integration-testing)

-   **Модульное тестирование в .NET Core с помощью теста dotnet**
    [*https://docs.microsoft.com/dotnet/core/testing/unit-testing-with-dotnet-test*](https://docs.microsoft.com/dotnet/core/testing/unit-testing-with-dotnet-test)

-   **xUnit.net**. Официальный сайт
    [*https://xUnit.github.IO/*](https://xunit.github.io/)

-   **О модульных тестах. ** 
     [ *https://msdn.microsoft.com/en-us/library/hh694602.aspx*](https://msdn.microsoft.com/en-us/library/hh694602.aspx)

-   **Заказа**. В репозитории GitHub.
    [*https://github.com/MOQ/MOQ*](https://github.com/moq/moq)

-   **NUnit**. Официальный сайт
    [*https://www.NUnit.org/*](https://www.nunit.org/)

### <a name="implementing-service-tests-on-a-multi-container-application"></a>Реализация службы тесты в приложении несколькими контейнера 

Как уже упоминалось, при тестировании приложения несколькими контейнера, микрослужбами нужно запускать в кластере или контейнера Docker. Служба конца в конец тесты, включающие несколько операций, включающих несколько микрослужбами требуется развертывание и запуск приложения целиком в узле Docker, выполнив docker-составления вверх (или механизм сопоставимых при использовании orchestrator). После запуска всего приложения и все его службы вы можете выполнять интеграцию с начала до конца и функциональных тестов.

Существует несколько подходов, которые можно использовать. В файле docker compose.yml, который используется для развертывания приложения (или аналогичные назначения, такие как docker compose.ci.build.yml), на уровне решения можно развернуть точку входа для использования [dotnet теста](https://docs.microsoft.com/dotnet/core/tools/dotnet-test). Можно также использовать другой создать файл, который будет выполнять тесты в образ, который вы используете. С помощью другого файла создания сообщения для интеграции тестов, которые включают микрослужбами и баз данных на контейнеры, можно убедитесь, что связанные данные всегда сбросить в исходное состояние перед выполнением тестов.

После создания сообщения приложение не работает, можно воспользоваться преимуществами точки останова и исключения, если вы используете Visual Studio. Или можно выполнить тесты интеграции автоматически в конвейер элемента конфигурации в Visual Studio Team Services или любую другую систему CI или компакт-диска, который поддерживает контейнеры Docker.

>[!div class="step-by-step"]
[Предыдущие] (подписаться events.md) [Далее] (.. /microservice-ddd-CQRS-Patterns/index.MD)
