---
title: "Проектирование микрослужбу ориентированных приложений"
description: "Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Проектирование микрослужбу ориентированных приложений"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 1e1dc919c7e35580576c86b4cf9872b4f8cea2c2
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2017
---
# <a name="designing-a-microservice-oriented-application"></a>Проектирование микрослужбу ориентированных приложений

Этот раздел посвящен разработке приложения гипотетической серверных корпоративных.

## <a name="application-specifications"></a>Спецификации приложения

Гипотетического приложения обрабатывает запросы, выполнение бизнес-логики, доступ к базам данных и затем возвращаясь ответы HTML, XML или JSON. Скажем, приложение должно поддерживать различных клиентов, включая классических браузерах, запущенных приложений на одной странице (SPAs), традиционный веб-приложений, мобильных веб-приложений и собственных мобильных приложений. Приложение также может предоставлять API-Интерфейс для использования третьим лицам. Также следует возможность интегрировать его микрослужбами или внешними приложениями асинхронно, позволяя подход поможет гибкости микрослужбами в случае частичных сбоев.

Приложение будет состоять из этих типов компонентов:

-   Компоненты представления. Они отвечают за обработку пользовательского интерфейса и использование удаленных служб.

-   Домен или бизнес-логики. Это логику домена приложения.

-   Логики доступа к базе данных. Сюда входят компоненты доступа к данным, обеспечивающий доступ к базам данных (SQL или NoSQL).

-   Интеграция логику приложения. Сюда входят канал обмена сообщениями, главным образом на основании посредникам.

Приложения потребуется высокую масштабируемость, обеспечив при этом ее подсистемами вертикальной масштабировать автономно, так как некоторые подсистемы потребуют более масштабируемой, чем другие.

Приложения должны иметь возможность развернуть в среде с несколькими инфраструктуры (несколько общедоступные облака и локальных) и желательно кросс платформенных, возможность легко перемещать с Linux для Windows (или наоборот).

## <a name="development-team-context"></a>Контекста команды разработки

Также предполагается следующие особенности процесса разработки для приложения:

-   У вас есть несколько команд разработчиков, сосредоточившись на различные области приложения.

-   Новым членам команды необходимо освоить быстро, и приложение должно быть легко понять и изменить.

-   Приложение будет иметь долгосрочной развитие и постоянно меняющихся бизнес-правил.

-   Вы должны хорошо долгосрочной удобство поддержки, это означает наличие гибкости при реализации в будущем новые изменения и обновить несколько подсистем с минимальным воздействием на другие подсистемы.

-   Вы хотите практике непрерывной интеграции и непрерывного развертывания приложения.

-   Вы хотите воспользоваться преимуществами новых технологий (платформы, языки программирования и т.д.) при развития приложения. Не следует вносить полный перенос приложения при переходе на новые технологии, так как, может привести к высокой стоимости и повлиять на предсказуемость и стабильности работы приложения.

## <a name="choosing-an-architecture"></a>Выбор архитектуры

Что следует архитектура развертывания приложения Спецификации для приложения вместе с контекстом разработки, настоятельно рекомендуется, необходимо сконструировать приложения путем декомпозиции его в автономной подсистем в виде совместной микрослужбами и контейнеры, где микрослужбу — это контейнер.

При таком подходе каждой службы (контейнер) реализует набор целостного и узко связанных функций. Например приложение может состоять из службы, такие как службы каталогов, упорядочение службе службе корзины, службой профилей пользователей, и т. д.

Микрослужбами обмениваться данными с помощью протоколов, таких как HTTP (REST), но также асинхронно (то есть AMQP) по возможности, особенно если распространение обновляет события интеграции.

Микрослужбами разработки и развертывания как контейнеры независимо друг от друга. Это означает, что команды разработчиков могут разработки и развертывания определенных микрослужбу без ущерба для других подсистем.

Каждый микрослужбу имеет собственную базу данных, позволяя им быть полностью отделены от других микрослужбами. При необходимости, согласованность между базами данных различных микрослужбами достигается с помощью события уровня приложения интеграции (с помощью шины логических событий) как обработанное в команде и разделение ответственности запросов (CQRS). Из-за этого ограничения бизнеса должен учесть окончательной согласованности между несколькими микрослужбами и связанных баз данных.

### <a name="eshoponcontainers-a-reference-application-for-net-core-and-microservices-deployed-using-containers"></a>eShopOnContainers: ссылка приложения для .NET Core и микрослужбами, развернутые с помощью контейнеров

Чтобы сосредоточиться на архитектуры и технологии вместо обдумывания домена hypothetic бизнеса, вы можете не знать, мы выбрали хорошо известных предметной — а именно, это приложение упрощенный электронной коммерции (e магазин), которое представляет каталог продукты, принимающего заказы от клиентов, инвентаризации проверяет и выполняет другие бизнес-функции. Этот исходный код приложения на основе контейнера доступен в [eShopOnContainers](http://aka.ms/MicroservicesArchitecture) в репозитории GitHub.

Приложение состоит из нескольких подсистем, включая несколько хранилища пользовательского интерфейса интерфейсные веб-приложения и собственного мобильного приложения, вместе с серверной части микрослужбами и контейнеры для всех необходимых серверных операций. Рис. 8-1 показана архитектура приложения ссылку.

![](./media/image1.png)

**Рис. 8-1**. EShopOnContainers ссылаться на приложение, прямой обмен данными клиента микрослужбу и шины событий

**Среда размещения**. В на рисунке 8-1, вы увидите несколько контейнеров, развернутые в одном узле Docker. При развертывании на один узел Docker с помощью docker, возможно в случае-составления копирование команды. Тем не менее при помощи orchestrator или контейнере кластера, каждый контейнер может выполняться в другой узел (узел) и любого узла может выполняться любое количество контейнеров, как мы ранее описано в разделе "Архитектура".

**Архитектура Communication**. EShopOnContainers приложение использует два типа связи, в зависимости от вида функциональной действие (запросы и обновления и транзакции):

-   Прямая связь клиента микрослужбы. Используется для запросов и принимая обновления или команды транзакций в клиентских приложениях.

-   Асинхронное взаимодействие на основе событий. Это происходит через шину событий распространения обновлений через микрослужбами или интегрировать с внешними приложениями. Шина событий может быть реализован с какой-либо технологии инфраструктуры обмена сообщениями компонента broker как RabbitMQ или более высокого уровня шины службы Azure Service Bus, NServiceBus, MassTransit или Brighter.

Приложение развертывается в виде набора микрослужбами в виде контейнеров. Клиентские приложения могут обмениваться данными с помощью этих контейнеров, а также связи между микрослужбами. Как уже упоминалось, эта архитектура начальной используется архитектура прямой обмен данными клиента микрослужбу, это означает, что клиентское приложение могут напрямую выполнять запросы к каждому микрослужбами. Каждый микрослужбу имеет общедоступную конечную точку как https://servicename.applicationname.companyname. При необходимости каждый микрослужбу можно использовать другие TCP-порты. В рабочей среде, что URL-адреса будут сопоставлены микрослужбами подсистемы балансировки нагрузки, что распределение запросов между микрослужбу доступных экземпляров.

**Важное примечание на виртуальном сервере шлюза API. Прямая связь в eShopOnContainers.** Как описано в разделе "Архитектура" данного руководства, архитектура прямой обмен данными клиента микрослужбу может иметь недостатки при построении больших и сложных микрослужбу приложением. Но это может быть подходят для небольших приложений, таких как в eShopOnContainers запуска приложения, где предназначена для того, чтобы сосредоточиться на более простые получении приложением контейнера Docker, и мы не хотим создайте один шлюз монолитные API, может повлиять на автономность разработки микрослужбами.

Однако, если планируется разработка большого приложения на основе микрослужбу с множеством микрослужбами настоятельно рекомендуется рассмотреть шаблоне шлюза API, как описано в разделе архитектуры.
Это решение архитектуры удалось провести оптимизацию кода после размышления о рабочей среде приложений и специально внесенные видов для удаленных клиентов. Наличие нескольких шлюзов пользовательского API в зависимости от клиентских приложений форм фактора обеспечивает преимущества в отношении статистической обработки данных в клиентское приложение, а также можно скрыть внутренние микрослужбами или API-интерфейсы для клиентских приложений и авторизации в нем один. 

Тем не менее, а также как сказано выше Учтите, что для больших и монолитные шлюзы API, может завершать вашей микрослужбами автономность разработки.

### <a name="data-sovereignty-per-microservice"></a>Независимости данных на микрослужбу

В примере приложения каждого микрослужбу владеет свою собственную базу данных или источник данных и каждой базы данных или источник данных развертывается как другой контейнер. Это было сделано только для того, чтобы облегчить разработчику получить код из GitHub, Клонирует его и откройте его в Visual Studio или Visual Studio Code. Либо, кроме того, он позволяет легко скомпилировать пользовательских образов Docker, с помощью .NET Core CLI и Docker CLI, а затем развернуть и запустить их в среде разработки Docker. В любом случае использование контейнеров для данных источников позволяет разработчикам построить и развернуть в течение нескольких минут, без необходимости применять внешней базы данных или любой другой источник данных с жестких зависимостей от инфраструктуры (облаке или локально).

В реальной рабочей среде, для обеспечения высокой доступности и масштабируемости баз данных должно быть основано на серверах баз данных в облаке или в локальной среде, но не в контейнеры.

Таким образом единицы развертывания для микрослужбами (и даже для баз данных в этом приложении) представляют собой контейнеры Docker, а приложение ссылку — приложение несколькими контейнера, который охватывает микрослужбами принципы.

### <a name="additional-resources"></a>Дополнительные ресурсы

-   **eShopOnContainers в репозитории GitHub. Исходный код для приложения ссылку**
    *https://aka.ms/eShopOnContainers/*

## <a name="benefits-of-a-microservice-based-solution"></a>Преимущества решения на основе микрослужбу

Подобное решение на основе микрослужбу имеет множество преимуществ:

**Каждый микрослужбу относительно невелико, простую в управлении развивать**. В частности:

-   Можно легко разработчику для понимания и быстро приступить к работе с хорошей производительности.

-   Руководство по контейнерам быстрых, что делает разработчикам повысить производительность.

-   Интегрированная среда разработки, как Visual Studio может загружать небольших проектов быстро, делая производительности труда разработчиков.

-   Каждый микрослужбу можно предназначены, разработки и развертывания независимо от других микрослужбами, который обеспечивает гибкость, так как это облегчает развертывание новых версий микрослужбами часто.

**Можно масштабировать отдельным областям приложения**. Для экземпляра службы каталогов или корзины службы может потребоваться расширить, но не упорядочивания процесс. Инфраструктура микрослужбами будет намного более эффективным с точки зрения ресурсов, используемых при горизонтального масштабирования, чем бы монолитные архитектуры.

**Можно разделить работу между несколькими командами разработки**. Каждая служба может принадлежать одной командой. Каждая команда может управлять, разрабатывать, развертывать и масштабировать свои службы независимо от остальная часть команды.

**Вопросы, более изолированная**. Если в одной службе имеется проблема, только эту службу изначально влияет (за исключением неверного разработки вместе, с прямой зависимости между микрослужбами), и другие службы может продолжать обрабатывать запросы. Напротив один неработающий компонент в архитектуре монолитные развертывания можно привести к остановке всей системы, особенно в том случае, если он содержит ресурсы, такие как утечки памяти. Кроме того после устранения проблемы в микрослужбу, можно развернуть только затронутые микрослужбу без ущерба для остальной части приложения.

**Можно использовать новейшие технологии**. Так как можно начать разработку службы независимо друг от друга и запускать их рядом друг с другом (благодаря контейнеры и .NET Core), можно приступить к использованию последних технологий и платформ expediently вместо заблокированных в старое стека или платформа для целого приложение.

## <a name="downsides-of-a-microservice-based-solution"></a>Отрицательные стороны решение на основе микрослужбу

Подобное решение на основе микрослужбу также есть некоторые недостатки:

**Распределенное приложение**. Распространение приложения усложняет для разработчиков при разработке и построении служб. Например должны реализовать разработчики interservice связи, используя протоколы, например HTTP или AMPQ, это вносит дополнительную сложность для тестирования и обработка исключений. Он также приводит к увеличению задержки в системе.

**Сложность развертывания**. Приложение, которое имеет множество типов микрослужбами и требуется высокий уровень масштабируемости (он должен иметь возможность создавать большое количество экземпляров каждой службы и сбалансировать эти службы много узлов) означает высокую степень сложности развертывания для ИТ-операций и управления. Если не используется микрослужбу ориентированного инфраструктуру (например, orchestrator и планировщик), что дополнительные сложности может потребоваться гораздо более разработку, чем само приложение бизнеса.

**Атомарные транзакции**. Атомарные транзакции между несколькими микрослужбами обычно невозможны. Принять окончательной согласованности между несколькими микрослужбами иметь бизнес-требований.

**Увеличение потребностей глобальных ресурсов** (общий объем памяти, дисков и сетевые ресурсы для всех серверов или узлов). Во многих случаях при замене монолитные приложения подход микрослужбами объем глобальных ресурсов, используемых в новое приложение на основе микрослужбу будут больше потребностями монолитные исходного приложения. Это вызвано более высокий уровень детализации и распределенных служб требует больше ресурсов. Тем не менее, низкой стоимости ресурсов в целом и преимуществом является возможность масштабирования только определенные части приложения, по сравнению с долгосрочной затраты при разработке приложений монолитные, увеличение использования ресурсов задан обычно хороший баланс для больших, долгосрочное приложения.

**Проблемы связи прямой client‑to‑microservice**. Приложение имеет большой размер, с помощью десятков микрослужбами, при проблемы и ограничения, если приложение требует прямого соединения клиента микрослужбу. Одна из проблем является возможное несоответствие между потребностям клиента и API-интерфейсы, предоставляемые каждым микрослужбами. В некоторых случаях клиентское приложение может потребоваться внести много отдельных запросов для создания пользовательского интерфейса, которой может оказаться неэффективным в Интернете и практично через мобильной сети. Таким образом запросы от клиентского приложения в обслуживающей системе должно быть минимальным.

Другая проблема с прямой связи клиента микрослужбу — что некоторые микрослужбами может использовать протоколы, которые не являются веб развертывания. Одна служба может использовать двоичный протокол, пока другая служба может использовать AMQP обмена сообщениями. Эти протоколы не являются firewall‑friendly и лучше всего использовать внутренним образом. Как правило в приложении необходимо использовать протоколы, такие как HTTP и WebSockets для связи за пределами брандмауэра.

Еще другим недостатком этого подхода прямой client‑to‑service — что он затрудняет рефакторинг контракты, для этих микрослужбами. Со временем разработчикам может потребоваться изменить, как система секционируется на службы. Например может объединить две службы или разбить на две или несколько служб, службы. Тем не менее если клиенты взаимодействуют напрямую с помощью служб, выполнение такого рода рефакторинга могут нарушить совместимость с приложениями клиента.

Как упоминалось в разделе «архитектура» при разработке и построении сложного приложения с учетом микрослужбами, может потребоваться использование нескольких шлюзов детально API вместо более простой подход client‑to‑microservice прямой связи.

**Секционирование микрослужбами**. Наконец независимо от выбранного подхода микрослужбу архитектуре, разбиение на разделы для готовое приложение в нескольких микрослужбами выбирают еще одна проблема. Как упоминалось в разделе руководства по архитектуре, существует несколько методов и подходов, которые можно предпринять. По сути необходимо определить области приложения, связаны с другим областям и имеют небольшое количество жестких зависимостей. Во многих случаях это согласуется с секционированием служб в варианте использования. Например в приложении e — центр у нас есть службу порядка сортировки, отвечающий за бизнес-логики, относящиеся к процессу заказа. У нас также есть службы каталогов и корзины, реализации других возможностей. В идеальном случае каждая служба должна иметь только небольшому числу обязанности. Это похоже на одном ответственности (SRP) применяется к классам, которое подтверждает, что класс должен иметь только одна из причин для изменения. Однако в этом случае она связана с микрослужбами, поэтому область будет больше, чем один класс. Чаще всего микрослужбу должен быть полностью автономными, сквозного, включая ответственность за источниками данных.

## <a name="external-versus-internal-architecture-and-design-patterns"></a>Внешние и внутренние и архитектурные шаблоны

Внешней архитектуры — архитектура микрослужбу, состоящие несколько службой следующие принципы, описанные в разделе "Архитектура" данного руководства. Тем не менее, в зависимости от характера каждого микрослужбу, а также независимо от архитектуры высокого уровня микрослужбу выборе распространено и иногда рекомендуется иметь внутренние архитектур, каждый исходя различные шаблоны для различных микрослужбами. Микрослужбами с помощью различных технологий и языков программирования. На рисунке 8-2 показано этого разнообразия.

![](./media/image2.png)

**Рис. 8-2**. Внешней и внутренней архитектуры и проектирования

Для экземпляра, в нашей *eShopOnContainers* простой образец каталога, корзины и пользователь микрослужбами профиля (по сути, подсистемы CRUD). Таким образом их внутренней архитектуры и разработки достаточно прост. Тем не менее могут появиться другие микрослужбами, такие как упорядочивания микрослужбу, который является более сложной и представляет постоянно меняющихся бизнес-правила с высокой степенью сложности для домена. В подобных случаях может потребоваться реализовать более сложные шаблоны в пределах определенного микрослужбу, имеющий методы разработки на основе домена (DDD), как это делается аналогичных *eShopOnContainers* упорядочение микрослужбы. (Мы рассмотрим эти шаблоны DDD в разделе ниже описывается реализация *eShopOnContainers* упорядочение микрослужбу.)

Другая причина возникновения различных технологий на микрослужбу может быть характер каждого микрослужбы. Например, возможно, лучше было бы использовать функциональный язык программирования, как F\#, или языка, например R, даже если вы используете AI и машинное обучение доменов, а не в объектно ориентированного программирования код C\#.

В конечном счете является то, что каждый микрослужбу можно другой внутренней архитектуры на основе шаблонов, другую структуру. Не все микрослужбами следует реализовать с помощью дополнительных шаблонов ддд, поскольку, может чрезмерно инженерные их. Точно так же как компоненты CRUD не следует реализовывать сложные микрослужбами с постоянно меняющихся бизнес-логики или иначе может оказаться низкое качество кода.



## <a name="the-new-world-multiple-architectural-patterns-and-polyglot-microservices"></a>Новый мир: несколько архитектурные шаблоны и polyglot микрослужбами

Существует много архитектурные шаблоны, используемые архитекторов и разработчиков. Ниже приведены некоторые (смешивание архитектура стили и шаблоны архитектуры):

-   Простой CRUD, среднего уровня одного уровня.

-   [Традиционные многоуровневая N](https://msdn.microsoft.com/en-us/library/ee658109.aspx#Layers).

-   [Домен Driven Design многоуровневая N](https://blogs.msdn.microsoft.com/cesardelatorre/2011/07/03/published-first-alpha-version-of-domain-oriented-n-layered-architecture-v2-0/).

-   [Очистка архитектура](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html) (как при использовании [eShopOnWeb](http://aka.ms/WebAppArchitecture))

-   [Команды и запроса разделение ответственности](https://martinfowler.com/bliki/CQRS.html) (CQRS).

-   [Архитектура обработки событий](https://en.wikipedia.org/wiki/Event-driven_architecture) (EDA).

Можно также создать микрослужбами с множеством технологий и языки, такие как веб-API ASP.NET Core, NancyFx, ASP.NET SignalR Core (предусмотрено в .NET Core 2), F\#, Node.js, Python, Java, C++, GoLang и многое другое.

Важно то, ни одному из шаблонов конкретной архитектуры или стиля, а также любой конкретной технологии подходит для всех случаев. Рис. 8-3 показывает некоторые подходы и технологии (не в любом порядке) может использоваться в различных микрослужбами.

![](./media/image3.png)

**Рис. 8-3**. Шаблоны нескольких архитектуры и world polyglot микрослужбами

Как показано на рис. 8-3, в приложениях, состоящий из многих микрослужбами (ограниченная контекстов в терминологии разработки на основе домена, или просто «подсистемы» как автономные микрослужбами), могут реализовывать каждый микрослужбу по-разному. Каждый может будет иметь другую архитектуру и использовать различные языки и баз данных в зависимости от характера приложения, бизнес-требований и определение приоритетов. В некоторых случаях может выглядеть микрослужбами. Но это не является обычно так, поскольку обычно отличаются границы контекста и требования к каждой подсистемы.

Для экземпляра для простого приложения CRUD обслуживания, не смысл для разработки и реализации DDD шаблонов. Однако основной домен или core бизнеса, может потребоваться применить более сложные шаблоны для решать сложную задачу бизнеса постоянно меняющихся бизнес-правила.

Особенно при использовании крупных приложений, сформирован несколько подсистем, не следует применять одной архитектуры верхнего уровня на основе шаблона одной архитектуры. Например CQRS не должна применяться как архитектура верхнего уровня для всего приложения, но может оказаться полезным для определенной группы служб.

Нет, не панацеей или шаблон правой архитектура каждом конкретном случае. Не может быть «один архитектура шаблон, чтобы исключить их все.» В зависимости от приоритета каждого микрослужбу вы должны выбрать другой подход для каждой из них, как описано в следующих разделах.


>[!div class="step-by-step"]
[Предыдущие] (index.md) [Далее] (данные управляемых crud-microservice.md)
