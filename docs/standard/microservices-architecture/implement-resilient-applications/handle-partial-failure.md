---
title: Обработка частичного сбоя
description: Архитектура микрослужб .NET для упакованных в контейнеры приложений .NET | Обработка частичного сбоя
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.openlocfilehash: 957a0b1b8b4d217fac591db54e4ee053098bc7da
ms.sourcegitcommit: 979597cd8055534b63d2c6ee8322938a27d0c87b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/29/2018
ms.locfileid: "37105199"
---
# <a name="handling-partial-failure"></a>Обработка частичного сбоя

В распределенных системах, таких как приложения на базе микрослужб, всегда существует риск частичного сбоя. Например, одна микрослужба или контейнер могут отказать или не отвечать какое-то время или одна виртуальная машина или сервер могут дать сбой. Поскольку клиенты и службы являются отдельными процессами, служба может не ответить вовремя на запрос клиента. Служба может быть перегружена, очень медленно отвечать на запросы, быть недоступна некоторое время из-за проблем в сети.

Рассмотрим страницу сведений о заказе в примере приложения eShopOnContainers. Если микрослужба заказа не отвечает при попытке оформить заказ, в результате неправильного применения клиентского процесса (веб-приложения MVC) — например, если код клиента должен был использовать синхронные RPC без установленного времени ожидания — потоки будут заблокированы в ожидании ответа на неопределенное время. Во-первых, клиент будет недоволен, а во-вторых, долгое ожидание занимает или блокирует поток, а потоки очень важны для масштабируемых приложений. Если заблокированных потоков много, в конце концов в среде выполнения приложения их не останется. В этом случае приложение перестанет отвечать на запросы вовсе, а не частично, как показано на рисунке 10-1.

![](./media/image1.png)

**Рис. 10-1**. Частичные сбои из-за зависимостей, влияющих на доступность потоков службы

В крупных приложениях на базе микрослужб частичные сбои могут быть более масштабными, особенно если взаимодействие с внутренними микрослужбами по большей части основано на синхронных вызовах HTTP (что считается антишаблоном). Представьте себе, что система получает миллионы входящих вызовов в день. Если система неправильно спроектирована и базируется на длинных цепочках синхронных вызовов HTTP, эти входящие вызовы могут превратиться в еще большее количество исходящих вызовов (предположим, в соотношении 1:4) в десятки внутренних микрослужб в качестве синхронных зависимостей. Эта ситуация, особенно зависимости, показана на рисунке 10-2 \#3.

![](./media/image2.png)

**Рис. 10-2**. Последствия построения неверной конструкции с длинными цепочками HTTP-запросов

Периодические сбои неизбежны в распределенной и облачной системе, даже если каждая зависимость в отдельности хорошо доступна. Этот факт необходимо учитывать.

Если вы не разрабатываете и не реализуете меры обеспечения отказоустойчивости, даже небольшие простои могут увеличиваться. Например, 50 зависимостей с доступностью 99,99 % — это несколько часов простоя в месяц в результате такого волнового эффекта. В случае сбоя зависимости от микрослужбы при обработке большого количества запросов этот сбой может заполнить все доступные потоки запросов в каждой службе и привести к отказу всего приложения.

![](./media/image3.png)

**Рис. 10-3**. Частичный сбой, усиленный микрослужбами с длинными цепочками синхронных вызовов HTTP

Чтобы свести к минимуму эту проблему, в разделе "*Асинхронная интеграция микрослужб приводит к автономности микрослужбы*" (в главе об архитектуре) мы рекомендуем использовать асинхронную связь с внутренними микрослужбами. В следующем разделе вы можете ознакомиться с дополнительной информацией.

Кроме того, вам необходимо разрабатывать микрослужбы и клиентские приложения с учетом возможности частичных сбоев — то есть создавать устойчивые микрослужбы и клиентские приложения.


>[!div class="step-by-step"]
[Назад](index.md)
[Вперед](partial-failure-strategies.md)
