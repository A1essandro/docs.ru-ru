---
title: "Частичный сбой обработки"
description: "Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Частичный сбой обработки"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: b7d16acf3de2d395da70e8f46e59c129dec24f71
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="handling-partial-failure"></a><span data-ttu-id="90aa5-104">Частичный сбой обработки</span><span class="sxs-lookup"><span data-stu-id="90aa5-104">Handling partial failure</span></span>

<span data-ttu-id="90aa5-105">В распределенных систем, как приложения на основе микрослужбами имеется штат постоянно риск частичных сбоев.</span><span class="sxs-lookup"><span data-stu-id="90aa5-105">In distributed systems like microservices-based applications, there is an ever-present risk of partial failure.</span></span> <span data-ttu-id="90aa5-106">Для экземпляра одного микрослужбу или контейнер может завершиться ошибкой или могут быть недоступны реагировать в течение некоторого времени или одной виртуальной Машины или сервере может завершиться со сбоем.</span><span class="sxs-lookup"><span data-stu-id="90aa5-106">For instance, a single microservice/container can fail or might not be available to respond for a short time, or a single VM or server can crash.</span></span> <span data-ttu-id="90aa5-107">Поскольку клиенты и службы являются отдельными процессами, служба может не иметь возможность своевременный отклик на запрос клиента.</span><span class="sxs-lookup"><span data-stu-id="90aa5-107">Since clients and services are separate processes, a service might not be able to respond in a timely way to a client’s request.</span></span> <span data-ttu-id="90aa5-108">Служба перегруженных и отвечает на запросы очень медленно для запросов может быть или просто будут недоступны в течение некоторого времени из-за сетевых проблем.</span><span class="sxs-lookup"><span data-stu-id="90aa5-108">The service might be overloaded and responding extremely slowly to requests, or might simply not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="90aa5-109">Например рассмотрим странице сведений о порядке из eShopOnContainers образца приложения.</span><span class="sxs-lookup"><span data-stu-id="90aa5-109">For example, consider the Order details page from the eShopOnContainers sample application.</span></span> <span data-ttu-id="90aa5-110">Если упорядочивания микрослужбу не отвечает при попытке оформить заказ, неправильной реализацией процесс клиента (веб-приложения MVC) — например, если код клиента для использования синхронных вызовов RPC в течение неограниченного времени — будет выполняться бесконечно потоков Ожидание ответа.</span><span class="sxs-lookup"><span data-stu-id="90aa5-110">If the ordering microservice is unresponsive when the user tries to submit an order, a bad implementation of the client process (the MVC web application)—for example, if the client code were to use synchronous RPCs with no timeout—would block threads indefinitely waiting for a response.</span></span> <span data-ttu-id="90aa5-111">Помимо создания неприятной ситуации, каждый отвечать на запросы ожидания использует или блокирует поток и потоков, особо важных высокомасштабируемых приложений.</span><span class="sxs-lookup"><span data-stu-id="90aa5-111">In addition to creating a bad user experience, every unresponsive wait consumes or blocks a thread, and threads are extremely valuable in highly scalable applications.</span></span> <span data-ttu-id="90aa5-112">При наличии множества заблокированных потоков в конечном итоге выполнения приложения может закончиться потоков.</span><span class="sxs-lookup"><span data-stu-id="90aa5-112">If there are many blocked threads, eventually the application’s runtime can run out of threads.</span></span> <span data-ttu-id="90aa5-113">В этом случае приложение может стать глобально отвечать на запросы, а не только частично отвечать на запросы, как показано на рисунке 10-1.</span><span class="sxs-lookup"><span data-stu-id="90aa5-113">In that case, the application can become globally unresponsive instead of just partially unresponsive, as show in Figure 10-1.</span></span>

![](./media/image1.png)

<span data-ttu-id="90aa5-114">**Рис. 10-1**.</span><span class="sxs-lookup"><span data-stu-id="90aa5-114">**Figure 10-1**.</span></span> <span data-ttu-id="90aa5-115">Частичные сбои из-за зависимостей, влиять на доступность службы потоков</span><span class="sxs-lookup"><span data-stu-id="90aa5-115">Partial failures because of dependencies that impact service thread availability</span></span>

<span data-ttu-id="90aa5-116">В больших микрослужбами приложением любые частичные сбои могут усилению, особенно в том случае, если большая часть взаимодействия внутренней микрослужбами основана на синхронные вызовы HTTP (которые считается антишаблон).</span><span class="sxs-lookup"><span data-stu-id="90aa5-116">In a large microservices-based application, any partial failure can be amplified, especially if most of the internal microservices interaction is based on synchronous HTTP calls (which is considered an anti-pattern).</span></span> <span data-ttu-id="90aa5-117">Подумайте о системе, получающего миллионы входящих вызовов в день.</span><span class="sxs-lookup"><span data-stu-id="90aa5-117">Think about a system that receives millions of incoming calls per day.</span></span> <span data-ttu-id="90aa5-118">Системы имеет неправильный вид, который основан на длинных цепочек синхронные вызовы HTTP, эти входящих вызовов может привести дополнительные миллионы исходящих вызовов (давайте предположим, что отношение 1:4) с десятками внутренней микрослужбами как синхронный зависимости.</span><span class="sxs-lookup"><span data-stu-id="90aa5-118">If your system has a bad design that is based on long chains of synchronous HTTP calls, these incoming calls might result in many more millions of outgoing calls (let’s suppose a ratio of 1:4) to dozens of internal microservices as synchronous dependencies.</span></span> <span data-ttu-id="90aa5-119">Это показано на рисунке 10-2, особенно зависимостей \#3.</span><span class="sxs-lookup"><span data-stu-id="90aa5-119">This situation is shown in Figure 10-2, especially dependency \#3.</span></span>

![](./media/image2.png)

<span data-ttu-id="90aa5-120">**На рис. 10-2**.</span><span class="sxs-lookup"><span data-stu-id="90aa5-120">**Figure 10-2**.</span></span> <span data-ttu-id="90aa5-121">Последствия неверный подход, при добавлении длинных цепочек HTTP-запросов</span><span class="sxs-lookup"><span data-stu-id="90aa5-121">The impact of having an incorrect design featuring long chains of HTTP requests</span></span>

<span data-ttu-id="90aa5-122">Периодические сбои практически не гарантируется в распределенной и облака на основе системы, даже если у каждой зависимости, сам отлично доступности.</span><span class="sxs-lookup"><span data-stu-id="90aa5-122">Intermittent failure is virtually guaranteed in a distributed and cloud based system, even if every dependency itself has excellent availability.</span></span> <span data-ttu-id="90aa5-123">Это должна быть фактов, которые следует принять во внимание.</span><span class="sxs-lookup"><span data-stu-id="90aa5-123">This should be a fact you need to consider.</span></span>

<span data-ttu-id="90aa5-124">Если не разработать и реализовать методы, чтобы обеспечить отказоустойчивость, можно усиливаться даже небольшое время простоя.</span><span class="sxs-lookup"><span data-stu-id="90aa5-124">If you do not design and implement techniques to ensure fault tolerance, even small downtimes can be amplified.</span></span> <span data-ttu-id="90aa5-125">Например 50 зависимости с 99,99% доступности приведет к несколько часов простоя каждого месяца из-за этого оказывает влияние.</span><span class="sxs-lookup"><span data-stu-id="90aa5-125">As an example, 50 dependencies each with 99.99% of availability would result in several hours of downtime each month because of this ripple effect.</span></span> <span data-ttu-id="90aa5-126">При обработке большого числа запросов в случае сбоя микрослужбу зависимость, сбой могут быстро насытить все потоки доступного запроса в каждой службы и сбой всего приложения.</span><span class="sxs-lookup"><span data-stu-id="90aa5-126">When a microservice dependency fails while handling a high volume of requests, that failure can quickly saturate all available request threads in each service and crash the whole application.</span></span>

![](./media/image3.png)

<span data-ttu-id="90aa5-127">**На рис. 10-3**.</span><span class="sxs-lookup"><span data-stu-id="90aa5-127">**Figure 10-3**.</span></span> <span data-ttu-id="90aa5-128">Частичный сбой усиливаться по микрослужбами с длинным цепочкам синхронных вызовов HTTP</span><span class="sxs-lookup"><span data-stu-id="90aa5-128">Partial failure amplified by microservices with long chains of synchronous HTTP calls</span></span>

<span data-ttu-id="90aa5-129">Чтобы свести к минимуму эту проблему, в разделе «*асинхронной микрослужбу интеграции применять его микрослужбу автономность*» (в главе архитектуры), мы рекомендуется использовать асинхронную связь между внутренней микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="90aa5-129">To minimize this problem, in the section "*Asynchronous microservice integration enforce microservice’s autonomy*” (in the architecture chapter), we encouraged you to use asynchronous communication across the internal microservices.</span></span> <span data-ttu-id="90aa5-130">Мы кратко описаны более в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="90aa5-130">We briefly explain more in the next section.</span></span>

<span data-ttu-id="90aa5-131">Кроме того, очень важно разработать микрослужбами и клиентские приложения для обработки частичных сбоев — то есть для создания гибкой микрослужбами и клиентских приложений.</span><span class="sxs-lookup"><span data-stu-id="90aa5-131">In addition, it is essential that you design your microservices and client applications to handle partial failures—that is, to build resilient microservices and client applications.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="90aa5-132">[Предыдущие] (index.md) [Далее] (частичного сбоя strategies.md)</span><span class="sxs-lookup"><span data-stu-id="90aa5-132">[Previous] (index.md) [Next] (partial-failure-strategies.md)</span></span>
