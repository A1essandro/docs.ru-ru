---
title: "Проектирование модели домена микрослужбу"
description: "Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Проектирование модели домена микрослужбу"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 455a2c5a39fb9b765b557610ab108f8c75882dbd
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="designing-a-microservice-domain-model"></a><span data-ttu-id="8584c-104">Проектирование модели домена микрослужбу</span><span class="sxs-lookup"><span data-stu-id="8584c-104">Designing a microservice domain model</span></span>

<span data-ttu-id="8584c-105">*Определить одну модель расширенный домен для каждого микрослужбу бизнеса или ограниченного контекста*</span><span class="sxs-lookup"><span data-stu-id="8584c-105">*Define one rich domain model for each business microservice or Bounded Context*</span></span>

<span data-ttu-id="8584c-106">Задача — Создание целостного однодоменным модели для каждого микрослужбу бизнеса или ограниченного контекста (BC).</span><span class="sxs-lookup"><span data-stu-id="8584c-106">Your goal is to create a single cohesive domain model for each business microservice or Bounded Context (BC).</span></span> <span data-ttu-id="8584c-107">Имейте в виду, однако, BC или business микрослужбу иногда может состоять из нескольких физических служб, совместно использующих один домен модели.</span><span class="sxs-lookup"><span data-stu-id="8584c-107">Keep in mind, however, that a BC or business microservice could sometimes be composed of several physical services that share a single domain model.</span></span> <span data-ttu-id="8584c-108">Модель домена должно записать правила, поведение, язык бизнеса и ограничения для одного контекста ограниченных или микрослужбу бизнес, который он представляет.</span><span class="sxs-lookup"><span data-stu-id="8584c-108">The domain model must capture the rules, behavior, business language, and constraints of the single Bounded Context or business microservice that it represents.</span></span>

## <a name="the-domain-entity-pattern"></a><span data-ttu-id="8584c-109">Шаблон сущности домена</span><span class="sxs-lookup"><span data-stu-id="8584c-109">The Domain Entity pattern</span></span>

<span data-ttu-id="8584c-110">Сущности представляют объекты домена и в основном определены свои удостоверения, обеспечения непрерывности и сохраняемости со временем, а не только атрибуты, которые составляют их.</span><span class="sxs-lookup"><span data-stu-id="8584c-110">Entities represent domain objects and are primarily defined by their identity, continuity, and persistence over time, and not only by the attributes that comprise them.</span></span> <span data-ttu-id="8584c-111">Как Eric Evans говорит: «объект, определенный в первую очередь по идентификатору вызывается сущности.»</span><span class="sxs-lookup"><span data-stu-id="8584c-111">As Eric Evans says, “an object primarily defined by its identity is called an Entity.”</span></span> <span data-ttu-id="8584c-112">Сущности являются очень важно для модели домена, поскольку они являются основой для модели.</span><span class="sxs-lookup"><span data-stu-id="8584c-112">Entities are very important in the domain model, since they are the base for a model.</span></span> <span data-ttu-id="8584c-113">Таким образом необходимо определить и разрабатывать их внимательно.</span><span class="sxs-lookup"><span data-stu-id="8584c-113">Therefore, you should identify and design them carefully.</span></span>

<span data-ttu-id="8584c-114">*Удостоверение сущности может пересекать несколько микрослужбами или ограниченных контекстах.*</span><span class="sxs-lookup"><span data-stu-id="8584c-114">*An entity’s identity can cross multiple microservices or Bounded Contexts.*</span></span>

<span data-ttu-id="8584c-115">То же удостоверение (хотя и не той же сущности) могут задаваться в нескольких контекстах ограниченных или микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="8584c-115">The same identity (though not the same entity) can be modeled across multiple Bounded Contexts or microservices.</span></span> <span data-ttu-id="8584c-116">Однако, не означает, что одной сущности, с теми же атрибутами и логику будут реализованы в нескольких контекстах, ограниченное.</span><span class="sxs-lookup"><span data-stu-id="8584c-116">However, that does not imply that the same entity, with the same attributes and logic would be implemented in multiple Bounded Contexts.</span></span> <span data-ttu-id="8584c-117">Вместо этого сущностей в каждом контексте ограниченных ограничить их атрибуты и поведения этих необходимым в контексте, ограниченных домена.</span><span class="sxs-lookup"><span data-stu-id="8584c-117">Instead, entities in each Bounded Context limit their attributes and behaviors to those required in that Bounded Context’s domain.</span></span>

<span data-ttu-id="8584c-118">Для экземпляра сущности покупатель, могут иметься большинство человека атрибуты, которые определены в сущности микрослужбу профиля или удостоверение, включая удостоверение пользователя.</span><span class="sxs-lookup"><span data-stu-id="8584c-118">For instance, the buyer entity might have most of a person’s attributes that are defined in the user entity in the profile or identity microservice, including the identity.</span></span> <span data-ttu-id="8584c-119">Но покупатель сущности в микрослужбу порядка сортировки может быть меньше атрибутов так, как только определенные данные покупателя, связанных с обработки заказа.</span><span class="sxs-lookup"><span data-stu-id="8584c-119">But the buyer entity in the ordering microservice might have fewer attributes, because only certain buyer data is related to the order process.</span></span> <span data-ttu-id="8584c-120">Контекст каждого микрослужбу или ограниченного контекста влияет на его модели домена.</span><span class="sxs-lookup"><span data-stu-id="8584c-120">The context of each microservice or Bounded Context impacts its domain model.</span></span>

<span data-ttu-id="8584c-121">*Сущности домена необходимо реализовать поведение помимо данных атрибутов*</span><span class="sxs-lookup"><span data-stu-id="8584c-121">*Domain entities must implement behavior in addition to implementing data attributes*</span></span>

<span data-ttu-id="8584c-122">Сущность домена в DDD необходимо реализовать логику домена или поведения, связанные с данными сущности (объект, к которому в памяти).</span><span class="sxs-lookup"><span data-stu-id="8584c-122">A domain entity in DDD must implement the domain logic or behavior related to the entity data (the object accessed in memory).</span></span> <span data-ttu-id="8584c-123">Например как часть класса сущности order должны иметь бизнес-логики и операций, которые реализованы как методы для задач, таких как добавление элемента заказа, проверка данных и общее расчет.</span><span class="sxs-lookup"><span data-stu-id="8584c-123">For example, as part of an order entity class you must have business logic and operations implemented as methods for tasks such as adding an order item, data validation, and total calculation.</span></span> <span data-ttu-id="8584c-124">Методы сущности аккуратно правил сущности, вместо того, эти правила, которые распределены на уровне приложения и инварианты.</span><span class="sxs-lookup"><span data-stu-id="8584c-124">The entity’s methods take care of the invariants and rules of the entity instead of having those rules spread across the application layer.</span></span>

<span data-ttu-id="8584c-125">Рис. 9-8 показана сущности домена, реализующая не только атрибуты данных, но операции и методов, имеющих связанные доменную логику.</span><span class="sxs-lookup"><span data-stu-id="8584c-125">Figure 9-8 shows a domain entity that implements not only data attributes but operations or methods with related domain logic.</span></span>

![](./media/image9.png)

<span data-ttu-id="8584c-126">**Рис. 9-8**.</span><span class="sxs-lookup"><span data-stu-id="8584c-126">**Figure 9-8**.</span></span> <span data-ttu-id="8584c-127">Пример схемы домена сущности, реализация данных, а также поведение</span><span class="sxs-lookup"><span data-stu-id="8584c-127">Example of a domain entity design implementing data plus behavior</span></span>

<span data-ttu-id="8584c-128">Конечно иногда может иметь сущностей, которые не реализуют логику в рамках класса сущностей.</span><span class="sxs-lookup"><span data-stu-id="8584c-128">Of course, sometimes you can have entities that do not implement any logic as part of the entity class.</span></span> <span data-ttu-id="8584c-129">Это может произойти в дочерних сущностей в агрегатную функцию, если дочерней сущности не имеет каких-либо алгоритмов, так как большую часть логики определяется в корне статистические.</span><span class="sxs-lookup"><span data-stu-id="8584c-129">This can happen in child entities within an aggregate if the child entity does not have any special logic because most of the logic is defined in the aggregate root.</span></span> <span data-ttu-id="8584c-130">При наличии сложных микрослужбу, со значительным логику, реализуемую службы вместо в классах сущностей домена может передачи управления в модель anemic домена, подробно описан в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="8584c-130">If you have a complex microservice that has a lot of logic implemented in the service classes instead of in the domain entities, you could be falling into the anemic domain model, explained in the following section.</span></span>

### <a name="rich-domain-model-versus-anemic-domain-model"></a><span data-ttu-id="8584c-131">Модель домена Rich и anemic доменную модель</span><span class="sxs-lookup"><span data-stu-id="8584c-131">Rich domain model versus anemic domain model</span></span>

<span data-ttu-id="8584c-132">В его post [AnemicDomainModel](https://martinfowler.com/bliki/AnemicDomainModel.html), Martin Fowler описывает модель anemic домена таким образом:</span><span class="sxs-lookup"><span data-stu-id="8584c-132">In his post [AnemicDomainModel](https://martinfowler.com/bliki/AnemicDomainModel.html), Martin Fowler describes an anemic domain model this way:</span></span>

<span data-ttu-id="8584c-133">Основные Признак Anemic модели домена заключается в том, что на первый взгляд выглядит как подлинные.</span><span class="sxs-lookup"><span data-stu-id="8584c-133">The basic symptom of an Anemic Domain Model is that at first blush it looks like the real thing.</span></span> <span data-ttu-id="8584c-134">Нет объектов, многие именам существительным в пространстве домена и эти объекты связаны с широкие возможности связи и структуры, содержащих модели домена значение true.</span><span class="sxs-lookup"><span data-stu-id="8584c-134">There are objects, many named after the nouns in the domain space, and these objects are connected with the rich relationships and structure that true domain models have.</span></span> <span data-ttu-id="8584c-135">Catch с момента, когда взглянуть на поведение и вы понимаете, что вряд ли любого поведения на эти объекты становятся немного больше контейнеры методов get и set.</span><span class="sxs-lookup"><span data-stu-id="8584c-135">The catch comes when you look at the behavior, and you realize that there is hardly any behavior on these objects, making them little more than bags of getters and setters.</span></span>

<span data-ttu-id="8584c-136">Конечно, при использовании модели домена anemic этих моделей данных будет использоваться из набора объектов службы (традиционно именованный *бизнес-слое*) которого захватить все домена или бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="8584c-136">Of course, when you use an anemic domain model, those data models will be used from a set of service objects (traditionally named the *business layer*) which capture all the domain or business logic.</span></span> <span data-ttu-id="8584c-137">Бизнес-уровне располагается в верхней части модели данных и использует модель данных так же, как данные.</span><span class="sxs-lookup"><span data-stu-id="8584c-137">The business layer sits on top of the data model and uses the data model just as data.</span></span>

<span data-ttu-id="8584c-138">Модель домена anemic — просто процедурного стиля макета.</span><span class="sxs-lookup"><span data-stu-id="8584c-138">The anemic domain model is just a procedural style design.</span></span> <span data-ttu-id="8584c-139">Объекты anemic сущности не являются реальными объектами из-за отсутствия возможности (методы).</span><span class="sxs-lookup"><span data-stu-id="8584c-139">Anemic entity objects are not real objects because they lack behavior (methods).</span></span> <span data-ttu-id="8584c-140">Только они содержат свойства данных и таким образом не объектно ориентированный проект.</span><span class="sxs-lookup"><span data-stu-id="8584c-140">They only hold data properties and thus it is not object-oriented design.</span></span> <span data-ttu-id="8584c-141">Путем помещения поведение помещает в объекты служб (бизнес-уровне) по сути заканчивается [тестированию кода](https://en.wikipedia.org/wiki/Spaghetti_code) или [сценарии транзакции](https://martinfowler.com/eaaCatalog/transactionScript.html), и поэтому будут потеряны преимущества, модель домена предоставляет.</span><span class="sxs-lookup"><span data-stu-id="8584c-141">By putting all the behavior out into service objects (the business layer) you essentially end up with [spaghetti code](https://en.wikipedia.org/wiki/Spaghetti_code) or [transaction scripts](https://martinfowler.com/eaaCatalog/transactionScript.html), and therefore you lose the advantages that a domain model provides.</span></span>

<span data-ttu-id="8584c-142">Независимо от того, если микрослужбу или ограниченного контекста является очень простым anemic доменная модель в форме объектов сущностей с только что свойства данных вполне достаточно (CRUD service), и не может иметь смысл реализации более сложных шаблонов ддд.</span><span class="sxs-lookup"><span data-stu-id="8584c-142">Regardless, if your microservice or Bounded Context is very simple (a CRUD service), the anemic domain model in the form of entity objects with just data properties might be good enough, and it might not be worth implementing more complex DDD patterns.</span></span> <span data-ttu-id="8584c-143">В этом случае он будет просто сохраняемости модели, поскольку намеренно создания сущности с данными только для целей CRUD.</span><span class="sxs-lookup"><span data-stu-id="8584c-143">In that case, it will be simply a persistence model, because you have intentionally created an entity with only data for CRUD purposes.</span></span>

<span data-ttu-id="8584c-144">Именно поэтому архитектур микрослужбами идеально подходящие для нескольких архитектурный подход в зависимости от того, в каждом контексте ограниченных.</span><span class="sxs-lookup"><span data-stu-id="8584c-144">That is why microservices architectures are perfect for a multi-architectural approach depending on each Bounded Context.</span></span> <span data-ttu-id="8584c-145">Для экземпляра в eShopOnContainers, порядка сортировки микрослужбу реализует шаблоны ддд, а микрослужбу каталога, который представляет собой простую службу CRUD, нет.</span><span class="sxs-lookup"><span data-stu-id="8584c-145">For instance, in eShopOnContainers, the ordering microservice implements DDD patterns, but the catalog microservice, which is a simple CRUD service, does not.</span></span>

<span data-ttu-id="8584c-146">Некоторые лица сказать, что модель anemic домена является антишаблон.</span><span class="sxs-lookup"><span data-stu-id="8584c-146">Some people say that the anemic domain model is an anti-pattern.</span></span> <span data-ttu-id="8584c-147">Это зависит то, что при реализации.</span><span class="sxs-lookup"><span data-stu-id="8584c-147">It really depends on what you are implementing.</span></span> <span data-ttu-id="8584c-148">Если микрослужбу, создается простой достаточно (например, служба CRUD), не антишаблон модели anemic домена.</span><span class="sxs-lookup"><span data-stu-id="8584c-148">If the microservice you are creating is simple enough (for example, a CRUD service), following the anemic domain model it is not an anti-pattern.</span></span> <span data-ttu-id="8584c-149">Тем не менее если необходимо решать сложности микрослужбу домена со значительным постоянно меняющихся бизнес-правил, модель anemic домена может быть антишаблон для этого микрослужбу или ограниченного контекста.</span><span class="sxs-lookup"><span data-stu-id="8584c-149">However, if you need to tackle the complexity of a microservice’s domain that has a lot of ever-changing business rules, the anemic domain model might be an anti-pattern for that microservice or Bounded Context.</span></span> <span data-ttu-id="8584c-150">В этом случае проектирование его в виде форматированного модели с сущностями, содержащих данные, а также поведение, а также для реализации дополнительных шаблонов DDD (статистические выражения, значение объекты, т. д.) может иметь больших преимущества для долговременного успеха таких микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="8584c-150">In that case, designing it as a rich model with entities containing data plus behavior as well as implementing additional DDD patterns (aggregates, value objects, etc.) might have huge benefits for the long-term success of such a microservice.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="8584c-151">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="8584c-151">Additional resources</span></span>

-   <span data-ttu-id="8584c-152">**DevIQ. Сущность домена**
    [*http://deviq.com/entity/*](http://deviq.com/entity/)</span><span class="sxs-lookup"><span data-stu-id="8584c-152">**DevIQ. Domain Entity**
[*http://deviq.com/entity/*](http://deviq.com/entity/)</span></span>

-   <span data-ttu-id="8584c-153">**Мартин Фоулер (Martin Fowler). Модель домена**
    [*https://martinfowler.com/eaaCatalog/domainModel.html*](https://martinfowler.com/eaaCatalog/domainModel.html)</span><span class="sxs-lookup"><span data-stu-id="8584c-153">**Martin Fowler. The Domain Model**
[*https://martinfowler.com/eaaCatalog/domainModel.html*](https://martinfowler.com/eaaCatalog/domainModel.html)</span></span>

-   <span data-ttu-id="8584c-154">**Мартин Фоулер (Martin Fowler). Модель домена Anemic**</span><span class="sxs-lookup"><span data-stu-id="8584c-154">**Martin Fowler. The Anemic Domain Model**</span></span>

    <span data-ttu-id="8584c-155"><https://martinfowler.com/bliki/AnemicDomainModel.HTML></span><span class="sxs-lookup"><span data-stu-id="8584c-155"><https://martinfowler.com/bliki/AnemicDomainModel.html></span></span>

### <a name="the-value-object-pattern"></a><span data-ttu-id="8584c-156">Объект значения шаблона</span><span class="sxs-lookup"><span data-stu-id="8584c-156">The Value Object pattern</span></span>

<span data-ttu-id="8584c-157">Иное Eric Evans «многие объекты имеют концептуальной удостоверения.</span><span class="sxs-lookup"><span data-stu-id="8584c-157">As Eric Evans has noted, “Many objects do not have conceptual identity.</span></span> <span data-ttu-id="8584c-158">Эти объекты описывают характеристики вещь.»</span><span class="sxs-lookup"><span data-stu-id="8584c-158">These objects describe certain characteristics of a thing.”</span></span>

<span data-ttu-id="8584c-159">Сущности требуется удостоверение, но существует множество объектов в системе, которая не будет сделано, как шаблон значение объекта.</span><span class="sxs-lookup"><span data-stu-id="8584c-159">An entity requires an identity, but there are many objects in a system that do not, like the Value Object pattern.</span></span> <span data-ttu-id="8584c-160">Объект-значение представляет собой объект удостоверение не концептуальной, описывающий аспект домена.</span><span class="sxs-lookup"><span data-stu-id="8584c-160">A value object is an object with no conceptual identity that describes a domain aspect.</span></span> <span data-ttu-id="8584c-161">Данные элементы являются объектами, в которых можно создать для представления конструктора элементов интересующие только вас временно.</span><span class="sxs-lookup"><span data-stu-id="8584c-161">These are objects that you instantiate to represent design elements that only concern you temporarily.</span></span> <span data-ttu-id="8584c-162">Вас интересует *что* они не, *,* их.</span><span class="sxs-lookup"><span data-stu-id="8584c-162">You care about *what* they are, not *who* they are.</span></span> <span data-ttu-id="8584c-163">Примеры включают чисел и строк, но также может быть более высокого уровня понятия, такие как группы атрибутов.</span><span class="sxs-lookup"><span data-stu-id="8584c-163">Examples include numbers and strings, but can also be higher-level concepts like groups of attributes.</span></span>

<span data-ttu-id="8584c-164">То, что представляет собой сущность в микрослужбу может быть сущности в другом микрослужбу, поскольку во втором случае контекст ограниченных может иметь другое значение.</span><span class="sxs-lookup"><span data-stu-id="8584c-164">Something that is an entity in a microservice might not be an entity in another microservice, because in the second case, the Bounded Context might have a different meaning.</span></span> <span data-ttu-id="8584c-165">Например адрес в приложение электронной коммерции может вообще не имеют удостоверения, так как он может только представляет группу атрибутов профиля пользователя для лица или компании.</span><span class="sxs-lookup"><span data-stu-id="8584c-165">For example, an address in an e-commerce application might not have an identity at all, since it might only represent a group of attributes of the customer’s profile for a person or company.</span></span> <span data-ttu-id="8584c-166">В этом случае адрес должен классифицироваться как объект значения.</span><span class="sxs-lookup"><span data-stu-id="8584c-166">In this case, the address should be classified as a value object.</span></span> <span data-ttu-id="8584c-167">Однако в приложении для компании программа электроэнергии, адрес клиента может быть важно для бизнес-среде.</span><span class="sxs-lookup"><span data-stu-id="8584c-167">However, in an application for an electric power utility company, the customer address could be important for the business domain.</span></span> <span data-ttu-id="8584c-168">Таким образом адрес должен иметь удостоверения, система выставления счетов могут быть связаны непосредственно к адресу.</span><span class="sxs-lookup"><span data-stu-id="8584c-168">Therefore, the address must have an identity so the billing system can be directly linked to the address.</span></span> <span data-ttu-id="8584c-169">В этом случае адрес должен классифицироваться как сущности домена.</span><span class="sxs-lookup"><span data-stu-id="8584c-169">In that case, an address should be classified as a domain entity.</span></span>

<span data-ttu-id="8584c-170">Имя и фамилия человека, обычно — это сущность, так как пользователь удостоверений, даже если имени и фамилии совпадают с другой набор значений, например, если эти имена также ссылается на другое лицо.</span><span class="sxs-lookup"><span data-stu-id="8584c-170">A person with a name and surname is usually an entity because a person has identity, even if the name and surname coincide with another set of values, such as if those names also refers to a different person.</span></span>

<span data-ttu-id="8584c-171">Значение объектов трудности в управлении в реляционных базах данных и моделей ORM, например EF, тогда как в документе ориентированные базы данных, которые их легче реализовать и использовать.</span><span class="sxs-lookup"><span data-stu-id="8584c-171">Value objects are hard to manage in relational databases and ORMs like EF, whereas in document oriented databases they are easier to implement and use.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="8584c-172">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="8584c-172">Additional resources</span></span>

-   <span data-ttu-id="8584c-173">**Мартин Фоулер (Martin Fowler). Значение шаблона объекта**
    [*https://martinfowler.com/bliki/ValueObject.html*](https://martinfowler.com/bliki/ValueObject.html)</span><span class="sxs-lookup"><span data-stu-id="8584c-173">**Martin Fowler. Value Object pattern**
[*https://martinfowler.com/bliki/ValueObject.html*](https://martinfowler.com/bliki/ValueObject.html)</span></span>

-   <span data-ttu-id="8584c-174">**Значение объекта**
    [*http://deviq.com/value-object/*](http://deviq.com/value-object/)</span><span class="sxs-lookup"><span data-stu-id="8584c-174">**Value Object**
[*http://deviq.com/value-object/*](http://deviq.com/value-object/)</span></span>

-   <span data-ttu-id="8584c-175">**Значение объектов в методики разработки**
    [*https://leanpub.com/tdd-ebook/read\#leanpub auto значение объектов*](https://leanpub.com/tdd-ebook/read#leanpub-auto-value-objects)</span><span class="sxs-lookup"><span data-stu-id="8584c-175">**Value Objects in Test-Driven Development**
[*https://leanpub.com/tdd-ebook/read\#leanpub-auto-value-objects*](https://leanpub.com/tdd-ebook/read#leanpub-auto-value-objects)</span></span>

-   <span data-ttu-id="8584c-176">**Эрик Эванс (Eric Evans). Проектирование на основе домена: Выполняемой сложность лежит в основе программного обеспечения.**</span><span class="sxs-lookup"><span data-stu-id="8584c-176">**Eric Evans. Domain-Driven Design: Tackling Complexity in the Heart of Software.**</span></span> <span data-ttu-id="8584c-177">(Книга; включает в себя обсуждение значение объектов) [ *https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/*](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/)</span><span class="sxs-lookup"><span data-stu-id="8584c-177">(Book; includes a discussion of value objects) [*https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/*](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/)</span></span>

### <a name="the-aggregate-pattern"></a><span data-ttu-id="8584c-178">Агрегатные шаблон</span><span class="sxs-lookup"><span data-stu-id="8584c-178">The Aggregate pattern</span></span>

<span data-ttu-id="8584c-179">Модель домена содержит кластеров сущностей данных и процессов, которые можно контролировать значительные области функций, таких как порядок выполнения или инвентаризации.</span><span class="sxs-lookup"><span data-stu-id="8584c-179">A domain model contains clusters of different data entities and processes that can control a significant area of functionality, such as order fulfilment or inventory.</span></span> <span data-ttu-id="8584c-180">Более мелкие DDD единица — агрегатной функции, описывающий кластера или группы сущностей и поведения, которые могут рассматриваться как единый блок.</span><span class="sxs-lookup"><span data-stu-id="8584c-180">A more fine-grained DDD unit is the aggregate, which describes a cluster or group of entities and behaviors that can be treated as a cohesive unit.</span></span>

<span data-ttu-id="8584c-181">Обычно определяются статистической обработки с учетом транзакций, которые необходимы.</span><span class="sxs-lookup"><span data-stu-id="8584c-181">You usually define an aggregate based on the transactions that you need.</span></span> <span data-ttu-id="8584c-182">Классический пример — заказа, который также содержится список элементов заказа.</span><span class="sxs-lookup"><span data-stu-id="8584c-182">A classic example is an order that also contains a list of order items.</span></span> <span data-ttu-id="8584c-183">Элемент заказа будет обычно сущности.</span><span class="sxs-lookup"><span data-stu-id="8584c-183">An order item will usually be an entity.</span></span> <span data-ttu-id="8584c-184">Но это не дочерней сущности в порядке статистической функции, которая также будет содержать сущность «заказы» как корневой объект, обычно называется корневого каталога статистические.</span><span class="sxs-lookup"><span data-stu-id="8584c-184">But it will be a child entity within the order aggregate, which will also contain the order entity as its root entity, typically called an aggregate root.</span></span>

<span data-ttu-id="8584c-185">Определение статистических выражений могут быть трудными.</span><span class="sxs-lookup"><span data-stu-id="8584c-185">Identifying aggregates can be hard.</span></span> <span data-ttu-id="8584c-186">Статистическое выражение представляет группу объектов, которые должны быть согласованы друг с другом, но не может просто выбрать группу объектов и пометьте их агрегатную функцию.</span><span class="sxs-lookup"><span data-stu-id="8584c-186">An aggregate is a group of objects that must be consistent together, but you cannot just pick a group of objects and label them an aggregate.</span></span> <span data-ttu-id="8584c-187">Должно начинаться с понятием домена и подумать о сущности, которые используются в наиболее распространенных операций, связанных с этой концепции.</span><span class="sxs-lookup"><span data-stu-id="8584c-187">You must start with a domain concept and think about the entities that are used in the most common transactions related to that concept.</span></span> <span data-ttu-id="8584c-188">Этих сущностей, которые должны быть согласованы являются что forms агрегатную функцию.</span><span class="sxs-lookup"><span data-stu-id="8584c-188">Those entities that need to be transactionally consistent are what forms an aggregate.</span></span> <span data-ttu-id="8584c-189">Обдумывания операции с транзакциями, скорее всего, — лучший способ определения статистических выражений.</span><span class="sxs-lookup"><span data-stu-id="8584c-189">Thinking about transaction operations is probably the best way to identify aggregates.</span></span>

### <a name="the-aggregate-root-or-root-entity-pattern"></a><span data-ttu-id="8584c-190">Шаблон статистической корневой или корневую сущность</span><span class="sxs-lookup"><span data-stu-id="8584c-190">The Aggregate Root or Root Entity pattern</span></span>

<span data-ttu-id="8584c-191">Статистическое выражение состоит из по крайней мере одна сущность: aggregate корень, также называют корневую сущность или основной ientity.</span><span class="sxs-lookup"><span data-stu-id="8584c-191">An aggregate is composed of at least one entity: the aggregate root, also called root entity or primary ientity.</span></span> <span data-ttu-id="8584c-192">Кроме того она может иметь несколько дочерних сущностей и значение объекты, содержащие все сущности и объекты работают совместно для реализации необходимого поведения и транзакции.</span><span class="sxs-lookup"><span data-stu-id="8584c-192">Additionally, it can have multiple child entities and value objects, with all entities and objects working together to implement required behavior and transactions.</span></span>

<span data-ttu-id="8584c-193">Агрегатные корневой предназначен для обеспечения согласованности агрегатной функции; он должен быть только точку входа для обновления через методы статистической функции или операции в агрегатной корневой класс.</span><span class="sxs-lookup"><span data-stu-id="8584c-193">The purpose of an aggregate root is to ensure the consistency of the aggregate; it should be the only entry point for updates to the aggregate through methods or operations in the aggregate root class.</span></span> <span data-ttu-id="8584c-194">К сущностям в статистическое выражение только через статистические корневой следует вносить изменения.</span><span class="sxs-lookup"><span data-stu-id="8584c-194">You should make changes to entities within the aggregate only via the aggregate root.</span></span> <span data-ttu-id="8584c-195">Это Защитника согласованности статистическое выражение, принимая во внимание инварианты и правила целостности, которые могут понадобиться в соответствии с вашей статистическими выражениями.</span><span class="sxs-lookup"><span data-stu-id="8584c-195">It is the aggregate’s consistency guardian, taking into account all the invariants and consistency rules you might need to comply with in your aggregate.</span></span> <span data-ttu-id="8584c-196">При изменении дочерний объект сущности или значение независимо друг от друга, статистические корневой нельзя убедитесь, Агрегатная функция находится в недопустимом состоянии.</span><span class="sxs-lookup"><span data-stu-id="8584c-196">If you change a child entity or value object independently, the aggregate root cannot ensure that the aggregate is in a valid state.</span></span> <span data-ttu-id="8584c-197">Он будет иметь следующий вид таблицы с свободный участок.</span><span class="sxs-lookup"><span data-stu-id="8584c-197">It would be like a table with a loose leg.</span></span> <span data-ttu-id="8584c-198">Обеспечение согласованности является основной целью статистической корневой.</span><span class="sxs-lookup"><span data-stu-id="8584c-198">Maintaining consistency is the main purpose of the aggregate root.</span></span>

<span data-ttu-id="8584c-199">В на рисунке 9-9, можно просмотреть образец агрегаты как покупатель aggregate, содержащий одну сущность (статистические корень покупатель).</span><span class="sxs-lookup"><span data-stu-id="8584c-199">In Figure 9-9, you can see sample aggregates like the buyer aggregate, which contains a single entity (the aggregate root Buyer).</span></span> <span data-ttu-id="8584c-200">Порядок статистическое выражение содержит несколько сущностей и объект значения.</span><span class="sxs-lookup"><span data-stu-id="8584c-200">The order aggregate contains multiple entities and a value object.</span></span>

![](./media/image10.png)

<span data-ttu-id="8584c-201">**Рис. 9-9**.</span><span class="sxs-lookup"><span data-stu-id="8584c-201">**Figure 9-9**.</span></span> <span data-ttu-id="8584c-202">Пример статистические выражения с несколькими или отдельные сущности</span><span class="sxs-lookup"><span data-stu-id="8584c-202">Example of aggregates with multiple or single entities</span></span>

<span data-ttu-id="8584c-203">Обратите внимание, что покупатель статистическое выражение может иметь дополнительные дочерние объекты, в зависимости от домена, как в упорядочивания микрослужбу в приложении ссылку eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="8584c-203">Note that the Buyer aggregate could have additional child entities, depending on your domain, as it does in the ordering microservice in the eShopOnContainers reference application.</span></span> <span data-ttu-id="8584c-204">Рис. 9-9 просто иллюстрирует случай, в котором покупатель состоит из одной сущности, в качестве примера статистическое выражение, которое содержит только статистические корень.</span><span class="sxs-lookup"><span data-stu-id="8584c-204">Figure 9-9 just illustrates a case in which the buyer has a single entity, as an example of an aggregate that contains only an aggregate root.</span></span>

<span data-ttu-id="8584c-205">Чтобы поддерживать разделение статистические выражения и сохранить четкие границы между ними, рекомендуется в модель домена ддд, чтобы запретить прямой навигации между статистические выражения и только с поле внешний ключ (FK), как осуществляется в [ Упорядочение модель домена микрослужбу](https://github.com/dotnet-architecture/eShopOnContainers/blob/master/src/Services/Ordering/Ordering.Domain/AggregatesModel/OrderAggregate/Order.cs) в eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="8584c-205">In order to maintain separation of aggregates and keep clear boundaries between them, it is a good practice in a DDD domain model to disallow direct navigation between aggregates and only having the foreign key (FK) field, as implemented in the [Ordering microservice domain model](https://github.com/dotnet-architecture/eShopOnContainers/blob/master/src/Services/Ordering/Ordering.Domain/AggregatesModel/OrderAggregate/Order.cs) in eShopOnContainers.</span></span> <span data-ttu-id="8584c-206">Сущность «заказы» только содержит поле внешнего ключа для покупателей, но не EF Core свойство навигации, как показано в следующем коде:</span><span class="sxs-lookup"><span data-stu-id="8584c-206">The Order entity only has a FK field for the buyer, but not an EF Core navigation property, as shown in the following code:</span></span>

```csharp
public class Order : Entity, IAggregateRoot
{
    private DateTime _orderDate;
    public Address Address { get; private set; }
    private int? _buyerId; //FK pointing to a different aggregate root
    public OrderStatus OrderStatus { get; private set; }
}
```

<span data-ttu-id="8584c-207">Идентификации и работа с статистические выражения требуется исследования и качества.</span><span class="sxs-lookup"><span data-stu-id="8584c-207">Identifying and working with aggregates requires research and experience.</span></span> <span data-ttu-id="8584c-208">Дополнительные сведения см. в следующем списке Дополнительные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="8584c-208">For more information, see the following Additional resources list.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="8584c-209">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="8584c-209">Additional resources</span></span>

-   <span data-ttu-id="8584c-210">**Вон Вернон (Vaughn Vernon). Эффективной статистические схемы — часть i. единое Агрегированное моделирования**
    [*https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD\_СООБЩЕСТВА\_ЭССЕ\_ Статистические ВЫРАЖЕНИЯ\_часть\_pdf 1.*](https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8584c-210">**Vaughn Vernon. Effective Aggregate Design - Part I: Modeling a Single Aggregate**
[*https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD\_COMMUNITY\_ESSAY\_AGGREGATES\_PART\_1.pdf*](https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_1.pdf)</span></span>

-   <span data-ttu-id="8584c-211">**Вон Вернон (Vaughn Vernon). Эффективной статистические схемы — часть II: Совместной работы агрегаты внесения**
    *<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_2.pdf>*</span><span class="sxs-lookup"><span data-stu-id="8584c-211">**Vaughn Vernon. Effective Aggregate Design - Part II: Making Aggregates Work Together**
*<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_2.pdf> *</span></span>

-   <span data-ttu-id="8584c-212">**Вон Вернон (Vaughn Vernon). Эффективной статистические схемы — часть III: Получения ценных сведений через обнаружение**
    *<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_3.pdf>*</span><span class="sxs-lookup"><span data-stu-id="8584c-212">**Vaughn Vernon. Effective Aggregate Design - Part III: Gaining Insight Through Discovery**
*<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_3.pdf> *</span></span>

-   <span data-ttu-id="8584c-213">**Сергея Grybniak. Шаблоны тактические разработки DDD**
    [*https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part*](https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part)</span><span class="sxs-lookup"><span data-stu-id="8584c-213">**Sergey Grybniak. DDD Tactical Design Patterns**
[*https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part*](https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part)</span></span>

-   <span data-ttu-id="8584c-214">**Крис Ричардсон. Разработка транзакций Микрослужбами используются агрегатные функции**
    [*https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson*](https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson)</span><span class="sxs-lookup"><span data-stu-id="8584c-214">**Chris Richardson. Developing Transactional Microservices Using Aggregates**
[*https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson*](https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson)</span></span>

-   <span data-ttu-id="8584c-215">**DevIQ. Шаблон статистической**
    [*http://deviq.com/aggregate-pattern/*](http://deviq.com/aggregate-pattern/)</span><span class="sxs-lookup"><span data-stu-id="8584c-215">**DevIQ. The Aggregate pattern**
[*http://deviq.com/aggregate-pattern/*](http://deviq.com/aggregate-pattern/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="8584c-216">[Предыдущие] (ddd ориентированного microservice.md) [Далее] (net-core микрослужбу домена model.md)</span><span class="sxs-lookup"><span data-stu-id="8584c-216">[Previous] (ddd-oriented-microservice.md) [Next] (net-core-microservice-domain-model.md)</span></span>
