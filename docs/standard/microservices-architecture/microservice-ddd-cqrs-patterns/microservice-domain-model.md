---
title: "Проектирование модели домена микрослужбу"
description: "Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Проектирование модели домена микрослужбу"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 455a2c5a39fb9b765b557610ab108f8c75882dbd
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="designing-a-microservice-domain-model"></a>Проектирование модели домена микрослужбу

*Определить одну модель расширенный домен для каждого микрослужбу бизнеса или ограниченного контекста*

Задача — Создание целостного однодоменным модели для каждого микрослужбу бизнеса или ограниченного контекста (BC). Имейте в виду, однако, BC или business микрослужбу иногда может состоять из нескольких физических служб, совместно использующих один домен модели. Модель домена должно записать правила, поведение, язык бизнеса и ограничения для одного контекста ограниченных или микрослужбу бизнес, который он представляет.

## <a name="the-domain-entity-pattern"></a>Шаблон сущности домена

Сущности представляют объекты домена и в основном определены свои удостоверения, обеспечения непрерывности и сохраняемости со временем, а не только атрибуты, которые составляют их. Как Eric Evans говорит: «объект, определенный в первую очередь по идентификатору вызывается сущности.» Сущности являются очень важно для модели домена, поскольку они являются основой для модели. Таким образом необходимо определить и разрабатывать их внимательно.

*Удостоверение сущности может пересекать несколько микрослужбами или ограниченных контекстах.*

То же удостоверение (хотя и не той же сущности) могут задаваться в нескольких контекстах ограниченных или микрослужбами. Однако, не означает, что одной сущности, с теми же атрибутами и логику будут реализованы в нескольких контекстах, ограниченное. Вместо этого сущностей в каждом контексте ограниченных ограничить их атрибуты и поведения этих необходимым в контексте, ограниченных домена.

Для экземпляра сущности покупатель, могут иметься большинство человека атрибуты, которые определены в сущности микрослужбу профиля или удостоверение, включая удостоверение пользователя. Но покупатель сущности в микрослужбу порядка сортировки может быть меньше атрибутов так, как только определенные данные покупателя, связанных с обработки заказа. Контекст каждого микрослужбу или ограниченного контекста влияет на его модели домена.

*Сущности домена необходимо реализовать поведение помимо данных атрибутов*

Сущность домена в DDD необходимо реализовать логику домена или поведения, связанные с данными сущности (объект, к которому в памяти). Например как часть класса сущности order должны иметь бизнес-логики и операций, которые реализованы как методы для задач, таких как добавление элемента заказа, проверка данных и общее расчет. Методы сущности аккуратно правил сущности, вместо того, эти правила, которые распределены на уровне приложения и инварианты.

Рис. 9-8 показана сущности домена, реализующая не только атрибуты данных, но операции и методов, имеющих связанные доменную логику.

![](./media/image9.png)

**Рис. 9-8**. Пример схемы домена сущности, реализация данных, а также поведение

Конечно иногда может иметь сущностей, которые не реализуют логику в рамках класса сущностей. Это может произойти в дочерних сущностей в агрегатную функцию, если дочерней сущности не имеет каких-либо алгоритмов, так как большую часть логики определяется в корне статистические. При наличии сложных микрослужбу, со значительным логику, реализуемую службы вместо в классах сущностей домена может передачи управления в модель anemic домена, подробно описан в следующем разделе.

### <a name="rich-domain-model-versus-anemic-domain-model"></a>Модель домена Rich и anemic доменную модель

В его post [AnemicDomainModel](https://martinfowler.com/bliki/AnemicDomainModel.html), Martin Fowler описывает модель anemic домена таким образом:

Основные Признак Anemic модели домена заключается в том, что на первый взгляд выглядит как подлинные. Нет объектов, многие именам существительным в пространстве домена и эти объекты связаны с широкие возможности связи и структуры, содержащих модели домена значение true. Catch с момента, когда взглянуть на поведение и вы понимаете, что вряд ли любого поведения на эти объекты становятся немного больше контейнеры методов get и set.

Конечно, при использовании модели домена anemic этих моделей данных будет использоваться из набора объектов службы (традиционно именованный *бизнес-слое*) которого захватить все домена или бизнес-логики. Бизнес-уровне располагается в верхней части модели данных и использует модель данных так же, как данные.

Модель домена anemic — просто процедурного стиля макета. Объекты anemic сущности не являются реальными объектами из-за отсутствия возможности (методы). Только они содержат свойства данных и таким образом не объектно ориентированный проект. Путем помещения поведение помещает в объекты служб (бизнес-уровне) по сути заканчивается [тестированию кода](https://en.wikipedia.org/wiki/Spaghetti_code) или [сценарии транзакции](https://martinfowler.com/eaaCatalog/transactionScript.html), и поэтому будут потеряны преимущества, модель домена предоставляет.

Независимо от того, если микрослужбу или ограниченного контекста является очень простым anemic доменная модель в форме объектов сущностей с только что свойства данных вполне достаточно (CRUD service), и не может иметь смысл реализации более сложных шаблонов ддд. В этом случае он будет просто сохраняемости модели, поскольку намеренно создания сущности с данными только для целей CRUD.

Именно поэтому архитектур микрослужбами идеально подходящие для нескольких архитектурный подход в зависимости от того, в каждом контексте ограниченных. Для экземпляра в eShopOnContainers, порядка сортировки микрослужбу реализует шаблоны ддд, а микрослужбу каталога, который представляет собой простую службу CRUD, нет.

Некоторые лица сказать, что модель anemic домена является антишаблон. Это зависит то, что при реализации. Если микрослужбу, создается простой достаточно (например, служба CRUD), не антишаблон модели anemic домена. Тем не менее если необходимо решать сложности микрослужбу домена со значительным постоянно меняющихся бизнес-правил, модель anemic домена может быть антишаблон для этого микрослужбу или ограниченного контекста. В этом случае проектирование его в виде форматированного модели с сущностями, содержащих данные, а также поведение, а также для реализации дополнительных шаблонов DDD (статистические выражения, значение объекты, т. д.) может иметь больших преимущества для долговременного успеха таких микрослужбы.

#### <a name="additional-resources"></a>Дополнительные ресурсы

-   **DevIQ. Сущность домена**
    [*http://deviq.com/entity/*](http://deviq.com/entity/)

-   **Мартин Фоулер (Martin Fowler). Модель домена**
    [*https://martinfowler.com/eaaCatalog/domainModel.html*](https://martinfowler.com/eaaCatalog/domainModel.html)

-   **Мартин Фоулер (Martin Fowler). Модель домена Anemic**

    <https://martinfowler.com/bliki/AnemicDomainModel.HTML>

### <a name="the-value-object-pattern"></a>Объект значения шаблона

Иное Eric Evans «многие объекты имеют концептуальной удостоверения. Эти объекты описывают характеристики вещь.»

Сущности требуется удостоверение, но существует множество объектов в системе, которая не будет сделано, как шаблон значение объекта. Объект-значение представляет собой объект удостоверение не концептуальной, описывающий аспект домена. Данные элементы являются объектами, в которых можно создать для представления конструктора элементов интересующие только вас временно. Вас интересует *что* они не, *,* их. Примеры включают чисел и строк, но также может быть более высокого уровня понятия, такие как группы атрибутов.

То, что представляет собой сущность в микрослужбу может быть сущности в другом микрослужбу, поскольку во втором случае контекст ограниченных может иметь другое значение. Например адрес в приложение электронной коммерции может вообще не имеют удостоверения, так как он может только представляет группу атрибутов профиля пользователя для лица или компании. В этом случае адрес должен классифицироваться как объект значения. Однако в приложении для компании программа электроэнергии, адрес клиента может быть важно для бизнес-среде. Таким образом адрес должен иметь удостоверения, система выставления счетов могут быть связаны непосредственно к адресу. В этом случае адрес должен классифицироваться как сущности домена.

Имя и фамилия человека, обычно — это сущность, так как пользователь удостоверений, даже если имени и фамилии совпадают с другой набор значений, например, если эти имена также ссылается на другое лицо.

Значение объектов трудности в управлении в реляционных базах данных и моделей ORM, например EF, тогда как в документе ориентированные базы данных, которые их легче реализовать и использовать.

#### <a name="additional-resources"></a>Дополнительные ресурсы

-   **Мартин Фоулер (Martin Fowler). Значение шаблона объекта**
    [*https://martinfowler.com/bliki/ValueObject.html*](https://martinfowler.com/bliki/ValueObject.html)

-   **Значение объекта**
    [*http://deviq.com/value-object/*](http://deviq.com/value-object/)

-   **Значение объектов в методики разработки**
    [*https://leanpub.com/tdd-ebook/read\#leanpub auto значение объектов*](https://leanpub.com/tdd-ebook/read#leanpub-auto-value-objects)

-   **Эрик Эванс (Eric Evans). Проектирование на основе домена: Выполняемой сложность лежит в основе программного обеспечения.** (Книга; включает в себя обсуждение значение объектов) [ *https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/*](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/)

### <a name="the-aggregate-pattern"></a>Агрегатные шаблон

Модель домена содержит кластеров сущностей данных и процессов, которые можно контролировать значительные области функций, таких как порядок выполнения или инвентаризации. Более мелкие DDD единица — агрегатной функции, описывающий кластера или группы сущностей и поведения, которые могут рассматриваться как единый блок.

Обычно определяются статистической обработки с учетом транзакций, которые необходимы. Классический пример — заказа, который также содержится список элементов заказа. Элемент заказа будет обычно сущности. Но это не дочерней сущности в порядке статистической функции, которая также будет содержать сущность «заказы» как корневой объект, обычно называется корневого каталога статистические.

Определение статистических выражений могут быть трудными. Статистическое выражение представляет группу объектов, которые должны быть согласованы друг с другом, но не может просто выбрать группу объектов и пометьте их агрегатную функцию. Должно начинаться с понятием домена и подумать о сущности, которые используются в наиболее распространенных операций, связанных с этой концепции. Этих сущностей, которые должны быть согласованы являются что forms агрегатную функцию. Обдумывания операции с транзакциями, скорее всего, — лучший способ определения статистических выражений.

### <a name="the-aggregate-root-or-root-entity-pattern"></a>Шаблон статистической корневой или корневую сущность

Статистическое выражение состоит из по крайней мере одна сущность: aggregate корень, также называют корневую сущность или основной ientity. Кроме того она может иметь несколько дочерних сущностей и значение объекты, содержащие все сущности и объекты работают совместно для реализации необходимого поведения и транзакции.

Агрегатные корневой предназначен для обеспечения согласованности агрегатной функции; он должен быть только точку входа для обновления через методы статистической функции или операции в агрегатной корневой класс. К сущностям в статистическое выражение только через статистические корневой следует вносить изменения. Это Защитника согласованности статистическое выражение, принимая во внимание инварианты и правила целостности, которые могут понадобиться в соответствии с вашей статистическими выражениями. При изменении дочерний объект сущности или значение независимо друг от друга, статистические корневой нельзя убедитесь, Агрегатная функция находится в недопустимом состоянии. Он будет иметь следующий вид таблицы с свободный участок. Обеспечение согласованности является основной целью статистической корневой.

В на рисунке 9-9, можно просмотреть образец агрегаты как покупатель aggregate, содержащий одну сущность (статистические корень покупатель). Порядок статистическое выражение содержит несколько сущностей и объект значения.

![](./media/image10.png)

**Рис. 9-9**. Пример статистические выражения с несколькими или отдельные сущности

Обратите внимание, что покупатель статистическое выражение может иметь дополнительные дочерние объекты, в зависимости от домена, как в упорядочивания микрослужбу в приложении ссылку eShopOnContainers. Рис. 9-9 просто иллюстрирует случай, в котором покупатель состоит из одной сущности, в качестве примера статистическое выражение, которое содержит только статистические корень.

Чтобы поддерживать разделение статистические выражения и сохранить четкие границы между ними, рекомендуется в модель домена ддд, чтобы запретить прямой навигации между статистические выражения и только с поле внешний ключ (FK), как осуществляется в [ Упорядочение модель домена микрослужбу](https://github.com/dotnet-architecture/eShopOnContainers/blob/master/src/Services/Ordering/Ordering.Domain/AggregatesModel/OrderAggregate/Order.cs) в eShopOnContainers. Сущность «заказы» только содержит поле внешнего ключа для покупателей, но не EF Core свойство навигации, как показано в следующем коде:

```csharp
public class Order : Entity, IAggregateRoot
{
    private DateTime _orderDate;
    public Address Address { get; private set; }
    private int? _buyerId; //FK pointing to a different aggregate root
    public OrderStatus OrderStatus { get; private set; }
}
```

Идентификации и работа с статистические выражения требуется исследования и качества. Дополнительные сведения см. в следующем списке Дополнительные ресурсы.

#### <a name="additional-resources"></a>Дополнительные ресурсы

-   **Вон Вернон (Vaughn Vernon). Эффективной статистические схемы — часть i. единое Агрегированное моделирования**
    [*https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD\_СООБЩЕСТВА\_ЭССЕ\_ Статистические ВЫРАЖЕНИЯ\_часть\_pdf 1.*](https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_1.pdf)

-   **Вон Вернон (Vaughn Vernon). Эффективной статистические схемы — часть II: Совместной работы агрегаты внесения**
    *<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_2.pdf>*

-   **Вон Вернон (Vaughn Vernon). Эффективной статистические схемы — часть III: Получения ценных сведений через обнаружение**
    *<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_3.pdf>*

-   **Сергея Grybniak. Шаблоны тактические разработки DDD**
    [*https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part*](https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part)

-   **Крис Ричардсон. Разработка транзакций Микрослужбами используются агрегатные функции**
    [*https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson*](https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson)

-   **DevIQ. Шаблон статистической**
    [*http://deviq.com/aggregate-pattern/*](http://deviq.com/aggregate-pattern/)


>[!div class="step-by-step"]
[Предыдущие] (ddd ориентированного microservice.md) [Далее] (net-core микрослужбу домена model.md)
