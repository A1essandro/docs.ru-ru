---
title: "Применение CQRS и CQS подходы в DDD микрослужбу в eShopOnContainers"
description: "Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Применение CQRS и CQS подходы в DDD микрослужбу в eShopOnContainers"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: a2c4429a75ca47d4fbcde868b95e76bc65ea2bef
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="applying-cqrs-and-cqs-approaches-in-a-ddd-microservice-in-eshoponcontainers"></a>Применение CQRS и CQS подходы в DDD микрослужбу в eShopOnContainers

Структуры упорядочивания микрослужбу приложения eShopOnContainers ссылка основана на принципах CQRS. Однако она использует простой метод, который просто разделяя запросы с помощью команд и с помощью той же базе данных для обоих этих действий.

Суть этих закономерностей и важно отметить, — запросы идемпотентными: независимо от того, сколько раз запрос системы, состояния системы, не приведет к изменению можно даже использовать модель данных разных «чтение», чем логики транзакций «запись» модель домена, несмотря на то, что упорядочивания микрослужбами использует ту же базу данных. Поэтому это упрощенный подход CQRS.

С другой стороны команды, которые инициировать транзакции и обновления данных, изменения состояния в системе. С помощью команд, необходимо соблюдать осторожность при связанных с сложности и постоянно меняющихся бизнес-правила. Это место, куда вы хотите применить DDD способов лучше смоделированных система.

Шаблоны ддд, рассматриваемые в данном руководстве не следует применять ко всем компонентам. Они накладывают ограничения на разработку. Эти ограничения обеспечивают преимущества, такие как более высокое качество по времени, особенно в командах и другой код, который изменяет состояние системы. Тем не менее эти ограничения усложнить с меньшим числом преимущества для чтения и запроса данных.

Один шаблон является агрегатной шаблона, в котором мы более подробно в дальнейших разделах. Кратко в шаблоне Aggregate, многие объекты домена обрабатывать как единое целое в результате их связь в домене. Вы не всегда могут получить преимущества от этого шаблона в запросах; он может увеличить сложность логики запроса. Для запросов только для чтения не дает преимущества обработке как единое Агрегированное несколько объектов. Можно получить только сложности.

Как показано на рисунке 9-2, это руководство предлагает с помощью шаблонов DDD только в области транзакций, обновления вашей микрослужбу (как вызвано команды). Запросы можно выполнить более простой подход и должны быть отделены от команды, в следующем подходе CQRS.

Для реализации на «стороне запросы», можно выбрать между многими способами из вашей полнофункционального ORM, например EF Core, AutoMapper проекций, хранимые процедуры, представления, материализованные представления или micro ORM.

В этом руководстве и в eShopOnContainers (в частности упорядочивания микрослужбу), мы решили реализовать прямых запросов, с помощью micro ORM, например [Dapper](https://github.com/StackExchange/dapper-dot-net). Это позволяет реализовать любой запрос на основе инструкций SQL для получения наилучшей производительности благодаря светлой framework с минимальными накладными расходами.

Помните, что при использовании этого подхода все обновления для модели, влияющих на как сущности, сохраняются в базе данных SQL также должны отдельных обновлений для SQL-запросы, используемые Dapper или любые другие отдельные (не EF) подход с запросом.

## <a name="cqrs-and-ddd-patterns-are-not-top-level-architectures"></a>Шаблоны CQRS и ддд не верхнего уровня архитектуры

Важно понимать, что CQRS и большинство шаблонов DDD (например, DDD слоев или модели домена с статистическими функциями) он не архитектурные стили, но только шаблоны архитектуры. Микрослужбами, SOA и архитектура событиями (EDA) являются примерами архитектуры стилей. Они описывают систему множество компонентов, таких как много микрослужбами. Шаблоны CQRS и ддд описывают что-то внутри одной системы или компонент. в этом случае что-нибудь внутри микрослужбы.

Различные шаблоны будущих ограниченных контекстах (BCs). Они имеют различные обязанности, и это ведет к различные решения. Стоит подчеркнуть, принудительное тот же шаблон, который everywhere приводит к сбою. Не используйте шаблоны CQRS и ддд everywhere. Многие подсистем, BCs или микрослужбами проще и можно реализовать более просто с помощью простых CRUD служб или другой подход.

Имеется только одно приложение архитектуры: архитектура системы или конца в конец приложения вы разрабатываете (например, архитектура микрослужбами). Однако структуру каждого ограниченного контекста или микрослужбу этого приложения отражает собственные компромиссы и внутренние проектные решения на уровне шаблоны архитектуры. Не пытайтесь применить те же архитектурные шаблоны как CQRS или DDD everywhere.

####  <a name="additional-resources"></a>Дополнительные ресурсы

-   **Мартин Фоулер (Martin Fowler). CQRS**
    [*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)

-   **Грег Янг. CQS vs. CQRS**
    [*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)

-   **Грег Янг. Документы CQRS**
    [*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)

-   **Грег Янг. CQRS задач на основе пользовательских интерфейсов и источники событий**
    [*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)

-   **UDI Dahan. Добавлено пояснение CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)

-   **CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)

-   **Источники событий (ES)**
    [*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)


>[!div class="step-by-step"]
[Предыдущие] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Далее] (cqrs микрослужбу reads.md)
