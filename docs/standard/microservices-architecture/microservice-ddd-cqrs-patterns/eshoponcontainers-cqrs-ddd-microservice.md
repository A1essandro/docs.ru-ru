---
title: "Применение CQRS и CQS подходы в DDD микрослужбу в eShopOnContainers"
description: "Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Применение CQRS и CQS подходы в DDD микрослужбу в eShopOnContainers"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: a2c4429a75ca47d4fbcde868b95e76bc65ea2bef
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="applying-cqrs-and-cqs-approaches-in-a-ddd-microservice-in-eshoponcontainers"></a><span data-ttu-id="2e56f-104">Применение CQRS и CQS подходы в DDD микрослужбу в eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="2e56f-104">Applying CQRS and CQS approaches in a DDD microservice in eShopOnContainers</span></span>

<span data-ttu-id="2e56f-105">Структуры упорядочивания микрослужбу приложения eShopOnContainers ссылка основана на принципах CQRS.</span><span class="sxs-lookup"><span data-stu-id="2e56f-105">The design of the ordering microservice at the eShopOnContainers reference application is based on CQRS principles.</span></span> <span data-ttu-id="2e56f-106">Однако она использует простой метод, который просто разделяя запросы с помощью команд и с помощью той же базе данных для обоих этих действий.</span><span class="sxs-lookup"><span data-stu-id="2e56f-106">However, it uses the simplest approach, which is just separating the queries from the commands and using the same database for both actions.</span></span>

<span data-ttu-id="2e56f-107">Суть этих закономерностей и важно отметить, — запросы идемпотентными: независимо от того, сколько раз запрос системы, состояния системы, не приведет к изменению можно даже использовать модель данных разных «чтение», чем логики транзакций «запись» модель домена, несмотря на то, что упорядочивания микрослужбами использует ту же базу данных.</span><span class="sxs-lookup"><span data-stu-id="2e56f-107">The essence of those patterns, and the important point here, is that queries are idempotent: no matter how many times you query a system, the state of that system will not change You could even use a different “reads” data model than the transactional logic “writes” domain model, although the ordering microservices is using the same database.</span></span> <span data-ttu-id="2e56f-108">Поэтому это упрощенный подход CQRS.</span><span class="sxs-lookup"><span data-stu-id="2e56f-108">Hence this is a simplified CQRS approach.</span></span>

<span data-ttu-id="2e56f-109">С другой стороны команды, которые инициировать транзакции и обновления данных, изменения состояния в системе.</span><span class="sxs-lookup"><span data-stu-id="2e56f-109">On the other hand, commands, which trigger transactions and data updates, change state in the system.</span></span> <span data-ttu-id="2e56f-110">С помощью команд, необходимо соблюдать осторожность при связанных с сложности и постоянно меняющихся бизнес-правила.</span><span class="sxs-lookup"><span data-stu-id="2e56f-110">With commands, you need to be careful when dealing with complexity and ever-changing business rules.</span></span> <span data-ttu-id="2e56f-111">Это место, куда вы хотите применить DDD способов лучше смоделированных система.</span><span class="sxs-lookup"><span data-stu-id="2e56f-111">This is the where you want to apply DDD techniques to have a better modeled system.</span></span>

<span data-ttu-id="2e56f-112">Шаблоны ддд, рассматриваемые в данном руководстве не следует применять ко всем компонентам.</span><span class="sxs-lookup"><span data-stu-id="2e56f-112">The DDD patterns presented in this guide should not be applied universally.</span></span> <span data-ttu-id="2e56f-113">Они накладывают ограничения на разработку.</span><span class="sxs-lookup"><span data-stu-id="2e56f-113">They introduce constraints on your design.</span></span> <span data-ttu-id="2e56f-114">Эти ограничения обеспечивают преимущества, такие как более высокое качество по времени, особенно в командах и другой код, который изменяет состояние системы.</span><span class="sxs-lookup"><span data-stu-id="2e56f-114">Those constraints provide benefits such as higher quality over time, especially in commands and other code that modifies system state.</span></span> <span data-ttu-id="2e56f-115">Тем не менее эти ограничения усложнить с меньшим числом преимущества для чтения и запроса данных.</span><span class="sxs-lookup"><span data-stu-id="2e56f-115">However, those constraints add complexity with fewer benefits for reading and querying data.</span></span>

<span data-ttu-id="2e56f-116">Один шаблон является агрегатной шаблона, в котором мы более подробно в дальнейших разделах.</span><span class="sxs-lookup"><span data-stu-id="2e56f-116">One such pattern is the Aggregate pattern, which we examine more in later sections.</span></span> <span data-ttu-id="2e56f-117">Кратко в шаблоне Aggregate, многие объекты домена обрабатывать как единое целое в результате их связь в домене.</span><span class="sxs-lookup"><span data-stu-id="2e56f-117">Briefly, in the Aggregate pattern, you treat many domain objects as a single unit as a result of their relationship in the domain.</span></span> <span data-ttu-id="2e56f-118">Вы не всегда могут получить преимущества от этого шаблона в запросах; он может увеличить сложность логики запроса.</span><span class="sxs-lookup"><span data-stu-id="2e56f-118">You might not always gain advantages from this pattern in queries; it can increase the complexity of query logic.</span></span> <span data-ttu-id="2e56f-119">Для запросов только для чтения не дает преимущества обработке как единое Агрегированное несколько объектов.</span><span class="sxs-lookup"><span data-stu-id="2e56f-119">For read-only queries, you do not get the advantages of treating multiple objects as a single Aggregate.</span></span> <span data-ttu-id="2e56f-120">Можно получить только сложности.</span><span class="sxs-lookup"><span data-stu-id="2e56f-120">You only get the complexity.</span></span>

<span data-ttu-id="2e56f-121">Как показано на рисунке 9-2, это руководство предлагает с помощью шаблонов DDD только в области транзакций, обновления вашей микрослужбу (как вызвано команды).</span><span class="sxs-lookup"><span data-stu-id="2e56f-121">As shown in Figure 9-2, this guide suggests using DDD patterns only in the transactional/updates area of your microservice (that is, as triggered by commands).</span></span> <span data-ttu-id="2e56f-122">Запросы можно выполнить более простой подход и должны быть отделены от команды, в следующем подходе CQRS.</span><span class="sxs-lookup"><span data-stu-id="2e56f-122">Queries can follow a simpler approach and should be separated from commands, following a CQRS approach.</span></span>

<span data-ttu-id="2e56f-123">Для реализации на «стороне запросы», можно выбрать между многими способами из вашей полнофункционального ORM, например EF Core, AutoMapper проекций, хранимые процедуры, представления, материализованные представления или micro ORM.</span><span class="sxs-lookup"><span data-stu-id="2e56f-123">For implementing the “queries side”, you can choose between many approaches, from your full-blown ORM like EF Core, AutoMapper projections, stored procedures, views, materialized views or a micro ORM.</span></span>

<span data-ttu-id="2e56f-124">В этом руководстве и в eShopOnContainers (в частности упорядочивания микрослужбу), мы решили реализовать прямых запросов, с помощью micro ORM, например [Dapper](https://github.com/StackExchange/dapper-dot-net).</span><span class="sxs-lookup"><span data-stu-id="2e56f-124">In this guide and in eShopOnContainers (specifically the ordering microservice) we chose to implement straight queries using a micro ORM like [Dapper](https://github.com/StackExchange/dapper-dot-net).</span></span> <span data-ttu-id="2e56f-125">Это позволяет реализовать любой запрос на основе инструкций SQL для получения наилучшей производительности благодаря светлой framework с минимальными накладными расходами.</span><span class="sxs-lookup"><span data-stu-id="2e56f-125">This lets you implement any query based on SQL statements to get the best performance, thanks to a light framework with very little overhead.</span></span>

<span data-ttu-id="2e56f-126">Помните, что при использовании этого подхода все обновления для модели, влияющих на как сущности, сохраняются в базе данных SQL также должны отдельных обновлений для SQL-запросы, используемые Dapper или любые другие отдельные (не EF) подход с запросом.</span><span class="sxs-lookup"><span data-stu-id="2e56f-126">Note that when you use this approach, any updates to your model that impact how entities are persisted to a SQL database also need separate updates to SQL queries used by Dapper or any other separate (non-EF) approaches to querying.</span></span>

## <a name="cqrs-and-ddd-patterns-are-not-top-level-architectures"></a><span data-ttu-id="2e56f-127">Шаблоны CQRS и ддд не верхнего уровня архитектуры</span><span class="sxs-lookup"><span data-stu-id="2e56f-127">CQRS and DDD patterns are not top-level architectures</span></span>

<span data-ttu-id="2e56f-128">Важно понимать, что CQRS и большинство шаблонов DDD (например, DDD слоев или модели домена с статистическими функциями) он не архитектурные стили, но только шаблоны архитектуры.</span><span class="sxs-lookup"><span data-stu-id="2e56f-128">It important to understand that CQRS and most DDD patterns (like DDD layers or a domain model with aggregates) are not architectural styles, but only architecture patterns.</span></span> <span data-ttu-id="2e56f-129">Микрослужбами, SOA и архитектура событиями (EDA) являются примерами архитектуры стилей.</span><span class="sxs-lookup"><span data-stu-id="2e56f-129">Microservices, SOA, and event-driven architecture (EDA) are examples of architectural styles.</span></span> <span data-ttu-id="2e56f-130">Они описывают систему множество компонентов, таких как много микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="2e56f-130">They describe a system of many components, such as many microservices.</span></span> <span data-ttu-id="2e56f-131">Шаблоны CQRS и ддд описывают что-то внутри одной системы или компонент. в этом случае что-нибудь внутри микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="2e56f-131">CQRS and DDD patterns describe something inside a single system or component; in this case, something inside a microservice.</span></span>

<span data-ttu-id="2e56f-132">Различные шаблоны будущих ограниченных контекстах (BCs).</span><span class="sxs-lookup"><span data-stu-id="2e56f-132">Different Bounded Contexts (BCs) will employ different patterns.</span></span> <span data-ttu-id="2e56f-133">Они имеют различные обязанности, и это ведет к различные решения.</span><span class="sxs-lookup"><span data-stu-id="2e56f-133">They have different responsibilities, and that leads to different solutions.</span></span> <span data-ttu-id="2e56f-134">Стоит подчеркнуть, принудительное тот же шаблон, который everywhere приводит к сбою.</span><span class="sxs-lookup"><span data-stu-id="2e56f-134">It is worth emphasizing that forcing the same pattern everywhere leads to failure.</span></span> <span data-ttu-id="2e56f-135">Не используйте шаблоны CQRS и ддд everywhere.</span><span class="sxs-lookup"><span data-stu-id="2e56f-135">Do not use CQRS and DDD patterns everywhere.</span></span> <span data-ttu-id="2e56f-136">Многие подсистем, BCs или микрослужбами проще и можно реализовать более просто с помощью простых CRUD служб или другой подход.</span><span class="sxs-lookup"><span data-stu-id="2e56f-136">Many subsystems, BCs, or microservices are simpler and can be implemented more easily using simple CRUD services or using another approach.</span></span>

<span data-ttu-id="2e56f-137">Имеется только одно приложение архитектуры: архитектура системы или конца в конец приложения вы разрабатываете (например, архитектура микрослужбами).</span><span class="sxs-lookup"><span data-stu-id="2e56f-137">There is only one application architecture: the architecture of the system or end-to-end application you are designing (for example, the microservices architecture).</span></span> <span data-ttu-id="2e56f-138">Однако структуру каждого ограниченного контекста или микрослужбу этого приложения отражает собственные компромиссы и внутренние проектные решения на уровне шаблоны архитектуры.</span><span class="sxs-lookup"><span data-stu-id="2e56f-138">However, the design of each Bounded Context or microservice within that application reflects its own tradeoffs and internal design decisions at an architecture patterns level.</span></span> <span data-ttu-id="2e56f-139">Не пытайтесь применить те же архитектурные шаблоны как CQRS или DDD everywhere.</span><span class="sxs-lookup"><span data-stu-id="2e56f-139">Do not try to apply the same architectural patterns like CQRS or DDD everywhere.</span></span>

####  <a name="additional-resources"></a><span data-ttu-id="2e56f-140">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="2e56f-140">Additional resources</span></span>

-   <span data-ttu-id="2e56f-141">**Мартин Фоулер (Martin Fowler). CQRS**
    [*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span><span class="sxs-lookup"><span data-stu-id="2e56f-141">**Martin Fowler. CQRS**
[*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span></span>

-   <span data-ttu-id="2e56f-142">**Грег Янг. CQS vs. CQRS**
    [*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span><span class="sxs-lookup"><span data-stu-id="2e56f-142">**Greg Young. CQS vs. CQRS**
[*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span></span>

-   <span data-ttu-id="2e56f-143">**Грег Янг. Документы CQRS**
    [*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span><span class="sxs-lookup"><span data-stu-id="2e56f-143">**Greg Young. CQRS Documents**
[*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span></span>

-   <span data-ttu-id="2e56f-144">**Грег Янг. CQRS задач на основе пользовательских интерфейсов и источники событий**
    [*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span><span class="sxs-lookup"><span data-stu-id="2e56f-144">**Greg Young. CQRS, Task Based UIs and Event Sourcing**
[*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span></span>

-   <span data-ttu-id="2e56f-145">**UDI Dahan. Добавлено пояснение CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="2e56f-145">**Udi Dahan. Clarified CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="2e56f-146">**CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="2e56f-146">**CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="2e56f-147">**Источники событий (ES)**
    [*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span><span class="sxs-lookup"><span data-stu-id="2e56f-147">**Event-Sourcing (ES)**
[*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="2e56f-148">[Предыдущие] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Далее] (cqrs микрослужбу reads.md)</span><span class="sxs-lookup"><span data-stu-id="2e56f-148">[Previous] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Next] (cqrs-microservice-reads.md)</span></span>
