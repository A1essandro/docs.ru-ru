---
title: "Применение упрощенных шаблонов CQRS и DDD в микрослужбах"
description: "Архитектура микрослужб .NET для контейнерных приложений .NET | Применение упрощенных шаблонов CQRS и DDD в микрослужбах"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: 5369ff73a0614170b220177f1e5d388483ca19f8
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/23/2017
---
# <a name="applying-simplified-cqrs-and-ddd-patterns-in-a-microservice"></a>Применение упрощенных шаблонов CQRS и DDD в микрослужбах

CQRS — это шаблон архитектуры, который разделяет модели для чтения и записи данных. Соответствующее понятие [Разделение команд и запросов (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) было дано Бертраном Мейером в его книге *Объектно-ориентированное конструирование программных систем*. Базовая идея состоит в том, что вы можете разделить операции системы на две четкие категории:

-   Запросы. Они возвращают результат, не изменяют состояние системы и не обладают побочными эффектами.

-   Команды. Они изменяют состояние системы.

CQS — простое понятие. Оно означает, что методы в одном и том же объекте должны быть либо запросами, либо командами. Каждый метод возвращает состояние или изменяет состояние, но не делает и то, и другое одновременно. Объект шаблона даже одного репозитория может соответствовать CQS. CQS может считаться фундаментальным принципом CQRS.

Принцип [разделения ответственности команд и запросов (CQRS)](https://martinfowler.com/bliki/CQRS.html) был введен Грегом Янгом и активно распространяется Уди Даханом и другими. Он основан на принципе CQS, но более детален. Его можно рассматривать как шаблон, основанный на командах и событиях с возможностью использовать асинхронные сообщения. Во многих случаях CQRS относится к более сложным сценариям, например, использование отдельных баз данных для операций чтения (запросов) и для операций записи (обновлений). Кроме того, в более сложной системе CQRS можно реализовать [Использование событий в качестве источников (ES)](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/) и хранить в модели предметной области только события вместо данных о текущем состоянии. Однако в данном руководстве этот подход не применяется. Мы используем простой подход CQRS, который включает только отделение запросов от команд.

Это отделение в CQRS достигается за счет группирования операций запроса на одном уровне и команд на другом уровне. На каждом уровне есть собственная модель данных (обратите внимание, что понятие "модель" не всегда означает другую базу данных), и она создается с использованием собственного сочетания шаблонов и технологий. Более того, эти два уровня могут находиться в пределах одного уровня или одной микрослужбы, как показано в примере, используемом в этом руководстве (микрослужба сортировки). Или они могут быть реализованы в различных микрослужбах или процессах, чтобы их можно было оптимизировать и масштабировать отдельно, так чтобы они не влияли друг на друга.

В CQRS для операций чтения и записи используются два объекта, а в других контекстах — один. База данных с денормализованными операциями чтения может быть удобной в некоторых ситуациях. О них можно узнать из более сложной литературы по CQRS. Но мы не будем использовать этот подход, так как наша цель — получить большую гибкость в запросах, а не ограничивать их из-за ограничений, присущих шаблонам DDD, таким как агрегаты.

Примером такого рода службы является микрослужба сортировки из примера приложения eShopOnContainers. Эта служба реализует микрослужбу на основе упрощенного подхода CQRS. В нем используется один источник данных или база данных, но две логических модели, а также шаблоны DDD для транзакционного домена, как показано на рис. 9-2.

![](./media/image2.png)

**Рис. 9-2**. Упрощенная микрослужба на основе CQRS и DDD

В качестве уровня приложения можно использовать само веб-API. Важный аспект создания такой архитектуры состоит в том, что в соответствии с шаблоном CQRS микрослужба отделила запросы и модели представлений (модели данных, созданные специально для клиентских приложений) от команд, модели предметной области и транзакций. Этот подход позволяет сохранить независимость запросов от ограничений шаблонов DDD, которые имеют смысл только для транзакций и обновлений, как описано в следующих разделах.


>[!div class="step-by-step"]
[Назад] (index.md) [Далее] (eshoponcontainers-cqrs-ddd-microservice.md)
