---
title: "Применение упрощенный CQRS и ддд шаблонов в микрослужбу"
description: "Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Применение упрощенный CQRS и ддд шаблонов в микрослужбу"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 99fd7ce32039742e23f8e01aa4c33cddd7a9f698
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="applying-simplified-cqrs-and-ddd-patterns-in-a-microservice"></a><span data-ttu-id="224ce-104">Применение упрощенный CQRS и ддд шаблонов в микрослужбу</span><span class="sxs-lookup"><span data-stu-id="224ce-104">Applying simplified CQRS and DDD patterns in a microservice</span></span>

<span data-ttu-id="224ce-105">CQRS — это архитектуры шаблон, который отделяет моделей для чтения и записи данных.</span><span class="sxs-lookup"><span data-stu-id="224ce-105">CQRS is an architectural pattern that separates the models for reading and writing data.</span></span> <span data-ttu-id="224ce-106">Связанные термин [разделение команды запроса (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) была изначально определена по Ильина Bertrand в своей книге *создания программного обеспечения ориентированного объекта*.</span><span class="sxs-lookup"><span data-stu-id="224ce-106">The related term [Command Query Separation (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) was originally defined by Bertrand Meyer in his book *Object Oriented Software Construction*.</span></span> <span data-ttu-id="224ce-107">Основная идея заключается в разделять операций системы на две категории резко запятыми:</span><span class="sxs-lookup"><span data-stu-id="224ce-107">The basic idea is that you can divide a system’s operations into two sharply separated categories:</span></span>

-   <span data-ttu-id="224ce-108">Запросы.</span><span class="sxs-lookup"><span data-stu-id="224ce-108">Queries.</span></span> <span data-ttu-id="224ce-109">Они возвращают результат и не изменять состояние системы, и они свободны от побочных эффектов.</span><span class="sxs-lookup"><span data-stu-id="224ce-109">These return a result and do not change the state of the system, and they are free of side effects.</span></span>

-   <span data-ttu-id="224ce-110">Команды.</span><span class="sxs-lookup"><span data-stu-id="224ce-110">Commands.</span></span> <span data-ttu-id="224ce-111">Эти изменения состояния системы.</span><span class="sxs-lookup"><span data-stu-id="224ce-111">These change the state of a system.</span></span>

<span data-ttu-id="224ce-112">CQS — это простое понятие — это касается методов в этом же объекте, запросов или команд.</span><span class="sxs-lookup"><span data-stu-id="224ce-112">CQS is a simple concept—it is about methods within the same object being either queries or commands.</span></span> <span data-ttu-id="224ce-113">Каждый метод возвращает состояние или изменяет состояние, но не оба.</span><span class="sxs-lookup"><span data-stu-id="224ce-113">Each method either returns state or mutates state, but not both.</span></span> <span data-ttu-id="224ce-114">Объект шаблона даже одного репозитория может соответствовать CQS.</span><span class="sxs-lookup"><span data-stu-id="224ce-114">Even a single repository pattern object can comply with CQS.</span></span> <span data-ttu-id="224ce-115">CQS могут считаться фундаментальные принцип для CQRS.</span><span class="sxs-lookup"><span data-stu-id="224ce-115">CQS can be considered a foundational principle for CQRS.</span></span>

<span data-ttu-id="224ce-116">[Команда и разделение ответственности запросов (CQRS)](https://martinfowler.com/bliki/CQRS.html) введенный Грег Янгом и строго распространяемых Udi Dahan и др.</span><span class="sxs-lookup"><span data-stu-id="224ce-116">[Command and Query Responsibility Segregation (CQRS)](https://martinfowler.com/bliki/CQRS.html) was introduced by Greg Young and strongly promoted by Udi Dahan and others.</span></span> <span data-ttu-id="224ce-117">Он основан на принципе CQS, несмотря на то, что более подробно.</span><span class="sxs-lookup"><span data-stu-id="224ce-117">It is based on the CQS principle, although it is more detailed.</span></span> <span data-ttu-id="224ce-118">Его можно применять шаблон, основанный на команды и события, а также при необходимости на асинхронных сообщениях.</span><span class="sxs-lookup"><span data-stu-id="224ce-118">It can be considered a pattern based on commands and events plus optionally on asynchronous messages.</span></span> <span data-ttu-id="224ce-119">Во многих случаях CQRS относится к более сложных сценариев, как если бы у разных физической базы данных для чтения (запросы), чем для операций записи (обновления).</span><span class="sxs-lookup"><span data-stu-id="224ce-119">In many cases, CQRS is related to more advanced scenarios, like having a different physical database for reads (queries) than for writes (updates).</span></span> <span data-ttu-id="224ce-120">Кроме того, может реализовать более доработанной системы CQRS [источники событий (ES)](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/) для обновления базы данных, таким образом будет только хранить события в модели домена вместо сохранения текущего состояния данных.</span><span class="sxs-lookup"><span data-stu-id="224ce-120">Moreover, a more evolved CQRS system might implement [Event-Sourcing (ES)](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/) for your updates database, so you would only store events in the domain model instead of storing the current-state data.</span></span> <span data-ttu-id="224ce-121">Однако это не этот подход используется в этом руководстве; Мы используем простой подход CQRS, который состоит только разделения запросов с помощью команд.</span><span class="sxs-lookup"><span data-stu-id="224ce-121">However, this is not the approach used in this guide; we are using the simplest CQRS approach, which consists of just separating the queries from the commands.</span></span>

<span data-ttu-id="224ce-122">Разделение аспектом CQRS достигается за счет группирования операций запроса в одном слое и команд в другом слое.</span><span class="sxs-lookup"><span data-stu-id="224ce-122">The separation aspect of CQRS is achieved by grouping query operations in one layer and commands in another layer.</span></span> <span data-ttu-id="224ce-123">Каждый слой имеет свою собственную модель данных (Обратите внимание, что мы говорим модели, не обязательно другую базу данных) и построен с использованием собственный сочетание шаблоны и технологий.</span><span class="sxs-lookup"><span data-stu-id="224ce-123">Each layer has its own data model (note that we say model, not necessarily a different database) and is built using its own combination of patterns and technologies.</span></span> <span data-ttu-id="224ce-124">Более того два уровня может быть одного уровня или микрослужбу, как показано в примере (Сортировка микрослужбу) используется в данном руководстве.</span><span class="sxs-lookup"><span data-stu-id="224ce-124">More importantly, the two layers can be within the same tier or microservice, as in the example (ordering microservice) used for this guide.</span></span> <span data-ttu-id="224ce-125">Или может быть реализован на разных микрослужбами или процессов, поэтому оптимизированными и отдельно масштабировать без взаимного влияния.</span><span class="sxs-lookup"><span data-stu-id="224ce-125">Or they could be implemented on different microservices or processes so they can be optimized and scaled out separately without affecting one another.</span></span>

<span data-ttu-id="224ce-126">CQRS означает, что два объекта для операции чтения и записи, где в других контекстах имеется один.</span><span class="sxs-lookup"><span data-stu-id="224ce-126">CQRS means having two objects for a read/write operation where in other contexts there is one.</span></span> <span data-ttu-id="224ce-127">Существует причин денормализованные операций чтения, база данных, который можно узнать о более сложных литература CQRS.</span><span class="sxs-lookup"><span data-stu-id="224ce-127">There are reasons to have a denormalized reads database, which you can learn about in more advanced CQRS literature.</span></span> <span data-ttu-id="224ce-128">Но не используются, этот подход, где предназначена для того, чтобы иметь большую гибкость в запросах, вместо ограничения запросов с ограничениями из шаблонов DDD как статистические выражения.</span><span class="sxs-lookup"><span data-stu-id="224ce-128">But we are not using that approach here, where the goal is to have more flexibility in the queries instead of limiting the queries with constraints from DDD patterns like aggregates.</span></span>

<span data-ttu-id="224ce-129">Примером такого рода службы является упорядочивания микрослужбу из приложения eShopOnContainers ссылки.</span><span class="sxs-lookup"><span data-stu-id="224ce-129">An example of this kind of service is the ordering microservice from the eShopOnContainers reference application.</span></span> <span data-ttu-id="224ce-130">Эта служба реализует микрослужбу, в зависимости от упрощенный подход CQRS.</span><span class="sxs-lookup"><span data-stu-id="224ce-130">This service implements a microservice based on a simplified CQRS approach.</span></span> <span data-ttu-id="224ce-131">В нем одного источника данных или базы данных, но два логическими моделями плюс DDD шаблоны для транзакций домена, как показано на рисунке 9-2.</span><span class="sxs-lookup"><span data-stu-id="224ce-131">It uses a single data source or database, but two logical models plus DDD patterns for the transactional domain, as shown in Figure 9-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="224ce-132">**Рис. 9-2**.</span><span class="sxs-lookup"><span data-stu-id="224ce-132">**Figure 9-2**.</span></span> <span data-ttu-id="224ce-133">Упрощенная CQRS DDD основе и микрослужбу</span><span class="sxs-lookup"><span data-stu-id="224ce-133">Simplified CQRS- and DDD-based microservice</span></span>

<span data-ttu-id="224ce-134">Уровень приложения может быть сам веб-API.</span><span class="sxs-lookup"><span data-stu-id="224ce-134">The application layer can be the Web API itself.</span></span> <span data-ttu-id="224ce-135">Здесь пропорции существенные из команды, модель домена и транзакции, следующие за шаблон CQRS является микрослужбу разделяется, запросы и ViewModels (модели данных, специально создана для клиентских приложений).</span><span class="sxs-lookup"><span data-stu-id="224ce-135">The important design aspect here is that the microservice has split the queries and ViewModels (data models especially created for the client applications) from the commands, domain model, and transactions following the CQRS pattern.</span></span> <span data-ttu-id="224ce-136">Этот подход позволяет запросы независимо от ограничения и ограничения, поступающих от DDD шаблоны, которые имеют смысл только для транзакций и обновлений, как описано в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="224ce-136">This approach keeps the queries independent from restrictions and constraints coming from DDD patterns that only make sense for transactions and updates, as explained in later sections.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="224ce-137">[Предыдущие] (index.md) [Далее] (eshoponcontainers-cqrs ддд microservice.md)</span><span class="sxs-lookup"><span data-stu-id="224ce-137">[Previous] (index.md) [Next] (eshoponcontainers-cqrs-ddd-microservice.md)</span></span>
