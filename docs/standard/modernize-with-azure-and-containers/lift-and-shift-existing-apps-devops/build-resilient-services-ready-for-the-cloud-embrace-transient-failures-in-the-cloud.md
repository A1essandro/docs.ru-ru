---
title: Построение гибких служб готов для облака. Принять временные сбои в облаке
description: Архитектура Микрослужбами .NET для приложений .NET в контейнерах | Построение гибких служб готов для облака. Принять временные сбои в облаке
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 10/26/2017
ms.prod: .net
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: 0ac1d67a5b5b9a19f47c1d20eeb446977466510f
ms.sourcegitcommit: 2e8acae16ae802f2d6d04e3ce0a6dbf04e476513
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2018
---
# <a name="build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud"></a><span data-ttu-id="fbe42-105">Построение гибких служб готов для облака: принятию временные сбои в облаке</span><span class="sxs-lookup"><span data-stu-id="fbe42-105">Build resilient services ready for the cloud: Embrace transient failures in the cloud</span></span>

<span data-ttu-id="fbe42-106">Устойчивость — это возможность восстановления после сбоев и продолжение работы.</span><span class="sxs-lookup"><span data-stu-id="fbe42-106">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="fbe42-107">Устойчивость не о как избежать ошибок, но принимает тот факт, что происходит сбой и затем реакции на них в, позволяющих избежать простою или потере данных.</span><span class="sxs-lookup"><span data-stu-id="fbe42-107">Resiliency is not about avoiding failures, but accepting the fact that failures will occur, and then responding to them in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="fbe42-108">Цель устойчивости — вернуть приложение в полностью функционирующее состояние после сбоя.</span><span class="sxs-lookup"><span data-stu-id="fbe42-108">The goal of resiliency is to return the application to a fully functioning state after a failure.</span></span>

<span data-ttu-id="fbe42-109">Приложение будет готово для облака, если по крайней мере, он реализует модель на основе программного обеспечения устойчивости, а не модель на основе оборудования.</span><span class="sxs-lookup"><span data-stu-id="fbe42-109">Your application is ready for the cloud when, at a minimum, it implements a software-based model of resiliency, rather than a hardware-based model.</span></span> <span data-ttu-id="fbe42-110">Облачные приложения должен учесть частичные сбои, которые наверняка возникнет.</span><span class="sxs-lookup"><span data-stu-id="fbe42-110">Your cloud application must embrace the partial failures that will certainly occur.</span></span> <span data-ttu-id="fbe42-111">Необходимо разработать или частично рефакторинг приложения, если требуется добиться устойчивость к отказам ожидаемый частичной.</span><span class="sxs-lookup"><span data-stu-id="fbe42-111">You need to design or partially refactor your application if you want to achieve resiliency to expected partial failures.</span></span> <span data-ttu-id="fbe42-112">Его необходимо предусмотреть справляться с частичные сбои, как сбои в работе временного сетевого и узлы или виртуальные машины, аварийное завершение работы в облаке.</span><span class="sxs-lookup"><span data-stu-id="fbe42-112">It should be designed to cope with partial failures, like transient network outages and nodes, or VMs crashing in the cloud.</span></span> <span data-ttu-id="fbe42-113">Даже контейнеры перемещается на другой узел в кластере orchestrator может привести к временные короткий неполадки в приложении.</span><span class="sxs-lookup"><span data-stu-id="fbe42-113">Even containers being moved to a different node within an orchestrator cluster can cause intermittent short failures within the application.</span></span>

## <a name="handling-partial-failure"></a><span data-ttu-id="fbe42-114">Обработка частичного сбоя</span><span class="sxs-lookup"><span data-stu-id="fbe42-114">Handling partial failure</span></span>

<span data-ttu-id="fbe42-115">В приложении облачной нет штат постоянно риск частичных сбоев.</span><span class="sxs-lookup"><span data-stu-id="fbe42-115">In a cloud-based application, there's an ever-present risk of partial failure.</span></span> <span data-ttu-id="fbe42-116">Для экземпляра экземпляр одного веб-сайта или контейнер может произойти сбой, или он может быть недоступен или не отвечает в течение некоторого времени.</span><span class="sxs-lookup"><span data-stu-id="fbe42-116">For instance, a single website instance or a container might fail, or it might be unavailable or unresponsive for a short time.</span></span> <span data-ttu-id="fbe42-117">Или одной виртуальной Машины или сервере может завершиться со сбоем.</span><span class="sxs-lookup"><span data-stu-id="fbe42-117">Or, a single VM or server might crash.</span></span>

<span data-ttu-id="fbe42-118">Поскольку клиенты и службы являются отдельными процессами, службы могут не иметь возможность своевременно ответить на запрос клиента.</span><span class="sxs-lookup"><span data-stu-id="fbe42-118">Because clients and services are separate processes, a service might not be able to respond in a timely manner to a client's request.</span></span> <span data-ttu-id="fbe42-119">Служба может быть перегружена и очень медленно реагировать на запросы или он может просто быть недоступна в течение некоторого времени из-за сетевых проблем.</span><span class="sxs-lookup"><span data-stu-id="fbe42-119">The service might be overloaded and respond extremely slowly to requests, or it might simply not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="fbe42-120">Например рассмотрим монолитные приложения .NET, который обращается к базе данных в базе данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="fbe42-120">For example, consider a monolithic .NET application that accesses a database in Azure SQL Database.</span></span> <span data-ttu-id="fbe42-121">Если база данных Azure SQL или любой другой службы сторонних разработчиков не отвечает в течение кратких времени (базы данных Azure SQL может быть перемещена на другой узел или сервер, а не отвечать в течение нескольких секунд), когда пользователь пытается выполнить какие-либо действия, приложение может завершиться со сбоем и Показать w исключение в то же самое время.</span><span class="sxs-lookup"><span data-stu-id="fbe42-121">If the Azure SQL database or any other third-party service is unresponsive for a brief time (an Azure SQL database might be moved to a different node or server, and be unresponsive for a few seconds), when the user tries to do any action, the application might crash and show an exception at the very same moment.</span></span>

<span data-ttu-id="fbe42-122">Похожее может произойти в приложении, которое использует службы HTTP.</span><span class="sxs-lookup"><span data-stu-id="fbe42-122">A similar scenario might occur in an app that consumes HTTP services.</span></span> <span data-ttu-id="fbe42-123">В сети или самой службы могут оказаться недоступными в облаке short, временного сбоя.</span><span class="sxs-lookup"><span data-stu-id="fbe42-123">The network or the service itself might not be available in the cloud during a short, transient failure.</span></span>

<span data-ttu-id="fbe42-124">Надежное приложение, как показано на рисунке 4 – 9 должны реализовывать такие методы, как «повторных попыток с экспоненциально растущим» для предоставления приложению возможность обработки временных сбоев в ресурсах.</span><span class="sxs-lookup"><span data-stu-id="fbe42-124">A resilient application like the one shown in Figure 4-9 should implement techniques like "retries with exponential backoff" to give the application an opportunity to handle transient failures in resources.</span></span> <span data-ttu-id="fbe42-125">«Размыкатели» также следует использовать в приложениях.</span><span class="sxs-lookup"><span data-stu-id="fbe42-125">You also should use "circuit breakers" in your applications.</span></span> <span data-ttu-id="fbe42-126">Размыкатель цепи прекращает попытки доступа к ресурсу, если это длительный сбой приложения.</span><span class="sxs-lookup"><span data-stu-id="fbe42-126">A circuit breaker stops an application from trying to access a resource when it's actually a long-term failure.</span></span> <span data-ttu-id="fbe42-127">Используя Размыкатель цепи, приложение позволяет избежать подстегивающих мысль отказ в обслуживании на самого себя.</span><span class="sxs-lookup"><span data-stu-id="fbe42-127">By using a circuit breaker, the application avoids provoking a denial of service to itself.</span></span>

![Частичные сбои, обрабатываемых повторных попыток с экспоненциально растущим](./media/image9.png)

> <span data-ttu-id="fbe42-129">**На рисунке 4 – 9.**</span><span class="sxs-lookup"><span data-stu-id="fbe42-129">**Figure 4-9.**</span></span> <span data-ttu-id="fbe42-130">Частичные сбои, обрабатываемых повторных попыток с экспоненциально растущим</span><span class="sxs-lookup"><span data-stu-id="fbe42-130">Partial failures handled by retries with exponential backoff</span></span>

<span data-ttu-id="fbe42-131">Эти методы можно использовать в HTTP-ресурсов и ресурсов баз данных.</span><span class="sxs-lookup"><span data-stu-id="fbe42-131">You can use these techniques both in HTTP resources and in database resources.</span></span> <span data-ttu-id="fbe42-132">В на рисунке 4 – 9, приложение основано на 3-уровневой архитектуре, поэтому необходимо, чтобы эти методы на уровне службы (HTTP) и на уровне данных (TCP).</span><span class="sxs-lookup"><span data-stu-id="fbe42-132">In Figure 4-9, the application is based on a 3-tier architecture, so you need these techniques at the services level (HTTP) and at the data tier level (TCP).</span></span> <span data-ttu-id="fbe42-133">Монолитные приложения, использующего только одно приложение для уровня в дополнение к базе данных (без дополнительных служб или микрослужбами) обработка временных ошибок подключения на уровне базы данных будет достаточно.</span><span class="sxs-lookup"><span data-stu-id="fbe42-133">In a monolithic application that uses only a single app tier in addition to the database (no additional services or microservices), handling transient failures at the database connection level might be enough.</span></span> <span data-ttu-id="fbe42-134">В этом случае требуется обычно только конкретной конфигурации подключения к базе данных.</span><span class="sxs-lookup"><span data-stu-id="fbe42-134">In that scenario, usually just a particular configuration of the database connection is required.</span></span>

<span data-ttu-id="fbe42-135">При реализации гибкой связи, доступ к базе данных, в зависимости от версии .NET с помощью, может быть очень просто (например, [Entity Framework 6 или более поздней версии](https://msdn.microsoft.com/library/dn456835(v=vs.113).aspx), это лишь Настройка подключение базы данных).</span><span class="sxs-lookup"><span data-stu-id="fbe42-135">When implementing resilient communications that access the database, depending on the version of .NET you are using, it can be very straightforward (for example, [with Entity Framework 6 or later](https://msdn.microsoft.com/library/dn456835(v=vs.113).aspx), it's just a matter of configuring the database connection).</span></span> <span data-ttu-id="fbe42-136">Или, может потребоваться использовать дополнительные библиотеки, такие как [временных Fault Handling Application Block](https://msdn.microsoft.com/library/hh680934(v=pandp.50).aspx) (для более ранних версиях .NET), или даже реализуют собственные библиотеки.</span><span class="sxs-lookup"><span data-stu-id="fbe42-136">Or, you might need to use additional libraries like the [Transient Fault Handling Application Block](https://msdn.microsoft.com/library/hh680934(v=pandp.50).aspx) (for earlier versions of .NET), or even implement your own library.</span></span>

<span data-ttu-id="fbe42-137">При реализации попыток HTTP и выключатели, для .NET рекомендуется использовать [Polly](https://github.com/App-vNext/Polly) библиотеки, который нацелен на .NET 4.0, .NET 4.5 и .NET Standard 1.1, которая включает поддержку .NET Core.</span><span class="sxs-lookup"><span data-stu-id="fbe42-137">When implementing HTTP retries and circuit breakers, the recommendation for .NET is to use the [Polly](https://github.com/App-vNext/Polly) library, which targets .NET 4.0, .NET 4.5, and .NET Standard 1.1, which includes .NET Core support.</span></span>

<span data-ttu-id="fbe42-138">Чтобы узнать, как для реализации стратегии для обработки частичные сбои в облаке, см. следующие ссылки.</span><span class="sxs-lookup"><span data-stu-id="fbe42-138">To learn how to implement strategies for handling partial failures in the cloud, see the following references.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="fbe42-139">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="fbe42-139">Additional resources</span></span>

-   <span data-ttu-id="fbe42-140">**Реализация гибкой связи для обработки частичный сбой**</span><span class="sxs-lookup"><span data-stu-id="fbe42-140">**Implementing resilient communication to handle partial failure**</span></span>

    [https://docs.microsoft.com/dotnet/standard/microservices-architecture/implement-resilient-applications/partial-failure-strategies](../../microservices-architecture/implement-resilient-applications/partial-failure-strategies.md)

-   <span data-ttu-id="fbe42-141">**Entity Framework подключения устойчивости и логика повторных попыток (версия 6 и более поздние версии)**</span><span class="sxs-lookup"><span data-stu-id="fbe42-141">**Entity Framework connection resiliency and retry logic (version 6 and later)**</span></span>

    [https://msdn.microsoft.com/library/dn456835(v=vs.113).aspx](https://msdn.microsoft.com/library/dn456835(v=vs.113).aspx)

-   <span data-ttu-id="fbe42-142">**Блок приложения обработки временных сбоев**</span><span class="sxs-lookup"><span data-stu-id="fbe42-142">**The Transient Fault Handling Application Block**</span></span>

-   [https://msdn.microsoft.com/library/hh680934(v=pandp.50).aspx](https://msdn.microsoft.com/library/hh680934(v=pandp.50).aspx)

-   <span data-ttu-id="fbe42-143">**Библиотека Polly для гибкой взаимодействие по протоколу HTTP**</span><span class="sxs-lookup"><span data-stu-id="fbe42-143">**Polly library for resilient HTTP communication**</span></span>

    https://github.com/App-vNext/Polly

>[!div class="step-by-step"]
<span data-ttu-id="fbe42-144">[Назад](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
[Вперед](modernize-your-apps-with-monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="fbe42-144">[Previous](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
[Next](modernize-your-apps-with-monitoring-and-telemetry.md)</span></span>
