---
title: Оркестрация микрослужбами и multicontainer приложений высокий уровень масштабируемости и доступности
description: Жизненный цикл контейнерного приложения Docker на основе платформы и средств Майкрософт
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/19/2017
ms.openlocfilehash: 3a505e10b2a37032a7ccfefdf4a6f4bb64d65486
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
---
# <a name="orchestrating-microservices-and-multicontainer-applications-for-high-scalability-and-availability"></a>Оркестрация микрослужбами и multicontainer приложений высокий уровень масштабируемости и доступности

Использование оркестраторов для приложений, готовых к развертыванию в рабочей среде, крайне важно, если приложение основано на микрослужбах или просто разнесено по нескольким контейнерам. Как было сказано ранее, в рамках подхода на основе микрослужб каждая микрослужба имеет собственную модель и данные, поэтому она является автономной с точки зрения разработки и развертывания. Но даже если у вас есть более традиционным приложения, состоящего из нескольких служб (например, SOA), также имеется несколько контейнеров или служб, образующих одной бизнес-приложений, необходимо развернуть как распределенная система. Эти виды систем сложны для горизонтального масштабирования и управления ими; Таким образом абсолютной необходимости orchestrator чтобы multicontainer приложение, в рабочей среде и масштабируемость.

Рис. 4-6 иллюстрирует развертывание на кластеры, состоящие из нескольких микрослужбами (контейнеров) приложения.

![](./media/image6.png)

Рис. 4-6: кластер контейнеров

Такой подход выглядит логичным. Но, как вы будете балансировки нагрузки, маршрутизацию и управляя операциями этих составных приложений?

Интерфейс командной строки Docker (CLI) потребностям управление один контейнер на одном узле, но не хватает, когда дело доходит до управление несколько контейнеров, которые развернуты на нескольких узлах для более сложных распределенных приложений. В большинстве случаев требуется платформа управления, который будет автоматически запустить контейнеры, приостанавливать их, или отключать их при необходимости и в идеале управляют как при доступе к ресурсам, например сети и хранения данных.

Чтобы перейти от управления отдельными контейнерами или очень простыми составными приложениями к управлению крупными корпоративными приложениями с микрослужбами, следует прибегнуть к платформам оркестрации и кластеризации.

С архитектуры и разработки точки зрения при наличии построение, крупным, основанный на микрослужбами, приложений, важно понять следующие платформы и продукты, которые поддерживают сложные сценарии:

-   **Кластеры и orchestrators** при необходимости масштабировать-приложениям на многих узлах Docker, такие как с большого приложения на основе микрослужбами крайне важно иметь возможность управлять всех этих узлов как кластер с Абстрагирование сложности базовой платформы. Именно такую возможность предоставляют кластеры контейнеров и оркестраторы. Примерами orchestrators являются помощью Docker Swarm, Mesosphere DC/OS, Kubernetes (первые три через контейнера службы Azure) и Azure Service Fabric.

-   **Планировщики** *планирования* означает возможность администратор может запустить контейнеры в кластере, чтобы они также предоставляют пользовательский интерфейс. Планировщик кластера имеет несколько функций: для эффективного использования ресурсов кластера, чтобы задать ограничения, предоставленный пользователем, эффективно контейнеры балансировки нагрузки между узлами или узлы и быть надежными от ошибок, обеспечивая высокий доступность.

Понятия кластера и планировщика тесно связаны друг с другом, поэтому продукты, предоставляемые разными поставщиками, часто включают в себя оба набора возможностей. В таблице 4-1 перечислены наиболее важные платформы и программного обеспечения варианты выбора для кластеров и планировщики. Эти кластеры обычно предоставляются в общедоступных облаках, таких как Azure.

Таблица 4-1: платформы программное обеспечение для кластеризации контейнера, управление и планирование

| Platform | Описание |
|---|---|
| Docker Swarm<br/> ![http://rancher.com/wp-content/themes/rancher-2016/assets/images/swarm.png?v=2016-07-10-am](./media/image7.png) | Docker группу мелких объектов дает возможность кластера и запланировать контейнеры Docker. С помощью Swarm можно превратить пул узлов Docker в единый виртуальный узел Docker. Клиенты могут выполнять запросы API для группу мелких объектов, таким же образом, как и на узлах, это означает, что группу мелких объектов позволяет масштабировать приложения с несколькими узлами. <br /><br /> Решение Docker Swarm предоставляется компанией Docker. <br /><br /> В Docker 1.12 или более поздней версии имеется встроенный режим Swarm. |
| Mesosphere DC/OS<br/>![https://mesosphere.com/wp-content/uploads/2016/04/logo-horizontal-styled.png](./media/image8.png) |  Mesosphere Enterprise DC/OS (на основе Apache Mesos) — это готовая к использованию в рабочей среде платформа для выполнения контейнеров и распределенных приложений. <br /><br /> DC/OS абстрагирует коллекцию ресурсов, доступных в кластере, и предоставляет доступ к ним компонентам, построенным на базе платформы. В качестве планировщика, интегрированного с DC/OS, обычно используется Marathon. |
| Google Kubernetes<br />![https://pbs.twimg.com/media/Bt\_pEfqCAAAiVyz.png](./media/image9.png) | Kubernetes — это решение с открытым кодом, которое предоставляет широкий ряд возможностей: от организации инфраструктуры кластера и планирования контейнеров до оркестрации. С его помощью можно автоматизировать развертывание, масштабирование и операций контейнеров приложения ко всем кластерам узлов. <br /><br /> Kubernetes предоставляет ориентированную на контейнеры инфраструктуру, которая объединяет контейнеры приложений в логические блоки, чтобы упростить управление и обнаружение. |
| Azure Service Fabric<br />![https://azure.microsoft.com/svghandler/service-fabric?width=600&height=315](./media/image10.png) | [Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview) — это платформа микрослужб от корпорации Майкрософт, которая предназначена для создания приложений. Она позволяет [оркестрировать](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-resource-manager-introduction) службы и создавать кластеры компьютеров. По умолчанию Service Fabric развертывает и активирует службы как процессы, но Service Fabric можно развернуть службы в образы контейнеров Docker. Более важно, можно комбинировать службами в процессах со службами в контейнерах в одном приложении. <br /><br /> По состоянию на май 2017 г. компонент Service Fabric, поддерживающего развертывание службы как контейнеры Docker находится в состоянии предварительной версии. <br /><br /> Можно разработать служб Service Fabric различными способами, с помощью [Service Fabric модели программирования](https://docs.microsoft.com/azure/service-fabric/service-fabric-choose-framework) до развертывания [гостевой исполняемые файлы](https://docs.microsoft.com/azure/service-fabric/service-fabric-deploy-existing-app) и контейнеры. Service Fabric поддерживает модели конкретные приложения как [служб с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction) и [службы Reliable Actor](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-actors-introduction).

## <a name="using-container-based-orchestrators-in-azure"></a>С помощью orchestrators на основе контейнера в Azure

Несколько поставщиков облачных обеспечивают поддержку контейнеры Docker, а также кластеры Docker и orchestration, включая поддержку Azure, контейнер службы Amazon EC2 и подсистема контейнеров Google. Azure поддерживает Docker кластера и orchestrator через службу контейнера Azure, как описано в следующем разделе.

Другой вариант — использовать Azure Service Fabric также поддерживает Docker на основе Linux и контейнеров Windows. Service Fabric запускается в Azure или любые другие облака в том числе в [локальной](https://docs.microsoft.com/azure/service-fabric/service-fabric-deploy-anywhere).

## <a name="using-azure-container-service"></a>Использование службы контейнеров Azure

Кластер Docker объединяет несколько узлов Docker в пул и предоставляет доступ к ним как к единому виртуальному узлу Docker, что позволяет развертывать несколько узлов в кластере. Кластер будет обрабатывать всё сложного управления например масштабируемость и работоспособности. Рис. 4-7 представляет сопоставление кластера Docker для составных приложений для службы контейнеров.

Контейнер службы предоставляет способ для упрощения создания, настройки и управления, кластера виртуальных машин, настроенных для запуска приложений в контейнерах. С помощью оптимизированного конфигурации популярных средств планирования и orchestration открытым исходным кодом, контейнер службы дает возможность использовать существующие навыки и отрисовки в теле большое и возрастающее опытом сообщества для развертывания и управления на основе контейнера приложения в Azure.

Контейнер службы оптимизирует конфигурации популярных Docker кластеризации открытым исходным кодом и технологии специально для Azure. Вы получаете открытое решение, которое обеспечивает переносимость как контейнеров, так и конфигурации приложения. Вы выбираете размер, число узлов и средства оркестрации, а служба контейнеров делает все остальное.

Контейнер службы использует образы Docker чтобы обеспечить полную переносимость контейнеры вашего приложения. Он поддерживает выбор orchestration с открытым исходным кодом платформы, такие как DC/OS, Kubernetes и с помощью Docker Swarm чтобы убедиться, что эти приложения можно масштабировать до тысяч или даже десятков тысяч контейнеров.

С помощью контейнера службы Azure вы сможете использовать высококлассные возможности Azure одновременно сохраняя переносимость приложения, включая orchestration уровнями.

![](./media/image11.png)

Рис. 4-7: кластеризации вариантов в контейнере службы Azure

Как показано на рисунке 4-8, служба контейнер является просто инфраструктуры Azure для развертывания контроллера домена/OS, Kubernetes или с помощью Docker Swarm, но он не реализует все дополнительные orchestrator. Таким образом служба контейнер является не orchestrator, таким образом; Это только это инфраструктура, которая использует преимущества существующей orchestrators с открытым исходным кодом для контейнеров.

![](./media/image12.png)

Рис. 4-8: Orchestrators в контейнер службы

С точки зрения использования службы контейнера предназначена для предоставления среды размещения контейнера с помощью популярных средств с открытым исходным кодом и технологий. С этой целью она предоставляет стандартные конечные точки API для выбранного оркестратора. Используя эти конечные точки, можно использовать программное обеспечение, которое может взаимодействовать с этими конечными точками. Например в случае с помощью Docker Swarm конечной точки, можно использовать Docker CLI. Для DC/OS можно выбрать интерфейс командной строки DC/OS.

### <a name="getting-started-with-container-service"></a>Приступая к работе со службой контейнера

Чтобы начать использование контейнера службы, развертывание кластера службы контейнеров из портала Azure с помощью шаблона Azure Resource Manager или [CLI](https://docs.microsoft.com/cli/azure/install-azure-cli). Доступные шаблоны включают в себя [Docker Swarm](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-swarm), [Kubernetes](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-kubernetes) и [DC/OS](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-dcos). Примеры использования шаблонов, чтобы включить дополнительные или расширенные конфигурации Azure можно изменить.

**Дополнительные сведения о** Дополнительные сведения о развертывании контейнера службы кластеров, на сайте Azure [развертывание кластера службы контейнера Azure](https://docs.microsoft.com/azure/container-service/dcos-swarm/container-service-deployment).

За программное обеспечение, устанавливаемое по умолчанию в составе службы ACS, плата не взимается. Все возможности по умолчанию реализуются с помощью ПО с открытым кодом.

Контейнер службы в настоящее время доступен для стандартных A, D, доменных служб Active Directory, G и GS серии виртуальных машин Linux в Azure. Плата взимается только для экземпляров вычислений, выбрать и другие базовой инфраструктуры ресурсы, используемые, такие как хранилища и сети. Отсутствуют добавочное накладные расходы для службы контейнеров сам.

### <a name="additional-resources"></a>Дополнительные ресурсы

Ниже перечислены расположения, где можно найти дополнительные сведения:

-   Введение в контейнер Docker размещения решений с помощью контейнера службы.  
    https://docs.microsoft.com/azure/container-service/kubernetes/container-service-intro-kubernetes>

-   Общие сведения о docker группу мелких объектов:  
    <https://docs.docker.com/swarm/overview/>

-   Общие сведения о режиме группу мелких объектов:  
    <https://docs.docker.com/engine/swarm/>

-   Общие сведения о mesosphere DC/OS:    
    <https://docs.mesosphere.com/1.7/overview/>

-   Kubernetes (официальный сайт):  
    <https://kubernetes.io/>

## <a name="using-service-fabric"></a>С помощью Service Fabric

От корпорации Майкрософт переход от доставки для доставки служб «поля» программных продуктов, которые были обычно монолитные в стиле, возникших Service Fabric. Процесс построения и эксплуатации больших служб в масштабе, например базы данных SQL Azure, Azure DB документа, Azure Service Bus или серверной Cortana в форму Service Fabric. Она продолжала развиваться по мере внедрения во множестве служб. Важно отметить, что Service Fabric работает не только в среде Azure, но и в автономных развертываниях Windows Server.

Для решения сложных проблем построения и запуска службы и эффективно использовать ресурсы инфраструктуры, чтобы команды можно решать бизнес-задачи, используя подход микрослужбами является целью Service Fabric.

Service Fabric предоставляет два масштабных решения, которые позволяют создавать приложения в рамках подхода на основе микрослужб.

-   Платформа, которая предоставляет системные службы для развертывания, обновления, обнаружения и перезапуска служб, в которых произошел сбой, а также обнаружения служб, управления состоянием и мониторинга работоспособности. Эти системные службы фактически предоставляют многие характеристики микрослужбами было описано выше.

-   Программные интерфейсы (API) или платформы, позволяющие создавать приложения как микрослужбы: [Reliable Actors и Reliable Services](https://docs.microsoft.com/azure/service-fabric/service-fabric-choose-framework). Для создания микрослужбы можно использовать любой код. Однако программные интерфейсы не только упрощают задачу, но и обеспечивают более глубокую интеграцию с платформой. Так вы можете, например, получать информацию о работоспособности и данные диагностики, а также пользоваться преимуществами средств управления надежным состоянием.

Для Service Fabric не важен способ создания службы, поэтому вы можете использовать любую технологию. Но эта платформа предоставляет встроенные интерфейсы API, упрощающие создание микрослужб.

На рисунке 4 – 9 показано, как создать и запустить микрослужбами в Service Fabric в виде простых процессов или как контейнеры Docker. Микрослужбы на основе контейнеров можно также сочетать с микрослужбами на основе процессов в рамках одного кластера Service Fabric.

![](./media/image13.png)

На рисунке 4 – 9: развертывание микрослужбами как процессы или контейнеры в Azure Service Fabric

Структуры службы кластеров на основе на узлах Linux и Windows можно запускать контейнеры Docker Linux и Windows.

**Дополнительные сведения о** актуальные сведения о поддержке контейнеры в Service Fabric на сайте Azure чтения [Service Fabric и контейнеры](https://docs.microsoft.com/azure/service-fabric/service-fabric-containers-overview).

Структура службы — это хороший пример платформы, с помощью которого можно определить другой логической архитектуры (business микрослужбами или ограниченного контексты) от физической реализации. Например, если вы реализуете [надежных служб с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction) в [Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview), которого представлены в следующем разделе «[Stateless сравнение с отслеживанием состояния микрослужбами](#stateless-versus-stateful-microservices),» у вас есть бизнес-концепция микрослужбу, с несколькими физический службами.

Как показано на рис. 4-10 и решения с точки зрения логического или business микрослужбу, при реализации службы с отслеживанием состояния надежные службы структуры обычно необходимо реализовать два уровня служб. Первый — в серверной части с отслеживанием состояния надежного службу, которая обрабатывает несколько секций. Второй уровень — это внешняя служба или служба шлюза, которая отвечает за маршрутизацию и объединение данных в разных разделах или экземплярах служб с отслеживанием состояния. Эту службу шлюза также обрабатывает клиентские взаимодействие с циклами повторных попыток доступа к внутренней службе, использовать в сочетании с Service Fabric [обратный прокси-сервер](https://docs.microsoft.com/azure/service-fabric/service-fabric-reverseproxy).

![](./media/image14.png)

Рис. 4-10: микрослужбу бизнеса с нескольких служб с отслеживанием состояния и без сохранения состояния в Service Fabric

В любом случае при использовании надежных служб Service Fabric с отслеживанием состояния у вас также есть логическая микрослужба или бизнес-микрослужба (ограниченный контекст), которая обычно состоит из нескольких физических служб. Каждый из них, служба шлюза и разделов службы может быть реализован как службы веб-API ASP.NET, как показано на рисунке 4-10.

В Service Fabric службы можно объединять в группы и развертывать как [приложение Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-application-model), которое представляет собой модуль упаковки и развертывания для оркестратора или кластера. Таким образом приложение Service Fabric может быть сопоставлен этот самостоятельных и микрослужбу логических границ или ограниченного контекста, также.

### <a name="service-fabric-and-containers"></a>Service Fabric и контейнеры

По отношению к контейнерам в Service Fabric можно развернуть службы в образы контейнеров в пределах кластера Service Fabric. Рис. 4-11 показана, большую часть времени, может содержать только один контейнер каждой службы.

![](./media/image15.png)

Рис. 4-11: микрослужбу бизнеса с несколькими службами (контейнеров) в Service Fabric

Тем не менее так называемые «сопроводительные» контейнеры (двух контейнеров, которые должны быть развернуты вместе как часть службы логических) также возможны в Service Fabric. Важным моментом является то, что бизнес-микрослужба — это логическая граница вокруг нескольких связанных элементов. Во многих случаях может быть одной службы с одной модели данных, но в некоторых других случаях может потребоваться физического несколько служб, а также.

Начиная с этой записи (апреле 2017 г.), в Service Fabric невозможно развернуть SF надежных служб с отслеживанием состояния в контейнерах, можно развернуть только контейнеры гостевой службы без сохранения состояния и служб субъекта в контейнерах. Но Обратите внимание, что вы можете сочетать в процессах и службы в контейнеры, в то же приложение Service Fabric как показано на рисунке 4-12.

![](./media/image16.png)

Рис. 4-12: Business микрослужбу сопоставлен с контейнерами и служб с отслеживанием состояния приложения Service Fabric

Поддержка также отличается в зависимости от того, используете ли вы контейнеры Docker на контейнеры Windows или Linux. Поддержка контейнеров в Service Fabric будет расширение в будущих выпусках. Последние новости о поддержке контейнера в Service Fabric на сайте Azure чтения [Service Fabric и контейнеры](https://docs.microsoft.com/azure/service-fabric/service-fabric-containers-overview).

## <a name="stateless-versus-stateful-microservices"></a>Микрослужбы с отслеживанием и без отслеживания состояния

Как уже упоминалось, у каждой микрослужбы (логического ограниченного контекста) должна быть своя модель предметной области (данные и логика). В случае без сохранения состояния микрослужбами базы данных будут внешних данных, построенных на реляционной вариантах, например SQL Server или NoSQL вариантах, например MongoDB или Azure DocumentDB.

Однако сами службы также можно с отслеживанием состояния, это означает, что данные находятся в пределах микрослужбу. Эти данные могут существовать не только на том же сервере, но внутри процесса микрослужбу в памяти и на дисках сохраняются и реплицируются на другие узлы. Рис. 4-13 показаны различные подходы.

![](./media/image17.png)

На рисунке 4 — 13: без учета состояния, сравнение с отслеживанием состояния микрослужбами

Правильный подход без сохранения состояния и проще реализовать чем микрослужбами с отслеживанием состояния, поскольку подход аналогичен шаблонов традиционных и хорошо известных. Но микрослужбы без отслеживания состояния вызывают задержку при взаимодействии процесса с источниками данных и вдобавок содержат больше "движущихся деталей", что осложняет повышение производительности за счет дополнительного кэша и очередей. Результат таков: вы можете получить более сложные архитектуры со слишком большим количеством уровней.

Напротив [с отслеживанием состояния микрослужбами](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction#when-to-use-reliable-services-apis) можно excel в сложных сценариях, так как нет задержка между доменную логику и данные. Обработка большого объема данных, игры заканчивается обратной, базы данных как службы и другие сценарии низкой задержкой, все преимущества служб с отслеживанием состояния, которые предоставляют локального состояния для более быстрого доступа.

Службы без отслеживания состояния и с отслеживанием состояния дополняют друг друга. Для экземпляра службы с отслеживанием состояния можно разбить на несколько разделов. Для доступа к этим разделам может потребоваться служба без отслеживания состояния, выступающая в роли службы шлюза и способная обращаться к каждому разделу с помощью ключей разделов.

У служб с отслеживанием состояния есть недостатки. Уровень сложности, что позволяет масштабировать ресурсов. Функциональность, которая обычно реализовывалась бы в рамках внешней базы данных, должна обрабатывать такие операции, как репликация данных между микрослужбами с отслеживанием состояния и секционирование данных. Тем не менее, это одна из областей, где orchestrator, например [Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-platform-architecture) с его [надежных служб с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction#when-to-use-reliable-services-apis) помогут наиболее — за счет упрощения разработки и жизненного цикла с отслеживанием состояния с помощью микрослужбами [надежные API служб](https://docs.microsoft.com/azure/service-fabric/service-fabric-work-with-reliable-collections) и [службы Reliable Actor](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-actors-introduction).

К другим платформам микрослужб, которые допускают использование служб с отслеживанием состояния и поддерживают шаблон субъекта, повышая отказоустойчивость и снижая задержки при взаимодействии между бизнес-логикой и данными, относятся Microsoft [Orleans](https://github.com/dotnet/orleans) от Microsoft Research и [Akka.NET](https://getakka.net/). В настоящее время идет работа над улучшением поддержки Docker в обеих этих платформах.

Учтите, что контейнеры Docker сами по себе не поддерживают отслеживание состояния. Чтобы реализовать службу с отслеживанием состояния, вам потребуется одна из высокоуровневых платформ, указанных выше. Однако на момент написания этой статьи с отслеживанием состояния службы в Service Fabric не поддерживается как контейнеры, только как обычный микрослужбами. Надежные службы поддержки в контейнерах, будут доступны в будущих версиях Service Fabric.


>[!div class="step-by-step"]
[Предыдущие] (soa-applications.md) [Далее] (docker приложения development-environment.md)
