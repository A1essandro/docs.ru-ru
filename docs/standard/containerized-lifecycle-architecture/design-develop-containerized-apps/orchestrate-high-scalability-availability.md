---
title: Управление микрослужбами и многоконтейнерными приложениями для обеспечения высокого уровня масштабируемости и доступности
description: Жизненный цикл контейнерного приложения Docker на основе платформы и средств Майкрософт
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/19/2017
ms.openlocfilehash: 993f1d18637f39b6df4d876db8a0fe86e34391e3
ms.sourcegitcommit: c93fd5139f9efcf6db514e3474301738a6d1d649
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/27/2018
ms.locfileid: "50192724"
---
# <a name="orchestrating-microservices-and-multicontainer-applications-for-high-scalability-and-availability"></a>Управление микрослужбами и многоконтейнерными приложениями для обеспечения высокого уровня масштабируемости и доступности

Использование оркестраторов для приложений, готовых к развертыванию в рабочей среде, крайне важно, если приложение основано на микрослужбах или просто разнесено по нескольким контейнерам. Как было сказано ранее, в рамках подхода на основе микрослужб каждая микрослужба имеет собственную модель и данные, поэтому она является автономной с точки зрения разработки и развертывания. Но даже если у вас есть более традиционные приложения, состоящего из нескольких служб (например, SOA), также имеется несколько контейнеров или служб, составляющих бизнес-приложение, которое необходимо развернуть по принципу распределенной системы. Такие системы сложны для горизонтального масштабирования и управления ими; Таким образом вы оркестратор абсолютно необходим, если требуется, чтобы производственную и масштабируемое многоконтейнерного приложения.

Рис. 4-6 показано развертывание в кластере приложения, состоящего из нескольких микрослужб (контейнеров).

![](./media/image6.png)

Рис. 4-6: кластер контейнеров

Такой подход выглядит логичным. Но как вы обрабатываются балансировки нагрузки, маршрутизацию и оркестрация этих составных приложений?

Интерфейс командной строки Docker (CLI) соответствует требованиям управления один контейнер на одном узле, но ее недостаточно, если требуется управлять множеством контейнеров, развернутых на нескольких узлах для более сложных распределенных приложений. В большинстве случаев требуется платформа управления, который будет автоматически запускать контейнеры, приостановки, или завершать их работу, при необходимости и в идеале также контролировать доступ к ресурсам, как сеть и хранилище данных.

Чтобы перейти от управления отдельными контейнерами или очень простыми составными приложениями к управлению крупными корпоративными приложениями с микрослужбами, следует прибегнуть к платформам оркестрации и кластеризации.

С архитектуры и разработки точки зрения Если построение корпоративных больших, на основе микрослужб, приложений, очень важно знать следующие платформы и продукты, которые поддерживают расширенные сценарии:

-   **Кластеры и оркестраторы** при необходимости масштабировать-приложениям на множестве узлов Docker, такие как с помощью большого приложения на базе микрослужб, крайне важно иметь возможность управлять всеми этими узлами как единым кластером, абстрагируясь от сложности базовой платформы. Вот какие преимущества предоставляет кластеры контейнеров и оркестраторы. Примерами оркестраторов могут Docker Swarm, Mesosphere DC/OS, Kubernetes (первые три доступных через службу контейнеров Azure) и Azure Service Fabric.

-   **Планировщики** *планирование* означает, что возможность администратору возможность запускать контейнеры в кластере таким образом, чтобы они также предоставляют пользовательский интерфейс. Планировщик кластера имеет несколько функций: для эффективного использования ресурсов кластера, чтобы задать ограничения, предоставленный пользователем, чтобы эффективно Балансировка нагрузки контейнеров между узлами и быть устойчивости к ошибкам, обеспечивая высокий доступность.

Понятия кластера и планировщика тесно связаны друг с другом, поэтому продукты, предоставляемые разными поставщиками, часто включают в себя оба набора возможностей. В таблице 4-1 перечислены наиболее важных платформ и программного обеспечения варианты кластерами и планирования. Эти кластеры обычно предоставляются в общедоступных облаках, таких как Azure.

В таблице 4-1: программные платформы для кластеризации контейнеров, оркестрации и планирования

| Platform | Описание |
|---|---|
| Docker Swarm<br/> ![Логотип docker Swarm](./media/image7.png) | Docker Swarm предоставляет возможность кластеризации и планирования контейнеров Docker. С помощью Swarm можно превратить пул узлов Docker в единый виртуальный узел Docker. Клиенты могут выполнять запросы API к Swarm так же, как и к узлам, это означает, что Swarm упрощает масштабирование приложений в нескольких узлах. <br /><br /> Решение Docker Swarm предоставляется компанией Docker. <br /><br /> В Docker 1.12 или более поздней версии имеется встроенный режим Swarm. |
| Mesosphere DC/OS<br/>![Логотип mesosphere DC/OS](./media/image8.png) |  Mesosphere Enterprise DC/OS (на основе Apache Mesos) — это готовая к использованию в рабочей среде платформа для выполнения контейнеров и распределенных приложений. <br /><br /> DC/OS абстрагирует коллекцию ресурсов, доступных в кластере, и предоставляет доступ к ним компонентам, построенным на базе платформы. В качестве планировщика, интегрированного с DC/OS, обычно используется Marathon. |
| Google Kubernetes<br />![Логотип Google Kubernetes](./media/image9.png) | Kubernetes — это решение с открытым кодом, которое предоставляет широкий ряд возможностей: от организации инфраструктуры кластера и планирования контейнеров до оркестрации. С ее помощью можно автоматизировать развертывание, масштабирование и операций в контейнерах приложений в кластерах узлов. <br /><br /> Kubernetes предоставляет ориентированную на контейнеры инфраструктуру, которая объединяет контейнеры приложений в логические блоки, чтобы упростить управление и обнаружение. |
| Azure Service Fabric<br />![Логотип Azure Service Fabric](./media/image10.png) | [Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview) — это платформа микрослужб от корпорации Майкрософт, которая предназначена для создания приложений. Она позволяет [оркестрировать](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-resource-manager-introduction) службы и создавать кластеры компьютеров. По умолчанию Service Fabric развертывает и активирует службы как процессы, но Service Fabric позволяет развертывать службы в образах контейнеров Docker. Что более важно, можно комбинировать службы в процессах и службы в контейнерах в одном приложении. <br /><br /> По состоянию на май 2017 г. особенностью Service Fabric, которая поддерживает развертывание службы в качестве контейнеров Docker находится в состоянии предварительной версии. <br /><br /> Вы можете разрабатывать службы Service Fabric во многих отношениях, с помощью [моделей программирования Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-choose-framework) развертыванию [гостевых исполняемых файлов](https://docs.microsoft.com/azure/service-fabric/service-fabric-deploy-existing-app) а также контейнеры. Service Fabric поддерживает модели конкретные приложения, например [служб с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction) и [Reliable Actors](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-actors-introduction).

## <a name="using-container-based-orchestrators-in-azure"></a>Использование оркестраторов на основе контейнеров в Azure

Несколько поставщиков облачных решений предлагают поддержку контейнеров Docker, а также кластеров Docker и поддержки оркестрации, включая Azure, Amazon EC2 Container Service и Google Container Engine. Azure предоставляет поддержку кластера и оркестратора посредством службы контейнеров Azure, Docker, как описано в следующем разделе.

Другой вариант — использовать Azure Service Fabric, которая также поддерживает Docker на основе Linux и контейнеров Windows. Service Fabric выполняется на Azure, любое иное облако производительны [локальной](https://docs.microsoft.com/azure/service-fabric/service-fabric-deploy-anywhere).

## <a name="using-azure-container-service"></a>Использование службы контейнеров Azure

Кластер Docker объединяет несколько узлов Docker в пул и предоставляет доступ к ним как к единому виртуальному узлу Docker, что позволяет развертывать несколько узлов в кластере. Кластер будет обрабатывать всё комплексного управления например масштабируемости и работоспособности. Рис. 4-7 представляет сопоставление кластер Docker для составных приложений в службе контейнеров.

Служба контейнеров позволяет упростить создание, Настройка и управление этим кластером виртуальных машин, настроенных для запуска контейнерных приложений. Благодаря оптимизированной конфигурации популярных средств планирования и оркестрации открытым исходным кодом, служба контейнеров позволяет использовать имеющиеся навыки или прибегая тела большого и постоянно растущего сообщества опыт развертывания и управления ими на основе контейнеров приложения в Azure.

Служба контейнеров оптимизирует специально под Azure конфигурацию популярных средств с открытым кодом кластеризации Docker и технологий. Вы получаете открытое решение, которое обеспечивает переносимость как контейнеров, так и конфигурации приложения. Вы выбираете размер, число узлов и средства оркестрации, а служба контейнеров делает все остальное.

Служба контейнеров использует образы Docker, чтобы убедиться, что контейнеры приложений можно полностью перенести. Он поддерживает свой выбор платформ оркестрации с открытым кодом, например DC/OS, Kubernetes и Docker Swarm, чтобы убедиться, что эти приложения можно масштабировать до тысяч или даже десятков тысяч контейнеров.

Со службой контейнеров Azure можно воспользоваться преимуществами функций корпоративного уровня платформы Azure, сохраняя при этом переносимость приложений, в том числе на уровнях оркестрации.

![](./media/image11.png)

Рис. 4-7: варианты кластеризации в службе контейнеров Azure

Как показано на рис. 4-8, служба контейнеров — просто инфраструктура, предоставляемая Azure для развертывания DC/OS, Kubernetes или Docker Swarm, но не реализован собственный Оркестратор. Таким образом служба контейнеров является не оркестратором, таким образом; Это лишь инфраструктурой, которая использует существующие оркестраторы с открытым исходным кодом для контейнеров.

![](./media/image12.png)

Рис. 4-8: Оркестраторы в службе контейнеров

С точки зрения использования службы контейнеров призвано обеспечить среды размещения контейнеров с помощью популярных средств с открытым исходным кодом и технологий. С этой целью она предоставляет стандартные конечные точки API для выбранного оркестратора. Используя эти конечные точки, можно использовать любое программное обеспечение, который может взаимодействовать с этими конечными точками. Например в случае с конечной точкой Docker Swarm, вы можете использовать интерфейс командной строки Docker. Для DC/OS можно выбрать интерфейс командной строки DC/OS.

### <a name="getting-started-with-container-service"></a>Приступая к работе со службой контейнеров

Чтобы начать работу со службой контейнеров, развертывается кластер службы контейнеров на портале Azure с помощью шаблона Azure Resource Manager или [CLI](https://docs.microsoft.com/cli/azure/install-azure-cli). Доступные шаблоны включают в себя [Docker Swarm](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-swarm), [Kubernetes](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-kubernetes) и [DC/OS](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-dcos). Можно изменить шаблоны быстрого запуска, чтобы включить дополнительную или расширенную конфигурацию Azure.

**Дополнительные сведения о** Дополнительные сведения о развертывании кластера службы контейнеров, на веб-сайте Azure, [развертывание кластера службы контейнеров Azure](https://docs.microsoft.com/azure/container-service/dcos-swarm/container-service-deployment).

За программное обеспечение, устанавливаемое по умолчанию в составе службы ACS, плата не взимается. Все возможности по умолчанию реализуются с помощью ПО с открытым кодом.

Служба контейнеров в настоящее время доступна для Standard A, D, DS, G и GS серии виртуальных машин Linux в Azure. Плата только за выбранные вычислительные выбран, а также другие используемые ресурсы базовой инфраструктуры, такие как хранилище и сети. Существует оплата не начисляется для службы контейнеров сам.

### <a name="additional-resources"></a>Дополнительные ресурсы

Ниже перечислены расположения, где можно найти дополнительные сведения:

-   Общие сведения о решениях с помощью службы контейнеров для размещения контейнера Docker.  
    https://docs.microsoft.com/azure/container-service/kubernetes/container-service-intro-kubernetes>

-   Обзор docker Swarm:  
    <https://docs.docker.com/swarm/overview/>

-   Общие сведения о режиме swarm:  
    <https://docs.docker.com/engine/swarm/>

-   Общие сведения о mesosphere DC/OS:    
    <https://docs.mesosphere.com/1.7/overview/>

-   Kubernetes (официальный сайт):  
    <https://kubernetes.io/>

## <a name="using-service-fabric"></a>С помощью Service Fabric

Service Fabric создана в рамках перехода корпорации Майкрософт от предоставления «коробочных» продуктов, зачастую монолитных в стиле, к предоставлению служб. Ее создании учитывался опыт разработки и эксплуатации масштабных служб, таких как базы данных SQL Azure, Azure Document DB, служебную шину Azure или серверная часть Кортаны, Service Fabric. Она продолжала развиваться по мере внедрения во множестве служб. Важно отметить, что Service Fabric работает не только в среде Azure, но и в автономных развертываниях Windows Server.

Service Fabric предназначен для решения сложных проблем построения и запуска службы и эффективным использованием ресурсов инфраструктуры, таким образом, чтобы командам решать бизнес-проблем, с использованием микрослужб.

Service Fabric предоставляет два масштабных решения, которые позволяют создавать приложения в рамках подхода на основе микрослужб.

-   Платформа, которая предоставляет системные службы для развертывания, обновления, обнаружения и перезапуска служб, в которых произошел сбой, а также обнаружения служб, управления состоянием и мониторинга работоспособности. По сути, эти системные службы предоставляют множество характеристик микрослужб, описанных ранее.

-   Программные интерфейсы (API) или платформы, позволяющие создавать приложения как микрослужбы: [Reliable Actors и Reliable Services](https://docs.microsoft.com/azure/service-fabric/service-fabric-choose-framework). Для создания микрослужбы можно использовать любой код. Однако программные интерфейсы не только упрощают задачу, но и обеспечивают более глубокую интеграцию с платформой. Так вы можете, например, получать информацию о работоспособности и данные диагностики, а также пользоваться преимуществами средств управления надежным состоянием.

Для Service Fabric не важен способ создания службы, поэтому вы можете использовать любую технологию. Но эта платформа предоставляет встроенные интерфейсы API, упрощающие создание микрослужб.

Рис. 4-9 показано, как создавать и запускать микрослужбы в Service Fabric как простые процессы или как контейнеры Docker. Микрослужбы на основе контейнеров можно также сочетать с микрослужбами на основе процессов в рамках одного кластера Service Fabric.

![](./media/image13.png)

Рис. 4-9: развертывание микрослужб в виде процессов или контейнеров в Azure Service Fabric

Кластеры Service Fabric, на основе узлов Linux и Windows можно запустить контейнеры Linux и контейнеров Windows.

**Дополнительные сведения о** актуальные сведения о поддержке контейнеров в Service Fabric на сайте Azure. в статье [Service Fabric и контейнеры](https://docs.microsoft.com/azure/service-fabric/service-fabric-containers-overview).

Service Fabric представляет собой хороший пример платформы, с помощью которого можно определить логическую архитектуру (бизнес-микрослужбы или ограниченные контексты) от физической реализации. Например, если вы реализуете [надежных служб с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction) в [Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview), которые представлены в следующем разделе, "[и микрослужбы с отслеживанием состояниябезотслеживаниясостояния](#stateless-versus-stateful-microservices),» у вас есть бизнес-микрослужба с нескольких физических служб.

Как показано на рисунке 4-10 и мышление с точки зрения логической архитектуры микрослужб, при реализации службы Reliable Service Fabric с отслеживанием состояния обычно необходимо реализовать два уровня служб. Первый — службу с отслеживанием состояния надежных серверной части, которая обеспечивает работу нескольких разделов. Второй — внешняя служба или служба шлюза, ответственный за маршрутизацию и объединение данных в нескольких секций или экземпляры службы с отслеживанием состояния. Служба шлюза также обрабатывает клиентскую связь с выполнение повторных обращений к внутренней службе, используется в сочетании с Service Fabric [обратный прокси-сервер](https://docs.microsoft.com/azure/service-fabric/service-fabric-reverseproxy).

![](./media/image14.png)

Рис. 4-10: бизнес-микрослужба с несколькими службами с отслеживанием и без отслеживания состояния в Service Fabric

В любом случае при использовании надежных служб Service Fabric с отслеживанием состояния у вас также есть логическая микрослужба или бизнес-микрослужба (ограниченный контекст), которая обычно состоит из нескольких физических служб. Каждый из их, служба шлюза и служб раздела можно реализовать как службы веб-API ASP.NET, как показано на рисунке 4-10.

В Service Fabric службы можно объединять в группы и развертывать как [приложение Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-application-model), которое представляет собой модуль упаковки и развертывания для оркестратора или кластера. Таким образом приложение Service Fabric может быть сопоставлен этот автономной и логической микрослужбой или ограниченным контекстом, а также.

### <a name="service-fabric-and-containers"></a>Service Fabric и контейнеры

Что касается контейнеров в Service Fabric вы также можете развернуть службы в образах контейнеров в кластере Service Fabric. Рис. 4-11 показано, что большую часть времени, может содержать только один контейнер для каждой службы.

![](./media/image15.png)

Рис. 4-11: бизнес-микрослужба с несколькими службами (контейнерами) в Service Fabric

Тем не менее так называемые «сцепленные» контейнеры (два контейнера, которые должны развертываться вместе как часть логической службы) также возможны в Service Fabric. Важным моментом является то, что бизнес-микрослужба — это логическая граница вокруг нескольких связанных элементов. Во многих случаях может быть одна служба с единственной моделью данных, но в некоторых других случаях может потребоваться несколько физических служб, а также.

На момент написания этой статьи (апрель 2017 г.), в Service Fabric нельзя развернуть SF надежных служб с отслеживанием состояния в контейнерах, можно развернуть только гостевых контейнеров, службы без отслеживания состояния или службы субъектов в контейнерах. Но Обратите внимание на то, что вы можете сочетать службы в процессах и служб в контейнерах в одном приложении Service Fabric, как показано на рисунке 4-12.

![](./media/image16.png)

Рис. 4-12: бизнес-микрослужба, сопоставляются с приложения Service Fabric с контейнерами и служб с отслеживанием состояния

Поддержка также отличается в зависимости от того, вы используете контейнеры Docker на контейнеры Windows или Linux. В будущих выпусках будет расширять поддержку контейнеров в Service Fabric. Последние новости о поддержке контейнеров в Service Fabric на сайте Azure. в статье [Service Fabric и контейнеры](https://docs.microsoft.com/azure/service-fabric/service-fabric-containers-overview).

## <a name="stateless-versus-stateful-microservices"></a>Микрослужбы с отслеживанием и без отслеживания состояния

Как уже упоминалось, у каждой микрослужбы (логического ограниченного контекста) должна быть своя модель предметной области (данные и логика). В случае микрослужб без отслеживания состояния базы данных будут внешними — применение реляционных параметрами, такими как SQL Server или NoSQL, например MongoDB или Azure DocumentDB.

Но сами службы также может быть с отслеживанием состояния, что означает, что данные находятся в микрослужбе. Эти данные могут существовать не только на одном сервере, но внутри процесса микрослужбы, в памяти и на дисках сохраняются и реплицируются на другие узлы. Рис. 4-13 показаны различные подходы.

![](./media/image17.png)

Рис. 4-13: без отслеживания состояния и микрослужбы с отслеживанием состояния

Подход без сохранения состояния — вполне допустимый и проще в реализации, чем микрослужбы с отслеживанием состояния, так как подобен традиционным и общеизвестным шаблонам. Но микрослужбы без отслеживания состояния вызывают задержку при взаимодействии процесса с источниками данных и вдобавок содержат больше "движущихся деталей", что осложняет повышение производительности за счет дополнительного кэша и очередей. Результат таков: вы можете получить более сложные архитектуры со слишком большим количеством уровней.

Напротив [микрослужбы с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction#when-to-use-reliable-services-apis) могут показывать превосходство в сложных сценариях, так как нет задержка между домена логику и данные. Интенсивная обработка данных, игровые серверов, баз данных как услуга и других сценариев малым временем задержки, все преимущества служб с отслеживанием состояния, которые предоставляют локальное состояние для более быстрого доступа.

Службы без отслеживания состояния и с отслеживанием состояния дополняют друг друга. Например службы с отслеживанием состояния можно разбить на несколько секций. Для доступа к этим разделам может потребоваться служба без отслеживания состояния, выступающая в роли службы шлюза и способная обращаться к каждому разделу с помощью ключей разделов.

У служб с отслеживанием состояния есть недостатки. Они повышают уровень сложности, что дает возможность масштабировать. Функциональность, которая обычно реализовывалась бы в рамках внешней базы данных, должна обрабатывать такие операции, как репликация данных между микрослужбами с отслеживанием состояния и секционирование данных. Тем не менее, это одна из областей, где оркестратор, например [Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-platform-architecture) с его [надежных служб с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction#when-to-use-reliable-services-apis) помогут наиболее, упрощая разработку и жизненный цикл с отслеживанием состояния с помощью микрослужб [Reliable Services API](https://docs.microsoft.com/azure/service-fabric/service-fabric-work-with-reliable-collections) и [Reliable Actors](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-actors-introduction).

К другим платформам микрослужб, которые допускают использование служб с отслеживанием состояния и поддерживают шаблон субъекта, повышая отказоустойчивость и снижая задержки при взаимодействии между бизнес-логикой и данными, относятся Microsoft [Orleans](https://github.com/dotnet/orleans) от Microsoft Research и [Akka.NET](https://getakka.net/). В настоящее время идет работа над улучшением поддержки Docker в обеих этих платформах.

Учтите, что контейнеры Docker сами по себе не поддерживают отслеживание состояния. Чтобы реализовать службу с отслеживанием состояния, вам потребуется одна из высокоуровневых платформ, указанных выше. Однако на момент написания этой статьи служб с отслеживанием состояния в Service Fabric не поддерживаются как контейнеры, только как простой микрослужбы. Поддержка надежных служб в контейнерах, будет доступна в будущих версиях Service Fabric.


>[!div class="step-by-step"]
[Назад](soa-applications.md)
[Вперед](docker-apps-development-environment.md)
