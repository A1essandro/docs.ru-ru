---
title: "Состояния и данных в приложениях Docker"
description: "Жизненный цикл контейнерного приложения Docker на основе платформы и средств Майкрософт"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 09/22/2017
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: d4b75faffd76a85f9ca1c779ed58bfa37625cff3
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/23/2017
---
# <a name="state-and-data-in-docker-applications"></a><span data-ttu-id="660a6-104">Состояния и данных в приложениях Docker</span><span class="sxs-lookup"><span data-stu-id="660a6-104">State and data in Docker applications</span></span>

<span data-ttu-id="660a6-105">Примитив контейнеры — неизменности.</span><span class="sxs-lookup"><span data-stu-id="660a6-105">A primitive of containers is immutability.</span></span> <span data-ttu-id="660a6-106">По сравнению с виртуальной машиной, как часто не исчезают контейнеров.</span><span class="sxs-lookup"><span data-stu-id="660a6-106">When compared to a VM, containers don't disappear as a common occurrence.</span></span> <span data-ttu-id="660a6-107">Виртуальная машина может завершиться ошибкой в различных формах исчезновения процессы, перегруженные ЦП или полной или сбоя диска.</span><span class="sxs-lookup"><span data-stu-id="660a6-107">A VM might fail in various forms from dead processes, overloaded CPU, or a full or failed disk.</span></span> <span data-ttu-id="660a6-108">Еще ожидается, что доступной виртуальной Машины и диски RAID широко распространены и убедиться, что ошибки диска сохранения данных.</span><span class="sxs-lookup"><span data-stu-id="660a6-108">Yet, we expect the VM to be available and RAID drives are commonplace to assure drive failures maintain data.</span></span>

<span data-ttu-id="660a6-109">Тем не менее контейнеры предположительно могут быть экземпляры процессов.</span><span class="sxs-lookup"><span data-stu-id="660a6-109">However, containers are thought to be instances of processes.</span></span> <span data-ttu-id="660a6-110">Процесс не поддерживает устойчивого состояния.</span><span class="sxs-lookup"><span data-stu-id="660a6-110">A process doesn't maintain durable state.</span></span> <span data-ttu-id="660a6-111">Несмотря на то, что контейнер можно записать на его локальное хранилище, при условии, что этот экземпляр будет происходить вокруг бесконечно бы эквивалентно при условии, что одной копии памяти будет устойчивой.</span><span class="sxs-lookup"><span data-stu-id="660a6-111">Even though a container can write to its local storage, assuming that that instance will be around indefinitely would be equivalent to assuming a single-copy memory will be durable.</span></span> <span data-ttu-id="660a6-112">Предполагается, что контейнеры, такие как процессы, повторяются, завершен, или, при управлении с orchestrator контейнера, они могут быть перемещены.</span><span class="sxs-lookup"><span data-stu-id="660a6-112">You should assume that containers, like processes, are duplicated, killed, or, when managed with a container orchestrator, they might be moved.</span></span>

<span data-ttu-id="660a6-113">Docker использует возможность, называемую *наложения файловой системы* реализовать процесс копирования при записи, в которой хранятся все обновленные сведения о файловой системе корневого контейнера, по сравнению с исходного изображения, на котором он основан.</span><span class="sxs-lookup"><span data-stu-id="660a6-113">Docker uses a feature known as an *overlay file system* to implement a copy-on-write process that stores any updated information to the root file system of a container, compared to the original image on which it is based.</span></span> <span data-ttu-id="660a6-114">Эти изменения будут потеряны, если контейнер впоследствии удаляется из системы.</span><span class="sxs-lookup"><span data-stu-id="660a6-114">These changes are lost if the container is subsequently deleted from the system.</span></span> <span data-ttu-id="660a6-115">Контейнер, следовательно, не имеет постоянное хранилище по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="660a6-115">A container, therefore, does not have persistent storage by default.</span></span> <span data-ttu-id="660a6-116">Несмотря на то, что существует возможность сохранения состояния контейнера, проектировании системы этой будет конфликтовать с принцип архитектуры контейнера.</span><span class="sxs-lookup"><span data-stu-id="660a6-116">Although it's possible to save the state of a container, designing a system around this would be in conflict with the principle of container architecture.</span></span>

<span data-ttu-id="660a6-117">Чтобы управлять постоянных данных в приложениях Docker, существуют общие решения:</span><span class="sxs-lookup"><span data-stu-id="660a6-117">To manage persistent data in Docker applications, there are common solutions:</span></span>

-   <span data-ttu-id="660a6-118">[**Тома данных**](https://docs.docker.com/engine/tutorials/dockervolumes/) эти подключения к узлу, представленными просто.</span><span class="sxs-lookup"><span data-stu-id="660a6-118">[**Data volumes**](https://docs.docker.com/engine/tutorials/dockervolumes/) These mount to the host, as just noted.</span></span>

-   <span data-ttu-id="660a6-119">[**Контейнеры томов данных**](https://docs.docker.com/engine/tutorials/dockervolumes/#/creating-and-mounting-a-data-volume-container) контейнерам, с помощью внешнего контейнера, который циклического они предоставляют общего хранилища.</span><span class="sxs-lookup"><span data-stu-id="660a6-119">[**Data volume containers**](https://docs.docker.com/engine/tutorials/dockervolumes/#/creating-and-mounting-a-data-volume-container) These provide shared storage across containers, using an external container that can cycle.</span></span>

-   <span data-ttu-id="660a6-120">[**Подключаемые модули тома**](https://docs.docker.com/engine/tutorials/dockervolumes/#/mount-a-shared-storage-volume-as-a-data-volume) эти подключения тома в удаленные расположения, предоставляя долгосрочной сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="660a6-120">[**Volume Plugins**](https://docs.docker.com/engine/tutorials/dockervolumes/#/mount-a-shared-storage-volume-as-a-data-volume) These mount volumes to remote locations, providing long-term persistence.</span></span>

-   <span data-ttu-id="660a6-121">**Удаленные источники данных** примеры включают базы данных SQL и SQL нет или кэшировать служб, таких как Redis.</span><span class="sxs-lookup"><span data-stu-id="660a6-121">**Remote data sources** Examples include SQL and NO-SQL databases or cache services like Redis.</span></span>

-   <span data-ttu-id="660a6-122">[**Хранилище Azure**](https://docs.microsoft.com/azure/storage/) это предоставляет платформу распространяемый geo хранения службы (PaaS), обеспечивая лучшее из контейнеров, как долгосрочное сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="660a6-122">[**Azure Storage**](https://docs.microsoft.com/azure/storage/) This provides geo distributable platform as a service (PaaS) storage, providing the best of containers as long-term persistence.</span></span>

<span data-ttu-id="660a6-123">Объемы данных, специально предназначены каталогов в один или несколько контейнеров, которые обходят [объединения файловой системы](https://docs.docker.com/v1.8/reference/glossary#union-file-system).</span><span class="sxs-lookup"><span data-stu-id="660a6-123">Data volumes are specially designated directories within one or more containers that bypass the [Union File System](https://docs.docker.com/v1.8/reference/glossary#union-file-system).</span></span> <span data-ttu-id="660a6-124">Тома данных предназначены для хранения данных, независимо от жизненный цикл контейнера.</span><span class="sxs-lookup"><span data-stu-id="660a6-124">Data volumes are designed to maintain data, independent of the container's life cycle.</span></span> <span data-ttu-id="660a6-125">Docker таким образом никогда не автоматически удаляет тома при вам удалить контейнер, а также его «сбор мусора» тома, которые больше не ссылается контейнер.</span><span class="sxs-lookup"><span data-stu-id="660a6-125">Docker therefore never automatically deletes volumes when you remove a container, nor will it "garbage collect" volumes that are no longer referenced by a container.</span></span> <span data-ttu-id="660a6-126">Операционная система узла можно просмотреть и изменить данные в любой том свободно, который является просто еще одна причина для использования томов данных только в случае необходимости.</span><span class="sxs-lookup"><span data-stu-id="660a6-126">The host operating system can browse and edit the data in any volume freely, which is just another reason to use data volumes sparingly.</span></span>

<span data-ttu-id="660a6-127">Объект [контейнер томов данных](https://docs.docker.com/v1.8/userguide/dockervolumes/) по сравнению с обычных данных тома.</span><span class="sxs-lookup"><span data-stu-id="660a6-127">A [data volume container](https://docs.docker.com/v1.8/userguide/dockervolumes/) is an improvement over regular data volumes.</span></span> <span data-ttu-id="660a6-128">Это по сути неактивные контейнер, который имеет один или несколько томов данных, созданные в нем (как описано выше).</span><span class="sxs-lookup"><span data-stu-id="660a6-128">It is essentially a dormant container that has one or more data volumes created within it (as described earlier).</span></span> <span data-ttu-id="660a6-129">Контейнер томов данных предоставляет доступ к контейнерам из точки центра подключения.</span><span class="sxs-lookup"><span data-stu-id="660a6-129">The data volume container provides access to containers from a central mount point.</span></span> <span data-ttu-id="660a6-130">Преимущество этого метода доступа является, она создает уровень абстракции расположение исходных данных, делая точки подключения логического контейнера данных.</span><span class="sxs-lookup"><span data-stu-id="660a6-130">The benefit of this method of access is that it abstracts the location of the original data, making the data container a logical mount point.</span></span> <span data-ttu-id="660a6-131">Она также позволяет контейнеры «приложение», обращающиеся к томам данных контейнера для создаваться и уничтожаться, сохраняя постоянный в выделенном контейнера данных.</span><span class="sxs-lookup"><span data-stu-id="660a6-131">It also allows "application" containers accessing the data container volumes to be created and destroyed while keeping the data persistent in a dedicated container.</span></span>

<span data-ttu-id="660a6-132">Рис. 4-5 показано, что регулярного тома Docker можно поместить в хранилище вне самим контейнерами, но в пределах физического узла виртуальной Машины server.</span><span class="sxs-lookup"><span data-stu-id="660a6-132">Figure 4-5 shows that regular Docker volumes can be placed on storage out of the containers themselves but within the host server/VM physical boundaries.</span></span> <span data-ttu-id="660a6-133">*Тома docker нет возможности использовать том из одного узла сервера или виртуальной Машины на другой*.</span><span class="sxs-lookup"><span data-stu-id="660a6-133">*Docker volumes don't have the ability to use a volume from one host server/VM to another*.</span></span>

![](./media/image5.png)

<span data-ttu-id="660a6-134">Рис. 4-5: объемы данных и внешних источников данных для приложений контейнеров и контейнеров</span><span class="sxs-lookup"><span data-stu-id="660a6-134">Figure 4-5: Data volumes and external data sources for containers apps/containers</span></span>

<span data-ttu-id="660a6-135">Из-за невозможности управления данными, общим для контейнеров, выполняющихся на разных физических узлах, рекомендуется не использовать тома для бизнес-данных, если узел Docker — основного узла и виртуальной Машины, так как при использовании контейнеров Docker в orchestrator контейнеры ожидаются для перемещения от одного к другому узлу, в зависимости от оптимизаций, которые должны быть выполнены в кластере.</span><span class="sxs-lookup"><span data-stu-id="660a6-135">Due to the inability to manage data shared between containers that run on separate physical hosts, it is recommended that you not use volumes for business data unless the Docker host is a fixed host/VM, because when using Docker containers in an orchestrator, containers are expected to be moved from one to another host, depending on the optimizations to be performed by the cluster.</span></span>

<span data-ttu-id="660a6-136">Таким образом обычных данных томов, хороший механизм для работы с файлы трассировки, временных файлов или все аналогичные концепция, которая не влияет на согласованность данных business, если или при перемещении вашей контейнеров на нескольких узлах.</span><span class="sxs-lookup"><span data-stu-id="660a6-136">Therefore, regular data volumes are a good mechanism to work with trace files, temporal files, or any similar concept that won't affect the business data consistency if or when your containers are moved across multiple hosts.</span></span>

<span data-ttu-id="660a6-137">Подключаемые модули тома, например [Flocker](https://clusterhq.com/flocker/) предоставляют данные между всеми узлами в кластере.</span><span class="sxs-lookup"><span data-stu-id="660a6-137">Volume plug-ins like [Flocker](https://clusterhq.com/flocker/) provide data across all hosts in a cluster.</span></span> <span data-ttu-id="660a6-138">Несмотря на то, что не все подключаемые модули тома создаются одинаково, подключаемые модули тома обычно предоставляют во внешних хранилищах постоянного надежного хранилища из неизменяемого контейнеров.</span><span class="sxs-lookup"><span data-stu-id="660a6-138">Although not all volume plug-ins are created equally, volume plug-ins typically provide externalized persistent reliable storage from the immutable containers.</span></span>

<span data-ttu-id="660a6-139">Удаленные источники данных и кэши, как база данных SQL, DocumentDB или удаленного кэша как Redis будет таким же, как разработка без контейнеров.</span><span class="sxs-lookup"><span data-stu-id="660a6-139">Remote data sources and caches like SQL Database, DocumentDB, or a remote cache like Redis would be the same as developing without containers.</span></span> <span data-ttu-id="660a6-140">Это одна из основного и проверенные, способы хранения данных бизнес-приложения.</span><span class="sxs-lookup"><span data-stu-id="660a6-140">This is one of the preferred, and proven, ways to store business application data.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="660a6-141">[Предыдущие] (монолитные applications.md) [Далее] (soa applications.md)</span><span class="sxs-lookup"><span data-stu-id="660a6-141">[Previous] (monolithic-applications.md) [Next] (soa-applications.md)</span></span>
