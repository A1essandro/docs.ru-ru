---
title: "Внутренний цикл разработки рабочего процесса для Docker приложений"
description: "Жизненный цикл контейнерного приложения Docker на основе платформы и средств Майкрософт"
keywords: "Docker, микрослужбы, ASP.NET, контейнер"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 09/22/2017
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: 3605a6cd53db695de3af015a777e3c1a0e92af58
ms.sourcegitcommit: 672c9cd122c13c9813f57f022c86ebdf6dd69b4f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/09/2018
---
# <a name="inner-loop-development-workflow-for-docker-apps"></a>Внутренний цикл разработки рабочего процесса для Docker приложений

Перед тем как запускать внешнего цикла рабочего процесса, охвата всего DevOps цикл, начинаются все процессы на компьютере каждый разработчик, кодирование само приложение, с помощью предпочитаемых языков или платформ и локального тестирования (рис. 4-14). Но в любом случае имеется очень важно в том случае, независимо от того, какой язык, framework или платформ выберите. В этом конкретного рабочего процесса вы всегда разработки и тестирования контейнеры Docker, а на локальном компьютере.

![](./media/image18.png)

Рис. 4-14: внутренний цикл разработки контекста

Контейнер или экземпляр образа Docker будет содержать следующие компоненты:

-   Выбор операционной системы (например, ОС Linux или Windows)

-   Файлы, добавленные разработчиком (например, двоичные файлы приложения)

-   Конфигурации (например, параметры среды и зависимостей)

-   Инструкции по какие процессы с Docker

Можно настроить внутренний цикл разработки рабочего процесса, который использует Docker в качестве процесса (как описано в следующем разделе). Учитывать начальные этапы настройки среды не включается, поскольку его нужно сделать только один раз.

## <a name="building-a-single-app-within-a-docker-container-using-visual-studio-code-and-docker-cli"></a>Создание одного приложения в контейнере Docker, с помощью кода Visual Studio и Docker CLI

Приложения состоят из собственных служб, а также дополнительные библиотеки (зависимостей).

Рис. 4-15 показывает основные шаги, которые обычно требуются для выполнения при создании приложения Docker, следуют подробное описание каждого шага.

![](./media/image19.png)

Рис. 4-15: высокоуровневый рабочий процесс для жизненного цикла для Docker контейнерных приложений с помощью Docker CLI

### <a name="step-1-start-coding-in-visual-studio-code-and-create-your-initial-appservice-baseline"></a>Шаг 1: Начать кодирование в Visual Studio Code и создание базового уровня начального приложения или службы

Способ разработки приложения очень похоже на способ сделать это без Docker. Разница заключается в том, что при разработке, развертывании и тестировании приложения или службы, работающие в контейнеры Docker, помещаются в локальной среде (например, виртуальных Машин с Linux или Windows).

**Настройка локальной среде**

Последние версии Docker для Mac и Windows проще, чем когда-либо для разработки приложений Docker и настройка является простым.

**Дополнительные сведения о** инструкции по настройке Docker для Windows, см. в [https://docs.docker.com/docker-for-windows/](https://docs.docker.com/docker-for-windows/).

Инструкции по настройке Docker для Mac, см. в <https://docs.docker.com/docker-for-mac/>.

Кроме того вам потребуется редактор кода, чтобы фактически можно разрабатывать приложения во время с помощью Docker CLI.

Корпорация Майкрософт предоставляет Visual Studio код, который является простой редактор кода, поддерживается в Windows, Mac и Linux и предоставляет IntelliSense с [для многих языков](https://code.visualstudio.com/docs/languages/overview) (JavaScript, .NET, Go, Java, Ruby, Python и большинство современные языки) [отладки](https://code.visualstudio.com/Docs/editor/debugging), [интеграция с Git](https://code.visualstudio.com/Docs/editor/versioncontrol) и [расширения поддержки](https://code.visualstudio.com/docs/extensions/overview). Этот редактор — отлично подходит для разработчиков Mac и Linux. В Windows можно использовать полный приложения Visual Studio.

**Дополнительные сведения о** инструкции по установке Visual Studio для Windows, Mac или Linux, перейдите к [http://code.visualstudio.com/docs/setup/setup-overview/https://docs.docker.com/docker-for-mac/](http://code.visualstudio.com/docs/setup/setup-overview/https:/docs.docker.com/docker-for-mac/).

Можно работать с Docker CLI и напишите код, используя любой редактор кода, но при использовании кода Visual Studio упрощает их автора Dockerfile и docker compose.yml файлов в рабочей области. Кроме того можно выполнять задачи кода Visual Studio в интегрированной среде разработки, который будет предлагать сценарии, которые могут работать продуманные операций, с помощью Docker CLI под.

Код Visual Studio предоставляется расширение, которое необходимо установить. Чтобы сделать это, нажмите клавиши Ctrl + Shift + P, введите **установить ext**, и запустите расширения: установить расширение команду, чтобы открыть список расширений Marketplace. Затем введите **docker** для фильтрации результатов и выберите Dockerfile и создать файл Docker (yml) расширения поддержки, как показано на рисунке 4-16.

![](./media/image20.png)

На рисунке 4 — 16: Установка расширения Docker в коде Visual Studio

### <a name="step-2-create-a-dockerfile-related-to-an-existing-image-plain-os-or-dev-environments-like-net-core-nodejs-and-ruby"></a>Шаг 2: Создайте файл DockerFile, связанные с существующим образом (plain операционной системы или среды разработки, как .NET Core, Node.js и Ruby)

Вам потребуется файл DockerFile каждого пользовательского образа для сборки и каждой контейнера должны быть развернуты, таким образом, если приложение состоит из одной пользовательской службы, потребуется один DockerFile. Но если приложение состоит из нескольких служб (как для архитектуры микрослужбами), вам потребуется один Dockerfile каждой службы.

DockerFile обычно размещается в корневой папке приложения или службы и содержит требуемые команды, так что Docker знает, как для установки и запуска данного приложения или службы. Можно создать DockerFile и добавить его в проект вместе с коде (node.js .NET Core, т. д.), или, если вы новичок в среду, взгляните на следующие подсказки.

> [!TIP]
> Можно использовать программу командной строки [ё docker](https://github.com/Microsoft/generator-docker), что закрепление файлов из проекта на языке, выберите и добавляет необходимые файлы конфигурации Docker. По сути, помогающее разработчикам Приступая к работе, он создает соответствующий файл DockerFile, docker compose.yml и другие связанные сценарии, чтобы построить и запустить в контейнеры Docker. Этот генератор yeoman отобразится запрос на несколько вопросов, попросить выбранных разработки языка и конечный узел контейнера.

![ё docker](./media/image21.png)

Для экземпляра на рисунке 4-17 показано два снимка экрана из терминалов в Windows и на компьютере Mac, в обоих случаях работе ё docker, который создаст образцов кода проектов (в настоящее время .NET Core, Golang и Node.js от поддерживаемых языков) уже настроен для работы с Начало Docker.

![](./media/image22.PNG)  ![](./media/image23.png)

На рисунке 4 — 17: ё docker программу командной в Windows (слева) и на компьютере Mac

На рисунке 4-18 представлен пример, с помощью ё docker после того как вы существующий проект .NET Core на месте, быть формирования шаблонов.

![](./media/image24.PNG)

На рисунке 4 — 18: ё docker с существующие .NET Core проекта на месте

Из файла DockerFile укажите какие базового образа Docker, вы будете использовать (например, с помощью «от microsoft/dotnet:1.0.0-core»). Обычно мы соберем настраиваемого образа на основе базового образа, можно получить из любой официальный репозиторий в [реестр Docker Hub](https://hub.docker.com/) (как [изображения для .NET Core](https://hub.docker.com/r/microsoft/dotnet/) или один [для Node.js](https://hub.docker.com/_/node/)).

***Вариант а используйте официальный существующего образа Docker***

Использование официальный репозиторий стека языка с номером версии гарантирует, что на всех компьютерах (включая разработку, тестирование и производственной) доступны те же возможности языка.

Ниже приведен образец файла DockerFile для контейнера .NET Core.

```
# Base Docker image to use
FROM microsoft/aspnetcore:1.0.1\

# Set the Working Directory and files to be copied to the image
ARG source
WORKDIR /app
COPY ${source:-bin/Release/PublishOutput} .

# Configure the listening port to 80 (Internal/Secured port within Docker host)
EXPOSE 80

# Application entry point
ENTRYPOINT ["dotnet", "MyCustomMicroservice.dll"]
```

В этом случае он использует версии 1.0.1 официальный образа ASP.NET Core Docker для Linux с именем microsoft/aspnetcore:1.0.1. Для получения дополнительных сведений обратитесь к [страницы образа Docker ASP.NET Core](https://hub.docker.com/r/microsoft/aspnetcore/) и [образа Docker .NET Core страницы](https://hub.docker.com/r/microsoft/dotnet/). Вы также может использовать другое изображение сопоставимых как узел: 4-onbuild для Node.js или много других предварительно настроенных образов для языков разработки, которые можно найти по адресу [Docker Hub](https://hub.docker.com/explore/).

В файле DockerFile необходимо также указать Docker для прослушивания TCP-порт, который будет использоваться во время выполнения (например, порт 80).

Существуют другие строки конфигурации, которые можно добавить в файл DockerFile в зависимости от языка и framework, которую вы используете, поэтому Docker знает, как запустить приложение. Для экземпляра, необходимо в строку ENTRYPOINT \[«dotnet», «MyCustomMicroservice.dll»\] для запуска приложения .NET Core, несмотря на то, что у вас есть несколько вариантов в зависимости от подхода для построения и запуска службы. При использовании пакета SDK и dotnet CLI построение и запуск приложения .NET было бы немного отличается. В конечном счете является что ENTRYPOINT строки, а также дополнительные строки будут отличаться в зависимости от языка или платформу, которая выбирается для приложения.

**Дополнительные сведения о** сведения о создании образов Docker для приложений .NET Core, перейдите к <https://docs.microsoft.com/dotnet/articles/core/docker/building-net-docker-images>.

Дополнительные сведения о создании собственных образов, перейдите к [https://docs.docker.com/engine/ \учебники/dockerimages/](https://docs.docker.com/engine/tutorials/dockerimages/).

**Репозитории многоплатформенного изображения**

Как контейнеры Windows становятся более широкое распространение, одном репозитории может содержать вариантов платформы, например образ Windows и Linux. Это новая функция, поступающих в Docker, позволяющий поставщикам использование одного репозитория для охвата нескольких платформ, таких как [microsoft/aspdotnetcore](https://hub.docker.com/r/microsoft/aspnetcore/) репозитория, которая находится на DockerHub реестра. Как компонент перейдет в активном состоянии, извлечение этого образа из узла Windows будет получать Windows variant, в то время как извлечение тем же именем образа из узла Linux будет получать Linux variant.

***Вариант б. Создание основной образ с нуля***

Собственный базовый образ Docker можно создать с нуля, как описано в этом [статьи](https://docs.docker.com/engine/userguide/eng-image/baseimages/) из Docker. Это сценарий, возможно, не лучше всего подходит для вас при запуске только с помощью Docker, но если вы хотите задать определенные биты базового образа, это можно сделать.

### <a name="step-3-create-your-custom-docker-images-embedding-your-service-in-it"></a>Шаг 3: Создание пользовательских образов Docker внедрения службы в ней

Для каждой пользовательской службы состоит из приложения необходимо будет создать связанные изображения. Если приложение состоит из одной службы или веб-приложение, вам потребуется всего одним изображением.

> [!NOTE]
> При учете «рабочий процесс DevOps внешний цикл», изображений будет создан автоматизированный процесс построения всякий раз, когда push исходный код репозитория (непрерывной интеграции), поэтому образы будут созданы в этой среде глобальных из вашей исходный код.

Но прежде чем мы рассмотрим переход в этом маршруте внешний цикл, необходимо убедиться, что приложение Docker фактически работает должным образом, чтобы они не push код, который может работать неправильно для системы управления версиями (Git, и т. д.).

Таким образом каждый разработчик сначала должен выполнить весь процесс внутреннего цикла для локального тестирования и продолжать разработку, пока они хотят принудительно функцию завершения, либо изменить систему управления версиями.

Для создания образа в локальной среде и с помощью файла DockerFile, можно использовать команду сборки docker, как показано на рисунке 4-19 (также можно запустить составления docker копирование--сборки для приложений, сформирован несколько контейнеров или служб).

![](./media/image25.png)

На рисунке 4-19: под управлением сборки docker

При необходимости вместо непосредственного использования docker сборки из папки проекта, вы сначала можно создать развертываемый папки с библиотеками .NET, необходимо с помощью выполнения dotnet команда публикации, а затем запустите сборки docker.

В этом примере создается образ Docker с именем cesardl и netcore-webapi микрослужбу-docker: первый (: первого — тег, например определенную версию). Можно выполнить этот шаг для каждого настраиваемого образа, необходимые для создания составных приложений Docker с помощью несколько контейнеров.

Можно найти существующие образы в ваш локальный репозиторий (компьютере разработки) с помощью docker команда изображений, как показано на рисунке 4 до 20.

![](./media/image26.png)

На рисунке 4 до 20: Просмотр существующих образов на основе образов docker

### <a name="step-4-optional-define-your-services-in-docker-composeyml-when-building-a-composed-docker-app-with-multiple-services"></a>Шаг 4: Определение (необязательно) служб в docker compose.yml при создании составных Docker приложения с несколькими службами

В файле docker compose.yml можно определить набор связанных служб для развертывания в виде составных приложений с помощью команд развертывания, см. Далее раздел шага.

Необходимо создать этот файл в ваш основной или корневую папку решения; он должен иметь аналогичное содержимое в следующий файл docker compose.yml:

```yml
version: '2'
services:
  web:
    build: .
    ports:
     - "81:80"
    volumes:
     - .:/code
    depends_on:
     - redis
  redis:
    image: redis
```

В данном случае этот файл определяет две службы: веб-службы (пользовательские службы) и redis службы (популярные кэша). Каждая служба будет развертываться как контейнер, поэтому необходимо использовать конкретный образ Docker для каждого. Для определенного веб-службу изображения необходимо сделать следующее:

-   Сборки из файла DockerFile в текущем каталоге

-   Пересылать предоставленный порт 80 для контейнера, чтобы порт 81 на хост-компьютере

-   Подключите каталог проекта на узле/Code в контейнере, благодаря чему можно изменять код без необходимости перестроения изображения

-   Связать веб-службы для службы redis

Служба использует redis [последний открытый redis образ](https://hub.docker.com/_/redis/) извлечено из реестра Docker Hub. [redis](http://redis.io/) — это система популярным кэша для серверных приложений.

### <a name="step-5-build-and-run-your-docker-app"></a>Шаг 5: Построение и запуск приложения Docker

Если ваше приложение имеет только один контейнер, необходимо просто запустите его, развернув узел Docker (физический сервер или ВМ). Тем не менее, если приложение состоит из нескольких служб, необходимо *комбинирование ее*, также. Давайте посмотрим, различные варианты.

***Параметр выполнения ответ одного контейнера или службы***

Образ Docker можно выполнить с помощью docker, выполните команду, как показано ниже:

```
docker run -t -d -p 80:5000
cesardl/netcore-webapi-microservice-docker:first
```

Обратите внимание, что для этого конкретного развертывания мы будем перенаправляться запросы, отправленные на порт 80, внутренний порт 5000. Теперь приложение прослушивает внешний порт 80 на уровне узла.

***Вариант б. Составление и запуск приложения-контейнера несколько***

В большинстве случаев корпоративного приложения Docker будет состоять из нескольких служб. В этих случаях можно выполнить команду docker составления вверх (на рисунке 4-21), который будет использовать файл docker compose.yml, созданные ранее. Выполнение этой команды развертывает состоит приложение со всеми его связанных контейнеров.

![](./media/image27.png)

На рисунке 4-21: результаты выполнения команды «docker-compose вверх»

После запуска docker-составления вверх, развертывания приложения и его связанных контейнеров в узла Docker, как показано в на рисунке 4-22 в представлении виртуальных Машин.

![](./media/image28.png)

На рисунке 4-22: виртуальной Машины с помощью развертывания контейнеров Docker

Примечание docker создания копии и запуска docker может оказаться достаточно для тестирования вашей контейнеры в среде разработки, но можно не использовать их вообще, если вы предполагаете, для работы с кластерами Docker и orchestrators, например помощью Docker Swarm Mesosphere DC/OS и Kubernetes Чтобы иметь возможность увеличения масштаба. Если вы используете кластер как [режиме с помощью Docker Swarm](https://docs.docker.com/engine/swarm/) (доступно в Docker для Windows и Mac с версии 1.12), необходимо развернуть и протестировать дополнительные команды, такие, как создать службу docker для одной службы или во время развертывание приложения, состоящие из нескольких контейнеров, с помощью docker создания пакета и docker развертывание myBundleFile, по для развертывания приложения состоит в стек, как описано в статье [наборы распределенных приложений](https://blog.docker.com/2016/06/docker-app-bundle/) из Docker.

Для [DC/OS](https://mesosphere.com/blog/2015/09/02/dcos-cli-command-line-tool-datacenter/) и [Kubernetes](http://kubernetes.io/docs/user-guide/deployments/#creating-a-deployment) развертывания команды и сценарии, а также используются.

### <a name="step-6-test-your-docker-application-locally-in-your-local-cd-vm"></a>Шаг 6: Тестирование приложения Docker (локально, в локальной ВМ компакт-диска)

Этот шаг будет зависеть от действия приложения.

В очень простой .NET Core веб-API «Hello World» развернуто как в одном контейнере или службу необходимо только для доступа к службе, предоставляя TCP-порт, указанный в DockerFile.

Если localhost еще не включен, для перехода к службе, найти IP-адрес для компьютера с помощью следующей команды:

машины docker ip *ваше имя контейнера*

На узле Docker откройте браузер и перейдите к этому сайту; Вы увидите работающей, приложения или службы, как показано на рисунке 4 до 23.

![](./media/image29.png)

На рисунке 4 до 23: тестирования приложения Docker локально с помощью localhost

Обратите внимание, что он использует порт 80, но внутренним образом был перенаправляемой порт 5000, так как это, как он был развернут с помощью docker при запуске, как было описано выше.

Это можно проверить с помощью ПЕРЕЛИСТЫВАНИЕ из терминала. В Windows при установке Docker IP-адрес по умолчанию — 10.0.75.1, как показано на рисунке 4-24.

![](./media/image30.png)

На рисунке 4 – 24: тестирование Docker приложения локально с помощью CURL

**Отладка контейнера, запущенного на Docker**

Кода Visual Studio поддерживает отладки Docker, если вы используете Node.js и другие платформы, такие как контейнеры .NET Core.

Также можно отлаживать .NET Core контейнеры Docker при использовании Visual Studio, как описано в следующем разделе.

**Дополнительные сведения:** Дополнительные сведения об отладке контейнеры Node.js Docker, перейдите к <https://blog.docker.com/2016/07/live-debugging-docker/> и [https://blogs.msdn.microsoft.com/ \ пользователь\_ed/2016/02/27/visual-studio-code-new-features-13-big-debugging-updates-rich-object-hover-conditional-breakpoints-node-js-mono-more/](https://blogs.msdn.microsoft.com/user_ed/2016/02/27/visual-studio-code-new-features-13-big-debugging-updates-rich-object-hover-conditional-breakpoints-node-js-mono-more/).


>[!div class="step-by-step"]
[Предыдущие] (docker приложения development-environment.md) [Далее] (visual средств studio для docker.md)
