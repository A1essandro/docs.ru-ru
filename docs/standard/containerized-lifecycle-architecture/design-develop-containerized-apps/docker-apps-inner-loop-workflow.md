---
title: Рабочий процесс внутреннего цикла разработки для приложений Docker
description: Дополнительные сведения «внутреннем цикле» рабочего процесса для разработки приложений Docker.
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 11/23/2018
ms.openlocfilehash: 2d592f92153040d910dcf529ec21770693f5973c
ms.sourcegitcommit: acd8ed14fe94e9d4e3a7fb685fe83d05e941073c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/20/2019
ms.locfileid: "56442325"
---
# <a name="inner-loop-development-workflow-for-docker-apps"></a>Рабочий процесс внутреннего цикла разработки для приложений Docker

Перед запуском рабочего процесса внешний цикл, охватывающие весь DevOps цикл, все начинает на компьютере каждого разработчика, кодирования самого приложения, с помощью предпочитаемых языков или платформ и его локальному тестированию (рис. 4-14). Но в любом случае, вы получите очень важный момент общее, независимо от того, какой язык, framework или платформ выбрано. В этом конкретного рабочего процесса вы всегда разработки и тестирования контейнеров Docker, а на локальном компьютере.

![](./media/image18.png)

Рис. 4-14: Внутренний цикл разработки контекста

Контейнер или экземпляр образа Docker будет содержать следующие компоненты:

-   Выбранная операционная система (например, дистрибутив Linux или Windows)

-   Файлы, добавленные разработчиком (например, двоичные файлы приложения)

-   Конфигурации (например, параметры среды и зависимости)

-   Инструкции для того, какие процессы с Docker

Можно настроить рабочий процесс внутреннего цикла разработки, который использует Docker, процесс (см. в следующем разделе). Учитывайте для учетной записи, что начальные действия по настройке среды не будет включен, так как вам нужно сделать только один раз.

## <a name="building-a-single-app-within-a-docker-container-using-visual-studio-code-and-docker-cli"></a>Создание одного приложения в контейнере Docker, с помощью Visual Studio Code и Docker CLI

Приложения, состоящего из ваших собственных служб и дополнительных библиотек (зависимостей).

Рис. 4-15 показывает основные шаги, которые обычно требуется выполнить при создании приложения Docker, следуют подробное описание каждого шага.

![](./media/image19.png)

Рис. 4-15. Высокоуровневый рабочий процесс для жизненного цикла для Docker контейнерных приложений с помощью интерфейса командной строки Docker

### <a name="step-1-start-coding-in-visual-studio-code-and-create-your-initial-appservice-baseline"></a>Шаг 1. Приступаем к написанию кода в Visual Studio Code и создания начальной приложения или услуги базовых показателей

Способ разработки приложения очень похоже на способ сделать это без Docker. Разница в том, что при разработке, развертывании и тестировании приложения или службы, работающие в контейнеры Docker, размещенные в локальной среде (например, виртуальной Машины Linux или Windows).

**Настройка локальной среды**

Последние версии Docker для Mac и Windows проще, чем когда-либо для разработки приложений Docker и установки прямолинейна.

**Дополнительные сведения о** инструкции по настройке Docker для Windows, см. в статье [ https://docs.docker.com/docker-for-windows/ ](https://docs.docker.com/docker-for-windows/).

Инструкции по настройке Docker для Mac, см. в статье <https://docs.docker.com/docker-for-mac/>.

Кроме того потребуется редактор кода, чтобы фактически можно разрабатывать приложения при использовании интерфейса командной строки Docker.

Корпорация Майкрософт предоставляет Visual Studio Code, который представляет собой редактор небольшой объем кода, который поддерживается на Mac, Windows и Linux, а также предоставляет поддержку технологии IntelliSense с [поддержка множества языков](https://code.visualstudio.com/docs/languages/overview) (JavaScript, .NET, Go, Java, Ruby, Python и большинство современные языки), [отладки](https://code.visualstudio.com/Docs/editor/debugging), [интеграция с Git](https://code.visualstudio.com/Docs/editor/versioncontrol) и [поддержке расширений](https://code.visualstudio.com/docs/extensions/overview). Этот редактор — отлично подходит для разработчиков Mac и Linux. В Windows также можно использовать полный приложения Visual Studio.

**Дополнительные сведения о** инструкции по установке Visual Studio для Windows, Mac или Linux, см. в статье <https://code.visualstudio.com/docs/setup/setup-overview/>.

Можно работать с помощью Docker CLI и написать код, используя любой редактор кода, но если вы используете Visual Studio Code, зато его автор Dockerfile и docker-compose.yml файлов в рабочей области. Кроме того можно выполнять задачи Visual Studio Code в интегрированной среде разработки, позволяющего запросить скрипты, которые можно выполнять сложные операции, с помощью интерфейса командной строки Docker под.

Visual Studio Code предоставляется расширение, которое необходимо установить. Чтобы сделать это, нажмите клавиши Ctrl + Shift + P, введите **установить ext**, а затем запустите расширения: Установите расширение команду, чтобы открыть список расширений Marketplace. Затем введите **docker** для фильтрации результатов, затем выберите файл Dockerfile и файл Docker Compose (yml) расширения поддержки, как показано на рисунке 4-16.

![](./media/image20.png)

Рис. 4-16. Установка расширения Docker в Visual Studio Code

### <a name="step-2-create-a-dockerfile-related-to-an-existing-image-plain-os-or-dev-environments-like-net-core-nodejs-and-ruby"></a>Шаг 2. Создание файла DockerFile, связанного с существующим образом (plain ОС или сред разработки, например .NET Core, Node.js и Ruby)

Вам потребуется файл DockerFile в пользовательский образ для построения и каждый контейнер развертывается, таким образом, если приложение состоит из единственный экземпляр пользовательской службы, вам потребуется один DockerFile. Но если приложение состоит из нескольких служб (как в архитектуре микрослужб), вам потребуется один Dockerfile каждой службы.

DockerFile обычно размещается в корневой папке приложения или службы и содержит необходимые команды, поэтому Docker знает, как установить и запустить приложения или службы. Можно создать DockerFile и добавить его в проект вместе с кода (node.js, .NET Core, и т.д.), или, если вы новичок в среду, взгляните на следующий совет.

> [!TIP]
> Можно использовать программу командной строки [yo docker](https://github.com/Microsoft/generator-docker), который формирует шаблоны файлов из проекта в языках, а также добавляет необходимые файлы конфигурации Docker. По сути, чтобы помочь разработчикам Приступая к работе, он создает соответствующий файл DockerFile, docker-compose.yml и другие связанные сценарии, для построения и выполнения контейнеров Docker. Этот генератор yeoman предложит ответить на несколько вопросов, запросом разработки выбранного языка и назначения узла контейнера.

![yo docker](./media/image21.png)

Например рис. 4-17 показано два снимка экрана из терминалов в Windows и на компьютер Mac, в обоих случаях с yo docker, который создаст образцов кода проектов (в настоящее время .NET Core, Golang и Node.js в качестве поддерживаемых языков) уже настроен для работы с Верхняя часть Docker.

![](./media/image22.PNG)  ![](./media/image23.png)

Рис. 4-17: docker команды yo средство в Windows (слева) и на компьютере Mac

Рис. 4-18 представлен пример с использованием yo docker после существующего проекта .NET Core на месте, чтобы быть скаффолдинга.

![](./media/image24.PNG)

Рис. 4-18: yo docker с .NET Core существующего проекта на месте

Из файла DockerFile укажите какой базовый образ Docker, вы будете использовать (например, использование «FROM microsoft/dotnet:1.0.0-core»). Создайте пользовательский образ на основе базового образа, который можно получить из любой официального репозитория в обычно будет [реестра Docker Hub](https://hub.docker.com/) (как [изображение для .NET Core](https://hub.docker.com/r/microsoft/dotnet/) или один [для Node.js](https://hub.docker.com/_/node/)).

***Вариант а Использовать существующий официальный образ Docker***

Использование официального репозитория стек для языка с номером версии гарантирует, что те же функции языка доступны на всех компьютерах (включая разработки, тестирования и эксплуатации).

Ниже приведен пример DockerFile для контейнера .NET Core.

```
# Base Docker image to use
FROM microsoft/aspnetcore:1.0.1\

# Set the Working Directory and files to be copied to the image
ARG source
WORKDIR /app
COPY ${source:-bin/Release/PublishOutput} .

# Configure the listening port to 80 (Internal/Secured port within Docker host)
EXPOSE 80

# Application entry point
ENTRYPOINT ["dotnet", "MyCustomMicroservice.dll"]
```

В этом случае он использует версии 1.0.1 официального образа ASP.NET Core Docker для Linux, с именем microsoft/aspnetcore:1.0.1. Для получения дополнительных сведений обратитесь к [страницы образ Docker ASP.NET Core](https://hub.docker.com/r/microsoft/aspnetcore/) и [образ Docker .NET Core страницы](https://hub.docker.com/r/microsoft/dotnet/). Его также можно использовать другое изображение сопоставимых как узел: 4-onbuild Node.js и многих других предварительно настроенных образов для разработки языков, которые можно найти по адресу [Docker Hub](https://hub.docker.com/explore/).

В файле DockerFile необходимо также указать Docker прослушивать TCP-порт, который будет использоваться во время выполнения (например, порт 80).

Существуют другие строки конфигурации, можно добавить в файл DockerFile в зависимости от языка и платформы, которую вы используете, чтобы Docker знает, как запустить приложение. К примеру, требуется ENTRYPOINT строку с \[«dotnet», «MyCustomMicroservice.dll»\] запустить приложение .NET Core, несмотря на то, что вы можете выбрать несколько вариантов в зависимости от подхода для построения и запуска службы. При использовании пакета SDK и dotnet CLI для создания и запуска приложений .NET, было бы немного отличается. Суть что ENTRYPOINT строки, а также дополнительные строки будет отличаться в зависимости от языка и платформы, выбранных для приложения.

**Дополнительные сведения о** сведения о создании образов Docker для приложений .NET Core, см. в статье [ https://docs.microsoft.com/dotnet/core/docker/building-net-docker-images ](../../../core/docker/building-net-docker-images.md).

Дополнительные сведения о создании собственных образов, перейдите к [ https://docs.docker.com/engine/\ учебники/dockerimages/](https://docs.docker.com/engine/tutorials/dockerimages/).

**Репозитории многоплатформенного образа**

Как контейнеры Windows станут более распространенными, один репозиторий может содержать варианты платформ, например образ Linux и Windows. Это новая функция, добавленная в Docker, который делает возможным для поставщиков использовать один репозиторий для охвата нескольких платформ, таких как [microsoft/aspdotnetcore](https://hub.docker.com/r/microsoft/aspnetcore/) репозитория, которая находится на реестра DockerHub. Как компонент оживает, получение этого образа с узла Windows будет получать вариант Windows, тогда как извлекать имя образа из узла Linux будет получен вариант для Linux.

***Вариант б Создание базового образа с нуля***

Можно создать свой собственный базовый образ Docker с нуля, описанные в этой [статье](https://docs.docker.com/engine/userguide/eng-image/baseimages/) из Docker. Это сценарий, скорее всего, не оптимальную для вас, если только вы начинаете с помощью Docker, но если вы хотите задать определенные биты базового образа, это можно сделать.

### <a name="step-3-create-your-custom-docker-images-embedding-your-service-in-it"></a>Шаг 3. Создание пользовательских образов Docker внедрения службы в нем

Для каждого пользовательского службы, которая состоит из приложения необходимо создать связанный образ. Если приложение состоит из одной службы или веб-приложения, вам потребуется всего одним изображением.

> [!NOTE]
> Учитывая «рабочего процесса DevOps внешний цикл», образы будут создаваться по автоматизированный процесс сборки при каждой отправке исходного кода в репозиторий Git (непрерывная интеграция), поэтому изображения будет создан в глобальной среде из вашей исходный код.

Но прежде чем мы рассмотрим переход по этому маршруту внешний цикл, но нужно убедиться, что приложения Docker фактически работает правильно, чтобы они не будет отправлено код, который может не работать должным образом для системы управления версиями (Git, и т.д.).

Таким образом каждый разработчик сначала необходимо выполнить процесс внутреннего цикла для локального тестирования и продолжить разработку, пока они хотят передать полный функцию или изменить систему управления версиями.

Чтобы создать образ в локальной среде и с помощью DockerFile, можно использовать команду docker build, как показано на рис. 4-19 (также можно запустить docker-compose up--сборки для приложений, состоящих из нескольких контейнеров и служб).

![](./media/image25.png)

Рис. 4-19. Выполнения команды docker build

При необходимости вместо непосредственного выполнения команды docker сборки из папки проекта, вы сначала можно создать развертываемую папку с библиотеками .NET, необходимо с помощью выполнения dotnet команды публикации, а затем запустите сборки docker.

В этом примере создается образ Docker с именем cesardl/netcore-webapi микрослужба-docker: first (: first — это тег, например определенной версии). Вы можете использовать этот шаг для каждого пользовательского образа, который необходимо создать для своего составного приложения Docker с несколькими контейнерами.

Можно найти существующие образы в локальном репозитории (компьютере разработки) с помощью docker команду образов, как показано на рис. 4-20.

![](./media/image26.png)

Рис. 4-20: Просмотр существующих образов с помощью образов docker

### <a name="step-4-optional-define-your-services-in-docker-composeyml-when-building-a-composed-docker-app-with-multiple-services"></a>Шаг 4. (Необязательно) Определение служб в файле docker-compose.yml, при создании составного приложения Docker с несколькими службами

В файле docker-compose.yml можно определить набор связанных служб для развертывания как составное приложение с помощью команд развертывания, как описано в следующем разделе шаг.

Чтобы создать этот файл в основной или корневой папке решения; он должен иметь аналогичное содержимое в следующий файл docker-compose.yml:

```yml
version: '2'
services:
  web:
    build: .
    ports:
     - "81:80"
    volumes:
     - .:/code
    depends_on:
     - redis
  redis:
    image: redis
```

В данном случае этот файл определяет две службы: веб-службы (настраиваемая служба) и служба redis (служба популярных кэширования). Каждая служба будет развертываться как контейнер, поэтому нам нужно использовать конкретный образ Docker для каждого. Для этого конкретного веб-службы изображение необходимо выполнить следующие:

-   Строится на основе файла DockerFile в текущем каталоге

-   Пересылать предоставленный порт 80 в контейнере для порта 81 на хост-компьютере

-   Подключения в каталог проекта на узле для/Code в контейнере, благодаря чему можно изменять код без повторной сборки образа

-   Привязать веб-службы к службе redis

Служба использует redis [последней версии образа общей redis](https://hub.docker.com/_/redis/) извлечь из реестра Docker Hub. [redis](https://redis.io/) — это система очень популярных кэширования для серверных приложений.

### <a name="step-5-build-and-run-your-docker-app"></a>Шаг 5. Сборка и запуск приложения Docker

Если приложение имеет только один контейнер, необходимо просто запустите его, развернув ее к узлу Docker (виртуальной Машине или физическом сервере). Тем не менее, если приложение состоит из нескольких служб, необходимо *комбинирование ее*, слишком. Давайте посмотрим, различные варианты.

***Вариант а Запустите единственного контейнера или службы***

Образ Docker можно запустить с помощью команды docker run, как показано ниже:

```
docker run -t -d -p 80:5000
cesardl/netcore-webapi-microservice-docker:first
```

Обратите внимание на то, что для данного конкретного развертывания, мы будем перенаправление запросы, отправляемые на порт 80 с внутренним портом 5000. Теперь приложение прослушивает внешний порт 80 на уровне узла.

***Вариант б Составление и выполнение приложения-контейнера с несколькими***

В большинстве корпоративных сценариев приложение Docker будет состоять из нескольких служб. В этих случаях можно выполнить команду docker-compose up (рис. 4-21), который будет использовать файл docker-compose.yml, который вы создали ранее. Данная команда развертывает составное приложение со всеми связанные с ним контейнеры.

![](./media/image27.png)

Рис. 4-21. Результаты выполнения команды «docker-compose up»

После запуска docker-compose up, развернуть приложение и его связанные контейнеры в узле Docker, как показано на рисунке 4-22, в представлении виртуальной Машины.

![](./media/image28.png)

Рис. 4-22: Виртуальная машина с развернутыми контейнерами Docker

Примечание docker-compose up "run" docker может оказаться достаточно для тестирования контейнеров в среде разработки, но не использовать их вообще, если вы предполагаете, для работы с кластерами Docker и оркестраторы, такие как Docker Swarm, Mesosphere DC/OS или Kubernetes Чтобы иметь возможность увеличить масштаб. Если вы используете кластер, например [Docker Swarm mode](https://docs.docker.com/engine/swarm/) (доступно в Docker для Windows и Mac с версии 1.12), необходимо для развертывания и тестирования с помощью дополнительных команд, таких как создания службы docker для одной службы или когда вы будете развертывание приложения, состоящего из нескольких контейнеров, пакета с помощью docker compose и docker myBundleFile, развертывание, развернув составных приложений в качестве стека, как описано в статье [наборы распределенных приложений](https://blog.docker.com/2016/06/docker-app-bundle/) из Docker.

Для [DC/OS](https://mesosphere.com/blog/2015/09/02/dcos-cli-command-line-tool-datacenter/) и [Kubernetes](https://kubernetes.io/docs/user-guide/deployments/#creating-a-deployment) команд разные развертывания и сценарии, а также используются.

### <a name="step-6-test-your-docker-application-locally-in-your-local-cd-vm"></a>Шаг 6. Тестирование приложения Docker (локально, в вашей локальной виртуальной Машине компакт-диска)

Этот шаг будет зависеть от действия приложения.

В очень простой .NET Core веб-API «Hello World» развернуть в качестве единственного контейнера или службы необходимо просто доступ к службе, предоставляя TCP-порт, указанный в DockerFile.

Если localhost не включена, чтобы перейти к службе, найти IP-адрес для компьютера с помощью следующей команды:

IP-адреса компьютера docker *your имя контейнера*

На узле Docker откройте браузер и перейдите к этому сайту; Вы увидите/службе приложений под управлением, как показано на рис. 4-23.

![](./media/image29.png)

Рис. 4-23. Тестирование приложения Docker локально с помощью localhost

Обратите внимание, что он использует порт 80, но внутренне были перенаправлены на порт 5000, потому что это, как он был развернут с помощью запуска, docker, как объяснялось ранее.

Это можно проверить с помощью CURL с терминала. В установки Docker в Windows IP-адрес по умолчанию является 10.0.75.1, как показано на рисунке 4-24.

![](./media/image30.png)

Рис. 4-24. Тестирование приложения Docker локально с помощью CURL

**Отладка контейнера, запущенного в Docker**

Visual Studio Code поддерживает отладки Docker, если вы используете Node.js и других платформ, таких как контейнеры .NET Core.

Также можно отлаживать контейнеры .NET Core в Docker при использовании Visual Studio, как описано в следующем разделе.

**Дополнительные сведения:** Дополнительные сведения об отладке контейнеров Node.js Docker, перейдите к <https://blog.docker.com/2016/07/live-debugging-docker/> и [ https://blogs.msdn.microsoft.com/\ пользователя\_ed/2016/02/27 / Visual-Studio-Code-New-Features-13-Big-Debugging-Updates-Rich-Object-hover-Conditional-Breakpoints-node-js-Mono-More/](https://blogs.msdn.microsoft.com/user_ed/2016/02/27/visual-studio-code-new-features-13-big-debugging-updates-rich-object-hover-conditional-breakpoints-node-js-mono-more/).

>[!div class="step-by-step"]
>[Назад](docker-apps-development-environment.md)
>[Вперед](visual-studio-tools-for-docker.md)