---
title: Действия в рабочем процессе DevOps внешний цикл для Docker приложения
description: Жизненный цикл контейнерного приложения Docker на основе платформы и средств Майкрософт
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 09/22/2017
ms.openlocfilehash: 198313c260b36d3f3025606e73e220c361a7ebb8
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
---
# <a name="steps-in-the-outer-loop-devops-workflow-for-a-docker-application"></a>Действия в рабочем процессе DevOps внешний цикл для Docker приложения

Рис. 5-1 представляется начала до конца, описание действия, составляющие внешний цикл DevOps рабочего процесса.

![](./media/image1.png)

Рисунок 5-1: рабочий процесс внешнего цикла DevOps для Docker приложений с помощью средства Microsoft

Теперь давайте рассмотрим каждое из этих действий более подробно.

## <a name="step-1-inner-loop-development-workflow"></a>Шаг 1: Рабочий процесс разработки внутреннего цикла

Этот шаг подробно рассматривается в главе 4, но Напомню, вот которой начинается внешнего цикла момент, когда разработчик помещает кода в систему управления версиями (например, Git), инициированные действия конвейера элемента конфигурации.

## <a name="step-2-source-code-control-integration-and-management-with-visual-studio-team-services-and-git"></a>Шаг 2: Интеграция системы управления версиями и управление с помощью Visual Studio Team Services и Git

На этом этапе необходимо иметь систему управления версиями для сбора консолидированных версии всего кода, поступающих от разные разработчики в команде.

Несмотря на то, что управление исходным кодом и управления исходным кодом (SCC) может показаться характер секунду, для большинства разработчиков, при создании приложений Docker в DevOps жизненного цикла, крайне важно для привлечения внимания, не должен отправить образов Docker с приложением непосредственно к глобальной Docker реестра (например, в реестре контейнеров Azure или Docker Hub) с компьютера разработчика. С другой стороны образы Docker, выпуска и развертывания в рабочей среде должны создаваться только на исходный код, который интегрированы в глобальной сборке или CI конвейера, на основе на репозиторий исходного кода (например, Git).

При тестировании в своих компьютерах локального изображения, созданные разработчиками сами следует использовать только разработчиками. Именно поэтому крайне важно, чтобы активировать из кода SCC конвейера DevOps.

Visual Studio Team Services и Team Foundation Server поддерживает Git и управления версиями Team Foundation. Можно выбрать между ними и использовать его для работы Microsoft начала до конца. Однако также можно управлять коде в хранилищах внешних (например, GitHub, локальными репозиториями Git или Subversion) и по-прежнему сможет подключиться к нему и получение кода в качестве отправной точки для элемента конфигурации DevOps конвейер.

## <a name="step-3-build-ci-integrate-and-test-with-visual-studio-team-services-and-docker"></a>Шаг 3: Сборки, CI, интеграции и тестирования с помощью Visual Studio Team Services и Docker

CI стал стандартом для тестирования современного программного обеспечения и доставки. Решение Docker обеспечивает четкое разделение между командами разработки и эксплуатации. Неизменность образов Docker обеспечивает множественного повторного развертывания между что разработки, тестирования до непрерывной Интеграции и запуска в производственной среде. Подсистема docker развернут на ноутбуках разработчика и инфраструктуре тестирования позволяет контейнеры переносимый во всех средах.

На этом этапе после с правильный код отправлен в системе управления версиями, необходимо *служба построения* для кода и запустить глобальной сборке и тестировании.

О построении CI конвейера, состоящий из своего кода репозитория (Git, т. д.), ваш сервер сборки (Visual Studio Team Services), подсистема Docker и реестр Docker — внутреннего рабочего процесса для этого шага (CI, сборки, тестирования).

Вы можно использовать Visual Studio Team Services как основа для создания приложений и задание конвейер элемента конфигурации, а также для публикации встроенный «артефакты» с «артефакты репозиторием,» которого описан в следующем шаге.

При использовании Docker для развертывания «окончательный артефактов» для развертывания образов Docker приложения или службы внедряются в них. Эти образы передаются или опубликованы в *реестра Docker* (закрытый репозитория тех, которые может иметь в реестре контейнеров Azure, или один открытый как реестр Docker Hub, часто используемый для официальный базовые образы).

Вот основные концепции: CI конвейера будет запущен off путем фиксации SCC репозитория Git. Фиксация приведет к Visual Studio Team Services запустить задание сборки в контейнер Docker и, после успешного завершения задания push образа Docker в реестр Docker, как показано на рисунке 5-2.

![](./media/image2.png)

Рисунок 5-2: шаги, необходимые для элемента конфигурации

Ниже приведены основные этапы рабочего процесса CI с Docker и Visual Studio Team Services.

1.  Разработчик помещает фиксации с репозиторием SCC (Git или Visual Studio Team Services, GitHub, и т. д.).

2.  Если вы используете Visual Studio Team Services или Git, CI является встроенной, это означает, что это просто флажка в Visual Studio Team Services. Если вы используете внешние SCC (например,) (GitHub), *веб-перехватчика* будет уведомления Visual Studio Team Services обновления или принудительная Git и GitHub.

3.  Visual Studio Team Services запрашивает хранилище SCC, включая DockerFile, описывающий изображение, а также код приложения и тестов.

4.  Visual Studio Team Services построения образа Docker и помечает его с номером сборки.

5.  Visual Studio Team Services создает контейнер Docker в пределах подготовленных узла Docker и выполняет соответствующие тесты.

6.  Если тесты проходят успешно, изображение сначала помечается значащее имя, чтобы пользователь знал, это «blessed сборка» (как «/ 1.0.0» или любые другие метки) и затем передается в системный реестр Docker (Docker Hub, реестр контейнера Azure, DTR, и т. д.)

### <a name="implementing-the-ci-pipeline-with-visual-studio-team-services-and-the-docker-extension-for-visual-studio-team-services"></a>Реализация конвейера CI с Visual Studio Team Services и расширения Docker для Visual Studio Team Services

[Расширения Visual Studio Team Services Docker](https://aka.ms/vstsdockerextension) добавляет задачу в ваш конвейер элементов конфигурации, с помощью которого можно создавать образы Docker, push образы Docker, прошедшего проверку подлинности реестр Docker, запуска Docker images или выполнить другие операции, предоставляемые Docker CLI. Он также добавляет Docker Compose задание, которое можно использовать для сборки, Push-уведомлений и запускать приложения multicontainer Docker или выполнить другие операции, предоставляемые Docker составления (CLI), как показано на рисунке 5-3.

![](./media/image3.png)

Рис. 5-3: В конвейере Docker CI в Visual Studio Team Services

Расширения Docker можно использовать конечные точки службы для узлов Docker, а также для контейнера и реестров изображения. Задачи по умолчанию использовать локальный узел Docker, если он доступен (в настоящее время для этого пользовательского агента Visual Studio Team Services); в противном случае они требуют введения подключения к узлу Docker. Действия, которые зависят от проверки подлинности с реестра Docker, например помещает изображения, необходимо предоставить Docker реестра соединения.

Расширение Visual Studio Team Services Docker устанавливаются следующие компоненты в вашей учетной записи Visual Studio Team Services:

-   Конечную точку службы для подключения к реестра Docker

-   Конечную точку службы для соединения с узлом контейнера Docker

-   Задачи Docker, выполните следующие действия:

-   Сборки образа

-   Принудительно отправить изображение или репозиторий реестра

-   Запустите изображения в контейнере

-   Выполните команду Docker

-   Задачи для выполнения команды Docker Compose Docker Compose

С этими задачами Visual Studio Team Services сборки Linux Docker/виртуальной Машины для узла подготовки в Azure и предпочтительный реестра Docker (реестра контейнера Azure, Docker Hub, закрытый DTR Docker или любые другие реестра Docker) можно объединить конвейер Docker CI очень согласованно.

***Требования:***

-   Visual Studio Team Services или для локальных установок Team Foundation Server 2015 обновлением 3 или более поздней версии.

-   Агент Visual Studio Team Services, который содержит двоичные файлы Docker.

Простой способ создать один из них — использовать Docker для запуска контейнера на основе образа Docker агент Visual Studio Team Services.

**Дополнительные сведения о** для чтения дополнительных сведений о сборке в Visual Studio Team Services Docker CI конвейерная передача и просмотр пошаговые руководства, посетите следующие сайты:

Агент Visual Studio Team Services как контейнер Docker: [ https://hub.docker.com/r/\ vsts/microsoft агент /](https://hub.docker.com/r/microsoft/vsts-agent/)

Расширения VSTS Docker. <https://aka.ms/vstsdockerextension>

Создание образов .NET Core Linux Docker с Visual Studio Team Services: <https://blogs.msdn.microsoft.com/stevelasker/2016/06/13/building-net-core-linux-docker-images-with-visual-studio-team-services/>

Построение компьютера под управлением Linux Visual Studio Team Service построения с поддержкой Docker: <http://donovanbrown.com/post/2016/06/03/Building-a-Linux-Based-Visual-Studio-Team-Service-Build-Machine-with-Docker-Support>

### <a name="integrate-test-and-validate-multicontainer-docker-applications"></a>Интеграция, тестирование и проверка приложений multicontainer Docker

Как правило большинство приложений Docker состоят из нескольких контейнеров, а не один контейнер. Хорошим примером является микрослужбами ориентированного приложения, для которого будет иметь один контейнер на микрослужбы. Но даже без строго следующим шаблонам микрослужбами подход, очень вероятно, что приложение Docker будет состоять из нескольких контейнеров или службы.

Таким образом после построения приложения контейнеры в конвейере CI, также необходимо развернуть, интеграцию и тестирование приложения в целом, все его контейнеры в рамках интеграции узел Docker или даже в тестовый кластер, к которому вашей контейнеры — распределенные.

Если вы используете один узел, можно использовать команды Docker, например docker-составить для построения и развертывания связанных контейнеров для тестирования и проверки среды Docker в одной виртуальной Машины. Однако при работе с кластером orchestrator как DC/OS, Kubernetes или с помощью Docker Swarm, необходимо выполнить развертывание на контейнеры посредством другого механизма или orchestrator, в зависимости от выбранного кластера или планировщика.

Ниже приведены несколько типов тестов, которые можно выполнять на контейнеры Docker.

-   Модульные тесты для контейнеров Docker

-   Тестирование группы взаимосвязанных приложений или микрослужбами

-   Тестирование в выпусках производства и со значением «предохранителя»

Важно то, что при выполнении интеграции и функционального тестирования, необходимо выполнить эти тесты из вне контейнеров. Тесты должны не определен и выполняющихся в контейнерах, развертывании, так как контейнеры основаны на статические изображения, которые должны быть так же, как те, которые планируется развертывание в рабочей среде.

Очень подходящий вариант, при тестировании более сложных сценариев, таких как тестирование несколько кластеров (проверки кластера, кластер промежуточной и производственного кластера) — опубликовать изображения в реестр для тестирования в различных кластеров.

### <a name="push-the-custom-application-docker-image-into-your-global-docker-registry"></a>Принудительная отправка образа Docker пользовательское приложение в глобальный реестр Docker

После тестирования и проверить образы Docker, может потребоваться теги и их публикация в системный реестр Docker. Реестр Docker — ключевой компонент в жизненном цикле приложения Docker, так как это центральное расположение, где хранятся пользовательские теста (также называется «blessed images») будет развернут в Качества и рабочих средах.

Подобно как код приложения, хранящийся в репозитории SCC (Git, т. д.) — «источник истины», реестр Docker — «источник истины» двоичных приложения или bits для развертывания в средах QA или рабочей.

Как правило вам может потребоваться вашей частных репозиториев для пользовательских образов в закрытом репозитории в реестре контейнеров Azure, локального реестра как доверенный реестр Docker или в реестре public облака с ограниченным доступом (например Docker Hub), хотя в этом последнем случае ваш код не является открытым исходным кодом, должны доверять поставщика безопасности. В любом случае метод, с помощью которого это делается очень похожих и в конечном счете исходя из команды push docker, как показано на рисунке 5-4.

![](./media/image4.png)

Рис. 5-4: публикация пользовательских образов реестр Docker

Существует несколько предложений реестров Docker от поставщиков облачных реестра контейнера Azure, Amazon Web Services контейнер реестра, Google реестра контейнера, Quay реестра и т. д.

С помощью расширения Visual Studio Team Services Docker, можно передать набор образов службы, определенной в файле docker compose.yml, несколько тегов, прошедшего проверку подлинности реестр Docker (например, реестр контейнера Azure), как показано на рисунке 5-5.

![](./media/image5.png)

Рис. 5-5: использование Visual Studio Team Services для публикации пользовательских образов реестр Docker

**Дополнительные сведения о** Дополнительные сведения о расширении Docker для Visual Studio Team Services, перейдите к <https://aka.ms/vstsdockerextension>. Чтобы узнать больше о реестре контейнеров Azure, перейдите на <https://aka.ms/azurecontainerregistry>.

## <a name="step-4-cd-deploy"></a>Шаг 4: Компакт-диска, развертывание

Неизменность образов Docker обеспечивает множественного повторного развертывания с что разработки, тестирования до непрерывной Интеграции и запуска в производственной среде. После того как вы образы Docker приложений, опубликованных в реестр Docker (частный или общедоступный), можно развернуть их на несколько сред, которые могут возникнуть (производственного Качества, промежуточного хранения, т. д.) из конвейера компакт-диска с помощью Visual Studio Team Services конвейер задачи или Visual Studio Team Services Release Management.

Однако на этом этапе он зависит от какого рода Docker приложения выполняется развертывание. Развертывание простого приложения (с композиции и развертывание точки зрения) как монолитные приложения, включающего в себя несколько контейнеров или служб и развертываются на нескольких серверах или виртуальных машин сильно отличается от более сложных приложений, таких как развертывание приложения, ориентированного на микрослужбами с крупномасштабным возможностями. Эти два сценария описаны в следующих разделах.

### <a name="deploying-composed-docker-applications-to-multiple-docker-environments"></a>Развертывание композицию Docker приложений в различных средах Docker

Рассмотрим сначала на менее сложный сценарий: развертывание простой узлах Docker (виртуальные машины или серверы) в одной среде или среде с несколькими (QA, промежуточной и производственной). В этом сценарии внутренне конвейер компакт-диска можно использовать docker-составления (из задачи развертывания Visual Studio Team Services) для развертывания приложений Docker с набором связанных контейнеров или служб, как показано на рисунке 5-6.

![](./media/image6.png)

Рис. 5-6: развертывание приложения контейнеры простой реестр среды узла Docker

На рисунке 5 – 7 выделяет способ подключения вашей сборки CI QA или тестовой среде с помощью Visual Studio Team Services, щелкнув Docker Compose в диалоговом окне Добавить задачу. Тем не менее, при выполнении развертывания в промежуточной или рабочей среде, обычно используется Release Management возможностей обработки нескольких сред (например QA, промежуточных и производственных). При развертывании одного узлах Docker с помощью Visual Studio Team Services задачи «Docker Compose» (которого вызывает docker-создания копии команда за кулисами). При развертывании службы контейнера Azure использует задачу развертывания Docker, как описано в следующем разделе.

![](./media/image7.png)

Рисунок 5-7: Добавление задачи Docker Compose в конвейере Visual Studio Team Services

При создании выпуска в Visual Studio Team Services, он принимает набор входных артефакты. Они предназначены для быть неизменными во время выпуска в нескольких средах. При вводе контейнеры входной артефакты идентификации изображения в реестре для развертывания. В зависимости от того, как они будут определены они не гарантируется остаются неизменными на протяжении выпуска, наиболее очевидный случай, выполняется при создании ссылки «myimage:latest» из файла docker-compose.

Расширения Docker для Visual Studio Team Services дает пользователю возможность создать артефактов сборки, содержащие изображения реестра формируется, гарантировать для уникальной идентификации тот же двоичный образ. Это то, что Вы действительно хотите использовать в качестве входных данных для выпуска.

### <a name="managing-releases-to-docker-environments-by-using-visual-studio-team-services-release-management"></a>Управление выпуски для среды Docker с помощью Visual Studio Team Services Release Management

Через расширения Visual Studio Team Services, можно создать новый образ, опубликовать его в реестр Docker, запустите его на узлах Linux или Windows и использовать команды, например docker-составления развертывается как приложение целиком все это визуальный элемент несколько контейнеров Возможности Team Services Release Management Studio, предназначены для нескольких сред, как показано на рисунке 5-8.

![](./media/image8.png)

Рис. 5-8: Настройка Visual Studio Team Services Docker Compose задач из Visual Studio Team Services Release Management

Однако следует помнить, очень проста (развертывание простой Docker узлы и виртуальные машины и будут существовать один контейнер или экземпляра каждого изображения) и, возможно, следует использовать только для разработки или тестирования sc сценария показано на рисунке 5-6 и реализации на рисунке 5-8 enarios. В большинстве случаев производственного предприятия, следует иметь высокий уровень доступности (HA) и простой в управлении масштабируемость, балансировку нагрузки между несколько узлов, серверы, виртуальные машины, а также «интеллектуальная переход на другой ресурс» таким образом, если сервер или узла завершается ошибкой, службы и контейнеры будут перемещены на другой сервер или ВМ. В этом случае необходимо более сложных технологий, как кластеры контейнера, orchestrators и планировщики. Таким образом способов развертывания на этих кластерах является точно через сложных сценариев, описывается в следующем разделе.

### <a name="deploying-complex-docker-applications-to-docker-clusters-dcos-kubernetes-and-docker-swarm"></a>Развертывание сложных приложений Docker кластерам Docker (DC/OS, Kubernetes и помощью Docker Swarm)

Характер распределенных приложений требуется вычислительных ресурсов, которые также распространяются. Чтобы возможности масштабирования рабочей среде, необходимо иметь кластеризации возможности, обеспечивающие высокий уровень масштабируемости и высокой ДОСТУПНОСТИ на основании пулов ресурсов.

Можно развернуть контейнеры вручную для этих кластеров в средстве CLI, например помощью Docker Swarm (подобно использованию [создать службу docker](https://docs.docker.com/engine/swarm/swarm-tutorial/deploy-service/)) или веб-интерфейса например [Mesosphere Marathon](https://mesosphere.github.io/marathon/docs/marathon-ui.html) DC/OS кластеров, но вы должны зарезервировать, только для тестирования развертывания punctual либо в целях управления как масштабирования или в целях мониторинга.

С точки зрения компакт-диска и Visual Studio Team Services в частности, можно выполнять задачи по развертыванию специально сделан из среды Visual Studio Team Services Release Management которых будет развертывать контейнерного приложения для распределенных кластеров в Контейнер службы, как показано на рисунке 5 – 9.

![](./media/image9.png)

Рисунок 5-9: развертывание распределенных приложений для службы контейнеров

Изначально при развертывании для некоторых кластеров или orchestrators традиционно используется конкретного развертывания скриптов и механизма каждого каждого orchestrator (то есть Mesosphere DC/OS или Kubernetes реализуйте механизмы развертывания отличаются от Docker и Docker Скапливаются) вместо проще и простые в использовании docker создать инструмент на основе файла определения docker compose.yml. Однако благодаря Microsoft Visual Studio Team Services Docker Deploy задачу, что показано в на рисунке 5 – 10, теперь также развертыванием для контроллера домена/OS с использованием файла знакомый docker-compose.yml только потому, что корпорация Майкрософт не выполняет «преобразования» автоматически (из вашей docker compose.yml файла в другие форматы, необходимые для контроллера домена/OS).

![](./media/image10.png)

Рис. 5-10: Добавление задачи Docker развертывания в вашей среде надежного обмена Сообщениями

Рис. 5-11 показано, как изменить задачу развертывания Docker и укажите тип объекта (контейнер службы контроллера домена или ОС Azure, в данном случае), файл Docker составить и подключения Docker реестра (например, в реестре контейнеров Azure или Docker Hub). Это где задачи будут получены все готово к использованию пользовательских образов Docker для развертывания в виде контейнеров в кластере DC/OS.

![](./media/image11.png)

Рис. 5 — 11: развертывание Docker задачи определения развертывания для контейнера службы контроллера домена или ОС Azure

**Дополнительные сведения о** чтобы узнать подробнее о конвейере компакт-диска с помощью Visual Studio Team Services и Docker, посетите следующие сайты:

Расширение Visual Studio Team Services для Docker и контейнера службы Azure: [ https://aka.ms/\ vstsdockerextension](https://aka.ms/vstsdockerextension)

Служба Azure контейнера: <https://aka.ms/azurecontainerservice>

Mesosphere DC/OS: <https://mesosphere.com/product/>

## <a name="step-5-run-and-manage"></a>Шаг 5: Запуск и управление

Поскольку выполнение приложений и управление ими корпоративного производственного уровня является главной темой, в и самого себя, а также из-за типа операций и людей, работающих на этом уровне (ИТ-операций), а также большого объема в этой области, мы выделено всего рядом главы описано его.

## <a name="step-6-monitor-and-diagnose"></a>Шаг 6: Мониторинг и диагностика

В этом разделе также рассматривается в следующей главе как часть задач, выполняемых ИТ-операций в рабочих системах; Тем не менее важно подчеркнуть, что аналитики, полученные на этом шаге передать команде разработчиков, чтобы приложение постоянно увеличивается. С этой точки зрения, он также является частью DevOps, несмотря на то, что задачи и операции, обычно выполняются по ИТ.

Только в том случае, если наблюдение и диагностику заполнены на 100% в пределах области DevOps являются мониторинга процессов и analytics, выполняемые команды разработчиков средах тестирования или бета-версии. Это делается путем выполнения нагрузочного тестирования или просто отслеживая бета-версии или QA средах, где тест-инженеров бета-версии пытаетесь новых версий.

>[!div class="step-by-step"]
[Предыдущие] (index.md) [Далее] (.. /Run-Manage-Monitor-docker-Environments/index.MD)
