---
title: "Weak References | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-standard"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "weak references, short"
  - "weak references, using"
  - "weak references, long"
  - "garbage collection, weak references"
ms.assetid: 6a600fe5-3af3-4c64-82da-10a0a8e2d79b
caps.latest.revision: 8
author: "rpetrusha"
ms.author: "ronpet"
manager: "wpickett"
caps.handback.revision: 8
---
# Weak References
Сборщик мусора не может собрать объект, используемый приложением, пока код приложения взаимодействует с этим объектом.  Говориться, что приложение имеет строгую ссылку на объект.  
  
 Слабая ссылка дает сборщику мусора возможность удалить объект, но в то же время обеспечивает приложению доступ к этому объекту.  Слабая ссылка допустима только в течение неопределенного количества времени до сборки объекта при отсутствии строгих ссылок.  При использовании слабой ссылки приложение все еще может получить строгую ссылку в объекте, что предотвратит удаление последнего.  Однако всегда существует вероятность удаления объекта сборщиком мусора до повторного создания строгой ссылки.  
  
 Слабые ссылки полезны для объектов, которые используют большой объем памяти, но могут быть созданы повторно без особых усилий, если они были удалены сборщиком мусора.  
  
 Предположим, что в иерархическом представлении приложения Windows Forms пользователь видит разветвленную иерархическую структуру различных решений.  Если базовые данные большие по объему, хранение этого дерева в памяти является неэффективным, особенно если пользователь делает в этом приложении что\-либо еще.  
  
 Если пользователь переключается в другую часть приложения, можно использовать класс <xref:System.WeakReference> для создания слабой ссылки на дерево и удалить все строгие ссылки.  Когда пользователь переключиться обратно к этому дереву, приложение попытается получить строгую ссылку на дерево и, при успешном выполнении этой операции, избежать повторного создания дерева.  
  
 Чтобы установить гибкую ссылку на объект, следует создать <xref:System.WeakReference> с помощью экземпляра отслеживаемого объекта.  Затем следует присвоить свойству <xref:System.WeakReference.Target%2A> этот объект и установить значение `null` для исходной ссылки на объект.  Пример кода см. в описании объекта <xref:System.WeakReference> в библиотеке классов.  
  
## Краткие и длинные слабые ссылки  
 Можно создать краткую слабую ссылку или длинную слабую ссылку:  
  
-   Short  
  
     Назначением краткой ссылки становится `null`, если объект удален сборщиком мусора.  Сама по себе слабая ссылка является управляемым объектом и подлежит сборке мусора, как и любые другие управляемые объекты.  Краткая слабая ссылка является конструктором по умолчанию для <xref:System.WeakReference>.  
  
-   Long  
  
     Длинная слабая ссылка сохраняется после вызова метода <xref:System.Object.Finalize%2A> объекта.  Это позволяет повторно создавать объект, однако состояние объекта остается непредсказуемым.  Чтобы использовать длинную ссылку, укажите значение `true` в конструкторе <xref:System.WeakReference>.  
  
     Если тип объекта не имеет метода <xref:System.Object.Finalize%2A>, используется функциональность краткой слабой ссылки, а сама слабая ссылка становится допустимой только до сборки цели, что может произойти в любое время после запуска метода завершения.  
  
 Чтобы установить строгую ссылку и повторно использовать объект, приведите свойство <xref:System.WeakReference.Target%2A> объекта <xref:System.WeakReference> к типу объекта.  Если свойство <xref:System.WeakReference.Target%2A> возвращает значение `null`, объект был собран; в противном случае можно продолжить использование объекта, так как приложение восстановило строгую ссылку на этот объект.  
  
## Правила использования слабых ссылок  
 Используйте длинные слабые ссылки только при необходимости, так как состояние объекта после выполнения завершения становится непредсказуемым.  
  
 Избегайте использования слабых ссылок на небольшие объекты, потому что сам указатель может быть таким же по объему или даже больше.  
  
 Избегайте использования слабых ссылок в качестве автоматического решения проблем, связанных с управлением памятью.  Вместо этого разработайте эффективную политику кэширования для обработки объектов приложения.  
  
## См. также  
 [Garbage Collection](../../../docs/standard/garbage-collection/index.md)