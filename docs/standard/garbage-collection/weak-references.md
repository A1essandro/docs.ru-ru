---
title: "Слабые ссылки"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- weak references, short
- weak references, using
- weak references, long
- garbage collection, weak references
ms.assetid: 6a600fe5-3af3-4c64-82da-10a0a8e2d79b
caps.latest.revision: "8"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: 906c23caa7065486bb094ad2475ed9e7e24b3d9c
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="weak-references"></a>Слабые ссылки
Сборщик мусора не может собрать объект, используемый приложением, пока код приложения взаимодействует с этим объектом. Говорят, что приложение имеет строгую ссылку на объект.  
  
 Слабая ссылка дает сборщику мусора возможность удалить объект, но в то же время обеспечивает приложению доступ к этому объекту. Слабая ссылка допустима только в течение неопределенного количества времени до сборки объекта при отсутствии строгих ссылок. При использовании слабой ссылки приложение все еще может получить строгую ссылку в объекте, что предотвратит удаление последнего. Однако всегда существует вероятность удаления объекта сборщиком мусора до повторного создания строгой ссылки.  
  
 Слабые ссылки полезны для объектов, которые используют большой объем памяти, но могут быть созданы повторно без особых усилий, если они были удалены сборщиком мусора.  
  
 Предположим, что представление в виде дерева в приложении Windows Forms отображает иерархическую структуру различных параметров для пользователя. Если базовые данные большие по объему, хранение этого дерева в памяти является неэффективным, особенно если пользователь делает в этом приложении что-либо еще.  
  
 Если пользователь переключается на другую часть приложения, можно использовать <xref:System.WeakReference> класс для создания слабой ссылки в дерево и удалить все строгие ссылки. Когда пользователь переключится обратно к этому дереву, приложение попытается получить строгую ссылку на дерево и, при успешном выполнении этой операции, избежать повторного создания дерева.  
  
 Чтобы установить гибкую ссылку на объект, следует создать <xref:System.WeakReference> отслеживаться с помощью экземпляра объекта. Затем следует присвоить свойству <xref:System.WeakReference.Target%2A> этот объект и задать значение `null` для исходной ссылки на объект. Пример кода см. в разделе <xref:System.WeakReference> в библиотеке классов.  
  
## <a name="short-and-long-weak-references"></a>Краткие и длинные слабые ссылки  
 Можно создать краткую слабую ссылку или длинную слабую ссылку:  
  
-   Short  
  
     Назначением краткой ссылки становится `null`, если объект удален сборщиком мусора. Сама по себе слабая ссылка является управляемым объектом и подлежит сборке мусора, как и любые другие управляемые объекты.  Краткая слабая ссылка является конструктором по умолчанию для <xref:System.WeakReference>.  
  
-   Long  
  
     Длинная слабая ссылка сохраняется после создания объекта <xref:System.Object.Finalize%2A> был вызван метод. Это позволяет повторно создавать объект, однако состояние объекта остается непредсказуемым. Чтобы использовать длинные ссылку, укажите `true` в <xref:System.WeakReference> конструктора.  
  
     Если тип объекта не имеет <xref:System.Object.Finalize%2A> применяется метод, функциональность краткой слабой ссылки и слабая ссылка является допустимым только до целевой сборки, которой может произойти в любое время после завершения выполнения.  
  
 Чтобы установить строгую ссылку и повторно использовать объект, приведите <xref:System.WeakReference.Target%2A> свойство <xref:System.WeakReference> типу объекта. Если <xref:System.WeakReference.Target%2A> возвращает `null`, объект был собранных; в противном случае, можно продолжать использовать объект, так как приложение восстановило строгую ссылку.  
  
## <a name="guidelines-for-using-weak-references"></a>Правила использования слабых ссылок  
 Используйте длинные слабые ссылки только при необходимости, так как состояние объекта после выполнения завершения становится непредсказуемым.  
  
 Избегайте использования слабых ссылок на небольшие объекты, потому что сам указатель может быть таким же по объему или даже больше.  
  
 Избегайте использования слабых ссылок в качестве автоматического решения проблем, связанных с управлением памятью. Вместо этого разработайте эффективную политику кэширования для обработки объектов приложения.  
  
## <a name="see-also"></a>См. также  
 [Сборка мусора](../../../docs/standard/garbage-collection/index.md)
