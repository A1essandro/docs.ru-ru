---
title: "Ошибки инициализации платформы .NET Framework. Управление взаимодействием с пользователем | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
  - "C++"
  - "jsharp"
helpviewer_keywords: 
  - "платформа .NET Framework, ошибки инициализации"
  - "ошибки инициализации [.NET Framework]"
  - "ни одна из платформ не нашла возможностей"
ms.assetid: 680a7382-957f-4f6e-b178-4e866004a07e
caps.latest.revision: 5
author: "mairaw"
ms.author: "mairaw"
manager: "wpickett"
caps.handback.revision: 5
---
# Ошибки инициализации платформы .NET Framework. Управление взаимодействием с пользователем
Система активации среды CLR определяет версию среды CLR, которая будет использоваться для выполнения управляемого кода приложения.  В некоторых случаях система активации может не найти версию среды CLR для загрузки.  Эта ситуация обычно возникает в том случае, если приложение требует версии среды CLR, которая недопустима или не установлена на данном компьютере.  Если запрошенная версия не найдена, то система активации среды CLR получает код ошибки HRESULT из вызванных функции или интерфейса, и может отобразить сообщение об ошибке для пользователя, запустившего приложение.  Данный раздел содержит список кодов HRESULT, и объясняет, как можно предотвратить отображения сообщения об ошибке.  
  
 Среда CLR предоставляет инфраструктуру ведения журнала для облегчения отладки проблем активации среды CLR, как описано в [Практическое руководство. Отладка проблем при активации CLR](../../../docs/framework/deployment/how-to-debug-clr-activation-issues.md).  Эта инфраструктура не следует путать с [журналами привязки сборок](../../../docs/framework/tools/fuslogvw-exe-assembly-binding-log-viewer.md), которая полностью отличаются.  
  
## Коды HRESULT активации среды CLR  
 API активации среды CLR возвращают HRESULT,чтобы сообщить о результатах операции активации основному приложению.  Основные приложения среды CLR должны всегда обращения к этими возвращаемым значениям прежде чем предпринимать какие\-либо дополнительные действия.  
  
-   CLR\_E\_SHIM\_RUNTIMELOAD  
  
-   CLR\_E\_SHIM\_RUNTIMEEXPORT  
  
-   CLR\_E\_SHIM\_INSTALLROOT  
  
-   CLR\_E\_SHIM\_INSTALLCOMP  
  
-   CLR\_E\_SHIM\_LEGACYRUNTIMEALREADYBOUND  
  
-   CLR\_E\_SHIM\_SHUTDOWNINPROGRESS  
  
## Пользовательский интерфейс для ошибок инициализации  
 Если системе активации среды CLR не удается загрузить правильную версию среды выполнения, которая требуется приложению, она отображает сообщение об ошибке, чтобы сообщить пользователю, что компьютер не настроен должным образом для запуска приложения, и предоставить с возможность исправить ситуацию.  Обычно в такой ситуации отображается следующее сообщения об ошибке.  Пользователь может выбрать **Да**, чтобы перейти к веб\-сайту Майкрософт, где он может загрузить правильную версию платформы .NET Framework для приложения.  
  
 ![Диалоговое окно ошибки инициализации платформы .NET Framework](../../../docs/framework/deployment/media/initerrordialog.png "InitErrorDialog")  
Типичное сообщение об ошибке инициализации  
  
## Устранение ошибок инициализации  
 В распоряжении разработчика имеются различные параметры для контроля сообщений об ошибках инициализации платформы .NET Framework.  Например, можно использовать флаг API для предотвращения отображения сообщения, как описано в следующем разделе.  Тем не менее, причину, по которой приложение не смогло загрузить нужную среду выполнения, нужно устранить.  В противном случае приложение не сможет работать, или часть функций будет недоступна.  
  
 Для разрешения проблем и наилучшего взаимодействия с пользователем \(меньшее количество сообщений об ошибках\), рекомендуется следующее:  
  
-   Для приложений .NET Framework 3.5 \(и более ранних версий\): Настройте приложение так, чтобы оно поддерживало платформы .NET Framework 4 или 4.5 \(см. [инструкции](../../../docs/framework/migration-guide/how-to-configure-an-app-to-support-net-framework-4-or-4-5.md)\).  
  
-   Для приложений .NET Framework версии 4: Установите распространяемый пакет платформы .NET Framework 4 в составе установки приложения.  См. раздел [Руководство по развертыванию для разработчиков](../../../docs/framework/deployment/deployment-guide-for-developers.md).  
  
## Управление сообщениями об ошибках  
 Отображение сообщения об ошибках для уведомления о том, что запрошенная версия платформы .NET Framework не найдена можно рассматривать как полезная служба или источник раздражения для пользователя.  В любом случае, можно управлять данным пользовательским интерфейсом, передавая флаги в API активации.  
  
 Метод [ICLRMetaHostPolicy::GetRequestedRuntime](../Topic/ICLRMetaHostPolicy::GetRequestedRuntime%20Method.md) принимает в качестве входных данных элемент перечисления [METAHOST\_POLICY\_FLAGS](../../../ocs/framework/unmanaged-api/hosting/metahost-policy-flags-enumeration.md).  Можно включить флаг METAHOST\_POLICY\_SHOW\_ERROR\_DIALOG для запроса сообщения об ошибке, если запрошенная версия среды CLR не будет найдена.  По умолчанию сообщение об ошибке не отображается. \(Метод [ICLRMetaHost::GetRuntime](../Topic/ICLRMetaHost::GetRuntime%20Method.md) не поддерживает этот флаг и не предоставляет иных способов отобразить сообщение об ошибке\).  
  
 Windows предоставляет функцию [SetErrorMode](http://go.microsoft.com/fwlink/p/?LinkID=255242), с помощью которой можно объявить, должны ли сообщения об ошибках отображаться как результат выполнения кода, выполняемого внутри вашего процесса.  Можно указать флаг SEM\_FAILCRITICALERRORS для предотвращения отображения сообщения об ошибке.  
  
 Однако в некоторых случаях важно переопределить параметр SEM\_FAILCRITICALERRORS установленный процессом приложения.  Например, если имеется собственный компонент COM, в котором находится среда CLR и, расположенный в процессе, для которого установлен флаг SEM\_FAILCRITICALERRORS, можно переопределить флаг в зависимости от влияния отображения сообщений об ошибках в пределах данного процесса приложения.  В этом случае можно воспользоваться одним из следующих флагов для переопределения SEM\_FAILCRITICALERRORS:  
  
-   Используйте METAHOST\_POLICY\_IGNORE\_ERROR\_MODE с методом [ICLRMetaHostPolicy::GetRequestedRuntime](../Topic/ICLRMetaHostPolicy::GetRequestedRuntime%20Method.md).  
  
-   Используйте RUNTIME\_INFO\_IGNORE\_ERROR\_MODE с функцией [GetRequestedRuntimeInfo](../../../ocs/framework/unmanaged-api/hosting/getrequestedruntimeinfo-function.md).  
  
## Политика пользовательского интерфейса для среды CLR\- Обеспечила узлы  
 Среда CLR включает набор узлов для различных сценариев и все эти узлы отображают сообщение об ошибке, если у них возникают проблемы с загрузкой необходимой версию среды времени выполнения.  Следующая таблица содержит список узлов и их политик сообщения об ошибке.  
  
|Узел CLR|Описание|Политика сообщения об ошибках|Можно ли отключить сообщений об ошибке?|  
|--------------|--------------|-----------------------------------|---------------------------------------------|  
|Узел управляемых EXE\-файлов|Запускает управляемые exe\-файлы.|Отображается в случае отсутствия версии платформы .NET Framework|Нет|  
|Узел управляемого COM|Загружает управляемые компоненты COM в процесс.|Отображается в случае отсутствия версии платформы .NET Framework|Да, установив флаг SEM\_FAILCRITICALERRORS|  
|Узел ClickOnce|Запускает приложения ClickOnce.|Отображается в случае отсутствия версии платформы .NET Framework, начиная с [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]|Нет|  
|Узел XBAP|Запускает приложения WPF XBAP.|Отображается в случае отсутствия версии платформы .NET Framework, начиная с [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]|Нет|  
  
## Поведение [!INCLUDE[win8](../../../includes/win8-md.md)] и пользовательский интерфейс  
 Система активации среды CLR обеспечивает такую же поведение и пользовательский интерфейс на [!INCLUDE[win8](../../../includes/win8-md.md)], как и на других версиях операционной системы windows, за исключением случаев, когда он обнаруживает проблемы с загрузкой среды CLR 2.0.  [!INCLUDE[win8](../../../includes/win8-md.md)] включает [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], в которой используется среда CLR версии 4.5. Однако [!INCLUDE[win8](../../../includes/win8-md.md)] не включает .NET Framework 2.0, 3,0 или 3.5, которые все используют среду CLR 2.0.  В результате приложения, зависящие от среды CLR 2.0, по умолчанию не будут работать на [!INCLUDE[win8](../../../includes/win8-md.md)].  Вместо этого они выводят следующее диалоговое окно, чтобы пользователи могли устанавливать .NET Framework 3.5.  Пользователи могут также включить .NET Framework 3.5 из Панели управления.  Обе возможности рассматриваются в статье [Установка платформы .NET Framework 3.5 в Windows 8 и более поздних версий](../../../docs/framework/install/net-framework-3-5-on-windows-8-plus.md).  
  
 ![Диалоговое окно установки версии 3.5 в Windows 8](../../../docs/framework/deployment/media/installdialog.png "installdialog")  
Приглашение для установки .NET Framework 3.5 по запросу  
  
> [!NOTE]
>  Платформа .NET Framework 4 \(CLR 4\) на компьютере пользователя заменяется на [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].  Поэтому приложения платформы .NET Framework версии 4 выполняются в [!INCLUDE[win8](../../../includes/win8-md.md)], не показывая это диалоговое окно.  
  
 В случае установки .NET Framework 3.5, пользователи могут запускать на компьютере с [!INCLUDE[win8](../../../includes/win8-md.md)] приложения, которые зависят от платформ .NET Framework 2.0, 3,0 или 3.5 на своих компьютерах .  Они также могут запускать приложения платформы .NET Framework 1.0 и 1.1, при условии, что эти приложения не настроены явным образом так, чтобы выполняться только на платформе .NET Framework 1.0 или 1.1.  См. раздел [Миграция с платформы .NET Framework 1.1](../../../docs/framework/migration-guide/migrating-from-the-net-framework-1-1.md).  
  
 Начиная с [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], ведение журналов активации среды CLR было улучшено для включения записи журнала, которые записывают, когда и почему было отображено сообщение об ошибке инициализации.  Для получения дополнительной информации см. [Практическое руководство. Отладка проблем при активации CLR](../../../docs/framework/deployment/how-to-debug-clr-activation-issues.md).  
  
## См. также  
 [Руководство по развертыванию для разработчиков](../../../docs/framework/deployment/deployment-guide-for-developers.md)   
 [Практическое руководство. Настройка приложения для поддержки платформы .NET Framework 4 или 4.5](../../../docs/framework/migration-guide/how-to-configure-an-app-to-support-net-framework-4-or-4-5.md)   
 [Практическое руководство. Отладка проблем при активации CLR](../../../docs/framework/deployment/how-to-debug-clr-activation-issues.md)   
 [Установка платформы .NET Framework 3.5 в Windows 8 и более поздних версий](../../../docs/framework/install/net-framework-3-5-on-windows-8-plus.md)