---
title: "Обход NAT с помощью IPv6 и Teredo | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
  - "C++"
  - "jsharp"
ms.assetid: 568cd245-3300-49ef-a995-d81bf845d961
caps.latest.revision: 6
author: "mcleblanc"
ms.author: "markl"
manager: "markl"
caps.handback.revision: 6
---
# Обход NAT с помощью IPv6 и Teredo
Усовершенствования были внесены, которые предоставляют поддержку для прохождения преобразования сетевых адресов \(nat\).  Эти изменения, предназначены для использования с IP версии 6 и Teredo, но они также применимы к другому IP заполнение тоннель технологии.  Эти улучшения влияют на <xref:System.Net> и связанных классов в пространствах имен.  
  
 Эти изменения могут повлиять на клиентские и серверные приложения, отвечающих за планирование использовать протокол IP заполнение тоннель технологии.  
  
 Изменения с обходом nat поддержки доступны только для приложений с помощью версии 4 платформы .NET Framework.  Эти функции будут недоступны на более ранних версиях платформы .NET Framework.  
  
## Общие сведения  
 Протокол IP версии 4 \(IPv4\) определила адрес IPv4, так как 32 бит.  В результате IPv4 поддерживает приблизительно 4 миллиардов однозначно ip\-адреса \(2^32\).  Например, число компьютеров и устройств сети в Интернете в развернутом 1990s, ограничения полей адреса IPv4 стали ясными.  
  
 Один из нескольких методов, используемых для расширения время существования IPv4 развертывание преобразование сетевых адресов для одного уникально открытое IP\-адрес для представления большое количество закрытой частных IP\-адресов \(интрасеть\).  Частных ip\-адресов, устройством nat совместно используют один открытый адрес IPv4.  Средство nat может быть выделенным прибором \(недорогие беспроволочные точку доступа и маршрутизатора, например\) или компьютером, где запущена служба, чтобы предоставить преобразование сетевых адресов.  Устройство или служба для открытого ip\-адреса сетевых пакетов по протоколу IP преобразуются между открытым и закрытой интернет, интрасеть.  
  
 Эта диаграмма хорошо работает для клиентских приложений, работающих в частной интрасети, которые отправляют запросы к другим серверам IP\-адресам \(обычно\) в Интернете.  Устройство или сервер nat могут содержать сопоставление клиентских запросов, чтобы если ответ будет возвращен него знает, куда отправлять ответ.  Однако эта схема представляет проблемы для приложений, выполняющихся в закрытой интрасети, устройством nat, которым необходимо предоставить службы настроены для пакетов, а также реагируют.  Это особенно приложения для одноранговых узлов.  
  
 Протокол IP версии 6, указанный в параметре адрес IPv4, так как 128 бит.  В результате IP версии 6 поддерживает очень большой объем IP\-адрес 3,2 х 10^38 уникальность адресов \(2^128\).  С местом для адресов данного размера, возможно для каждого устройства, подключенного к Интернету, чтобы предоставляемые уникальный адрес.  Однако проблемы.  Многие " использует только IPv4.  В частности, многие из существующих и маршрутизаторов беспроволочные точки доступа, используемые маленькими компаниями, организациями, и домочадцами не поддерживают IP версии 6.  Также некоторые поставщики интернет\-услуг, обслуживающие эти клиенты или не поддерживают и не настроена поддержка IP версии 6.  
  
 Несколько технологий go IP версии 6 были разработаны, чтобы отображать тоннель адреса IP версии 6 в пакете IPv4.  Эти технологии включают 6to4, ISATAP и туннели Teredo, которые предоставляют нисходящую маршрутизацию событий присваивания адреса и основное приложение\-к\- узла автоматическую для трафика IP версии 6 одноадресной рассылки, если узлы IP версии 6, должны проходить сети IP4 для достижения других сетей IP версии 6.  Отправитьы пакеты IP версии 6 проложили тоннель в пакеты IPv4.  Несколько методов нисходящей маршрутизации событий используются, позволяющие обходом nat для адресов IP версии 6 через устройство преобразование сетевых адресов.  
  
 Teredo одна из технологий go IP версии 6, которая помещает соединение IP версии 6 на сетям IPv4.  Документы Teredo в публикованном IETF RFC IETF \(4380\).  Windows XP SP2\) и более поздних версий обеспечивает поддержку Teredo виртуального адаптера, который может предоставить общий адрес в диапазоне 2001:0::\/32 IP версии 6.  Этот адрес IP версии 6 можно использовать для прослушивания для входящих подключений из Интернета и может быть реализован клиенты, входящие IP версии 6, которые желают подключиться к службе, ожидающей передачи данных.  Это освобождает приложения из тревожиться о том, как решить компьютер с устройством nat, поскольку приложение может просто подключиться к нему с помощью его адрес Teredo IP версии 6.  
  
## Улучшения для поддержки Teredo и обходом nat  
 Улучшения добавлены к <xref:System.Net>, <xref:System.Net.NetworkInformation> и пространства имен <xref:System.Net.Sockets> для поддержки обходом nat с помощью IP версии 6 и Teredo.  
  
 Несколько методов добавлены к классу <xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=fullName> чтобы получить список IP\-адресов одноадресной рассылки на узле.  Метод <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A> начинает асинхронный запрос для получения стабильная таблица IP\-адрес одноадресной рассылки на локальном компьютере.  Метод <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A> завершить отложенный асинхронный запрос для получения стабильная таблица IP\-адрес одноадресной рассылки на локальном компьютере.  Метод <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A> синхронный запрос для получения стабильная таблица IP\-адрес одноадресной рассылки на локальном компьютере ожидания до тех пор, пока не будет, если таблица address стабилизировать обязательный.  
  
 Свойство <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=fullName> можно использовать, чтобы определить, <xref:System.Net.IPAddress> адрес Teredo IP версии 6.  
  
 Используя эти новые методы класса <xref:System.Net.NetworkInformation.IPGlobalProperties> в сочетании с свойством <xref:System.Net.IPAddress.IsIPv6Teredo%2A> позволяет приложению легко найти адрес Teredo.  Приложение обычно необходимо знать только локальный адрес Teredo, если он передает эти сведения для удаленных приложений.  Например, приложение однорангового может отправлять все адреса IP версии 6 на сервер matchmaking, который затем может переадресовать их в другие одноранговые узлы, чтобы включить прямое сообщение.  
  
 Приложение должно устанавливать его как правило, прослушивающих службу для ожидания передачи данных на <xref:System.Net.IPAddress.IPv6Any?displayProperty=fullName>, а не на локальном адрес Teredo.  Если удаленный клиент или одноранговый узел, предусмотрены непосредственные маршрут IP версии 6 к узлу службы прослушивания, то клиент или одноранговый узел может подключиться непосредственно с помощью IP версии 6 и использование Teredo, чтобы отображать тоннель пакеты.  
  
 Для приложений TCP, класс <xref:System.Net.Sockets.TcpListener?displayProperty=fullName> содержит метод <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A> чтобы включить обходом nat.  Для приложений по протоколу UDP <xref:System.Net.Sockets.UdpClient?displayProperty=fullName> класс содержит метод <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A> чтобы включить обходом nat.  
  
 Для приложений, использующих <xref:System.Net.Sockets.Socket?displayProperty=fullName> и связанные классы и методы, <xref:System.Net.Sockets.Socket.GetSocketOption%2A><xref:System.Net.Sockets.Socket.SetSocketOption%2A> может использоваться с параметром сокета <xref:System.Net.Sockets.SocketOptionName?displayProperty=fullName> запросить, чтобы включить или отключить обходом nat.  
  
## См. также  
 <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=fullName>   
 <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A?displayProperty=fullName>   
 <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A?displayProperty=fullName>   
 <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A?displayProperty=fullName>   
 <xref:System.Net.Sockets.IPProtectionLevel?displayProperty=fullName>   
 <xref:System.Net.Sockets.Socket.SetIPProtectionLevel%2A?displayProperty=fullName>   
 <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A?displayProperty=fullName>   
 <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A?displayProperty=fullName>