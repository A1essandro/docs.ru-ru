---
title: "Изменения в аутентификации NTLM для HttpWebRequest в версии&#160;3.5 с пакетом обновления&#160;1 (SP1) | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
  - "C++"
  - "jsharp"
ms.assetid: 8bf0b428-5a21-4299-8d6e-bf8251fd978a
caps.latest.revision: 8
author: "mcleblanc"
ms.author: "markl"
manager: "markl"
caps.handback.revision: 8
---
# Изменения в аутентификации NTLM для HttpWebRequest в версии&#160;3.5 с пакетом обновления&#160;1 (SP1)
Примененных изменений безопасности в платформе .NET Framework версии 3.5 SP1 или более поздних версиях, не влияют на том, как встроенная проверка подлинности Windows, которым регулируется <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream> и связанные классы в пространстве имен System.Net.  Эти изменения могут повлиять на приложения, которые используют эти классы для выполнения запросов через интернет и получить ответы, где используется встроенная проверка подлинности Windows на основе NTLM.  Веб\-сервер и клиентские приложения этого влияния изменения чаши, настроитьы для использования встроенной проверки подлинности Windows.  
  
## Общие сведения  
 Формирование встроенной проверки подлинности Windows позволяет учетных данных для некоторых ответов на универсальной, означать их можно повторно использовать или переадресованы.  Эта особенность, если указанная конструктивная не требуется, протоколов проверки подлинности, должны содержать определенные данные целевого объекта, так же как и перенаправления конкретную информацию.  Службы могут обеспечить расширенную защиту, чтобы убедиться, что ответы учетных данных содержат данные службы, определенные в качестве имени участника\-службы \(spn\).  Располагая этими сведениями в обменах учетных данных служб могут лучше защищать от злостой использования ответов учетных данных, которые могут быть получены неправильно.  
  
 Несколько компонентов в <xref:System.Net> и пространства имен <xref:System.Net.Security> выполняют встроенную проверку подлинности Windows, имя вызывающего приложения.  Этот раздел описывает изменения к компонентам System.Net для добавления расширенная защита в их использование встроенной проверки подлинности Windows.  
  
## Изменения  
 Процесс проверки подлинности NTLM, используемый с интегрированной проверкой подлинности Windows включает в себя возможность выданную конечным компьютером и отправленную обратно клиентскому компьютеру.  Если компьютер осуществляет возможность он создал, проверка подлинности завершится ошибкой, если соединение не будет цикла \- примыкание с тыловой сторон \(IPv4\) адреса, например 127.0.0.1.  
  
 Во время доступа к службам на внутреннем веб\-сервере, она применяется для обращения к службе с помощью url\-адреса, схожего с http:\/\/contoso\/service или HTTPs:\/\/contoso\/service.  Имя "contoso" не является часто имени компьютера компьютера, на котором служба развертыватьа.  <xref:System.Net> и соответствующий поддержка пространств имен с помощью Active Directory, DNS, NetBIOS локального компьютера \(например, WINDOWS\\system32\\drivers\\etc\\hosts\) или lmhosts локального компьютера \(например WINDOWS\\system32\\drivers\\etc\\lmhosts\), чтобы разрешить имена к адресам.  Имя "contoso" разрешено, так что запросы, отправленные "contoso" будут отправлены к соответствующему компьютеру\-серверу.  
  
 Настроенный для крупных развертываниях, кроме того, общий для одного имени виртуального сервера, присваиваемое развертыванию с основные имена компьютеров, используемых клиентскими приложениями и никогда не пользователями.  Например, можно вызвать сервер www.contoso.com, но на использовании "contoso" внутренней сети просто.  Это имя вызываются заголовком узла в запросе Интернета клиента.  В соответствии с протоколом HTTP, поле заголовка запроса узла определяет узел в интернете и номер порта, опрошенным ресурса.  Эти данные извлекаются из исходного uri, заданного пользователя или ссылався ресурс \(обычно URL\-адрес HTTP\).  На платформе .NET Framework версии 4 эти сведения также может быть установлено клиентом с помощью нового свойства <xref:System.Net.HttpWebRequest.Host%2A>.  
  
 Класс <xref:System.Net.AuthenticationManager> контролирует управляемые компоненты проверки подлинности \("модули"\), используемые классами <xref:System.Net.WebRequest> производеными и классом <xref:System.Net.WebClient>.  Класс <xref:System.Net.AuthenticationManager> предоставляет свойство, которое предоставляет объект <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=fullName>, индексированное строкой универсального кода ресурса \(uri\) для приложения предоставить пользовательскую строку имени участника\-службы, которые должны использоваться в процессе проверки подлинности.  
  
 В версии 3.5 с пакетом обновления 1 \(SP1\) теперь по умолчанию указывается имя узла, используемого в URL запроса в SPN при обмене проверки подлинности по протоколу NTLM \(NT LAN Manager\), когда свойство <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> не задано.  Имя узла, используемое в URL\-адреса запроса, может отличаться от заголовка узла, указанного в <xref:System.Net.HttpRequestHeader?displayProperty=fullName> в запросе клиента.  Имя узла, используемое в URL\-адресе запроса, может отличаться от фактического имени узла сервера, имени компьютера сервера, IP\-адреса компьютера или адреса замыкания на себя.  В этих случаях запрос проверки подлинности Windows завершится с ошибкой.  Для решения проблемы необходимо уведомить Windows, что имя узла используется в url\-адресе запроса в клиентском запросе \("contoso", например\), альтернативное имя локального компьютера.  
  
 Существует несколько возможных методов для серверного приложения обхода этого изменения.  Рекомендуемый подход сопоставление имени узла используется в url\-адресе запроса к ключу `BackConnectionHostNames` в реестре на сервере.  Раздел реестра `BackConnectionHostNames` обычно используется для сопоставления имени узла до петлевому адрес.  Шаги перечислены ниже.  
  
 Чтобы определить имена узлов, которые сопоставлены к петлевому адрес и могут подключиться с веб\-сайта на локальном компьютере, выполните следующие действия:  
  
 1.  В меню Пуск выберите Выполнить, введите "regedit" и нажмите кнопку ОК.  
  
 2.  В редакторе реестра, найдите и выберите следующий раздел реестра:  
  
 `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0`  
  
 3.  Щелкните правой кнопкой мыши MSV1\_0, укажите создать, а затем щелкните значение Multi\- Строки.  
  
 4.  Введите `BackConnectionHostNames` и нажмите клавишу ВВОД.  
  
 5.  Щелкните правой кнопкой мыши `BackConnectionHostNames`, а затем нажмите кнопку изменить.  
  
 6.  В данных о значениях, поместите в упакован введите имя узла или имена узлов для сайтов \(имени узла, используемого в url\-адресе запроса\), что на локальном компьютере, а затем нажмите кнопку ОК.  
  
 7.  Закройте редактор реестра, а затем перезапустите службу IISAdmin и запустите IISReset.  
  
 Защищенный рабочий вокруг отключить цикл \- задний проверка, как описано в [http:\/\/support.microsoft.com\/kb\/896861](http://go.microsoft.com/fwlink/?LinkID=179657) разделе.  Это запрещает защиту от атак отражения.  Поэтому лучше ограничить набор других имен только теми ожидается, что фактически использует компьютер.  
  
## См. также  
 <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=fullName>   
 <xref:System.Net.HttpRequestHeader?displayProperty=fullName>   
 <xref:System.Net.HttpWebRequest.Host%2A?displayProperty=fullName>