---
title: "Упрощение отладки образов"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- images [.NET Framework], debugging
- executable image for debugging
- debugging [.NET Framework], executable images for
ms.assetid: 7d90ea7a-150f-4f97-98a7-f9c26541b9a3
caps.latest.revision: "13"
author: mairaw
ms.author: mairaw
manager: wpickett
ms.openlocfilehash: 46a9c11f3545e5d2b9f91572a87ee2614810e4d0
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2017
---
# <a name="making-an-image-easier-to-debug"></a><span data-ttu-id="f3080-102">Упрощение отладки образов</span><span class="sxs-lookup"><span data-stu-id="f3080-102">Making an Image Easier to Debug</span></span>
<span data-ttu-id="f3080-103">При компиляции неуправляемого кода можно настроить исполняемый образ для отладки, задав параметры командной строки или интегрированной среды разработки.</span><span class="sxs-lookup"><span data-stu-id="f3080-103">When compiling unmanaged code, you can configure an executable image for debugging by setting IDE switches or command-line options.</span></span> <span data-ttu-id="f3080-104">Например, параметр командной строки /**Zi** в Visual C++ служит для создания файлов с отладочными символами (с расширением PDB).</span><span class="sxs-lookup"><span data-stu-id="f3080-104">For example, you can use the /**Zi** command-line option in Visual C++ to ask it to emit debug symbol files (file extension .pdb).</span></span> <span data-ttu-id="f3080-105">Аналогичным образом параметр командной строки /**Od** отключает оптимизацию компилятора.</span><span class="sxs-lookup"><span data-stu-id="f3080-105">Similarly, the /**Od** command-line option tells the compiler to disable optimization.</span></span> <span data-ttu-id="f3080-106">В результате выполнение кода происходит медленнее, однако это упрощает его отладку, если она понадобится.</span><span class="sxs-lookup"><span data-stu-id="f3080-106">The resulting code runs more slowly, but is easier to debug, should this be necessary.</span></span>  
  
 <span data-ttu-id="f3080-107">При компиляции управляемого кода .NET Framework компиляторы (например, Visual C++, Visual Basic и C#) компилируют исходную программу в промежуточный язык MSIL.</span><span class="sxs-lookup"><span data-stu-id="f3080-107">When compiling .NET Framework managed code, compilers such as Visual C++, Visual Basic, and C# compile their source program into Microsoft Intermediate Language (MSIL).</span></span> <span data-ttu-id="f3080-108">Далее перед выполнением код MSIL преобразуется в машинный код с помощью JIT-компиляции.</span><span class="sxs-lookup"><span data-stu-id="f3080-108">MSIL is subsequently JIT-compiled, just before execution, into native machine code.</span></span> <span data-ttu-id="f3080-109">Как и в случае с неуправляемым кодом, можно настроить исполняемый образ для отладки, задав параметры командной строки или интегрированной среды разработки.</span><span class="sxs-lookup"><span data-stu-id="f3080-109">As with unmanaged code, you can configure an executable image for debugging by setting IDE switches or command-line options.</span></span> <span data-ttu-id="f3080-110">Кроме того, таким же образом можно настроить для отладки JIT-компиляцию.</span><span class="sxs-lookup"><span data-stu-id="f3080-110">In addition, you can configure the JIT compilation for debugging in much the same way.</span></span>  
  
 <span data-ttu-id="f3080-111">Данная JIT-конфигурация имеет два аспекта.</span><span class="sxs-lookup"><span data-stu-id="f3080-111">This JIT configuration has two aspects:</span></span>  
  
-   <span data-ttu-id="f3080-112">Можно запросить создание JIT-компилятором сведений об отслеживании.</span><span class="sxs-lookup"><span data-stu-id="f3080-112">You can request the JIT-compiler to generate tracking information.</span></span> <span data-ttu-id="f3080-113">После этого отладчик сможет сопоставлять цепочки команд MSIL с соответствующими командами машинного кода, а также отслеживать место хранения локальных переменных и аргументов функций.</span><span class="sxs-lookup"><span data-stu-id="f3080-113">This makes it possible for the debugger to match up a chain of MSIL with its machine code counterpart, and to track where local variables and function arguments are stored.</span></span>  <span data-ttu-id="f3080-114">В .NET Framework версии 2.0 JIT-компилятор всегда создает сведения об отслеживании, поэтому запрашивать их не нужно.</span><span class="sxs-lookup"><span data-stu-id="f3080-114">In the .NET Framework version 2.0, the JIT compiler will always generate tracking information, so there is no need to request it.</span></span>  
  
-   <span data-ttu-id="f3080-115">В JIT-компиляторе можно отключить оптимизацию получившегося машинного кода.</span><span class="sxs-lookup"><span data-stu-id="f3080-115">You can request the JIT-compiler to not optimize the resulting machine code.</span></span>  
  
 <span data-ttu-id="f3080-116">Как правило, параметры JIT-компилятора задаются компилятором, создающим код MSIL, на основе заданных параметров интегрированной среды разработки или командной строки (например, /**Od**).</span><span class="sxs-lookup"><span data-stu-id="f3080-116">Normally, the compiler that generates the MSIL sets these JIT-compiler options appropriately, based upon the IDE switches or command-line options you specify, for example, /**Od**.</span></span>  
  
 <span data-ttu-id="f3080-117">В некоторых случаях может возникнуть необходимость изменить поведение JIT-компилятора, чтобы создаваемый машинный код было проще отлаживать.</span><span class="sxs-lookup"><span data-stu-id="f3080-117">In some cases, you might want to change the behavior of the JIT compiler so that the machine code it generates is easier to debug.</span></span> <span data-ttu-id="f3080-118">Например, для окончательной сборки или оптимизации управления может потребоваться создать сведения о JIT-отслеживании.</span><span class="sxs-lookup"><span data-stu-id="f3080-118">For example, you might want to generate JIT tracking information for a retail build or control optimization.</span></span> <span data-ttu-id="f3080-119">Это можно сделать с помощью файла инициализации (INI).</span><span class="sxs-lookup"><span data-stu-id="f3080-119">You can do so with an initialization (.ini) file.</span></span>  
  
 <span data-ttu-id="f3080-120">Например, если сборка для отладки называется MyApp.exe, нужно создать текстовый файл с именем MyApp.ini в той же папке, что и MyApp.exe. Этот файл должен содержать следующие три строки:</span><span class="sxs-lookup"><span data-stu-id="f3080-120">For example, if the assembly you want to debug is called MyApp.exe, then you can create a text file named MyApp.ini, in the same folder as MyApp.exe, which contains these three lines:</span></span>  
  
```  
[.NET Framework Debugging Control]  
GenerateTrackingInfo=1  
AllowOptimize=0  
```  
  
 <span data-ttu-id="f3080-121">Значением каждого параметра может быть 0 или 1; отсутствующие параметры получают значение 0.</span><span class="sxs-lookup"><span data-stu-id="f3080-121">You can set the value of each option to 0 or 1, and any absent option defaults to 0.</span></span> <span data-ttu-id="f3080-122">Для упрощения отладки значение `GenerateTrackingInfo` должно быть равным 1, а значение `AllowOptimize` — 0.</span><span class="sxs-lookup"><span data-stu-id="f3080-122">Setting `GenerateTrackingInfo` to 1 and `AllowOptimize` to 0 provides the easiest debugging.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f3080-123">В .NET Framework версии 2.0 JIT-компилятор всегда генерирует сведения об отслеживании независимо от значения `GenerateTrackingInfo`, однако значение `AllowOptimize` по-прежнему действует.</span><span class="sxs-lookup"><span data-stu-id="f3080-123">In the .NET Framework version 2.0, the JIT compiler always generates tracking information regardless of the value for `GenerateTrackingInfo`; however, the `AllowOptimize` value still has an effect.</span></span> <span data-ttu-id="f3080-124">При использовании [Ngen.exe (средства для создания образов в машинном коде)](../../../docs/framework/tools/ngen-exe-native-image-generator.md) для предварительной компиляции образа в машинном коде без оптимизации INI-файл, содержащий параметр `AllowOptimize=0`, должен находиться в целевой папке во время выполнения Ngen.exe.</span><span class="sxs-lookup"><span data-stu-id="f3080-124">When using the [Ngen.exe (Native Image Generator)](../../../docs/framework/tools/ngen-exe-native-image-generator.md) to precompile the native image without optimization, the .ini file must be present in the target folder with `AllowOptimize=0` when Ngen.exe executes.</span></span> <span data-ttu-id="f3080-125">При предварительной компиляции сборки без оптимизации следует удалить предварительно скомпилированный код с помощью параметра NGen.exe **/uninstall**, прежде чем перезапускать Ngen.exe для предварительной компиляции оптимизированного кода.</span><span class="sxs-lookup"><span data-stu-id="f3080-125">If you have precompiled an assembly without optimization, you must remove the precompiled code using the NGen.exe **/uninstall** option before rerunning Ngen.exe to precompile the code as optimized.</span></span> <span data-ttu-id="f3080-126">Если файл INI отсутствует в папке, Ngen.exe по умолчанию предварительно компилирует код как оптимизированный.</span><span class="sxs-lookup"><span data-stu-id="f3080-126">If the .ini file is not present in the folder, by default Ngen.exe precompiles the code as optimized.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f3080-127"><xref:System.Diagnostics.DebuggableAttribute?displayProperty=nameWithType> управляет параметрами для сборки.</span><span class="sxs-lookup"><span data-stu-id="f3080-127">The <xref:System.Diagnostics.DebuggableAttribute?displayProperty=nameWithType> controls the settings for an assembly.</span></span> <span data-ttu-id="f3080-128">**DebuggableAttribute** содержит два поля для записи параметров, определяющих, выполняет ли JIT-компилятор оптимизацию и создает ли он сведения об отслеживании.</span><span class="sxs-lookup"><span data-stu-id="f3080-128">**DebuggableAttribute** includes two fields that record the settings for whether the JIT compiler should optimize, and/or generate tracking information.</span></span> <span data-ttu-id="f3080-129">В .NET Framework версии 2.0 JIT-компилятор всегда генерирует сведения об отслеживании.</span><span class="sxs-lookup"><span data-stu-id="f3080-129">In the .NET Framework version 2.0, the JIT compiler will always generate tracking information.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f3080-130">Для окончательных сборок параметры **DebuggableAttribute** не задаются компилятором.</span><span class="sxs-lookup"><span data-stu-id="f3080-130">For a retail build, compilers do not set any **DebuggableAttribute**.</span></span> <span data-ttu-id="f3080-131">По умолчанию JIT-компилятор настроен для обеспечения максимальной производительности, что затрудняет отладку машинного кода.</span><span class="sxs-lookup"><span data-stu-id="f3080-131">The JIT-compiler default behavior is to generate the highest performance, hardest to debug machine code.</span></span> <span data-ttu-id="f3080-132">Включение JIT-отслеживания несколько снижает производительность; отключение оптимизации снижает производительность значительно.</span><span class="sxs-lookup"><span data-stu-id="f3080-132">Enabling JIT tracking lowers performance a little, and disabling optimization lowers performance a lot.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f3080-133">**DebuggableAttribute** одновременно применяется ко всей сборке, а не к ее отдельным модулям.</span><span class="sxs-lookup"><span data-stu-id="f3080-133">The **DebuggableAttribute** applies to a whole assembly at a time, not to individual modules within the assembly.</span></span> <span data-ttu-id="f3080-134">Средства разработки должны, таким образом, подключать пользовательские атрибуты к классу **System.Runtime.CompilerServices.AssemblyAttributesGoHere** или, если сборка уже создана, к токену метаданных сборки.</span><span class="sxs-lookup"><span data-stu-id="f3080-134">Development tools must therefore attach custom attributes to the assembly metadata token, if an assembly has already been created, or to the class called **System.Runtime.CompilerServices.AssemblyAttributesGoHere**.</span></span> <span data-ttu-id="f3080-135">Средство ALink выполняет перемещение атрибутов **DebuggableAttribute** из каждого модуля в сборку, частью которой они становятся.</span><span class="sxs-lookup"><span data-stu-id="f3080-135">The ALink tool will then promote these **DebuggableAttribute** attributes from each module to the assembly they become a part of.</span></span> <span data-ttu-id="f3080-136">Возникновение конфликта вызывает сбой в работе ALink.</span><span class="sxs-lookup"><span data-stu-id="f3080-136">If there is a conflict, the ALink operation will fail.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f3080-137">В .NET Framework версии 1.0 **DebuggableAttribute** добавляется компилятором Microsoft Visual C++, если указаны параметры компилятора **/clr** и **/Zi**.</span><span class="sxs-lookup"><span data-stu-id="f3080-137">In version 1.0 of the .NET Framework, the Microsoft Visual C++ compiler adds the **DebuggableAttribute** when the **/clr** and **/Zi** compiler options are specified.</span></span> <span data-ttu-id="f3080-138">В .NET Framework версии 1.1 **DebugabbleAttribute** можно добавить как вручную (в коде), так и с помощью параметра **/ASSEMBLYDEBUG** компоновщика.</span><span class="sxs-lookup"><span data-stu-id="f3080-138">In version 1.1 of the .NET Framework, you must either add the **DebugabbleAttribute** manually in your code or use the **/ASSEMBLYDEBUG** linker option.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f3080-139">См. также</span><span class="sxs-lookup"><span data-stu-id="f3080-139">See Also</span></span>  
 [<span data-ttu-id="f3080-140">Отладка, трассировка и профилирование</span><span class="sxs-lookup"><span data-stu-id="f3080-140">Debugging, Tracing, and Profiling</span></span>](../../../docs/framework/debug-trace-profile/index.md)  
 [<span data-ttu-id="f3080-141">Включение отладки с JIT-присоединением</span><span class="sxs-lookup"><span data-stu-id="f3080-141">Enabling JIT-Attach Debugging</span></span>](../../../docs/framework/debug-trace-profile/enabling-jit-attach-debugging.md)  
 [<span data-ttu-id="f3080-142">Включение профилирования</span><span class="sxs-lookup"><span data-stu-id="f3080-142">Enabling Profiling</span></span>](http://msdn.microsoft.com/en-us/3b669676-f0e0-4ebf-8674-68986dd2020d)
