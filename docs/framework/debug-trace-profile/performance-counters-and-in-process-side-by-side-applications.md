---
title: "Performance Counters and In-Process Side-By-Side Applications | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
  - "C++"
  - "jsharp"
helpviewer_keywords: 
  - "performance counters"
  - "performance counters,and in-process side-by-side applications"
  - "performance,.NET Framework applications"
  - "performance monitoring,counters"
ms.assetid: 6888f9be-c65b-4b03-a07b-df7ebdee2436
caps.latest.revision: 26
author: "rpetrusha"
ms.author: "ronpet"
manager: "wpickett"
caps.handback.revision: 26
---
# Performance Counters and In-Process Side-By-Side Applications
С помощью системного монитора \(Perfmon.exe\) можно различать счетчики производительности по средам выполнения.  В этом разделе рассматривается изменение реестра, необходимое для включения данной функциональности.  
  
## Поведение по умолчанию  
 По умолчанию монитор производительности отображает счетчики производительности по приложениям.  Однако существует два сценария, в которых это создает проблемы:  
  
-   При контроле двух приложений с одинаковыми именами.  Например, если оба приложения называются myapp.exe, в столбце **Экземпляр** одно отображается как **myapp**, а другое как **myapp\#1**.  В такой ситуации трудно понять, какой счетчик производительности соответствует конкретному приложению.  Неясно, относятся ли данные, собранные для **myapp\#1**, к первому или ко второму приложению myapp.exe.  
  
-   Когда приложение использует несколько экземпляров среды CLR.  [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)] поддерживает внутрипроцессные параллельные сценарии размещения; то есть, один процесс или приложение может загрузить несколько экземпляров среды CLR.  Если одно приложение с именем myapp.exe загружает два экземпляра среды выполнения, по умолчанию они обозначаются в столбце **Экземпляр** как **myapp** и **myapp\#1**.  В таком случае неясно, означают ли **myapp** и **myapp\#1** два приложения с одинаковым именем или одно приложение с двумя средами выполнения.  Если несколько приложений с одинаковым именем загружают несколько сред выполнения, это приводит к еще большей неоднозначности.  
  
 Для устранения такой неоднозначности можно задать раздел реестра.  Для приложений, разработанных с использованием [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], это изменение реестра добавляет идентификатор процесса и идентификатор экземпляра среды выполнения к имени приложения в столбце **Экземпляр**.  Вместо *application* или *application*\#1, приложение теперь определяется как *application*\_`p`*processID*\_`r`*runtimeID* в столбце **Экземпляр**.  Если приложение было разработано с использованием предыдущей версии среды CLR, этот экземпляр отображается как *application\_*`p`*processID*, при условии, что установлена платформа [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)].  
  
## Счетчики производительности для внутрипроцессных параллельных приложений  
 Чтобы работать со счетчиками производительности для нескольких версий среды CLR, размещенных в одном приложении, необходимо изменить один параметр раздела реестра, как показано в следующей таблице.  
  
|||  
|-|-|  
|Имя раздела|HKEY\_LOCAL\_MACHINE\\System\\CurrentControlSet\\Services\\.NETFramework\\Performance|  
|Имя значения|ProcessNameFormat|  
|Тип значения|REG\_DWORD|  
|Значение|1 \(0x00000001\)|  
  
 Значение 0 для `ProcessNameFormat` указывает, что включено поведение по умолчанию; то есть, Perfmon.exe отображает счетчики производительности по приложениям.  Если установить значение 1, Perfmon.exe будет различать несколько версий приложения и предоставлять счетчики производительности по средам выполнения.  Любые другие значения раздела реестра `ProcessNameFormat` не поддерживаются и зарезервированы для дальнейшего использования.  
  
 После обновления значения раздела реестра `ProcessNameFormat` необходимо перезапустить Perfmon.exe или какие\-либо другие пользовательские счетчики производительности для правильной работы функции именования экземпляров.  
  
 В следующем примере показан программный способ изменения значения `ProcessNameFormat`.  
  
 [!code-csharp[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/cs/regsetting1.cs#1)]
 [!code-vb[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/vb/regsetting1.vb#1)]  
  
 Если в реестр внесено это изменение, программа Perfmon.exe отображает имена приложений, нацеленных на [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], как *application*\_`p`*processID*\_`r`*runtimeID*, где *application*— это имя приложения, *processID* — идентификатор процесса приложения, а *runtimeID* — идентификатор среды CLR.  Например, если приложение с именем myapp.exe загружает два экземпляра среды CLR, то программа Perfmon.exe может отображать один экземпляр как myapp\_p1416\_r10, а второй как myapp\_p3160\_r10.  Идентификатор среды выполнения только однозначно обозначает среды выполнения в пределах процесса; он не содержит никаких других сведений о среде выполнения. \(Например, идентификатор среды выполнения никак не связан с версией или SKU среды выполнения.\)  
  
 Если установлена платформа [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], это изменение реестра также влияет на приложения, разработанные с помощью более ранних версий платформы .NET Framework.  Они отображаются в программе Perfmon.exe как *application\_*`p`*processID*, где *application* — это имя приложения, а *processID* — идентификатор процесса.  Например, если контролируются счетчики производительности двух приложений с именем myapp.exe, одно может отображаться как myapp\_p23900, а другое — как myapp\_p24908.  
  
> [!NOTE]
>  Идентификатор процесса устраняет неоднозначность идентификации двух приложений с одинаковым именем, использующих более ранние версии среды выполнения.  Для предыдущих версий идентификатор среды выполнения не требуется, так как предыдущие версии среды CLR не поддерживают параллельные сценарии.  
  
 Если платформа [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] отсутствует или была удалена, задание этого ключа реестра не оказывает никакого влияния.  Это означает, что два приложения с одинаковым именем будут по\-прежнему отображаться в программе Perfmon.exe как *application* и *application\#1* \(например, как **myapp** и **myapp\#1**\).