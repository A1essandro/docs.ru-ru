---
title: "Трассировка и оборудование приложений | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
  - "C++"
  - "jsharp"
helpviewer_keywords: 
  - "трассировка [платформа .NET Framework]"
  - "отладка [платформа .NET Framework], инструментирование"
  - "мониторинг производительности, инструментарий"
  - "инструментарий, об инструментарии"
  - "трассировка [платформа .NET Framework], о трассировке"
  - "мониторинг производительности, трассировка кода"
  - "Класс Trace, инструментарий для приложений .NET"
ms.assetid: 773b6fc4-9013-4322-b728-5dec7a72e743
caps.latest.revision: 21
author: "mairaw"
ms.author: "mairaw"
manager: "wpickett"
caps.handback.revision: 21
---
# Трассировка и оборудование приложений
Трассировка — это способ мониторинга выполнения приложения во время его выполнения. Вы можете добавить инструментирование трассировки и отладки в свое приложения .NET Framework при его разработке; кроме того, вы можете использовать это инструментирование при разработке приложения и после его развертывания. Можно использовать <xref:System.Diagnostics.Trace?displayProperty=fullName>, <xref:System.Diagnostics.Debug?displayProperty=fullName>, и <xref:System.Diagnostics.TraceSource?displayProperty=fullName> классы для записи сведений об ошибках и выполнении приложения в журналы, текстовые файлы или другие устройства для последующего анализа.  
  
 Термин *инструментария* обозначает возможность отслеживания и измерения уровня производительности продукта и диагностики ошибок. В программировании это означает способность приложения включать следующие возможности.  
  
-   **Трассировка кода** — получение информационных сообщений о работе приложения во время выполнения.  
  
-   **Отладка** — отслеживание и устранение ошибок программирования в приложении при разработке. Дополнительные сведения см. в разделе [Отладка](../Topic/Debugging%20in%20Visual%20Studio.md).  
  
-   **Счетчики производительности** — компоненты, позволяющие отслеживать производительность приложения. Дополнительные сведения см. в разделе [счетчики производительности](../../../docs/framework/debug-trace-profile/performance-counters.md).  
  
-   **Журналы событий** — компоненты, позволяющие получать и отслеживать основные события при выполнении приложения. Дополнительные сведения см. в разделе <xref:System.Diagnostics.EventLog> класса.  
  
 Инструментирование приложения путем добавления операторов трассировки в стратегически важных местах кода особенно полезно для распределенных приложений. С помощью операторов трассировки можно инструментировать приложение не только для отображения сведений о неправильных моментах, но также отслеживать, насколько хорошо работает приложение.  
  
 <xref:System.Diagnostics.TraceSource> класс предоставляет улучшенные функции трассировки и может использоваться вместо статических методов более старых <xref:System.Diagnostics.Trace> и <xref:System.Diagnostics.Debug> классов трассировки. Привычный <xref:System.Diagnostics.Trace> и <xref:System.Diagnostics.Debug> по-прежнему широко используются классы, но <xref:System.Diagnostics.TraceSource> рекомендуется использовать класс для новых команд трассировки, таких как <xref:System.Diagnostics.TraceSource.TraceEvent%2A> и <xref:System.Diagnostics.TraceSource.TraceData%2A>.  
  
 <xref:System.Diagnostics.Trace> и <xref:System.Diagnostics.Debug> классы являются идентичными, за исключением того, что процедуры и функции <xref:System.Diagnostics.Trace> класса по умолчанию компилируются в сборки выпуска, а <xref:System.Diagnostics.Debug> класса.  
  
 <xref:System.Diagnostics.Trace> и <xref:System.Diagnostics.Debug> классы предоставляют средства для контроля и исследования производительности приложения как во время разработки, так и после развертывания. Например, можно использовать <xref:System.Diagnostics.Trace> класса для отслеживания отдельных типов действий в развертываемом приложении по мере их выполнения (например, создание новых подключений к базе данных) и последующего мониторинга производительности приложения.  
  
## <a name="code-tracing-and-debugging"></a>Отладка и трассировка кода  
 Во время разработки, можно использовать методы вывода <xref:System.Diagnostics.Debug> класс позволяет отображать сообщения в окне вывода в среде разработки Visual Studio (IDE). Например:  
  
```vb  
Trace.WriteLine("Hello World!")  
Debug.WriteLine("Hello World!")  
  
```  
  
```csharp  
System.Diagnostics.Trace.WriteLine("Hello World!");  
System.Diagnostics.Debug.WriteLine("Hello World!");  
  
```  
  
 В каждом из этих примеров будет отображаться «Hello World!» в окне вывода при запуске приложения в отладчике.  
  
 Это позволяет отлаживать приложения и оптимизировать их производительность на основе их поведения в среде тестирования. Можно отлаживать приложения при отладочном построении с <xref:System.Diagnostics.Debug> включенным, чтобы получать все выходные данные отладки условным атрибутом. Когда приложение будет готово к выпуску, можно скомпилировать построение выпуска без включения <xref:System.Diagnostics.Debug> условный атрибут, чтобы код отладки не будет включен компилятором в конечный исполняемый файл. Дополнительные сведения см. в разделе [как: компиляции условная с использованием атрибутов Trace и Debug](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md). Дополнительные сведения о различных конфигурациях построений для приложения см. в разделе [компиляции и построения](../Topic/Compiling%20and%20Building%20in%20Visual%20Studio.md).  
  
 Вы можно также отслеживать выполнение кода в установленном приложении, с помощью методов <xref:System.Diagnostics.Trace> класса. Поместив [переключателей трассировки](../../../docs/framework/debug-trace-profile/trace-switches.md) в коде, можно управлять трассировкой и насколько полной она является. Это позволяет наблюдать за состоянием приложения в рабочей среде. Это особенно важно в бизнес-приложении, использующем множественные компоненты, выполняющиеся на нескольких компьютерах. Вы можете управлять порядком использования переключателей после развертывания с помощью файла конфигурации. Дополнительные сведения см. в разделе [Практическое руководство: создание, инициализация и настройка переключателей трассировки](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md).  
  
 При разработке приложения, для которого предполагается использовать трассировку, в код приложения обычно включают сообщения трассировки и отладки. Когда будете готовы для развертывания приложения, можно скомпилировать построение выпуска без включения **отладки** условным атрибутом. Тем не менее, можно включить **трассировки** условный атрибут, чтобы компилятор включил код трассировки в исполняемый файл. Дополнительные сведения см. в разделе [как: компиляции условная с использованием атрибутов Trace и Debug](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md).  
  
### <a name="phases-of-code-tracing"></a>Этапы трассировки кода  
 Существует три этапа трассировки кода.  
  
1.  **Инструментарий** — Добавление кода трассировки в приложении.  
  
2.  **Трассировка** — код трассировки записывает данные в указанный целевой объект.  
  
3.  **Анализ** — оценка сведений трассировки для определения и понимания проблем в приложении.  
  
 Во время разработки все методы вывода трассировки и отладки записывают сведения в окне вывода Visual Studio по умолчанию. В развернутом приложении эти методы записывают сведения трассировки в указанные целевые объекты. Дополнительные сведения об указании целевого объекта выходных данных трассировки или отладки в разделе [прослушиватели трассировки](../../../docs/framework/debug-trace-profile/trace-listeners.md).  
  
 Ниже приведен полный обзор основных шагов, обычно выполняемых при использовании трассировки для анализа и исправления возможных проблем в развертываемом приложении. Дополнительные сведения о выполнении этих шагов см. по соответствующей ссылке.  
  
##### <a name="to-use-tracing-in-an-application"></a>Использование трассировки в приложении  
  
1.  Обдумайте, какие выходные данные трассировки вы хотите получить на месте после развертывания приложения.  
  
2.  Создайте набора переключателей. Дополнительные сведения см. в разделе [Практическое руководство: Настройка переключателей трассировки](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md).  
  
3.  Добавьте операторы трассировки в код приложения.  
  
4.  Определите, где вы хотите получать выходные данные трассировки, и добавьте соответствующие прослушиватели. Дополнительные сведения см. в разделе [Создание и инициализация прослушивателей трассировки](../../../docs/framework/debug-trace-profile/how-to-create-and-initialize-trace-listeners.md).  
  
5.  Выполните тестирование и отладку своего приложения и содержащегося в нем кода трассировки.  
  
6.  Скомпилируйте приложение в исполняемый код с помощью одной из следующих процедур.  
  
    -   Используйте **построения** меню вместе с **отладки** страница **страницы свойств** диалогового окна в **обозревателе решений**. Используйте эту процедуру при компиляции в Visual Studio.  
  
         \- или -  
  
    -   Используйте **трассировки** и **отладки** директивы компилятора для компиляции из командной строки. Дополнительные сведения см. в разделе [компиляции условная с использованием атрибутов Trace и Debug](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md). Используйте эту процедуру при компиляции из командной строки.  
  
7.  Если во время выполнения возникает проблема, включите соответствующий переключатель трассировки. Дополнительные сведения см. в разделе [Настройка переключателей трассировки](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md).  
  
     Код трассировки записывает сообщения трассировки в указанный целевой объект, например в экран, текстовый файл или журнал событий. Тип прослушивателя, включенного в **Trace.Listeners** коллекции определяет целевой объект.  
  
8.  Проанализируйте сообщения трассировки, чтобы обнаружить и понять проблемы в приложении.  
  
## <a name="trace-instrumentation-and-distributed-applications"></a>Инструментирование трассировки и распределенные приложения  
 При создании распределенного приложения тестирование приложения способом, которым оно будет использоваться, может показаться сложной задачей. Немногие группы разработчиков имеют возможность протестировать все возможные сочетания операционных систем или веб-браузеров (в том числе все параметры локализованных версий) или смоделировать большое число пользователей, которые будут обращаться к приложению одновременно. В таких обстоятельствах невозможно протестировать реакцию распределенного приложения на большую нагрузку, различные настройки и разные действия конечных пользователей. Кроме того, многие компоненты распределенного приложения не имеют пользовательского интерфейса, с которым можно взаимодействовать напрямую или просматривать активность этих компонентов.  
  
 Тем не менее, вы можете компенсировать это, позволив распределенным приложениям описывать определенные события интерес для системных администраторов, особенно распределенному, по *инструментирование* приложения — то есть путем размещения операторов трассировки в стратегически важных местах кода. Затем, если во время выполнения произойдет что-либо неожиданное (например, слишком большое время отклика), можно будет определить вероятную причину.  
  
 Операторы трассировки помогают избежать сложностей проверки исходного кода, его изменения, перекомпиляции, а также попыток воспроизвести ошибку времени выполнения в среде отладки. Помните, что можно инструментировать приложение не только для отображения ошибок, но также для наблюдения за производительностью.  
  
## <a name="strategic-placement-of-trace-statements"></a>Стратегическое размещение операторов трассировки  
 Необходимо уделить особое внимание размещению операторов трассировки для использования во время выполнения. Вы должны учесть, какие сведения трассировки скорее всего потребуются в развертываемом приложении, чтобы в полной мере охватить все вероятные сценарии трассировки. Поскольку приложения, использующие трассировку, могут быть самыми разными, не существует общих принципов стратегического размещения трассировки. Дополнительные сведения о размещении операторов трассировки см. в разделе [Практическое руководство: добавление операторов трассировки в код приложения](../../../docs/framework/debug-trace-profile/how-to-add-trace-statements-to-application-code.md).  
  
## <a name="output-from-tracing"></a>Выходные данные трассировки  
 Выходные данные трассировки собираются объектами, именуемыми *прослушиватели*. Прослушиватель — это объект, который принимает выходные данные трассировки и записывает их в устройство вывода (обычно это окно, журнал или текстовый файл). При создании прослушиватель трассировки, как правило, добавляется к <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=fullName> коллекции, что позволяет ему получать все выходные данные трассировки.  
  
 Сведения трассировки всегда записываются по крайней мере по умолчанию <xref:System.Diagnostics.Trace> целевые выходные данные <xref:System.Diagnostics.DefaultTraceListener>. Если для какой-то причине вы удалили <xref:System.Diagnostics.DefaultTraceListener> без добавления других прослушивателей для <xref:System.Diagnostics.Trace.Listeners%2A> коллекции, сообщения трассировки не будут получены. Дополнительные сведения см. в разделе [прослушиватели трассировки](../../../docs/framework/debug-trace-profile/trace-listeners.md).  
  
 Шести <xref:System.Diagnostics.Debug> членов и <xref:System.Diagnostics.Trace> в следующей таблице перечислены методы, которые записывают сведения трассировки.  
  
|Метод|Вывод|  
|------------|------------|  
|**Утверждение**|Указанный текст; если ничего не указано, то стек вызовов. Выходные данные записываются, только если условие, заданное в качестве аргумента **Assert** инструкция **false**.|  
|**Сбой**|Указанный текст; если ничего не указано, то стек вызовов.|  
|**Записи**|Указанный текст.|  
|**WriteIf**|Заданный текст, если условие, заданное в качестве аргумента **WriteIf** выполняется инструкция.|  
|**WriteLine**|Заданный текст и возврат каретки.|  
|**WriteLineIf**|Заданный текст и возврат каретки, если условие, заданное в качестве аргумента **WriteLineIf** выполняется инструкция.|  
  
 Все прослушиватели в <xref:System.Diagnostics.Trace.Listeners%2A> коллекции получают сообщения, описанные в приведенной выше таблице, но предпринимаемые ими действия зависят от вида прослушивателя, получившего сообщения. Например <xref:System.Diagnostics.DefaultTraceListener> Отображение диалогового окна утверждения, при получении **ошибкой** или сбой **Assert** уведомления, но <xref:System.Diagnostics.TextWriterTraceListener> просто записывает вывод в свой поток.  
  
 Можно создавать пользовательские результаты путем реализации собственного прослушивателя. Пользовательский прослушиватель трассировки может, например, отображать сообщения в окне сообщения или подключаться к базе данных для добавления сообщений в таблицу. Все пользовательские прослушиватели должны поддерживать шесть вышеупомянутых методов. Дополнительные сведения о создании прослушивателей, определяемых разработчиками, см. <xref:System.Diagnostics.TraceListener> в справочнике по .NET Framework.  
  
> [!NOTE]
>  В [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)], **Debug.Write**, **Debug.WriteIf**, **Debug.WriteLine**, и **Debug.WriteLineIf** методы были заменены **Debug.Print** метод, который был доступен в более ранних версиях Visual Basic.  
  
 **Записи** и **WriteLine** методы всегда записывают указанный текст можно задать. **Assert**, **WriteIf**, и **WriteLineIf** требуется логический аргумент, который управляет ли они записывают указанный текст, так как они заданный текст записывается только если выражение является **true** (для **WriteIf** и **WriteLineIf**), или **false** (для **Assert**). **Сбой** всегда записывает указанный текст. Дополнительные сведения см. в разделе [Практическое руководство: добавление операторов трассировки в код приложения](../../../docs/framework/debug-trace-profile/how-to-add-trace-statements-to-application-code.md) и справочнике по .NET Framework.  
  
## <a name="security-concerns"></a>Проблемы безопасности  
 Если не отключить трассировку и отладку перед развертыванием приложения ASP.NET, то приложение может отображать сведения о себе, которые могут использоваться вредоносными программами. Дополнительные сведения см. в разделе [как: компиляции условная с использованием атрибутов Trace и Debug](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md), [компиляции и построения](../Topic/Compiling%20and%20Building%20in%20Visual%20Studio.md), и [Практическое руководство: создание, инициализация и настройка переключателей трассировки](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md). Отладка также настраивается через службы IIS.  
  
## <a name="see-also"></a>См. также  
 <xref:System.Diagnostics.Trace>   
 <xref:System.Diagnostics.TraceSource>   
 [Контракты для кода](../../../docs/framework/debug-trace-profile/code-contracts.md)   
 [C#, F # и типы проектов Visual Basic](../Topic/Debugging%20Preparation:%20C%23,%20F%23,%20and%20Visual%20Basic%20Project%20Types.md)   
 [Практическое руководство: добавление инструкций трассировки в код приложения](../../../docs/framework/debug-trace-profile/how-to-add-trace-statements-to-application-code.md)   
 [Практическое руководство: условная компиляция с Trace и Debug](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md)   
 [Практическое руководство: создание, инициализация и настройка переключателей трассировки](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md)   
 [Практическое руководство: Создание и инициализация источников трассировки](../../../docs/framework/debug-trace-profile/how-to-create-and-initialize-trace-sources.md)   
 [Практическое руководство: использование TraceSource и фильтров с прослушивателями трассировки](../../../docs/framework/debug-trace-profile/how-to-use-tracesource-and-filters-with-trace-listeners.md)   
 [Прослушиватели трассировки](../../../docs/framework/debug-trace-profile/trace-listeners.md)   
 [Переключатели трассировки](../../../docs/framework/debug-trace-profile/trace-switches.md)