---
title: "Default XAML Schema Context and WPF XAML Schema Context | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-wpf"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: 04e06a15-09b3-4210-9bdf-9a64c2eccb83
caps.latest.revision: 7
author: "wadepickett"
ms.author: "wpickett"
manager: "wpickett"
caps.handback.revision: 7
---
# Default XAML Schema Context and WPF XAML Schema Context
Контекст схемы XAML — это концептуальная сущность, которая определяет порядок взаимодействия производства XAML\-кода, использующего определенный словарь XAML, с поведением записи объектов, включая порядок разрешения сопоставлений типов, загрузки сборок и интерпретации некоторых параметров средств чтения и записи.  В этом разделе описываются функции служб XAML платформы .NET Framework и связанный с ними контекст схемы XAML по умолчанию, основанный на системе типов среды CLR.  Также рассматривается контекст схемы XAML, используемый для WPF.  
  
## Контекст схемы XAML по умолчанию  
 Службы XAML платформы .NET Framework и реализуют, и используют контекст схемы XAML по умолчанию.  Поведение контекста схемы XAML по умолчанию не всегда бывает полностью видимым в API\-интерфейсе класса <xref:System.Xaml.XamlSchemaContext>.  Однако во многих случаях поведение, на которое влияет контекст схемы XAML по умолчанию, можно наблюдать через общий API\-интерфейс системы типов XAML, такой как члены класса <xref:System.Xaml.XamlMember> или <xref:System.Xaml.XamlType>, или через API\-интерфейсы, предоставляемые средствами чтения и записи XAML, которые используют контекст схемы XAML по умолчанию.  
  
 Можно создать объект <xref:System.Xaml.XamlSchemaContext>, который инкапсулирует поведение по умолчанию, вызвав конструктор класса <xref:System.Xaml.XamlSchemaContext>.  При этом явно создается контекст схемы XAML по умолчанию.  Этот же контекст схемы XAML по умолчанию создается неявно, если инициализировать средство чтения или записи XAML, используя API\-интерфейсы, не принимающие явным образом входной параметр типа <xref:System.Xaml.XamlSchemaContext>.  
  
 Поведение сопоставления типов контекста схемы XAML по умолчанию основывается на отражении среды CLR.  Сюда входит рассмотрение и определение типа \(<xref:System.Type>\) среды CLR и связанных с ним объектов <xref:System.Reflection.PropertyInfo> или <xref:System.Reflection.MethodInfo>.  Кроме того, атрибуты среды CLR, которыми помечены типы или члены, используются для выяснения определенных подробностей о типе XAML или члене XAML, информация о котором взята из резервного типа среды CLR.  Контекст схемы XAML по умолчанию не требует методик расширения системы типов, таких как шаблон `Invoker`, поскольку необходимую информацию можно получить из системы типов среды CLR.  
  
 В части логики загрузки сборок контекст схемы XAML по умолчанию полагается главным образом на значения сборок, предоставленные в сопоставлениях пространств имен XAML.  Кроме того, свойство <xref:System.Xaml.XamlReaderSettings.LocalAssembly%2A> может подсказывать сборку, которую требуется загрузить, для таких сценариев, как загрузка внутренних типов.  
  
## Контекст схемы XAML в WPF  
 Контекст схемы XAML в WPF рассматривается в этом разделе по той причине, что реализация WPF представляет собой интересную иллюстрацию возможностей, которые можно получить путем реализации контекста схемы XAML, отличного от существующего по умолчанию.  Кроме того, в документации WPF, посвященной XAML в WPF, концепции контекста схемы XAML уделено не очень много внимания; для полного понимания поведения, обеспечиваемого контекстом схемы XAML, желательно рассматривать его в привязке к работе контекста схемы XAML по умолчанию.  Контекст схемы XAML в WPF реализует следующее поведение.  
  
 **Переопределения поиска:** в WPF имеется несколько моделей содержимого для XAML, в которых присутствуют свойства содержимого XAML, функционирующие, не будучи помеченными атрибутом <xref:System.Windows.Markup.ContentPropertyAttribute>.  Это поведение реализуется переопределениями метода <xref:System.Xaml.XamlType.LookupContentProperty%2A> для WPF.  
  
 **Отсрочка для выражений WPF:** в WPF предусмотрено несколько классов выражений, в которых определение значения откладывается до тех пор, пока не будет доступен контекст среды выполнения.  Кроме того, расширение шаблона — поведение времени выполнения, которые основывается на методиках отсрочки.  
  
 **Оптимизация поиска в системе типов:** WPF располагает обширными словарем XAML и объектной моделью, включая определения членов базовых классов, наследуемые в буквальном смысле сотнями определенных в WPF классов.  Кроме того, сама платформа WPF распределена по нескольким сборкам.  Поиск типов в WPF оптимизируется за счет применения таблиц подстановки и других методик.  Это обеспечивает повышение производительности по сравнению с контекстом схемы XAML по умолчанию с присущим ему поиском типов на основе среды CLR.  В случаях, где типы отсутствуют в таблице подстановки, в поведении используются методики контекста схемы XAML, аналогичные контексту схемы XAML по умолчанию.  
  
 **Расширение классов XamlType и XamlMember:** в WPF концепция свойств расширена свойствами зависимостей, а концепция событий — перенаправленными событиями.  Чтобы увеличить доступность этих концепций для операций обработки XAML, в WPF расширены классы <xref:System.Xaml.XamlType> и <xref:System.Xaml.XamlMember>, а также добавлены внутренние свойства, сообщающие характеристики свойств зависимостей и перенаправленных событий.  
  
### Доступ к контексту схемы XAML в WPF  
 Если используются методики работы с XAML, основанные на классах WPF <xref:System.Windows.Markup.XamlReader?displayProperty=fullName> или <xref:System.Windows.Markup.XamlWriter?displayProperty=fullName>, в этих реализациях средства чтения и записи XAML уже используется контекст схемы XAML в WPF.  
  
 Если используются другие реализации средства чтения или записи XAML, не инициализируемые контекстом схемы XAML в WPF, получить работающий контекст схемы XAML в WPF можно от метода <xref:System.Windows.Markup.XamlReader.GetWpfSchemaContext%2A?displayProperty=fullName>.  Это значение затем можно использовать для инициализации других API\-интерфейсов, предполагающих использование контекста <xref:System.Xaml.XamlSchemaContext>.  Например, можно вызвать метод <xref:System.Xaml.XamlXmlReader.%23ctor%2A> для инициализации и передать контекст схемы XAML в WPF.  Другой вариант — использовать контекст схемы XAML в WPF для операций с системой типов XAML.  Это может включать инициализацию конструктором <xref:System.Xaml.XamlType> или <xref:System.Xaml.XamlMember> или вызов метода <xref:System.Xaml.XamlSchemaContext.GetXamlType%2A?displayProperty=fullName>.  
  
 Обратите внимание, что при доступе к определенным аспектам XAML в WPF исключительно с точки зрения потока узлов XAML некоторые возможности платформы WPF могут быть еще не задействованы.  \(Например, еще не применены шаблоны WPF для элементов управления.\)  Следовательно, при доступе к свойству, которое во время выполнения может быть заполнено полным визуальным деревом, возможно, удастся получить только значение свойства, ссылающееся на шаблон.  Контекст службы, предоставляемый для расширений разметки WPF, также может быть не точным, если он предоставляется не во время выполнения, и может привести к исключениям при попытке записи графа объектов.  
  
## XAML и загрузка сборок  
 Загрузка сборок для XAML и служб XAML платформы .NET Framework тесно связана с концепцией домена приложения \(<xref:System.AppDomain>\), определяемой средой CLR.  Контекст схемы XAML интерпретирует либо порядок загрузки сборок, либо поиска типов во время выполнения или во время разработки, основываясь на использовании <xref:System.AppDomain> и других факторах.  Логика слегка различается в зависимости от того, представляет ли XAML\-код собой свободный XAML для средства чтения XAML, скомпилирован ли XAML\-код в библиотеку DLL с помощью задачи `XamlBuildTask` или представляет собой BAML\-код, сформированный задачей WPF `PresentationBuildTask`.  
  
 Контекст схемы XAML для WPF тесно связан с моделью приложения WPF, которая, в свою очередь, использует <xref:System.AppDomain>, а также другие факторы, представляющие собой подробности реализации WPF.  
  
#### Входные данные средства чтения XAML \(свободный XAML\)  
  
1.  Контекст схемы XAML выполняет перебор объектов <xref:System.AppDomain> приложения с целью поиска уже загруженной сборки, соответствующей всем аспектам имени, начиная с последней загруженной сборки.  Если соответствие обнаружено, эта сборка используется для разрешения.  
  
2.  В противном случае для загрузки сборки используется одна из следующих методик, основанных на API\-интерфейсе <xref:System.Reflection.Assembly> среды CLR.  
  
    -   Если имя определено в сопоставлении, вызовите метод <xref:System.Reflection.Assembly.Load%28System.String%29?displayProperty=fullName> для определенного имени.  
  
    -   Если предыдущий шаг завершается неудачно, используйте короткое имя \(и токен открытого ключа, если он присутствует\) для вызова метода <xref:System.Reflection.Assembly.Load%28System.String%29?displayProperty=fullName>.  
  
    -   Если имя не определено в сопоставлении, вызовите метод <xref:System.Reflection.Assembly.LoadWithPartialName%2A?displayProperty=fullName>.  
  
#### XamlBuildTask  
 Задача `XamlBuildTask` используется для [!INCLUDE[vsindigo](../../../includes/vsindigo-md.md)] и [!INCLUDE[TLA#tla_workflow](../../../includes/tlasharptla-workflow-md.md)].  
  
 Обратите внимание, что ссылки на сборки, полученные через `XamlBuildTask`, всегда полностью определены.  
  
1.  Вызовите метод <xref:System.Reflection.Assembly.Load%28System.String%29?displayProperty=fullName> для определенного имени.  
  
2.  Если предыдущий шаг завершается неудачно, используйте короткое имя \(и токен открытого ключа, если он присутствует\) для вызова метода <xref:System.Reflection.Assembly.Load%28System.String%29?displayProperty=fullName>.  
  
#### BAML \(PresentationBuildTask\)  
 Существует два аспекта загрузки сборок для языка BAML: загрузка первоначальной сборки, содержащей BAML\-код в качестве компонента, и загрузка сборок резервирования типов для типов, на которые ссылается производство BAML.  
  
##### Загрузка сборок для первоначальной разметки:  
 Ссылка на сборку, из которой требуется загрузить разметку, никогда не является полностью определенной.  
  
1.  Контекст схемы XAML в WPF выполняет перебор объектов <xref:System.AppDomain> приложения WPF с целью поиска уже загруженной сборки, соответствующей всем аспектам имени, начиная с последней загруженной сборки.  Если соответствие обнаружено, эта сборка используется для разрешения.  
  
2.  Если предыдущий шаг завершается неудачно, используйте короткое имя \(и токен открытого ключа, если он присутствует\) для вызова метода <xref:System.Reflection.Assembly.Load%28System.String%29?displayProperty=fullName>.  
  
##### Ссылки на сборки из типов BAML:  
 Ссылки на сборки для типов, используемых в производстве BAML, всегда полностью определены, поскольку они являются выходными данными задачи построения.  
  
1.  Контекст схемы XAML в WPF выполняет перебор объектов <xref:System.AppDomain> приложения WPF с целью поиска уже загруженной сборки, соответствующей всем аспектам имени, начиная с последней загруженной сборки.  Если соответствие обнаружено, эта сборка используется для разрешения.  
  
2.  В противном случае для загрузки сборки используется одна из следующих методик.  
  
    -   Вызовите метод <xref:System.Reflection.Assembly.Load%28System.String%29?displayProperty=fullName> для определенного имени.  
  
    -   Если сочетание "короткое имя \+ токен открытого ключа" соответствуют сборке, из которой был загружен BAML\-код, используйте эту сборку.  
  
    -   Используйте сочетание "короткое имя \+ токен открытого ключа" для вызова метода <xref:System.Reflection.Assembly.Load%28System.String%29?displayProperty=fullName>.  
  
## См. также  
 [Understanding XAML Node Stream Structures and Concepts](../../../docs/framework/xaml-services/understanding-xaml-node-stream-structures-and-concepts.md)