---
title: "Собираемые сборки для создания динамического типа"
description: 
ms.date: 08/29/2017
ms.prod: .net
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- reflection, dynamic assembly
- assemblies, collectible
- collectible assemblies, retrieving
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: 2c9a613f4cc13c3e4189a59ace2e05d01d1bcb4f
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="collectible-assemblies-for-dynamic-type-generation"></a><span data-ttu-id="624df-102">Собираемые сборки для создания динамического типа</span><span class="sxs-lookup"><span data-stu-id="624df-102">Collectible assemblies for dynamic type generation</span></span>

<span data-ttu-id="624df-103">*Собираемые сборки* являются динамических сборок, которые могут быть выгружены без выгрузки домена приложения, в котором они были созданы.</span><span class="sxs-lookup"><span data-stu-id="624df-103">*Collectible assemblies* are dynamic assemblies that can be unloaded without unloading the application domain in which they were created.</span></span> <span data-ttu-id="624df-104">Невозможно освободить управляемые и неуправляемые память, используемая собираемой сборки и типы, содержащиеся в нем.</span><span class="sxs-lookup"><span data-stu-id="624df-104">All managed and unmanaged memory used by a collectible assembly and the types it contains can be reclaimed.</span></span> <span data-ttu-id="624df-105">Сведения, такие как имя сборки, удаляется из внутренних таблиц.</span><span class="sxs-lookup"><span data-stu-id="624df-105">Information such as the assembly name is removed from internal tables.</span></span>

<span data-ttu-id="624df-106">Чтобы включить выгрузку, используйте <xref:System.Reflection.Emit.AssemblyBuilderAccess.RunAndCollect?displayProperty=nameWithType> флаг при создании динамической сборки.</span><span class="sxs-lookup"><span data-stu-id="624df-106">To enable unloading, use the <xref:System.Reflection.Emit.AssemblyBuilderAccess.RunAndCollect?displayProperty=nameWithType> flag when you create a dynamic assembly.</span></span> <span data-ttu-id="624df-107">Сборка является временной (то есть их нельзя сохранять), в зависимости от ограничений, описанные в [ограничения собираемых сборок](#restrictions-on-collectible-assemblies) раздела.</span><span class="sxs-lookup"><span data-stu-id="624df-107">The assembly is transient (that is, it cannot be saved) and is subject to limitations described in the [Restrictions on Collectible Assemblies](#restrictions-on-collectible-assemblies) section.</span></span> <span data-ttu-id="624df-108">Общеязыковая среда выполнения (CLR) выгружает собираемая сборка автоматически после отпускания все объекты, связанные со сборкой.</span><span class="sxs-lookup"><span data-stu-id="624df-108">The common language runtime (CLR) unloads a collectible assembly automatically when you release all objects associated with the assembly.</span></span> <span data-ttu-id="624df-109">Во всех прочих отношениях собираемые сборки создаются и используются в так же, как другие динамических сборок.</span><span class="sxs-lookup"><span data-stu-id="624df-109">In all other respects, collectible assemblies are created and used in the same way as other dynamic assemblies.</span></span>

## <a name="lifetime-of-collectible-assemblies"></a><span data-ttu-id="624df-110">Время существования собираемых сборок</span><span class="sxs-lookup"><span data-stu-id="624df-110">Lifetime of collectible assemblies</span></span>

<span data-ttu-id="624df-111">Время существования собираемой сборки контролируется на наличие ссылки на типы, содержащиеся в нем и объекты, созданные из этих типов.</span><span class="sxs-lookup"><span data-stu-id="624df-111">The lifetime of a collectible assembly is controlled by the existence of references to the types it contains and the objects that are created from those types.</span></span> <span data-ttu-id="624df-112">Общеязыковая среда выполнения не будет выгружен сборки до тех пор, пока существует один или несколько из следующих действий (`T` — любой тип, определенный в сборке):</span><span class="sxs-lookup"><span data-stu-id="624df-112">The common language runtime does not unload an assembly as long as one or more of the following exist (`T` is any type that is defined in the assembly):</span></span> 

- <span data-ttu-id="624df-113">Экземпляр `T`.</span><span class="sxs-lookup"><span data-stu-id="624df-113">An instance of `T`.</span></span>

- <span data-ttu-id="624df-114">Экземпляр массива `T`.</span><span class="sxs-lookup"><span data-stu-id="624df-114">An instance of an array of `T`.</span></span>
 
- <span data-ttu-id="624df-115">Экземпляр универсального типа, который имеет `T` как один из его аргументов типа.</span><span class="sxs-lookup"><span data-stu-id="624df-115">An instance of a generic type that has `T` as one of its type arguments.</span></span> <span data-ttu-id="624df-116">Сюда входят универсальные коллекции `T`, даже если коллекция пуста.</span><span class="sxs-lookup"><span data-stu-id="624df-116">This includes generic collections of `T`, even if that collection is empty.</span></span>

- <span data-ttu-id="624df-117">Экземпляр <xref:System.Type> или <xref:System.Reflection.Emit.TypeBuilder> , представляющий `T`.</span><span class="sxs-lookup"><span data-stu-id="624df-117">An instance of <xref:System.Type> or <xref:System.Reflection.Emit.TypeBuilder> that represents `T`.</span></span> 

   > [!IMPORTANT]
   > <span data-ttu-id="624df-118">Необходимо освободить все объекты, представляющие части сборки.</span><span class="sxs-lookup"><span data-stu-id="624df-118">You must release all objects that represent parts of the assembly.</span></span> <span data-ttu-id="624df-119"><xref:System.Reflection.Emit.ModuleBuilder> , Определяющий `T` хранит ссылки на <xref:System.Reflection.Emit.TypeBuilder>и <xref:System.Reflection.Emit.AssemblyBuilder> сохраняет ссылку на <xref:System.Reflection.Emit.ModuleBuilder>, поэтому должны быть удалены ссылки на эти объекты.</span><span class="sxs-lookup"><span data-stu-id="624df-119">The <xref:System.Reflection.Emit.ModuleBuilder> that defines `T` keeps a reference to the <xref:System.Reflection.Emit.TypeBuilder>, and the <xref:System.Reflection.Emit.AssemblyBuilder> object keeps a reference to the <xref:System.Reflection.Emit.ModuleBuilder>, so references to these objects must be released.</span></span> <span data-ttu-id="624df-120">Даже наличие <xref:System.Reflection.Emit.LocalBuilder> или <xref:System.Reflection.Emit.ILGenerator> используется при построении `T` выгрузку предотвращает.</span><span class="sxs-lookup"><span data-stu-id="624df-120">Even the existence of a <xref:System.Reflection.Emit.LocalBuilder> or an <xref:System.Reflection.Emit.ILGenerator> used in the construction of `T` prevents unloading.</span></span>

- <span data-ttu-id="624df-121">Статическая ссылка на `T` другим типом динамически определяемым `T1` , все же доступна при выполнении кода.</span><span class="sxs-lookup"><span data-stu-id="624df-121">A static reference to `T` by another dynamically defined type `T1` that is still reachable by executing code.</span></span> <span data-ttu-id="624df-122">Например `T1` может наследовать из `T`, или `T` может быть типом параметра в методе `T1`.</span><span class="sxs-lookup"><span data-stu-id="624df-122">For example, `T1` might derive from `T`, or `T` might be the type of a parameter in a method of `T1`.</span></span>
 
- <span data-ttu-id="624df-123">Объект **ByRef** для статического поля, к которому принадлежит `T`.</span><span class="sxs-lookup"><span data-stu-id="624df-123">A **ByRef** to a static field that belongs to `T`.</span></span>

- <span data-ttu-id="624df-124">Объект <xref:System.RuntimeTypeHandle>, <xref:System.RuntimeFieldHandle>, или <xref:System.RuntimeMethodHandle> , обозначающий `T` или с компонентом `T`.</span><span class="sxs-lookup"><span data-stu-id="624df-124">A <xref:System.RuntimeTypeHandle>, <xref:System.RuntimeFieldHandle>, or <xref:System.RuntimeMethodHandle> that refers to `T` or to a component of `T`.</span></span>

- <span data-ttu-id="624df-125">Экземпляр любого объекта отражения, который может быть использован косвенно или для доступа к <xref:System.Type> , представляющий `T`.</span><span class="sxs-lookup"><span data-stu-id="624df-125">An instance of any reflection object that could be used indirectly or directly to access the <xref:System.Type> object that represents `T`.</span></span> <span data-ttu-id="624df-126">Например <xref:System.Type> для объекта `T` можно получить из типа массива, тип элементов которого является `T`, или из универсального типа, который имеет `T` как аргумент типа.</span><span class="sxs-lookup"><span data-stu-id="624df-126">For example, the <xref:System.Type> object for `T` can be obtained from an array type whose element type is `T`, or from a generic type that has `T` as a type argument.</span></span> 

- <span data-ttu-id="624df-127">Метод `M` в стеке вызова любого потока, где `M` — это метод `T` или уровня модуля метода, который определен в сборке.</span><span class="sxs-lookup"><span data-stu-id="624df-127">A method `M` on the call stack of any thread, where `M` is a method of `T` or a module-level method that is defined in the assembly.</span></span>

- <span data-ttu-id="624df-128">Делегат для статического метода, который определен в модуле сборки.</span><span class="sxs-lookup"><span data-stu-id="624df-128">A delegate to a static method that is defined in a module of the assembly.</span></span>

<span data-ttu-id="624df-129">Если только один элемент из этого списка существует только один тип или один метод в сборке, среда выполнения не удается выгрузить сборку.</span><span class="sxs-lookup"><span data-stu-id="624df-129">If only one item from this list exists for only one type or one method in the assembly, the runtime cannot unload the assembly.</span></span>

> [!NOTE]
> <span data-ttu-id="624df-130">Среда выполнения не будет выгружен фактически сборка пока не выполнены методы завершения для всех элементов в списке.</span><span class="sxs-lookup"><span data-stu-id="624df-130">The runtime does not actually unload the assembly until finalizers have run for all items in the list.</span></span>

<span data-ttu-id="624df-131">В целях отслеживания времени существования сконструированный универсальный тип, например `List<int>` (в C#) или `List(Of Integer)` (в Visual Basic), создается и используется в генерации собираемой сборки считается были определенным либо в сборке, содержит универсальный определение типа или в сборке, содержащей определения одного из его аргументов типа.</span><span class="sxs-lookup"><span data-stu-id="624df-131">For purposes of tracking lifetime, a constructed generic type such as `List<int>` (in C#) or `List(Of Integer)` (in Visual Basic) that is created and used in the generation of a collectible assembly is considered to have been defined either in the assembly that contains the generic type definition or in an assembly that contains the definition of one of its type arguments.</span></span> <span data-ttu-id="624df-132">Точное сборку, которая используется — сведения о реализации и может быть изменена.</span><span class="sxs-lookup"><span data-stu-id="624df-132">The exact assembly that is used is an implementation detail and subject to change.</span></span>
 
## <a name="restrictions-on-collectible-assemblies"></a><span data-ttu-id="624df-133">Ограничения собираемых сборок</span><span class="sxs-lookup"><span data-stu-id="624df-133">Restrictions on collectible assemblies</span></span>

<span data-ttu-id="624df-134">К собираемым сборкам применяются следующие ограничения:</span><span class="sxs-lookup"><span data-stu-id="624df-134">The following restrictions apply to collectible assemblies:</span></span> 

- <span data-ttu-id="624df-135">**Ссылки на статические** </span><span class="sxs-lookup"><span data-stu-id="624df-135">**Static references** </span></span>  
  <span data-ttu-id="624df-136">Типы в обычные динамические сборки не могут иметь статические ссылки на типы, определенные в собираемой сборке.</span><span class="sxs-lookup"><span data-stu-id="624df-136">Types in an ordinary dynamic assembly cannot have static references to types that are defined in a collectible assembly.</span></span> <span data-ttu-id="624df-137">Например, если определяется обычный тип, наследующий от типа в собираемой сборке <xref:System.NotSupportedException> исключения.</span><span class="sxs-lookup"><span data-stu-id="624df-137">For example, if you define an ordinary type that inherits from a type in a collectible assembly, a <xref:System.NotSupportedException> exception is thrown.</span></span> <span data-ttu-id="624df-138">Тип в собираемой сборке может иметь статические ссылки на тип в другой собираемой сборке, но при этом расширяется время существования сборки от времени существования ссылочную сборку.</span><span class="sxs-lookup"><span data-stu-id="624df-138">A type in a collectible assembly can have static references to a type in another collectible assembly, but this extends the lifetime of the referenced assembly to the lifetime of the referencing assembly.</span></span>

- <span data-ttu-id="624df-139">**Взаимодействие COM** </span><span class="sxs-lookup"><span data-stu-id="624df-139">**COM interop** </span></span>  
   <span data-ttu-id="624df-140">Интерфейсы COM не могут быть заданы внутри собираемой сборки и экземпляры типов в собираемой сборке не могут быть преобразованы в COM-объекты.</span><span class="sxs-lookup"><span data-stu-id="624df-140">No COM interfaces can be defined within a collectible assembly, and no instances of types within a collectible assembly can be converted into COM objects.</span></span> <span data-ttu-id="624df-141">Тип в собираемой сборке не может служить в качестве вызываемой оболочки COM (CCW) или вызываемой оболочки времени выполнения (RCW).</span><span class="sxs-lookup"><span data-stu-id="624df-141">A type in a collectible assembly cannot serve as a COM callable wrapper (CCW) or runtime callable wrapper (RCW).</span></span> <span data-ttu-id="624df-142">Однако типы в сборках с возможностью сбора можно использовать объекты, реализующие интерфейсы COM.</span><span class="sxs-lookup"><span data-stu-id="624df-142">However, types in collectible assemblies can use objects that implement COM interfaces.</span></span>

- <span data-ttu-id="624df-143">**Неуправляемого кода** </span><span class="sxs-lookup"><span data-stu-id="624df-143">**Platform invoke** </span></span>  
   <span data-ttu-id="624df-144">Методы, которые имеют <xref:System.Runtime.InteropServices.DllImportAttribute> атрибута не будет компилироваться, если они были объявлены в собираемой сборке.</span><span class="sxs-lookup"><span data-stu-id="624df-144">Methods that have the <xref:System.Runtime.InteropServices.DllImportAttribute> attribute will not compile when they are declared in a collectible assembly.</span></span> <span data-ttu-id="624df-145"><xref:System.Reflection.Emit.OpCodes.Calli?displayProperty=nameWithType> Инструкция не может использоваться в реализации типа в собираемой сборке, и такие типы невозможно маршалировать в неуправляемый код.</span><span class="sxs-lookup"><span data-stu-id="624df-145">The <xref:System.Reflection.Emit.OpCodes.Calli?displayProperty=nameWithType> instruction cannot be used in the implementation of a type in a collectible assembly, and such types cannot be marshaled to unmanaged code.</span></span> <span data-ttu-id="624df-146">Тем не менее можно вызывать в машинном коде с помощью точки входа, объявленный в сборке, не подлежащая сбору.</span><span class="sxs-lookup"><span data-stu-id="624df-146">However, you can call into native code by using an entry point that is declared in a non-collectible assembly.</span></span>
 
- <span data-ttu-id="624df-147">**Маршалинг** </span><span class="sxs-lookup"><span data-stu-id="624df-147">**Marshaling** </span></span>  
   <span data-ttu-id="624df-148">Объекты (в частности, делегатов), определенные в собираемые сборки не могут быть упакованы.</span><span class="sxs-lookup"><span data-stu-id="624df-148">Objects (in particular, delegates) that are defined in collectible assemblies cannot be marshaled.</span></span> <span data-ttu-id="624df-149">Это ограничение для всех временных выдаваемых типов.</span><span class="sxs-lookup"><span data-stu-id="624df-149">This is a restriction on all transient emitted types.</span></span>

- <span data-ttu-id="624df-150">**Загрузка сборок** </span><span class="sxs-lookup"><span data-stu-id="624df-150">**Assembly loading** </span></span>  
   <span data-ttu-id="624df-151">Порождение отражения — только механизм, который поддерживается для загрузки собираемые сборки.</span><span class="sxs-lookup"><span data-stu-id="624df-151">Reflection emit is the only mechanism that is supported for loading collectible assemblies.</span></span> <span data-ttu-id="624df-152">Сборки, загруженные с помощью любой другой форме загрузка сборки не может быть выгружен.</span><span class="sxs-lookup"><span data-stu-id="624df-152">Assemblies that are loaded by using any other form of assembly loading cannot be unloaded.</span></span>
 
- <span data-ttu-id="624df-153">**Контекстно привязанные объекты**  </span><span class="sxs-lookup"><span data-stu-id="624df-153">**Context-bound objects**  </span></span>  
   <span data-ttu-id="624df-154">Переменные статического контекста не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="624df-154">Context-static variables are not supported.</span></span> <span data-ttu-id="624df-155">Типы в собираемой сборке не может расширять <xref:System.ContextBoundObject>.</span><span class="sxs-lookup"><span data-stu-id="624df-155">Types in a collectible assembly cannot extend <xref:System.ContextBoundObject>.</span></span> <span data-ttu-id="624df-156">Тем не менее код в собираемые сборки можно использовать контекстно привязанные объекты, определенные в другом месте.</span><span class="sxs-lookup"><span data-stu-id="624df-156">However, code in collectible assemblies can use context-bound objects that are defined elsewhere.</span></span>

- <span data-ttu-id="624df-157">**Статического потока данных**     </span><span class="sxs-lookup"><span data-stu-id="624df-157">**Thread-static data**     </span></span>  
   <span data-ttu-id="624df-158">Переменные статического потока, не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="624df-158">Thread-static variables are not supported.</span></span>

## <a name="see-also"></a><span data-ttu-id="624df-159">См. также</span><span class="sxs-lookup"><span data-stu-id="624df-159">See also</span></span>

[<span data-ttu-id="624df-160">Предоставление динамических методов и сборок</span><span class="sxs-lookup"><span data-stu-id="624df-160">Emitting Dynamic Methods and Assemblies</span></span>](emitting-dynamic-methods-and-assemblies.md)
