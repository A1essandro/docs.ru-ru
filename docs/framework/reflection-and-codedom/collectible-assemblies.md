---
title: "Собираемые сборки для создания динамического типа"
description: 
ms.date: 08/29/2017
ms.prod: .net
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- reflection, dynamic assembly
- assemblies, collectible
- collectible assemblies, retrieving
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: 2c9a613f4cc13c3e4189a59ace2e05d01d1bcb4f
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="collectible-assemblies-for-dynamic-type-generation"></a>Собираемые сборки для создания динамического типа

*Собираемые сборки* являются динамических сборок, которые могут быть выгружены без выгрузки домена приложения, в котором они были созданы. Невозможно освободить управляемые и неуправляемые память, используемая собираемой сборки и типы, содержащиеся в нем. Сведения, такие как имя сборки, удаляется из внутренних таблиц.

Чтобы включить выгрузку, используйте <xref:System.Reflection.Emit.AssemblyBuilderAccess.RunAndCollect?displayProperty=nameWithType> флаг при создании динамической сборки. Сборка является временной (то есть их нельзя сохранять), в зависимости от ограничений, описанные в [ограничения собираемых сборок](#restrictions-on-collectible-assemblies) раздела. Общеязыковая среда выполнения (CLR) выгружает собираемая сборка автоматически после отпускания все объекты, связанные со сборкой. Во всех прочих отношениях собираемые сборки создаются и используются в так же, как другие динамических сборок.

## <a name="lifetime-of-collectible-assemblies"></a>Время существования собираемых сборок

Время существования собираемой сборки контролируется на наличие ссылки на типы, содержащиеся в нем и объекты, созданные из этих типов. Общеязыковая среда выполнения не будет выгружен сборки до тех пор, пока существует один или несколько из следующих действий (`T` — любой тип, определенный в сборке): 

- Экземпляр `T`.

- Экземпляр массива `T`.
 
- Экземпляр универсального типа, который имеет `T` как один из его аргументов типа. Сюда входят универсальные коллекции `T`, даже если коллекция пуста.

- Экземпляр <xref:System.Type> или <xref:System.Reflection.Emit.TypeBuilder> , представляющий `T`. 

   > [!IMPORTANT]
   > Необходимо освободить все объекты, представляющие части сборки. <xref:System.Reflection.Emit.ModuleBuilder> , Определяющий `T` хранит ссылки на <xref:System.Reflection.Emit.TypeBuilder>и <xref:System.Reflection.Emit.AssemblyBuilder> сохраняет ссылку на <xref:System.Reflection.Emit.ModuleBuilder>, поэтому должны быть удалены ссылки на эти объекты. Даже наличие <xref:System.Reflection.Emit.LocalBuilder> или <xref:System.Reflection.Emit.ILGenerator> используется при построении `T` выгрузку предотвращает.

- Статическая ссылка на `T` другим типом динамически определяемым `T1` , все же доступна при выполнении кода. Например `T1` может наследовать из `T`, или `T` может быть типом параметра в методе `T1`.
 
- Объект **ByRef** для статического поля, к которому принадлежит `T`.

- Объект <xref:System.RuntimeTypeHandle>, <xref:System.RuntimeFieldHandle>, или <xref:System.RuntimeMethodHandle> , обозначающий `T` или с компонентом `T`.

- Экземпляр любого объекта отражения, который может быть использован косвенно или для доступа к <xref:System.Type> , представляющий `T`. Например <xref:System.Type> для объекта `T` можно получить из типа массива, тип элементов которого является `T`, или из универсального типа, который имеет `T` как аргумент типа. 

- Метод `M` в стеке вызова любого потока, где `M` — это метод `T` или уровня модуля метода, который определен в сборке.

- Делегат для статического метода, который определен в модуле сборки.

Если только один элемент из этого списка существует только один тип или один метод в сборке, среда выполнения не удается выгрузить сборку.

> [!NOTE]
> Среда выполнения не будет выгружен фактически сборка пока не выполнены методы завершения для всех элементов в списке.

В целях отслеживания времени существования сконструированный универсальный тип, например `List<int>` (в C#) или `List(Of Integer)` (в Visual Basic), создается и используется в генерации собираемой сборки считается были определенным либо в сборке, содержит универсальный определение типа или в сборке, содержащей определения одного из его аргументов типа. Точное сборку, которая используется — сведения о реализации и может быть изменена.
 
## <a name="restrictions-on-collectible-assemblies"></a>Ограничения собираемых сборок

К собираемым сборкам применяются следующие ограничения: 

- **Ссылки на статические**   
  Типы в обычные динамические сборки не могут иметь статические ссылки на типы, определенные в собираемой сборке. Например, если определяется обычный тип, наследующий от типа в собираемой сборке <xref:System.NotSupportedException> исключения. Тип в собираемой сборке может иметь статические ссылки на тип в другой собираемой сборке, но при этом расширяется время существования сборки от времени существования ссылочную сборку.

- **Взаимодействие COM**   
   Интерфейсы COM не могут быть заданы внутри собираемой сборки и экземпляры типов в собираемой сборке не могут быть преобразованы в COM-объекты. Тип в собираемой сборке не может служить в качестве вызываемой оболочки COM (CCW) или вызываемой оболочки времени выполнения (RCW). Однако типы в сборках с возможностью сбора можно использовать объекты, реализующие интерфейсы COM.

- **Неуправляемого кода**   
   Методы, которые имеют <xref:System.Runtime.InteropServices.DllImportAttribute> атрибута не будет компилироваться, если они были объявлены в собираемой сборке. <xref:System.Reflection.Emit.OpCodes.Calli?displayProperty=nameWithType> Инструкция не может использоваться в реализации типа в собираемой сборке, и такие типы невозможно маршалировать в неуправляемый код. Тем не менее можно вызывать в машинном коде с помощью точки входа, объявленный в сборке, не подлежащая сбору.
 
- **Маршалинг**   
   Объекты (в частности, делегатов), определенные в собираемые сборки не могут быть упакованы. Это ограничение для всех временных выдаваемых типов.

- **Загрузка сборок**   
   Порождение отражения — только механизм, который поддерживается для загрузки собираемые сборки. Сборки, загруженные с помощью любой другой форме загрузка сборки не может быть выгружен.
 
- **Контекстно привязанные объекты**    
   Переменные статического контекста не поддерживаются. Типы в собираемой сборке не может расширять <xref:System.ContextBoundObject>. Тем не менее код в собираемые сборки можно использовать контекстно привязанные объекты, определенные в другом месте.

- **Статического потока данных**       
   Переменные статического потока, не поддерживаются.

## <a name="see-also"></a>См. также

[Предоставление динамических методов и сборок](emitting-dynamic-methods-and-assemblies.md)
