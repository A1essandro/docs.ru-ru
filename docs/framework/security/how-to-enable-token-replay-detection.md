---
title: "Практическое руководство. Включение обнаружения повторного использования токенов | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: 5a9f5771-f5f6-4100-8501-406aa20d731a
caps.latest.revision: 4
author: "BrucePerlerMS"
ms.author: "bruceper"
manager: "mbaldwin"
caps.handback.revision: 4
---
# Практическое руководство. Включение обнаружения повторного использования токенов
## Применение  
  
-   Основой идентификатора Microsoft® Windows® \(WIF\)  
  
-   Веб\-формы ASP.NET®  
  
## Сводка  
 Это предоставляет подробные пошаговые процедуры для разрешить обнаружение воспроизведения токена в приложении ASP.NET, которое использует WIF.  Он также предоставляет инструкции для тестирования приложения проверить, что обнаружение воспроизведения разрешено токена.  Это называется не содержит подробные инструкции по созданию службы маркеров безопасности \(sts\), а вместо этого использует службу маркеров безопасности разработки, которая поставляется с помощью идентификатора и доступа.  Служба маркеров безопасности реальную разработки не выполняет проверку подлинности и предназначена только для целей тестирования.  Необходимо будет установить инструмент доступа идентификатора и для выполнения Как.  Его можно загрузить со следующего расположения. [средство идентификатора и доступа](http://go.microsoft.com/fwlink/?LinkID=245849)  
  
## Содержимое  
  
-   Назначения  
  
-   Общие сведения  
  
-   Сводка шагов  
  
-   Шаг 1. создание простого приложения веб\-форм ASP.NET и включить обнаружение воспроизведения  
  
-   Шаг 2 \- теста решение  
  
## Назначения  
  
-   Создать простое приложение ASP.NET, которое использует службу маркеров безопасности WIF и разработки от идентификатора и доступ к средству  
  
-   Включить обнаружение воспроизведения токена и убедитесь, что он работает  
  
## Общие сведения  
 Атака воспроизведения заключается в том, что клиент пытается проверить подлинность с токеном проверяющей стороне службы маркеров безопасности, который клиент уже используется.  Чтобы предотвратить такую атаку, содержащий кэш WIF обнаружения воспроизведения ранее, используемых маркеров службы маркеров безопасности.  При активации, обнаружение воспроизведения проверяет токен входящего запроса и проверяет, использовался ли токен ранее.  Если токен был использован уже, запрос отклоняется и создается исключение <xref:System.IdentityModel.Tokens.SecurityTokenReplayDetectedException>.  
  
 Следующие шаги демонстрируют изменения конфигурации, необходимые для включенных обнаружение воспроизведения.  
  
## Сводка шагов  
  
-   Шаг 1. создание простого приложения веб\-форм ASP.NET и включить обнаружение воспроизведения  
  
-   Шаг 2 \- теста решение  
  
## Шаг 1. создание простого приложения веб\-форм ASP.NET и включить обнаружение воспроизведения  
 На этом шаге создается новое приложение веб\-формы ASP.NET и измените *файл web.config*, чтобы включить обнаружение воспроизведения.  
  
#### Создать простое приложение ASP.NET  
  
1.  Запустите Visual Studio и щелкните **Файл**, **Создать**, а затем **Проект**.  
  
2.  В окне **Создать проект**, нажмите кнопку **приложение веб\-формы ASP.NET**.  
  
3.  В **Имя** введите `TestApp` и нажмите клавишу **ОК**.  
  
4.  Щелкните правой кнопкой мыши проект **TestApp** в **Обозреватель решений**, а затем выберите **идентификатор и доступ**.  
  
5.  Окно **идентификатор и доступ**.  В **Поставщики** выберите **Проверьте приложение с локальной службой маркеров безопасности разработки**, затем нажмите кнопку **Применить**.  
  
6.  Добавьте следующий элемент **\<tokenReplayDetection\>** в *файл конфигурации Web.config* сразу после элементов **\<system.identityModel\>** и **\<identityConfiguration\>**, как отображается:  
  
    ```  
    <system.identityModel>  
        <identityConfiguration>  
            <tokenReplayDetection enabled=”true”/>  
    ```  
  
## Шаг 2 \- теста решение  
 На этом этапе проверки ваше приложение ASP.NET проверять, что WIF\- разрешено обнаружение воспроизведения включен.  
  
#### Тестирования WIF\- разрешенный приложение ASP.NET для обнаружения воспроизведения  
  
1.  Запустите решение, нажав клавиши ключ **F5**.  Необходимо по умолчанию домашней страницей ASP.NET и быть автоматически выполняется с именем пользователя *terri*, которое пользователь по умолчанию, возвращаемый службой маркеров безопасности разработки.  
  
2.  Нажмите кнопку **Назад** браузера.  Необходимо со страницей **Ошибка сервера "\/" в приложение** со следующим описанием: *ID1062: воспроизведение было обнаружено для: токен: "System.IdentityModel.Tokens.SamlSecurityToken"*, за которым следует *AssertionId* и *Issuer*.  
  
     Эта страница выводится ошибка, поскольку было выдано исключение типа <xref:System.IdentityModel.Tokens.SecurityTokenReplayDetectedException>, когда воспроизведение было обнаружитьо токена.  Эта ошибка возникает, поскольку попытке отправить re\- начальный запрос POST, если маркер был первоначально приведен.  Кнопка не приведет к **Назад** эти расширения функциональности в последующих запросах к серверу.