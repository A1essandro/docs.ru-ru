---
title: "Устранение рисков. Выделение пространства для столбцов со звездочкой в элементе управления &quot;Сетка&quot; | Документация Майкрософт"
ms.custom: 
ms.date: 04/07/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- retargeting changes
- .NET Framework 4.7 retargeting changes
- WPF retargeting changes
- Grid control retargeting changes
ms.assetid: 707c064d-85e9-4ea1-aefb-e42b60b88679
caps.latest.revision: 4
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.translationtype: Human Translation
ms.sourcegitcommit: 9460c8b6ca8db927af4064e3567eca34c1bf5c91
ms.openlocfilehash: c7acce9d41af7e72b04b89751a7b186c9581dfea
ms.contentlocale: ru-ru
ms.lasthandoff: 04/18/2017

---
# <a name="mitigation-grid-control39s-space-allocation-to-star-columns"></a>Устранение рисков. Выделение пространства для столбцов со звездочкой в элементе управления "Сетка"

Начиная с приложений для .NET Framework 4.7, WPF заменяет алгоритм, который использовался в элементе управления <xref:System.Windows.Controls.Grid> для выделения пространства для \*-столбцов. 

## <a name="whats-changed"></a>Изменения по сравнению с предыдущей версией

Новый алгоритм устраняет некоторые ошибки, присутствующие в старом алгоритме:

1. Общее выделенное пространство для столбцов может превышать ширину сетки. Это может произойти при выделении пространства для столбца, пропорциональная доля которого меньше его минимального размера. Алгоритм выделяет минимальный размер, что уменьшает пространство, доступное для других столбцов. Если не осталось \*-столбцов для выделения, общее выделенное пространство будет слишком большим.

1. Общее выделенное пространство может быть меньше ширины сетки. Это смежная с первой проблема возникает при выделении пространства для столбца, пропорциональная доля которого больше его максимального размера, когда не остается \*-столбцов для заполнения зарезервированного пространства.

1. Два \*-столбца могут получить выделенное пространство, непропорциональное их весу. Это более мягкая версия первой или второй проблемы возникает при выделении пространства для *-столбцов A, B и C (в таком порядке), когда пропорциональная доля столбца B нарушает его минимальное (или максимальное) ограничение. Как показано выше, при этом изменяется место, доступное для столбца C, который получает меньше (или больше) пропорционально выделенного пространства, чем получил столбец A.

1. Все столбцы с очень большим весом (свыше 10^298) обрабатываются так, как если бы у них был вес 10^298. Пропорциональные различия между ними (и между столбцами с немного меньшим весом) не учитываются.

1. Столбцы с бесконечным весом не обрабатываются правильно. [Фактически невозможно определить вес как бесконечный, но это искусственное ограничение. Его обработка кодом выделения была безуспешной.]

1. Несколько мелких проблем при предотвращении переполнения, нехватки данных, потери точности и аналогичных проблем с плавающей запятой.

1. Корректировки округления макета неверны при достаточно высоком DPI.

Новый алгоритм выдает результаты, соответствующие следующим критериям:

О. Фактическая ширина, назначенная *-столбцу, никогда не меньше его минимальной ширины и не больше максимальной ширины.

Б. Каждому -столбцу, которому не назначена минимальная или максимальная ширина, назначается ширина пропорционально его -весу. Точнее, если два столбца объявлены с шириной x и y соответственно, и ни один из них не получил минимальную или максимальную ширину, у фактических значений ширины v и w, присвоенные столбцам, будет та же пропорция: v / w == x / y.

В. Общая ширина, выделяемая "пропорциональным" \*-столбцам, равна свободному пространству, доступному после выделения для ограниченных столбцов (фиксированных, автоматических и \*-столбцов, которым выделена минимальная или максимальная ширина). Это значение может быть равно нулю, например, если сумма минимальных значений ширины превышает доступную ширину сетки.

Г. Все эти инструкции должны интерпретироваться по отношению к гипотетическому идеальному макету. Если действует округление макета, фактические значения ширины могут отличаться от идеальных максимум на один пиксель.

Старый алгоритм учитывал (А), но не учитывал другие критерии в случаях, описанных выше.

Все сказанное о столбцах и ширине в этом разделе применяется также к строкам и высоте.

## <a name="impact"></a>Последствия

Новый алгоритм изменяет фактическую ширину, назначенную \*-столбцам в ряде случаев:

- Если один или несколько \*-столбцов также имеют минимальную или максимальную ширину, переопределяющую пропорциональное выделение для этого столбца. (Минимальная ширина может быть производной от явного объявления <xref:System.Windows.FrameworkElement.MinWidth%2A> или неявного минимума, полученного из содержимого столбца. Максимальная ширина может быть только задана явно, в объявлении <xref:System.Windows.FrameworkElement.MaxWidth%2A>.)

- Когда один или несколько \*-столбцов объявляют слишком большой \*-вес — более 10^298.

- Когда \*-веса достаточно отличаются, приводя к нестабильности операций с плавающей запятой (переполнение, нехватка данных, потеря точности).

- Когда включено округление макета, а действующее значение DPI дисплея достаточно высокое.

В первых двух случаях значения ширины, создаваемые новым алгоритмом, могут значительно отличаться от созданных старым алгоритмом; в последнем случае разница будет равна максимум одному или двум пикселям.

## <a name="mitigation"></a>Уменьшение

По умолчанию приложения, предназначенные для версий .NET Framework 4.7 и выше, будут использовать новый алгоритм, а приложения, предназначенные для .NET Framework 4.6.2 и более ранних версий, — старый алгоритм.

Чтобы переопределить настройку по умолчанию, используйте следующий параметр конфигурации:

```xml
<runtime>
    <AppContextSwitchOverrides value="Switch.System.Windows.Controls.Grid.StarDefinitionsCanExceedAvailableSpace=true" /> 
</runtime>
```

Значение true позволяет выбрать старый алгоритм, а false — новый.

## <a name="see-also"></a>См. также
[Изменения целевой платформы в .NET Framework 4.7](../../../docs/framework/migration-guide/retargeting-changes-in-the-net-framework-4-7.md)

