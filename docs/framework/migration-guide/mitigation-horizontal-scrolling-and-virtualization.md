---
title: "Устранение рисков. Горизонтальная прокрутка и виртуализация"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology:
- dotnet-bcl
- dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: d5bafd9b-a3b3-4f92-8241-2aad254fb1a9
caps.latest.revision: 6
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.translationtype: HT
ms.sourcegitcommit: 306c608dc7f97594ef6f72ae0f5aaba596c936e1
ms.openlocfilehash: 40eaf185e9c0c60493e9a2e5428c58b7463789fe
ms.contentlocale: ru-ru
ms.lasthandoff: 07/28/2017

---
# <a name="mitigation-horizontal-scrolling-and-virtualization"></a><span data-ttu-id="ba4ca-102">Устранение рисков. Горизонтальная прокрутка и виртуализация</span><span class="sxs-lookup"><span data-stu-id="ba4ca-102">Mitigation: Horizontal Scrolling and Virtualization</span></span>
<span data-ttu-id="ba4ca-103">Это изменение относится к элементу управления <xref:System.Windows.Controls.ItemsControl>, который выполняет собственную виртуализацию в направлении, перпендикулярном основному направлению прокрутки.</span><span class="sxs-lookup"><span data-stu-id="ba4ca-103">This change applies to an <xref:System.Windows.Controls.ItemsControl> that does its own virtualization in the direction orthogonal to the main scrolling direction.</span></span> <span data-ttu-id="ba4ca-104">(Важнейшим примером является элемент управления <xref:System.Windows.Controls.DataGrid>, у которого <xref:System.Windows.Controls.DataGrid.EnableColumnVirtualization%2A> имеет значение `true`.)  Результат некоторых операций горизонтальной прокрутки был изменен для получения результатов, которые являются более интуитивно понятными и более подобными результатам сопоставимых вертикальных операций.</span><span class="sxs-lookup"><span data-stu-id="ba4ca-104">(The chief  example is a <xref:System.Windows.Controls.DataGrid> control with <xref:System.Windows.Controls.DataGrid.EnableColumnVirtualization%2A> set to `true`.)  The outcome of certain  horizontal scrolling operations has been changed to produce results that are more intuitive and more analogous to the results of comparable vertical operations.</span></span>  <span data-ttu-id="ba4ca-105">К конкретным операциям относятся **Прокрутка на месте** и **К правому краю**, с использованием имен из меню, открываемого щелчком правой кнопкой мыши по горизонтальной полосе прокрутки.</span><span class="sxs-lookup"><span data-stu-id="ba4ca-105">The specific operations include **Scroll Here** and **Right Edge**, to use the names from the menu obtained by right-clicking a horizontal scrollbar.</span></span>  <span data-ttu-id="ba4ca-106">Обе они вычисляют предполагаемое смещение и вызывают <xref:System.Windows.Controls.Primitives.IScrollInfo.SetHorizontalOffset%2A?displayProperty=fullName>.</span><span class="sxs-lookup"><span data-stu-id="ba4ca-106">Both of these compute a  candidate offset and call <xref:System.Windows.Controls.Primitives.IScrollInfo.SetHorizontalOffset%2A?displayProperty=fullName>.</span></span>  <span data-ttu-id="ba4ca-107">После прокрутки к новой позиции может измениться значение "на месте" или "правый край" может измениться, поскольку новое девиртуализированное содержимое изменяет значение свойства <xref:System.Windows.Controls.Primitives.IScrollInfo.ExtentWidth%2A?displayProperty=fullName>.</span><span class="sxs-lookup"><span data-stu-id="ba4ca-107">After scrolling to the new offset, the definition of "here" or "right edge" may have changed because newly de-virtualized content has changed the value of <xref:System.Windows.Controls.Primitives.IScrollInfo.ExtentWidth%2A?displayProperty=fullName>.</span></span>  
  
## <a name="description-of-the-change"></a><span data-ttu-id="ba4ca-108">Описание изменения</span><span class="sxs-lookup"><span data-stu-id="ba4ca-108">Description of the change</span></span>  
 <span data-ttu-id="ba4ca-109">В версиях до [!INCLUDE[net_v462](../../../includes/net-v462-md.md)] операция прокрутки просто использует смещение кандидатов, несмотря на то, что оно может оказаться больше не "на месте" или на "правом краю".</span><span class="sxs-lookup"><span data-stu-id="ba4ca-109">Prior to the [!INCLUDE[net_v462](../../../includes/net-v462-md.md)], the scroll operation simply uses the candidate offset, even though it may not be "here" or at the "right edge" any more.</span></span>  <span data-ttu-id="ba4ca-110">Его результаты проявляются в виде "подпрыгивания" бегунка прокрутки. Лучше всего это проиллюстрировать на примере.</span><span class="sxs-lookup"><span data-stu-id="ba4ca-110">This results in effects like "bouncing" the scroll thumb, best illustrated by example.</span></span>  <span data-ttu-id="ba4ca-111">Предположим, что элемент управления <xref:System.Windows.Controls.DataGrid> имеет параметр <xref:System.Windows.Controls.Primitives.IScrollInfo.ExtentWidth%2A> со значением 1000 и параметр <xref:System.Windows.FrameworkElement.Width%2A> со значением 200.</span><span class="sxs-lookup"><span data-stu-id="ba4ca-111">Suppose a <xref:System.Windows.Controls.DataGrid> control has <xref:System.Windows.Controls.Primitives.IScrollInfo.ExtentWidth%2A> set to 1000 and <xref:System.Windows.FrameworkElement.Width%2A> set to 200.</span></span>  <span data-ttu-id="ba4ca-112">При прокрутке "К правому краю" используется смещение кандидата 1000 – 200 = 800.</span><span class="sxs-lookup"><span data-stu-id="ba4ca-112">A scroll to "Right Edge" uses candidate offset  1000 - 200 = 800.</span></span>  <span data-ttu-id="ba4ca-113">В процессе прокрутки к этому смещению девиртуализируются новые столбцы. Предположим, что они очень широкие, и теперь свойство <xref:System.Windows.Controls.Primitives.IScrollInfo.ExtentWidth%2A> получает значение 2000.</span><span class="sxs-lookup"><span data-stu-id="ba4ca-113">While scrolling to that offset, new columns are de-virtualized; let's suppose they are very wide, so that the <xref:System.Windows.Controls.Primitives.IScrollInfo.ExtentWidth%2A> changes to 2000.</span></span>  <span data-ttu-id="ba4ca-114">Прокрутка заканчивается при <xref:System.Windows.Controls.Primitives.IScrollInfo.HorizontalOffset%2A>= 800, и бегунок "отпрыгивает" обратно почти в середину полосы прокрутки, а точнее на позицию 40% (800/2000).</span><span class="sxs-lookup"><span data-stu-id="ba4ca-114">The scroll ends with <xref:System.Windows.Controls.Primitives.IScrollInfo.HorizontalOffset%2A>=800, and the thumb "bounces" back to near the middle of the scrollbar -- precisely at 800/2000 = 40%.</span></span>  
  
 <span data-ttu-id="ba4ca-115">Начиная с [!INCLUDE[net_v462](../../../includes/net-v462-md.md)], в такой ситуации пересчитывается новое смещение кандидата.</span><span class="sxs-lookup"><span data-stu-id="ba4ca-115">Starting with the [!INCLUDE[net_v462](../../../includes/net-v462-md.md)], a new candidate offset is recomputed when this situation occurs.</span></span> <span data-ttu-id="ba4ca-116">(Так уже работает вертикальная прокрутка.)</span><span class="sxs-lookup"><span data-stu-id="ba4ca-116">(This is how vertical scrolling works already.)</span></span>  
  
## <a name="impact"></a><span data-ttu-id="ba4ca-117">Последствия</span><span class="sxs-lookup"><span data-stu-id="ba4ca-117">Impact</span></span>  
 <span data-ttu-id="ba4ca-118">Это поведение стало более прогнозируемым и интуитивно понятным для конечного пользователя, но изменение может повлиять на те приложения, которые ожидают конкретных значений свойства <xref:System.Windows.Controls.Primitives.IScrollInfo.HorizontalOffset%2A?displayProperty=fullName> после горизонтальной прокрутки, вызванной действиями пользователя или прямым вызовом <xref:System.Windows.Controls.Primitives.IScrollInfo.SetHorizontalOffset%2A?displayProperty=fullName>.</span><span class="sxs-lookup"><span data-stu-id="ba4ca-118">The change produces a more predictable and intuitive experience for the end user, but it could also affect any app that depends on the exact value of <xref:System.Windows.Controls.Primitives.IScrollInfo.HorizontalOffset%2A?displayProperty=fullName> after a horizontal scroll, whether invoked by the end user or by an explicit call to <xref:System.Windows.Controls.Primitives.IScrollInfo.SetHorizontalOffset%2A?displayProperty=fullName>.</span></span>  
  
## <a name="mitigation"></a><span data-ttu-id="ba4ca-119">Уменьшение</span><span class="sxs-lookup"><span data-stu-id="ba4ca-119">Mitigation</span></span>  
 <span data-ttu-id="ba4ca-120">Нужно изменить приложения, использующие прогнозируемое значение для <xref:System.Windows.Controls.Primitives.IScrollInfo.HorizontalOffset%2A?displayProperty=fullName>, чтобы они получали фактическое значение (а также значение <xref:System.Windows.Controls.Primitives.IScrollInfo.ExtentWidth%2A>) после любой горизонтальной прокрутки, при которой <xref:System.Windows.Controls.Primitives.IScrollInfo.ExtentWidth%2A> может измениться из-за девиртуализации.</span><span class="sxs-lookup"><span data-stu-id="ba4ca-120">An app that uses a predicted value for <xref:System.Windows.Controls.Primitives.IScrollInfo.HorizontalOffset%2A?displayProperty=fullName> should be changed to retrieve the actual value (and the value of <xref:System.Windows.Controls.Primitives.IScrollInfo.ExtentWidth%2A>) after any horizontal scroll that could change <xref:System.Windows.Controls.Primitives.IScrollInfo.ExtentWidth%2A> due to de-virtualization.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ba4ca-121">См. также</span><span class="sxs-lookup"><span data-stu-id="ba4ca-121">See Also</span></span>  
 [<span data-ttu-id="ba4ca-122">Изменения среды выполнения</span><span class="sxs-lookup"><span data-stu-id="ba4ca-122">Runtime Changes</span></span>](../../../docs/framework/migration-guide/runtime-changes-in-the-net-framework-4-6-2.md)

