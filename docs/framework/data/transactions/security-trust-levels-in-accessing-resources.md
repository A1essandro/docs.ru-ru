---
title: "Уровни доверия системы безопасности, используемые при доступе к ресурсам  | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: fb5be924-317d-4d69-b33a-3d18ecfb9d6e
caps.latest.revision: 3
author: "Erikre"
ms.author: "erikre"
manager: "erikre"
caps.handback.revision: 3
---
# Уровни доверия системы безопасности, используемые при доступе к ресурсам 
В этом разделе описывается порядок ограничения доступа к ресурсам различных типов, используемым инфраструктурой <xref:System.Transactions>.  
  
 Предусмотрено три основных уровня доверия для инфраструктуры <xref:System.Transactions>.Уровни доверия определяются на основе типов ресурсов, используемых инфраструктурой <xref:System.Transactions>, и уровня доверия, который требуется для доступа к этим ресурсам.Ресурсами, к которым инфраструктура <xref:System.Transactions> предоставляет доступ, являются системная память, ресурсы, общие для всего процесса, и ресурсы, общие для всей системы.Ниже представлены предусмотренные уровни доверия.  
  
-   **AllowPartiallyTrustedCallers** \(APTCA\) — для приложений, использующих транзакции в одном домене приложения.  
  
-   **DistributedTransactionPermission** \(DTP\) — для приложений, использующих распределенные транзакции.  
  
-   FullTrust — для устойчивых ресурсов, приложений управления конфигурацией и приложений взаимодействия с традиционными системами.  
  
> [!NOTE]
>  Не следует вызывать какие\-либо интерфейсы зачисления с олицетворяемыми контекстами.  
  
## Уровни доверия  
  
### APTCA \(частичное доверие\)  
 Сборка <xref:System.Transactions> может вызываться кодом с частичным доверием, поскольку она отмечена атрибутом **AllowPartiallyTrustedCallers** \(APTCA\).Этот атрибут по существу исключает неявный запрос <xref:System.Security.Permissions.SecurityAction> для набора разрешений **FullTrust**, который в противном случае автоматически используется в каждом общедоступном методе каждого типа.Однако для некоторых типов и элементов по\-прежнему требуются разрешения более высокого уровня.  
  
 Атрибут APTCA позволяет приложениям использовать транзакции с частичным доверием в одном домене приложения.Это обеспечивает использование неповышаемых транзакций и зачислений неустойчивых ресурсов, которые можно применять для обработки ошибок.В качестве примера рассмотрим транзакционную хэш\-таблицу и используемое ей приложение.Данные можно добавлять и удалять из хэш\-таблицы в рамках одной транзакции.В случае последующего отката транзакции все произведенные в рамках транзакции изменения хэш\-таблицы могут быть отменены.  
  
### Разрешение DistributedTransactionPermission \(DTP\)  
 При передаче управления транзакцией <xref:System.Transactions> координатору MSDTC инфраструктура <xref:System.Transactions> запрашивает разрешение <xref:System.Transactions.DistributedTransactionPermission> \(DTP\) для создания распределенной транзакции.Это означает, что коду, вызывающему передачу транзакции на следующий уровень иерархии \(например, посредством сериализации или зачисления дополнительных устойчивых ресурсов\), требуется предоставление разрешения DTP.Коду, который изначально создал транзакцию <xref:System.Transactions>, не обязательно располагать данным разрешением.  
  
### FullTrust \(полное доверие\)  
 Этот уровень разрешений предназначен для ограничения приложений, записывающих данные в устойчивые ресурсы.В случае сбоя приложение должно быть способно восстановить связь с диспетчером транзакций для определения окончательного результата транзакции, чтобы обновить постоянные данные.Приложение такого типа называется диспетчером устойчивых ресурсов.Классическим примером такого приложения является SQL.  
  
 Для выполнения восстановления у этого приложения имеется способность постоянно потреблять системные ресурсы.Это необходимо, поскольку диспетчер ресурсов, выполняющий восстановление, должен вспомнить все зафиксированные транзакции, прежде чем он сможет подтвердить, что все участвующие в транзакции диспетчеры устойчивых ресурсов получили результат транзакции.Поэтому приложению данного типа требуется разрешение FullTrust, и его не следует запускать, если такой уровень доверия не предоставлен.  
  
 Дополнительные сведения о зачислении устойчивых ресурсов и восстановлении см. в разделах [Прикрепление ресурсов в качестве участников транзакции ](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md) и [Выполнение восстановления ](../../../../docs/framework/data/transactions/performing-recovery.md).  
  
 Приложениям, которые выполняют традиционные операции взаимодействия с COM\+, также требуется разрешение FullTrust.  
  
 Ниже представлен список типов и элементов, которые не вызываются кодом с частичным доверием, поскольку они отмечены декларативным атрибутом безопасности **FullTrust**.  
  
 `PermissionSetAttribute(SecurityAction.LinkDemand, Name := "FullTrust")`  
  
-   <xref:System.Transactions.Transaction.EnlistDurable%2A?displayProperty=fullName>  
  
-   <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A>  
  
-   <xref:System.Transactions.TransactionInterop>  
  
-   <xref:System.Transactions.TransactionManager.DistributedTransactionStarted>  
  
-   <xref:System.Transactions.HostCurrentTransactionCallback>  
  
-   <xref:System.Transactions.TransactionManager.Reenlist%2A>  
  
-   <xref:System.Transactions.TransactionManager.RecoveryComplete%2A>  
  
-   <xref:System.Transactions.TransactionScope.%23ctor%28System.Transactions.TransactionScopeOption%2CSystem.Transactions.TransactionOptions%2CSystem.Transactions.EnterpriseServicesInteropOption%29>  
  
 Разрешением **FullTrust**, позволяющим использовать перечисленные выше типы и методы, необходимо располагать только непосредственному вызывающему.