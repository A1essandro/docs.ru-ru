---
title: "Технология LINQ to SQL в многоуровневых приложениях с веб-службами | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework-4.6"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-ado"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: 9cb10eb8-957f-4beb-a271-5f682016fed2
caps.latest.revision: 3
author: "JennieHubbard"
ms.author: "jhubbard"
manager: "jhubbard"
caps.handback.revision: 3
---
# Технология LINQ to SQL в многоуровневых приложениях с веб-службами
Технология [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] специально предназначена для использования на среднем уровне слабо связанного компонента DAL, такого как веб\-службы.  Если уровнем представления данных является веб\-страница ASP.NET, то для управления передачей данных между пользовательским интерфейсом и [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] на среднем уровне используется серверный веб\-элемент управления <xref:System.Web.UI.WebControls.LinqDataSource>.  Если уровень представления данных не является страницей ASP.NET, то и на среднем уровне, и на уровне представления данных необходимо выполнить дополнительные действия по управлению сериализацией и десериализацией данных.  
  
## Настройка технологии LINQ to SQL на среднем уровне  
 Средний уровень веб\-службы или многоуровневого приложения содержит контекст данных и классы сущностей.  Эти классы можно создать вручную либо с помощью программы SQLMetal.exe или конструктора [!INCLUDE[vs_ordesigner_long](../../../../../../includes/vs-ordesigner-long-md.md)], как описано в документации.  Во время разработки можно сделать класс сущностей сериализуемым.  Для получения дополнительной информации см. [Как обеспечить сериализацию сущностей](../../../../../../docs/framework/data/adonet/sql/linq/how-to-make-entities-serializable.md).  Другой способ заключается в создании отдельного набора классов, инкапсулирующих данные, которые необходимо сериализовать, и последующем проецировании данных в эти сериализуемые типы при их возвращении в запросах [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)].  
  
 Затем следует определить интерфейс с методами, которые клиенты будут вызывать для извлечения, вставки и обновления данных.  Методы интерфейса заключают запросы [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] в оболочку.  Для обработки удаленных вызовов методов и сериализации данных можно использовать любой вид механизма сериализации.  Единственное требование заключается в том, что если в объектной модели существуют циклические или двунаправленные отношения, например между классами "Customers" и "Orders" в стандартной объектной модели "Northwind", то необходимо использовать сериализатор, который поддерживает такие отношения.  Класс <xref:System.Runtime.Serialization.DataContractSerializer> в WCF поддерживает двунаправленные связи в отличие от сериализатора XmlSerializer, который используется для веб\-служб, несовместимых с WCF. Если используется сериализатор XmlSerializer, то необходимо убедиться в том, что в объектной модели отсутствуют циклические связи.  
  
 Дополнительные сведения о технологии Windows Communication Foundation см. в разделе [Windows Communication Foundation Services and WCF Data Services in Visual Studio](../Topic/Windows%20Communication%20Foundation%20Services%20and%20WCF%20Data%20Services%20in%20Visual%20Studio.md).  
  
 Реализуйте бизнес\-правила и другую логику, относящуюся к домену, используя разделяемые классы и методы в классе <xref:System.Data.Linq.DataContext> и классах сущностей для обработки событий [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] времени выполнения.  Для получения дополнительной информации см. [Реализация многоуровневой бизнес\-логики](../../../../../../docs/framework/data/adonet/sql/linq/implementing-business-logic-linq-to-sql.md).  
  
## Определение сериализуемых типов  
 Клиент или уровень представления данных должен иметь определения типов для классов, которые он будет получать от среднего уровня.  Данные типы могут сами быть классами сущностей или представлять собой особые классы, которые включают только определенные поля из классов сущностей для удаленного взаимодействия.  В любом случае технология [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] совершенно не зависит от способа получения уровнем представления данных определений этих типов.  Например, уровень представления данных может использовать технологию WCF для автоматического создания типов, содержать копию библиотеки DLL, в которой определены эти типы или определить собственные версии типов.  
  
## Извлечение и вставка данных  
 Средний уровень определяет интерфейс, указывающий, как уровень представления данных получает доступ к данным.  Например, `GetProductByID(int productID)` или `GetCustomers()`.  На среднем уровне тело метода обычно создает новый экземпляр класса <xref:System.Data.Linq.DataContext> и выполняет запрос к одной или нескольким своим таблицам.  Затем средний уровень возвращает результат в виде интерфейса <xref:System.Collections.Generic.IEnumerable%601>, где `T` является классом сущностей или другим типом, используемым для сериализации.  Уровень представления данных никогда не отправляет переменные запроса непосредственно на средний уровень и не получает этих переменных из среднего уровня.  Оба уровня обмениваются значениями, объектами и коллекциями конкретных данных.  После получения коллекции уровень представления данных при необходимости может использовать технологию [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] to Objects для выполнения запроса к этой коллекции.  
  
 При вставке данных уровень представления может создать новый объект и отправить его на средний уровень или указать среднему уровню создать объект на основе предоставленных им значений.  В общем случае извлечение и вставка данных в многоуровневых приложениях не сильно отличается от аналогичного процесса в двухуровневых приложениях.  Дополнительные сведения см. в разделах [Выполнение запросов к базе данных](../../../../../../docs/framework/data/adonet/sql/linq/querying-the-database.md) и [Внесение и отправка изменений данных ](../../../../../../docs/framework/data/adonet/sql/linq/making-and-submitting-data-changes.md).  
  
## Отслеживание изменений для обновления и удаления  
 Технология [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] поддерживает оптимистический параллелизм, основанный на отметках времени \(также называемых RowVersions\) или на исходных значениях.  Если таблицам базы данных присвоены отметки времени, то для операций обновления и удаления требуются некоторые дополнительные действия либо на среднем уровне, либо на уровне представления данных.  Однако если для проверок на оптимистический параллелизм необходимо использовать исходные значения, то ответственность за отслеживание этих значений и отправку их обратно при выполнении обновлений лежит на уровне представления данных.  Причиной этого является тот факт, что изменения сущностей, выполненные на уровне представления данных, не отслеживаются на среднем уровне.  В действительности, исходное извлечение сущности и окончательное его обновление обычно выполняется двумя совершенно различными экземплярами класса <xref:System.Data.Linq.DataContext>.  
  
 Чем больше количество изменений, выполненных на уровне представления данных, тем сложнее становится отслеживать эти изменения и отправлять их в пакетах обратно на средний уровень.  Реализация механизма передачи изменений полностью зависит от приложения.  Единственное требование заключается в том, что технологии [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] должны быть предоставлены исходные значений, которые необходимы для выполнения проверок на оптимистический параллелизм.  
  
 Для получения дополнительной информации см. [Получение данных и операции CUD в многоуровневых приложениях \(LINQ to SQL\)](../../../../../../docs/framework/data/adonet/sql/linq/data-retrieval-and-cud-operations-in-n-tier-applications.md).  
  
## См. также  
 [Многоуровневые и удаленные приложения с LINQ to SQL](../../../../../../docs/framework/data/adonet/sql/linq/n-tier-and-remote-applications-with-linq-to-sql.md)   
 [NIB: LinqDataSource Web Server Control Overview](http://msdn.microsoft.com/ru-ru/104cfc3f-7385-47d3-8a51-830dfa791136)