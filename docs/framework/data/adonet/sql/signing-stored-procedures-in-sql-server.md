---
title: "Подписывание хранимых процедур в SQL Server"
ms.custom: 
ms.date: 01/05/2018
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology:
- dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: eeed752c-0084-48e5-9dca-381353007a0d
caps.latest.revision: 
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload:
- dotnet
ms.openlocfilehash: 15771cc214ee17bc2c98bab2423013483d1355f1
ms.sourcegitcommit: f28752eab00d2bd97e971542c0f49ce63cfbc239
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2018
---
# <a name="signing-stored-procedures-in-sql-server"></a>Подписывание хранимых процедур в SQL Server
 Цифровая сигнатура представляет собой хэш-код данных, зашифрованную при помощи закрытого ключа лица, ставящего свою сигнатуру. Закрытый ключ обеспечивает уникальность цифровой сигнатуры его владельцу. Можно подписывать хранимые процедуры, функции (за исключением встроенных функций возвращающих табличные значения), триггеры и сборки.  
  
 Хранимую процедуру можно подписать сертификатом или асимметричным ключом. Эта возможность предназначена для сценариев, в которых разрешения не могут наследоваться по цепочке владения или если цепочка владения разорвана, например в динамическом SQL. Затем можно создать пользователя, сопоставленного с сертификатом, предоставление сертификата пользователя разрешений на объекты, которые требуется доступ к хранимой процедуре.  

 Можно также создать имя входа, сопоставленное один и тот же сертификат и затем предоставить этому имени входа, все необходимые разрешения на уровне сервера или добавьте имя входа для одного или нескольких предопределенных ролей сервера. Это делается во избежание включения поддержки `TRUSTWORTHY` параметр для сценариев, в которых требуется разрешений более высокого уровня базы данных.  
  
 При выполнении хранимой процедуры SQL Server объединяет разрешения пользователя сертификата и/или имя входа с разрешениями вызывающего объекта. В отличие от `EXECUTE AS` предложения, не изменяет контекст выполнения процедуры. Встроенные функции, которые возвращают имя входа и имена пользователей, возвращают имя вызывающей стороны, а не имя пользователя сертификата.  
  
## <a name="creating-certificates"></a>Создание сертификатов  
 При подписании хранимой процедуры с помощью сертификата или асимметричного ключа Сводка данных, состоящая из зашифрованного хэш-кода хранимой процедуры, а также execute-имени пользователя, создается с помощью закрытого ключа. Во время выполнения сводка данных расшифровывается открытым ключом и сравнивается с хэш-кодом хранимой процедуры. Изменение execute-как пользователь делает недействительным хэш-значения, чтобы больше не соответствует цифровой подписи. Измените хранимую процедуру удаляет подпись полностью, что не позволяет тем, кто не имеет доступа к закрытому ключу изменение кода хранимой процедуры. В любом случае следует подписывать процедуру каждый раз при изменении кода или execute-имени пользователя.  
  
 Подписи модуля участвуют два действия:  
  
1.  Создание сертификата с использованием инструкции Transact-SQL `CREATE CERTIFICATE [certificateName]`. Эта инструкция имеет несколько параметров для настройки даты начала и даты окончания, а также пароля. Дата окончания срока действия по умолчанию — один год.  
  
1.  Подписание процедуры при помощи сертификата с использованием инструкции Transact-SQL `ADD SIGNATURE TO [procedureName] BY CERTIFICATE [certificateName]`.  

После подписан модуль, одного или нескольких участников должна быть создана для хранения дополнительных разрешений, которые должны быть связаны с сертификатом.  

Если модуль нужны дополнительные разрешения уровня базы данных:  
  
1.  Создание пользователя базы данных, связанного с этим сертификатом, с использованием инструкции Transact-SQL `CREATE USER [userName] FROM CERTIFICATE [certificateName]`. Этот пользователь существует только в базе данных и не связан с именем входа, если имя входа также должна быть создана из того же сертификата.  
  
1.  Предоставление пользователю сертификата необходимых разрешений уровня базы данных.  
  
Если модуль должен дополнительные разрешения на уровне сервера:  
  
1.  Скопируйте сертификат `master` базы данных.  
 
1.  Создайте имя входа, связанный с этим сертификатом, с помощью Transact-SQL `CREATE LOGIN [userName] FROM CERTIFICATE [certificateName]` инструкции.  
  
1.  Предоставьте требуемые разрешения уровня сервера имя входа сертификата.  
  
> [!NOTE]  
>  Сертификат не может предоставлять разрешения пользователю, у которого разрешения были отменены инструкцией DENY. DENY имеет преимущество над GRANT, предотвращая тем самым наследование вызывающей стороной разрешений, предоставленных пользователю сертификата.  
  
## <a name="external-resources"></a>Внешние ресурсы  
 Дополнительные сведения см. в следующих ресурсах.  
  
|Ресурс|Описание:|  
|--------------|-----------------|  
|[Подписание модулей](http://go.microsoft.com/fwlink/?LinkId=98590) в электронной документации по SQL Server|Описывает подписывание модулей, демонстрирует образец сценария и содержит ссылки на соответствующие разделы по языку Transact-SQL.|  
|[Подписывание хранимых процедур с помощью сертификата](http://msdn.microsoft.com/library/bb283630.aspx) в электронной документации по SQL Server|Предоставляет учебник для подписания хранимой процедуры с помощью сертификата.|  
  
## <a name="see-also"></a>См. также  
 [Защита приложений ADO.NET](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)  
 [Общие сведения о безопасности SQL Server](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)  
 [Сценарии безопасности приложений в SQL Server](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)  
 [Управление разрешениями с использованием хранимых процедур в SQL Server](../../../../../docs/framework/data/adonet/sql/managing-permissions-with-stored-procedures-in-sql-server.md)  
 [Написание безопасного динамического кода SQL в SQL Server](../../../../../docs/framework/data/adonet/sql/writing-secure-dynamic-sql-in-sql-server.md)  
 [Настройка разрешений с олицетворением в SQL Server](../../../../../docs/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server.md)  
 [Изменение данных с помощью хранимых процедур](../../../../../docs/framework/data/adonet/modifying-data-with-stored-procedures.md)  
 [Центр разработчиков наборов данных и управляемых поставщиков ADO.NET](http://go.microsoft.com/fwlink/?LinkId=217917)
