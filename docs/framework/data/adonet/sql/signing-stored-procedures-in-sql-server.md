---
title: "Подписывание хранимых процедур в SQL Server"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: eeed752c-0084-48e5-9dca-381353007a0d
caps.latest.revision: "6"
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload: dotnet
ms.openlocfilehash: a3f1ed66ed7caf2272ca27097dc9a838bec7d0ae
ms.sourcegitcommit: ed26cfef4e18f6d93ab822d8c29f902cff3519d1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/17/2018
---
# <a name="signing-stored-procedures-in-sql-server"></a>Подписывание хранимых процедур в SQL Server
Хранимую процедуру можно подписать сертификатом или асимметричным ключом. Эта возможность предназначена для сценариев, в которых разрешения не могут наследоваться по цепочке владения или если цепочка владения разорвана, например в динамическом SQL. Можно создать пользователя, сопоставленного с сертификатом, предоставляя разрешения пользователя сертификата на объекты, доступ к которым нужен хранимым процедурам.  
  
 При выполнении хранимой процедуры SQL Server объединяет разрешения пользователя сертификата с разрешениями вызывающей стороны. В отличие от предложения EXECUTE AS, он не меняет контекст выполнения процедуры. Встроенные функции, которые возвращают имя входа и имена пользователей, возвращают имя вызывающей стороны, а не имя пользователя сертификата.  
  
 Цифровая сигнатура представляет собой сводку данных, зашифрованную при помощи закрытого ключа лица, ставящего свою сигнатуру. Закрытый ключ обеспечивает уникальность цифровой сигнатуры его владельцу. Можно подписывать хранимые процедуры, функции или триггеры.  
  
> [!NOTE]
>  Можно создать сертификат в базе данных master, чтобы предоставить разрешения уровня сервера.  
  
## <a name="creating-certificates"></a>Создание сертификатов  
 При подписании хранимой процедуры сертификатом создается с использованием закрытого ключа сводка данных, состоящая из зашифрованного хэш-кода хранимой процедуры. Во время выполнения сводка данных расшифровывается открытым ключом и сравнивается с хэш-значением хранимой процедуры. Изменение хранимой процедуры приводит к недействительности хэш-значения, так что цифровая сигнатура больше не совпадает со сводкой данных. Это предотвращает изменение кода хранимой процедуры лицом, не имеющим доступа к закрытому ключу. Поэтому следует подписывать процедуру при каждом ее изменении.  
  
 Подписание модуля выполняется в четыре шага.  
  
1.  Создание сертификата с использованием инструкции Transact-SQL `CREATE CERTIFICATE [certificateName]`. Эта инструкция имеет несколько параметров для настройки даты начала и даты окончания, а также пароля. По умолчанию срок действия сертификата истекает через год.  
  
2.  Создание пользователя базы данных, связанного с этим сертификатом, с использованием инструкции Transact-SQL `CREATE USER [userName] FROM CERTIFICATE [certificateName]`. Этот пользователь существует только в базе данных и не связан с именем входа.  
  
3.  Предоставление пользователю сертификата необходимых разрешений на объекты базы данных.  
  
> [!NOTE]
>  Сертификат не может предоставлять разрешения пользователю, у которого разрешения были отменены инструкцией DENY. DENY имеет преимущество над GRANT, предотвращая тем самым наследование вызывающей стороной разрешений, предоставленных пользователю сертификата.  
  
1.  Подписание процедуры при помощи сертификата с использованием инструкции Transact-SQL `ADD SIGNATURE TO [procedureName] BY CERTIFICATE [certificateName]`.  
  
## <a name="external-resources"></a>Внешние ресурсы  
 Дополнительные сведения см. в следующих ресурсах.  
  
|Ресурс|Описание:|  
|--------------|-----------------|  
|[Подписание модулей](http://go.microsoft.com/fwlink/?LinkId=98590) в электронной документации по SQL Server|Описывает подписывание модулей, демонстрирует образец сценария и содержит ссылки на соответствующие разделы по языку Transact-SQL.|  
|[Подписывание хранимых процедур с помощью сертификата](http://msdn.microsoft.com/library/bb283630.aspx) в электронной документации по SQL Server|Предоставляет учебник для подписания хранимой процедуры с помощью сертификата.|  
  
## <a name="see-also"></a>См. также  
 [Защита приложений ADO.NET](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)  
 [Общие сведения о безопасности SQL Server](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)  
 [Сценарии безопасности приложений в SQL Server](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)  
 [Управление разрешениями с использованием хранимых процедур в SQL Server](../../../../../docs/framework/data/adonet/sql/managing-permissions-with-stored-procedures-in-sql-server.md)  
 [Написание безопасного динамического кода SQL в SQL Server](../../../../../docs/framework/data/adonet/sql/writing-secure-dynamic-sql-in-sql-server.md)  
 [Настройка разрешений с олицетворением в SQL Server](../../../../../docs/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server.md)  
 [Изменение данных с помощью хранимых процедур](../../../../../docs/framework/data/adonet/modifying-data-with-stored-procedures.md)  
 [Центр разработчиков наборов данных и управляемых поставщиков ADO.NET](http://go.microsoft.com/fwlink/?LinkId=217917)
