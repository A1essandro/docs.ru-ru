---
title: "Поддержка SqlClient для высокого уровня доступности, аварийного восстановления"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 61e0b396-09d7-4e13-9711-7dcbcbd103a0
caps.latest.revision: "13"
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.workload: dotnet
ms.openlocfilehash: 612f667020522d94b53c3f7e715b9a2ad1177836
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2017
---
# <a name="sqlclient-support-for-high-availability-disaster-recovery"></a><span data-ttu-id="c14db-102">Поддержка SqlClient для высокого уровня доступности, аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="c14db-102">SqlClient Support for High Availability, Disaster Recovery</span></span>
<span data-ttu-id="c14db-103">В данном разделе рассматривается поддержка групп доступности AlwaysOn (высокая доступность, аварийное восстановление) в SqlClient, которая появилась в [!INCLUDE[net_v45](../../../../../includes/net-v45-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c14db-103">This topic discusses SqlClient support (added in [!INCLUDE[net_v45](../../../../../includes/net-v45-md.md)]) for high-availability, disaster recovery -- AlwaysOn Availability Groups.</span></span>  <span data-ttu-id="c14db-104">Группы доступности AlwaysOn появились в [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012.</span><span class="sxs-lookup"><span data-stu-id="c14db-104">AlwaysOn Availability Groups feature was added to [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012.</span></span> <span data-ttu-id="c14db-105">Дополнительные сведения о группах обеспечения доступности AlwaysOn см. в электронной документации по [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c14db-105">For more information about AlwaysOn Availability Groups, see [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] Books Online.</span></span>  
  
 <span data-ttu-id="c14db-106">Теперь в свойстве соединения можно указать прослушиватель группы доступности, обладающей свойствами высокой доступности и аварийного восстановления, или экземпляр отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012.</span><span class="sxs-lookup"><span data-stu-id="c14db-106">You can now specify the availability group listener of a (high-availability, disaster-recovery) availability group (AG) or [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 Failover Cluster Instance in the connection property.</span></span> <span data-ttu-id="c14db-107">Если во время переноса базы данных AlwaysOn к ней подключено приложение SqlClient, то изначальное подключение будет разорвано, а приложение должно создать новое подключение для продолжения работы после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="c14db-107">If a SqlClient application is connected to an AlwaysOn database that fails over, the original connection is broken and the application must open a new connection to continue work after the failover.</span></span>  
  
 <span data-ttu-id="c14db-108">Если не осуществляется соединение с прослушивателем группы доступности или к экземпляру отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 и при этом с именем узла ассоциированы несколько IP-адресов, SqlClient повторит операцию поочередно для всех IP-адресов, ассоциированных с записью DNS.</span><span class="sxs-lookup"><span data-stu-id="c14db-108">If you are not connecting to an availability group listener or [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 Failover Cluster Instance, and if multiple IP addresses are associated with a hostname, SqlClient will iterate sequentially through all IP addresses associated with DNS entry.</span></span> <span data-ttu-id="c14db-109">Это может занять продолжительное время в случае, если первый IP-адрес, возвращенный сервером DNS, не привязан ни к одному из адаптеров сетевого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="c14db-109">This can be time consuming if the first IP address returned by DNS server is not bound to any network interface card (NIC).</span></span> <span data-ttu-id="c14db-110">При соединении с прослушивателем группы доступности или с экземпляром отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 SqlClient пытается подключиться параллельно ко всем IP-адресам до первого успешного подключения.</span><span class="sxs-lookup"><span data-stu-id="c14db-110">When connecting to an availability group listener or [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 Failover Cluster Instance, SqlClient attempts to establish connections to all IP addresses in parallel and if a connection attempt succeeds, the driver will discard any pending connection attempts.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c14db-111">Увеличение максимального времени ожидания соединения и реализация логики повторных попыток соединения повышает вероятность успешного подключения приложения к группе доступности.</span><span class="sxs-lookup"><span data-stu-id="c14db-111">Increasing connection timeout and implementing connection retry logic will increase the probability that an application will connect to an availability group.</span></span> <span data-ttu-id="c14db-112">Кроме того, поскольку существует вероятность разрыва соединения вследствие отработки отказа, рекомендуется реализация логики повторных попыток подключения, при которой будут выполняться повторные попытки подключения до успешного восстановления связи.</span><span class="sxs-lookup"><span data-stu-id="c14db-112">Also, because a connection can fail because of a failover, you should implement connection retry logic, retrying a failed connection until it reconnects.</span></span>  
  
 <span data-ttu-id="c14db-113">В [!INCLUDE[net_v45](../../../../../includes/net-v45-md.md)] были добавлены следующие свойства соединения в SqlClient:</span><span class="sxs-lookup"><span data-stu-id="c14db-113">The following connection properties were added to SqlClient in [!INCLUDE[net_v45](../../../../../includes/net-v45-md.md)]:</span></span>  
  
-   `ApplicationIntent`  
  
-   `MultiSubnetFailover`  
  
 <span data-ttu-id="c14db-114">Можно программно изменять эти ключевые слова строки подключения с помощью следующего:</span><span class="sxs-lookup"><span data-stu-id="c14db-114">You can programmatically modify these connection string keywords with:</span></span>  
  
1.  <xref:System.Data.SqlClient.SqlConnectionStringBuilder.ApplicationIntent%2A>  
  
2.  <xref:System.Data.SqlClient.SqlConnectionStringBuilder.MultiSubnetFailover%2A>  
  
## <a name="connecting-with-multisubnetfailover"></a><span data-ttu-id="c14db-115">Соединение с MultiSubnetFailover</span><span class="sxs-lookup"><span data-stu-id="c14db-115">Connecting With MultiSubnetFailover</span></span>  
 <span data-ttu-id="c14db-116">При соединении с прослушивателем группы доступности `MultiSubnetFailover=True` 2012 или с экземпляром отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 всегда указывайте [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c14db-116">Always specify `MultiSubnetFailover=True` when connecting to a [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 availability group listener or [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 Failover Cluster Instance.</span></span> <span data-ttu-id="c14db-117">`MultiSubnetFailover` уменьшает время отработки отказа для всех групп доступности или экземпляров отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 и значительно уменьшит время отработки отказа для топологий AlwaysOn с одной или несколькими подсетями.</span><span class="sxs-lookup"><span data-stu-id="c14db-117">`MultiSubnetFailover` enables faster failover for all Availability Groups and or Failover Cluster Instance in [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 and will significantly reduce failover time for single and multi-subnet AlwaysOn topologies.</span></span> <span data-ttu-id="c14db-118">Во время отработки отказа в топологии с несколькими подсетями клиент будет пытаться установить соединения параллельно.</span><span class="sxs-lookup"><span data-stu-id="c14db-118">During a multi-subnet failover, the client will attempt connections in parallel.</span></span> <span data-ttu-id="c14db-119">Во время отработки отказа в топологии с одной подсетью клиент будет агрессивно пытаться восстановить соединение TCP.</span><span class="sxs-lookup"><span data-stu-id="c14db-119">During a subnet failover, will aggressively retry the TCP connection.</span></span>  
  
 <span data-ttu-id="c14db-120">Свойство соединения `MultiSubnetFailover` указывает, что приложение развертывается в группе доступности или в экземпляре отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 и что SqlClient будет пытаться установить соединение с базой данных на основном экземпляре [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)], перебирая по очереди все IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="c14db-120">The `MultiSubnetFailover` connection property indicates that the application is being deployed in an availability group or [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 Failover Cluster Instance and that SqlClient will try to connect to the database on the primary [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] instance by trying to connect to all the IP addresses.</span></span> <span data-ttu-id="c14db-121">Если для соединения указано `MultiSubnetFailover=True`, частота повторных попыток клиента восстановить соединение TCP превышает частоту интервалов повторной передачи TCP по умолчанию в операционной системе.</span><span class="sxs-lookup"><span data-stu-id="c14db-121">When `MultiSubnetFailover=True` is specified for a connection, the client retries TCP connection attempts faster than the operating system’s default TCP retransmit intervals.</span></span> <span data-ttu-id="c14db-122">Это обеспечивает более скорое восстановление подключения после переноса группы доступности AlwaysOn или экземпляра отказоустойчивого кластера AlwaysOn и применяется как к топологиям с одной подсетью, так и к топологиям с несколькими подсетями.</span><span class="sxs-lookup"><span data-stu-id="c14db-122">This enables faster reconnection after failover of either an AlwaysOn Availability Group or an AlwaysOn Failover Cluster Instance, and is applicable to both single- and multi-subnet Availability Groups and Failover Cluster Instances.</span></span>  
  
 <span data-ttu-id="c14db-123">Дополнительные сведения о ключевых словах строки подключения SqlClient см. в разделе <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span><span class="sxs-lookup"><span data-stu-id="c14db-123">For more information about connection string keywords in SqlClient, see <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
 <span data-ttu-id="c14db-124">Указание `MultiSubnetFailover=True` при соединении с любой другой службой, кроме прослушивателя группы доступности и экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012, может иметь негативные последствия в плане производительности, поэтому не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="c14db-124">Specifying `MultiSubnetFailover=True` when connecting to something other than a availability group listener or [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 Failover Cluster Instance may result in a negative performance impact, and is not supported.</span></span>  
  
 <span data-ttu-id="c14db-125">Пользуйтесь следующими рекомендациями для подключения к серверу в группе доступности или к экземпляру отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012.</span><span class="sxs-lookup"><span data-stu-id="c14db-125">Use the following guidelines to connect to a server in an availability group or [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] 2012 Failover Cluster Instance:</span></span>  
  
-   <span data-ttu-id="c14db-126">Использование свойства соединения `MultiSubnetFailover` повысит производительность как в топологии с одной подсетью, так и в топологии с несколькими подсетями.</span><span class="sxs-lookup"><span data-stu-id="c14db-126">Use the `MultiSubnetFailover` connection property when connecting to a single subnet or multi-subnet; it will improve performance for both.</span></span>  
  
-   <span data-ttu-id="c14db-127">Для подключения к группе доступности укажите в строке подключения в качестве сервера прослушиватель группы доступности.</span><span class="sxs-lookup"><span data-stu-id="c14db-127">To connect to an availability group, specify the availability group listener of the availability group as the server in your connection string.</span></span>  
  
-   <span data-ttu-id="c14db-128">Попытка соединения с экземпляром [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)], в котором настроено более 64 IP-адресов, приведет к сбою подключения.</span><span class="sxs-lookup"><span data-stu-id="c14db-128">Connecting to a [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] instance configured with more than 64 IP addresses will cause a connection failure.</span></span>  
  
-   <span data-ttu-id="c14db-129">Используемый тип проверки подлинности (`MultiSubnetFailover`, Kerberos или Windows) не влияет на работу приложения, использующего свойство соединения [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c14db-129">Behavior of an application that uses the `MultiSubnetFailover` connection property is not affected based on the type of authentication: [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] Authentication, Kerberos Authentication, or Windows Authentication.</span></span>  
  
-   <span data-ttu-id="c14db-130">Для согласования времени отработки отказа и уменьшения количества попыток восстановления подключения со стороны приложения следует увеличить значение `Connect Timeout`.</span><span class="sxs-lookup"><span data-stu-id="c14db-130">Increase the value of `Connect Timeout` to accommodate for failover time and reduce application connection retry attempts.</span></span>  
  
-   <span data-ttu-id="c14db-131">Распределенные транзакции не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="c14db-131">Distributed transactions are not supported.</span></span>  
  
 <span data-ttu-id="c14db-132">Если не применяется маршрутизация только для чтения, подключение к адресу вторичной реплики вернет ошибку в следующих ситуациях.</span><span class="sxs-lookup"><span data-stu-id="c14db-132">If read-only routing is not in effect, connecting to a secondary replica location will fail in the following situations:</span></span>  
  
1.  <span data-ttu-id="c14db-133">Если адрес вторичной реплики не принимает входящие соединения.</span><span class="sxs-lookup"><span data-stu-id="c14db-133">If the secondary replica location is not configured to accept connections.</span></span>  
  
2.  <span data-ttu-id="c14db-134">Если приложение использует `ApplicationIntent=ReadWrite` (описано ниже) и адрес вторичной реплики настроен только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c14db-134">If an application uses `ApplicationIntent=ReadWrite` (discussed below) and the secondary replica location is configured for read-only access.</span></span>  
  
 <span data-ttu-id="c14db-135"><xref:System.Data.SqlClient.SqlDependency> не поддерживается на вторичных репликах только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c14db-135"><xref:System.Data.SqlClient.SqlDependency> is not supported on read-only secondary replicas.</span></span>  
  
 <span data-ttu-id="c14db-136">Попытка подключения вернет ошибку, если первичная реплика настроена для отклонения рабочих нагрузок и предназначена только для чтения, а строка подключения содержит `ApplicationIntent=ReadOnly`.</span><span class="sxs-lookup"><span data-stu-id="c14db-136">A connection will fail if a primary replica is configured to reject read-only workloads and the connection string contains `ApplicationIntent=ReadOnly`.</span></span>  
  
## <a name="upgrading-to-use-multi-subnet-clusters-from-database-mirroring"></a><span data-ttu-id="c14db-137">Переход от зеркального отображения базы данных к использованию кластеров с множеством подсетей</span><span class="sxs-lookup"><span data-stu-id="c14db-137">Upgrading to Use Multi-Subnet Clusters from Database Mirroring</span></span>  
 <span data-ttu-id="c14db-138">Если в строке подключения присутствуют ключевые слова <xref:System.ArgumentException> и `MultiSubnetFailover` или если используется `Failover Partner` с любым другим протоколом, кроме TCP, то попытка подключения вернет ошибку (`MultiSubnetFailover=True`).</span><span class="sxs-lookup"><span data-stu-id="c14db-138">A connection error (<xref:System.ArgumentException>) will occur if the `MultiSubnetFailover` and `Failover Partner` connection keywords are present in the connection string, or if `MultiSubnetFailover=True` and a protocol other than TCP is used.</span></span> <span data-ttu-id="c14db-139">Ошибка (<xref:System.Data.SqlClient.SqlException>) также возникает в том случае, если используется `MultiSubnetFailover` и [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] возвращает ответ партнера по обеспечению отработки отказа, указывающий на его участие в паре зеркального отображения базы данных.</span><span class="sxs-lookup"><span data-stu-id="c14db-139">An error (<xref:System.Data.SqlClient.SqlException>) will also occur if `MultiSubnetFailover` is used and the [!INCLUDE[ssNoVersion](../../../../../includes/ssnoversion-md.md)] returns a failover partner response indicating it is part of a database mirroring pair.</span></span>  
  
 <span data-ttu-id="c14db-140">При обновлении приложения SqlClient, использующего зеркальное отображение базы данных, до сценария с множеством подсетей необходимо удалить свойство подключения `Failover Partner`, заменив его на `MultiSubnetFailover` со значением `True`, а в строке подключения заменить имя сервера на прослушиватель группы доступности.</span><span class="sxs-lookup"><span data-stu-id="c14db-140">If you upgrade a SqlClient application that currently uses database mirroring to a multi-subnet scenario, you should remove the `Failover Partner` connection property and replace it with `MultiSubnetFailover` set to `True` and replace the server name in the connection string with an availability group listener.</span></span> <span data-ttu-id="c14db-141">Если в строке подключения указано `Failover Partner` и `MultiSubnetFailover=True`, то драйвер вернет ошибку.</span><span class="sxs-lookup"><span data-stu-id="c14db-141">If a connection string uses `Failover Partner` and `MultiSubnetFailover=True`, the driver will generate an error.</span></span> <span data-ttu-id="c14db-142">Но если в строке подключения указано `Failover Partner` и `MultiSubnetFailover=False` (или `ApplicationIntent=ReadWrite`), то приложение будет использовать зеркальное отображение базы данных.</span><span class="sxs-lookup"><span data-stu-id="c14db-142">However, if a connection string uses `Failover Partner` and `MultiSubnetFailover=False` (or `ApplicationIntent=ReadWrite`), the application will use database mirroring.</span></span>  
  
 <span data-ttu-id="c14db-143">Драйвер вернет ошибку, если на базе данных-источнике в группе доступности используется зеркальное отображение базы данных и если указано `MultiSubnetFailover=True` в строке подключения, которая подключается к базе данных-источнику вместо прослушивателя группы доступности.</span><span class="sxs-lookup"><span data-stu-id="c14db-143">The driver will return an error if database mirroring is used on the primary database in the AG, and if `MultiSubnetFailover=True` is used in the connection string that connects to a primary database instead of to an availability group listener.</span></span>  
  
## <a name="specifying-application-intent"></a><span data-ttu-id="c14db-144">Указание цели приложения</span><span class="sxs-lookup"><span data-stu-id="c14db-144">Specifying Application Intent</span></span>  
 <span data-ttu-id="c14db-145">Если задано `ApplicationIntent=ReadOnly`, то клиент запрашивает рабочую нагрузку на чтение при попытке соединения с базой данных в режиме AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="c14db-145">When `ApplicationIntent=ReadOnly`, the client requests a read workload when connecting to an AlwaysOn enabled database.</span></span> <span data-ttu-id="c14db-146">Сервер принудительно включает цель в момент соединения и в момент выполнения инструкции базы данных USE, но только для баз данных в режиме AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="c14db-146">The server will enforce the intent at connection time and during a USE database statement but only to an Always On enabled database.</span></span>  
  
 <span data-ttu-id="c14db-147">Ключевое слово `ApplicationIntent` не работает с базами данных прежних версий, доступными только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c14db-147">The `ApplicationIntent` keyword does not work with legacy, read-only databases.</span></span>  
  
 <span data-ttu-id="c14db-148">База данных может разрешить или запретить рабочие нагрузки для чтения на целевой базе данных в режиме AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="c14db-148">A database can allow or disallow read workloads on the targeted AlwaysOn database.</span></span> <span data-ttu-id="c14db-149">(Это выполняется с помощью предложения `ALLOW_CONNECTIONS` инструкций `PRIMARY_ROLE` и `SECONDARY_ROLE`[!INCLUDE[tsql](../../../../../includes/tsql-md.md)].)</span><span class="sxs-lookup"><span data-stu-id="c14db-149">(This is done with the `ALLOW_CONNECTIONS` clause of the `PRIMARY_ROLE` and `SECONDARY_ROLE`[!INCLUDE[tsql](../../../../../includes/tsql-md.md)] statements.)</span></span>  
  
 <span data-ttu-id="c14db-150">Ключевое слово `ApplicationIntent` служит для включения маршрутизации только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c14db-150">The `ApplicationIntent` keyword is used to enable read-only routing.</span></span>  
  
## <a name="read-only-routing"></a><span data-ttu-id="c14db-151">Маршрутизация только для чтения</span><span class="sxs-lookup"><span data-stu-id="c14db-151">Read-Only Routing</span></span>  
 <span data-ttu-id="c14db-152">Маршрутизация только для чтения способна обеспечить доступность нередактируемой реплики базы данных.</span><span class="sxs-lookup"><span data-stu-id="c14db-152">Read-only routing is a feature that can ensure the availability of a read only replica of a database.</span></span> <span data-ttu-id="c14db-153">Для включения маршрутизации только для чтения:</span><span class="sxs-lookup"><span data-stu-id="c14db-153">To enable read-only routing:</span></span>  
  
1.  <span data-ttu-id="c14db-154">Необходимо подключиться к прослушивателю группы доступности в режиме AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="c14db-154">You must connect to an Always On Availability Group availability group listener.</span></span>  
  
2.  <span data-ttu-id="c14db-155">Необходимо присвоить значение `ApplicationIntent` ключевому слову `ReadOnly` строки подключения.</span><span class="sxs-lookup"><span data-stu-id="c14db-155">The `ApplicationIntent` connection string keyword must be set to `ReadOnly`.</span></span>  
  
3.  <span data-ttu-id="c14db-156">Администратор базы данных должен настроить включение маршрутизации только для чтения в группе доступности.</span><span class="sxs-lookup"><span data-stu-id="c14db-156">The Availability Group must be configured by the database administrator to enable read-only routing.</span></span>  
  
 <span data-ttu-id="c14db-157">Возможно, что не все соединения, использующие маршрутизацию только для чтения, смогут подключиться к одной и той же реплике, доступной только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c14db-157">It is possible that multiple connections using read-only routing will not all connect to the same read-only replica.</span></span> <span data-ttu-id="c14db-158">Изменения в синхронизации базы данных или изменения в настройках маршрутизации на сервере могут привести к соединению клиентов с разными репликами, доступными только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c14db-158">Changes in database synchronization or changes in the server's routing configuration can result in client connections to different read-only replicas.</span></span> <span data-ttu-id="c14db-159">Чтобы убедиться, что все запросы, доступные только для чтения, подключаются к одной и той же нередактируемой реплике, не указывайте прослушиватель группы доступности в ключевом слове `Data Source` строки подключения.</span><span class="sxs-lookup"><span data-stu-id="c14db-159">To ensure that all read-only requests connect to the same read-only replica, do not pass an availability group listener to the `Data Source` connection string keyword.</span></span> <span data-ttu-id="c14db-160">Вместо этого укажите имя экземпляра, доступного только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c14db-160">Instead, specify the name of the read-only instance.</span></span>  
  
 <span data-ttu-id="c14db-161">Подключение в сценарии с маршрутизацией только для чтения может занять больше времени, чем подключение к первичной реплике, так как в сценарии с маршрутизацией только для чтения в первую очередь осуществляется подключение к первичной реплике, затем выполняется поиск наиболее подходящей и доступной вторичной реплики.</span><span class="sxs-lookup"><span data-stu-id="c14db-161">Read-only routing may take longer than connecting to the primary because read only routing first connects to the primary and then looks for the best available readable secondary.</span></span> <span data-ttu-id="c14db-162">В связи с этим следует увеличить максимальное время ожидания входа в систему.</span><span class="sxs-lookup"><span data-stu-id="c14db-162">Because of this, you should increase your login timeout.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c14db-163">См. также</span><span class="sxs-lookup"><span data-stu-id="c14db-163">See Also</span></span>  
 [<span data-ttu-id="c14db-164">Возможности SQL Server и ADO.NET</span><span class="sxs-lookup"><span data-stu-id="c14db-164">SQL Server Features and ADO.NET</span></span>](../../../../../docs/framework/data/adonet/sql/sql-server-features-and-adonet.md)  
 [<span data-ttu-id="c14db-165">Центр разработчиков наборов данных и управляемых поставщиков ADO.NET</span><span class="sxs-lookup"><span data-stu-id="c14db-165">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
