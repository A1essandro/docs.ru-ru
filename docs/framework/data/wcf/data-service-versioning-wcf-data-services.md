---
title: "Управление версиями службы данных (службы WCF Data Services)"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework-oob
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- versioning, WCF Data Services
- versioning [WCF Data Services]
- WCF Data Services, versioning
ms.assetid: e3e899cc-7f25-4f67-958f-063f01f79766
caps.latest.revision: "9"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 73e394c4d0a7f78fca7c8c70f68bfc16da556d8d
ms.sourcegitcommit: c0dd436f6f8f44dc80dc43b07f6841a00b74b23f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/19/2018
---
# <a name="data-service-versioning-wcf-data-services"></a>Управление версиями службы данных (службы WCF Data Services)
[!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)] Позволяет создавать службы данных, чтобы клиенты могут обращаться к данным как ресурсам по идентификатору URI, основанные на модели данных. [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] также поддерживает определение операций службы. После первоначального развертывания служб и, возможно, несколько раз на протяжении времени их существования возникает потребность в изменении этих служб. Причин тому немало: изменяющиеся потребности бизнеса, требования информационных технологий или необходимость решить какие-либо другие проблемы. При внесении изменений в существующую службу данных необходимо принять решение, следует ли определить новую версию службы данных и как оптимальным способом свести к минимуму воздействие на существующие клиентские приложения. Этот раздел содержит указания о том, когда и как следует создавать новую версию службы данных. В нем также описывается, как [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] обеспечивает обмен между клиентами и службами данных, которые поддерживают разные версии протокола [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)].  
  
## <a name="versioning-a-wcf-data-service"></a>Управление версиями службы данных WCF  
 После того как служба данных развернута и данные получены, изменения в службе данных могут стать причиной несовместимости с существующими клиентскими приложениями. Но поскольку изменения часто обусловлены общими бизнес-потребностями службы, необходимо решить, когда и как создать новую версию службы данных с минимальным воздействием на клиентские приложения.  
  
### <a name="data-model-changes-that-recommend-a-new-data-service-version"></a>Изменения в модели данных, при внесении которых рекомендуется перейти на новую версию службы данных  
 При рассмотрении вопроса о необходимости публиковать новую версию службы данных важно понимать, как различные изменения могут повлиять на клиентские приложения. Изменения в службе данных, которые могут привести к необходимости создать новую версию службы данных, можно разделить на следующие две категории.  
  
-   Изменения в контракте службы, которые включают обновления операций службы, изменения в доступности наборов сущностей (каналы), изменения версии и другие изменения поведения службы.  
  
-   Изменения в контракте данных, которые включают изменения в модели данных, форматах каналов или настройках каналов.  
  
 В следующей таблице приведены сведения, для каких видов изменений следует рассмотреть вопрос о публикации новой версии службы данных.  
  
|Тип изменения|Требуется новая версия|Новая версия не нужна|  
|--------------------|----------------------------|----------------------------|  
|Операции служб|-Добавьте новый параметр<br />-Изменение типа возвращаемого значения<br />-Удаление операции службы|-Удаление существующих параметров<br />-Добавление новой операции службы|  
|Поведения служб|-Отключить запросы количества<br />-Отключение поддержки проекции<br />-Увеличение необходимой версии службы данных|-Включение запросов счетчиков<br />-Включение поддержки проекции<br />-Уменьшение необходимой версии службы данных|  
|Разрешения набора сущностей|-Ограничение разрешений набора сущностей<br />-Изменение кода ответа (новое значение первой цифры) <sup>1</sup>|-Смягчение разрешений набора сущностей<br />-Изменение кода ответа (того же значения первой цифры)|  
|Свойства сущности|-Удаление существующего свойства или отношения<br />-Добавить свойство не допускающим<br />-Изменение существующего свойства|-Добавьте свойство необязательной определенности<sup>2</sup>|  
|Наборы сущностей|-Удаление набора сущностей|-Добавление производного типа<br />-Изменение базового типа<br />-Добавление набора сущностей|  
|Настройка канала|-Измените сопоставление свойств сущности||  
  
 <sup>1</sup> это может зависеть от строгости обработки клиентского приложения при получении кода ошибки.  
  
 <sup>2</sup> можно задать <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> свойства `true` чтобы клиент игнорировал любые новые свойства отправленных службой данных, не определенные на клиенте. Однако при выполнении вставок свойства, не включенным клиентом в запрос POST, устанавливаются в значения по умолчанию. Для обновлений все данные, существующие в неизвестном клиенту свойстве, могут быть перезаписаны значениями по умолчанию. В этом случае необходимо отправлять обновление как запрос MERGE, который используется по умолчанию. Дополнительные сведения см. в разделе [управление контекстом службы данных](../../../../docs/framework/data/wcf/managing-the-data-service-context-wcf-data-services.md).  
  
### <a name="how-to-version-a-data-service"></a>Управление версиями службы данных  
 При необходимости новая версия службы данных определяется путем создания нового экземпляра службы с обновленным контрактом службы или моделью данных. Затем новая служба предоставляется с использованием новой конечной точки URI, в чем заключается отличие от предыдущей версии. Например:  
  
-   Старая версия: `http://services.odata.org/Northwind/v1/Northwind.svc/`  
  
-   Новая версия: `http://services.odata.org/Northwind/v2/Northwind.svc/`  
  
 При обновлении службы данных необходимо также обновить клиенты на основе новых метаданных службы данных и использовать новый корневой URI. Если возможно, следует сохранить предыдущую версию службы данных для поддержки клиентов, которые еще не обновлены для работы с новой версией. Более старые версии службы данных можно удалить, если они больше не нужны. Необходимо рассмотреть вопрос о сохранении конечной точки URI службы данных во внешнем файле конфигурации.  
  
## <a name="odata-protocol-versions"></a>Версии протокола OData  
 Как новые версии [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] , выпуска, клиентские приложения возможно, не использует ту же версию [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] протокол, поддерживаемый службой данных. Старое клиентское приложение может получить доступ к службе данных, поддерживающей новую версию [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]. Клиентское приложение также могут использовать более новую версию [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] клиентской библиотеки, которая поддерживает более новой версии [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] , чем служба данных, к которому имеет доступ.  
  
 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]использует поддержки, обеспечиваемой [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] для обработки таких сценариев управления версиями. Имеется также поддержка создания и использования метаданных модели данных для создания классов службы данных клиента, когда клиент использует другую версию [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] чем служба данных использует. Дополнительные сведения см. в разделе [OData: управление версиями протокола](http://go.microsoft.com/fwlink/?LinkId=186071).  
  
### <a name="version-negotiation"></a>Согласование версий  
 Служба данных может быть настроена для определения самую новую версию [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] протокол, который будет использоваться службой, независимо от версии, запрашиваемый клиентом. Это можно сделать, указав <xref:System.Data.Services.Common.DataServiceProtocolVersion> значение для <xref:System.Data.Services.DataServiceBehavior.MaxProtocolVersion%2A> свойство <xref:System.Data.Services.DataServiceBehavior> используется службой данных. Дополнительные сведения см. в разделе [Настройка службы данных](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md).  
  
 Если приложение использует клиентские библиотеки служб [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] для доступа к службе данных, библиотеки автоматически устанавливают правильные значения для этих заголовков, в зависимости от версии служб [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] и компонентов, используемых в приложении. По умолчанию [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] использует самую раннюю версию протокола, который поддерживает запрошенную операцию.  
  
 В следующей таблице описаны версии [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] и [!INCLUDE[silverlight](../../../../includes/silverlight-md.md)], которые включают в себя поддержку [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] для определенных версий протокола [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)].  
  
|Версия протокола [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]|Поддержка введена в...|  
|-----------------------------------------------------------------------------------|----------------------------|  
|Версия 1|-   [!INCLUDE[netfx35_long](../../../../includes/netfx35-long-md.md)]Пакет обновления 1 (SP1)<br />-   [!INCLUDE[silverlight](../../../../includes/silverlight-md.md)]версия 3|  
|Версия 2|-   [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)]<br />-Обновление [!INCLUDE[netfx35_long](../../../../includes/netfx35-long-md.md)] SP1. Можно загрузить и установить это обновление [центра загрузки Майкрософт](http://go.microsoft.com/fwlink/?LinkId=158125).<br />-   [!INCLUDE[silverlight](../../../../includes/silverlight-md.md)]версии 4|  
|Версия 3|— Можно загрузить и установить предварительную версию, которая поддерживает [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] версии 3 из [центра загрузки Майкрософт](http://go.microsoft.com/fwlink/?LinkId=203885).|  
  
### <a name="metadata-versions"></a>Версии метаданных  
 По умолчанию службы [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] для представления модели данных используют CSDL версии 1.1. Это всегда справедливо для моделей данных, основанных на поставщике отражения или на специализированном поставщике служб данных. Но если модель данных определена с помощью платформы [!INCLUDE[adonet_ef](../../../../includes/adonet-ef-md.md)], возвращаемая версия CSDL та же, что и версия, используемая платформой [!INCLUDE[adonet_ef](../../../../includes/adonet-ef-md.md)]. Версия CSDL определяется пространство имен [элемент схемы](http://msdn.microsoft.com/library/396074d8-f99c-4f50-a073-68bce848224f). [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]спецификации [ \[MC-CSDL\]: формат файла определения концептуальной схемы](http://go.microsoft.com/fwlink/?LinkId=159072).  
  
 Элемент `DataServices` возвращаемых метаданных содержит также атрибут `DataServiceVersion`, имеющий то же значение, что и заголовок `DataServiceVersion` в ответном сообщении. Клиентские приложения, такие как **добавить ссылку на службу** диалоговое окно в [!INCLUDE[vs_current_short](../../../../includes/vs-current-short-md.md)], эти сведения можно использовать для создания клиентские классы службы данных, правильно работающих с версией [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] , где размещена служба данных. Дополнительные сведения см. в разделе [OData: управление версиями протокола](http://go.microsoft.com/fwlink/?LinkId=186071).  
  
## <a name="see-also"></a>См. также  
 [Поставщики служб данных](../../../../docs/framework/data/wcf/data-services-providers-wcf-data-services.md)  
 [Определение служб данных WCF](../../../../docs/framework/data/wcf/defining-wcf-data-services.md)
