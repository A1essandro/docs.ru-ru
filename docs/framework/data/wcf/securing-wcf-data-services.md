---
title: Защита служб WCF Data Services
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- securing application [WCF Data Services]
- WCF Data Services, security
ms.assetid: 99fc2baa-a040-4549-bc4d-f683d60298af
ms.openlocfilehash: 56ece9c2c81f05047e85ab681e7cfe0da65f35b9
ms.sourcegitcommit: 6eac9a01ff5d70c6d18460324c016a3612c5e268
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/15/2018
ms.locfileid: "45647412"
---
# <a name="securing-wcf-data-services"></a><span data-ttu-id="196db-102">Защита служб WCF Data Services</span><span class="sxs-lookup"><span data-stu-id="196db-102">Securing WCF Data Services</span></span>
<span data-ttu-id="196db-103">В этом разделе приведены сведения по безопасности, связанные с разработкой, развертыванием и запуском [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] и приложений, которые обращаются к службам, поддерживающим [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="196db-103">This topic describes security considerations that are specific to developing, deploying, and running [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] and applications that access services that support the [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)].</span></span> <span data-ttu-id="196db-104">Необходимо также следовать инструкциям по созданию безопасных приложений [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="196db-104">You should also follow recommendations for creating secure [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] applications.</span></span>  
  
 <span data-ttu-id="196db-105">При планировании безопасности службы [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] на базе [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] следует позаботиться как о проверке подлинности (о процедуре определения и проверки идентификатора участника), так и об авторизации (о процедуре, определяющей, разрешен ли прошедшему проверку подлинности участнику доступ к запрашиваемым ресурсам).</span><span class="sxs-lookup"><span data-stu-id="196db-105">When planning how to secure a [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]-based [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] service, you must address both authentication, the process of discovering and verifying the identity of a principal, and authorization, the process of determining whether an authenticated principal is allowed to access the requested resources.</span></span> <span data-ttu-id="196db-106">Следует также рассмотреть необходимость шифрования сообщения с помощью протокола SSL.</span><span class="sxs-lookup"><span data-stu-id="196db-106">You should also consider whether to encrypt the message by using SSL.</span></span>  
  
## <a name="authenticating-client-requests"></a><span data-ttu-id="196db-107">Проверка подлинности клиентских запросов</span><span class="sxs-lookup"><span data-stu-id="196db-107">Authenticating Client Requests</span></span>  
 <span data-ttu-id="196db-108">Поскольку в [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] не реализована собственная схема проверки подлинности, она реализуется средствами, предоставляемыми узлом службы данных.</span><span class="sxs-lookup"><span data-stu-id="196db-108">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] does not implement any kind of authentication of its own, but rather relies on the authentication provisions of the data service host.</span></span> <span data-ttu-id="196db-109">Это означает, что служба предполагает, что все получаемые запросы уже прошли проверку подлинности на сетевом узле и что узел соответствующим образом правильно определил участника, передавшего запрос, через интерфейсы, предоставляемые [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)].</span><span class="sxs-lookup"><span data-stu-id="196db-109">This means that the service assumes that any request that it receives has already been authenticated by the network host and that the host has correctly identified the principle for the request appropriately via the interfaces provided by [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)].</span></span> <span data-ttu-id="196db-110">Эти параметры проверки подлинности и методики, подробно изложены в [OData and Authentication серии](https://go.microsoft.com/fwlink/?LinkId=200381).</span><span class="sxs-lookup"><span data-stu-id="196db-110">These authentication options and approaches are detailed in [OData and Authentication series](https://go.microsoft.com/fwlink/?LinkId=200381).</span></span>  
  
### <a name="authentication-options-for-a-wcf-data-service"></a><span data-ttu-id="196db-111">Параметры проверки подлинности для службы данных WCF</span><span class="sxs-lookup"><span data-stu-id="196db-111">Authentication Options for a WCF Data Service</span></span>  
 <span data-ttu-id="196db-112">В приведенной ниже таблице перечислены некоторые из механизмов проверки подлинности, с помощью которых можно выполнять проверку подлинности запросов к службе данных WCF.</span><span class="sxs-lookup"><span data-stu-id="196db-112">The following table lists some of the authentication mechanisms that are available to help you authenticate requests to a WCF Data Service.</span></span>  
  
|<span data-ttu-id="196db-113">Параметры проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="196db-113">Authentication Options</span></span>|<span data-ttu-id="196db-114">Описание</span><span class="sxs-lookup"><span data-stu-id="196db-114">Description</span></span>|  
|----------------------------|-----------------|  
|<span data-ttu-id="196db-115">Анонимная проверка подлинности</span><span class="sxs-lookup"><span data-stu-id="196db-115">Anonymous authentication</span></span>|<span data-ttu-id="196db-116">При использовании анонимной проверки подлинности по HTTP любой участник может подключиться к службе данных.</span><span class="sxs-lookup"><span data-stu-id="196db-116">When HTTP anonymous authentication is enabled, any principle is able to connect to the data service.</span></span> <span data-ttu-id="196db-117">Учетные данные для анонимного доступа не требуются.</span><span class="sxs-lookup"><span data-stu-id="196db-117">Credentials are not required for anonymous access.</span></span> <span data-ttu-id="196db-118">Используйте этот параметр, только если требуется предоставить общий доступ к службе данных.</span><span class="sxs-lookup"><span data-stu-id="196db-118">Use this option only when you want to allow anyone to access the data service.</span></span>|  
|<span data-ttu-id="196db-119">Обычная и дайджест-проверка подлинности</span><span class="sxs-lookup"><span data-stu-id="196db-119">Basic and digest authentication</span></span>|<span data-ttu-id="196db-120">Для проверки подлинности необходимы учетные данные, состоящие из имени пользователя и пароля.</span><span class="sxs-lookup"><span data-stu-id="196db-120">Credentials consisting of a user name and password are required for authentication.</span></span> <span data-ttu-id="196db-121">Поддерживает проверку подлинности клиентов, отличных от Windows.</span><span class="sxs-lookup"><span data-stu-id="196db-121">Supports authentication of non-Windows clients.</span></span> <span data-ttu-id="196db-122">**Примечание по безопасности:** учетные данные обычной проверки подлинности (имя пользователя и пароль) отправляются в незашифрованном виде и могут быть перехвачены.</span><span class="sxs-lookup"><span data-stu-id="196db-122">**Security Note:**  Basic authentication credentials (user name and password) are sent in the clear and can be intercepted.</span></span> <span data-ttu-id="196db-123">При дайджест-проверке подлинности отправляется хэш, основанный на переданных учетных данных, что обеспечивает большую безопасность по сравнению с обычной проверкой подлинности.</span><span class="sxs-lookup"><span data-stu-id="196db-123">Digest authentication sends a hash based-on the supplied credentials, which makes it more secure than basic authentication.</span></span> <span data-ttu-id="196db-124">Оба эти метода проверки подлинности уязвимы для атак типа «злоумышленник в середине».</span><span class="sxs-lookup"><span data-stu-id="196db-124">Both are susceptible to man-in-the-middle attacks.</span></span> <span data-ttu-id="196db-125">При использовании этих методов проверки подлинности следует организовать зашифрованное соединение между клиентом и службой данных с помощью протокола SSL.</span><span class="sxs-lookup"><span data-stu-id="196db-125">When using these authentication methods, you should consider encrypting communication between client and the data service by using the Secure Sockets Layer (SSL).</span></span> <br /><br /> <span data-ttu-id="196db-126">В службах Microsoft IIS предусмотрена реализация как обычной, так и дайджест-проверки подлинности для HTTP-запросов в приложении [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="196db-126">Microsoft Internet Information Services (IIS) provides an implementation of both basic and digest authentication for HTTP requests in an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] application.</span></span> <span data-ttu-id="196db-127">Эта реализация поставщика проверки подлинности Windows позволяет клиентскому приложению .NET Framework передавать учетные данные службе данных в HTTP-заголовке запроса, что дает возможность беспрепятственно согласовывать проверку подлинности пользователя Windows.</span><span class="sxs-lookup"><span data-stu-id="196db-127">This Windows Authentication Provider implementation enables a .NET Framework client application to supply credentials in the HTTP header of the request to the data service to seamlessly negotiate authentication of a Windows user.</span></span> <span data-ttu-id="196db-128">Дополнительные сведения см. в разделе [Технический справочник хэш-кода проверки подлинности](https://go.microsoft.com/fwlink/?LinkId=200408).</span><span class="sxs-lookup"><span data-stu-id="196db-128">For more information, see [Digest Authentication Technical Reference](https://go.microsoft.com/fwlink/?LinkId=200408).</span></span><br /><br /> <span data-ttu-id="196db-129">Если требуется использовать в службе данных обычную проверку подлинности на базе некоторой нестандартной службы проверки подлинности и без учетных данных Windows, для этого необходимо реализовать пользовательский HTTP-модуль [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="196db-129">When you want to have your data service use basic authentication based on some custom authentication service and not Windows credentials, you must implement a custom [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] HTTP Module for authentication.</span></span><br /><br /> <span data-ttu-id="196db-130">Пример того, как использовать схему пользовательских обычную проверку подлинности с помощью [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], см. в записи [Custom Basic Authentication](https://go.microsoft.com/fwlink/?LinkID=200388) в [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] и рядов для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="196db-130">For an example of how to use a custom basic authentication scheme with [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], see the post on [Custom Basic Authentication](https://go.microsoft.com/fwlink/?LinkID=200388) in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] and authentication series.</span></span>|  
|<span data-ttu-id="196db-131">Аутентификация Windows</span><span class="sxs-lookup"><span data-stu-id="196db-131">Windows authentication</span></span>|<span data-ttu-id="196db-132">Обмен учетными данными на базе Windows происходит с помощью NTLM или Kerberos.</span><span class="sxs-lookup"><span data-stu-id="196db-132">Windows-based credentials are exchanged by using NTLM or Kerberos.</span></span> <span data-ttu-id="196db-133">Этот механизм более надежен, чем простая или дайджест-проверка подлинности, но он требует, чтобы клиент был приложением на базе Windows.</span><span class="sxs-lookup"><span data-stu-id="196db-133">This mechanism is more secure than basic or digest authentication, but it requires that the client be a Windows-based application.</span></span> <span data-ttu-id="196db-134">Кроме того, в службах IIS предусмотрена реализация проверки подлинности Windows для HTTP-запросов в приложении [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="196db-134">IIS also provides an implementation of Windows authentication for HTTP requests in an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] application.</span></span> <span data-ttu-id="196db-135">Дополнительные сведения см. в разделе [обзор проверки подлинности форм ASP.NET](https://msdn.microsoft.com/library/099c1587-6934-476e-ac95-28f534bc9708).</span><span class="sxs-lookup"><span data-stu-id="196db-135">For more information, see [ASP.NET Forms Authentication Overview](https://msdn.microsoft.com/library/099c1587-6934-476e-ac95-28f534bc9708).</span></span><br /><br /> <span data-ttu-id="196db-136">Пример того, как использовать проверку подлинности Windows с [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], см. в записи [проверки подлинности Windows](https://go.microsoft.com/fwlink/?LinkID=200384) в [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] и рядов для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="196db-136">For an example of how to use Windows authentication with [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], see the post on [Windows Authentication](https://go.microsoft.com/fwlink/?LinkID=200384) in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] and authentication series.</span></span>|  
|<span data-ttu-id="196db-137">Проверка подлинности с помощью форм в [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]</span><span class="sxs-lookup"><span data-stu-id="196db-137">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] forms authentication</span></span>|<span data-ttu-id="196db-138">Проверка подлинности с помощью форм позволяет проверять подлинность пользователей с помощью собственного кода и затем предоставлять маркер проверки подлинности в файле Cookie или в URL-адресе страницы.</span><span class="sxs-lookup"><span data-stu-id="196db-138">Forms authentication lets you authenticate users by using your own code and then maintain an authentication token in a cookie or in the page URL.</span></span> <span data-ttu-id="196db-139">Проверка подлинности имени пользователя и пароля пользователя выполняется с помощью созданной вами формы входа в систему.</span><span class="sxs-lookup"><span data-stu-id="196db-139">You authenticate the user name and password of your users using a login form that you create.</span></span> <span data-ttu-id="196db-140">Запросы без проверки подлинности перенаправляются на страницу входа, на которой пользователь указывает учетные данные и отправляет их.</span><span class="sxs-lookup"><span data-stu-id="196db-140">Unauthenticated requests are redirected to a login page, where the user provides credentials and submits the form.</span></span> <span data-ttu-id="196db-141">Если приложение удостоверяет подлинность запроса, система создает билет подлинности, который содержит ключ для повторного запроса данных.</span><span class="sxs-lookup"><span data-stu-id="196db-141">If the application authenticates the request, the system issues a ticket that contains a key for reestablishing the identity for subsequent requests.</span></span> <span data-ttu-id="196db-142">Дополнительные сведения см. в разделе [поставщика проверки подлинности форм](https://msdn.microsoft.com/library/77e21ba2-bad1-4967-a8ec-74942dea7e47).</span><span class="sxs-lookup"><span data-stu-id="196db-142">For more information, see [Forms Authentication Provider](https://msdn.microsoft.com/library/77e21ba2-bad1-4967-a8ec-74942dea7e47).</span></span> <span data-ttu-id="196db-143">**Примечание по безопасности:** по умолчанию, файл cookie, который содержит билета проверки подлинности не защищен при использовании проверки подлинности форм в [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="196db-143">**Security Note:**  By default, the cookie that contains the forms authentication ticket is not secured when you use forms authentication in a [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Web application.</span></span> <span data-ttu-id="196db-144">Рассмотрите вариант с защитой как билета проверки подлинности, так и первоначальных учетных данных для входа с помощью SSL.</span><span class="sxs-lookup"><span data-stu-id="196db-144">You should consider requiring SSL to protect both the authentication ticket and the initial login credentials.</span></span> <br /><br /> <span data-ttu-id="196db-145">Для примера использования проверки подлинности форм с [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], см. в записи [проверки подлинности форм](https://go.microsoft.com/fwlink/?LinkID=200389) в [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] и рядов для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="196db-145">For an example of how to use forms authentication with [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], see the post on [Forms Authentication](https://go.microsoft.com/fwlink/?LinkID=200389) in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] and authentication series.</span></span>|  
|<span data-ttu-id="196db-146">Проверка подлинности на основе утверждений</span><span class="sxs-lookup"><span data-stu-id="196db-146">Claims-based authentication</span></span>|<span data-ttu-id="196db-147">В проверке подлинности на основе утверждений служба данных возлагает на «third-party» доверенный поставщик службы для аутентификации пользователя.</span><span class="sxs-lookup"><span data-stu-id="196db-147">In claims-based authentication, the data service relies on a trusted "third-party" identity provider service to authenticate the user.</span></span> <span data-ttu-id="196db-148">Поставщик удостоверений выполняет с положительным результатом проверку подлинности пользователя, который запросил доступ к ресурсам службы данных, и выдает маркер, предоставляющий доступ к запрошенным ресурсам.</span><span class="sxs-lookup"><span data-stu-id="196db-148">The identity provider positively authenticates the user that is requesting access to data service resources and issues a token that grants access to the requested resources.</span></span> <span data-ttu-id="196db-149">Затем этот маркер представляется службе данных, которая предоставляет доступ пользователю на базе отношений доверия со службой удостоверений, выдавшей маркер доступа.</span><span class="sxs-lookup"><span data-stu-id="196db-149">This token is then presented to the data service, which then grants access to the user based on the trust relationship with the identity service that issued the access token.</span></span><br /><br /> <span data-ttu-id="196db-150">Преимущество использования поставщика проверки подлинности на базе утверждений заключается в том, что этот метод можно использовать для проверки подлинности клиентов различных типов между несколькими доверенными доменами.</span><span class="sxs-lookup"><span data-stu-id="196db-150">The benefit of using a claims-based authentication provider is that they can be used to authenticate various types of clients across trust domains.</span></span> <span data-ttu-id="196db-151">Благодаря применению такого стороннего поставщика, служба данных может быть освобождена от дополнительной нагрузки по поддержке и проверке подлинности пользователей.</span><span class="sxs-lookup"><span data-stu-id="196db-151">By employing such a third-party provider, a data service can offload the requirements of maintaining and authenticating users.</span></span> <span data-ttu-id="196db-152">OAuth 2.0 — это протокол проверки подлинности на основе утверждений, поддерживаемый системой контроля доступа к фабрике приложений Microsoft Azure для федеративной проверки подлинности и реализованный в виде службы.</span><span class="sxs-lookup"><span data-stu-id="196db-152">OAuth 2.0 is a claims-based authentication protocol that is supported by Windows Azure AppFabric Access Control for federated authorization as a service.</span></span> <span data-ttu-id="196db-153">Этот протокол поддерживает службы на основе REST.</span><span class="sxs-lookup"><span data-stu-id="196db-153">This protocol supports REST-based services.</span></span> <span data-ttu-id="196db-154">Пример демонстрирует использование OAuth 2.0 с [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], см. в записи [OData и OAuth](https://go.microsoft.com/fwlink/?LinkId=200514) в [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] и рядов для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="196db-154">For an example of how to use OAuth 2.0 with [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], see the post on [OData and OAuth](https://go.microsoft.com/fwlink/?LinkId=200514) in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] and authentication series.</span></span>|  
  
<a name="clientAuthentication"></a>   
### <a name="authentication-in-the-client-library"></a><span data-ttu-id="196db-155">Проверка подлинности в клиентской библиотеке</span><span class="sxs-lookup"><span data-stu-id="196db-155">Authentication in the Client Library</span></span>  
 <span data-ttu-id="196db-156">По умолчанию клиентская библиотека [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] не поддерживает учетные данные при формировании запроса к службе [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="196db-156">By default, the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library does not supply credentials when making a request to an [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] service.</span></span> <span data-ttu-id="196db-157">Если службе данных для проверки подлинности пользователя требуются учетные данные, то их можно предоставить в объекте <xref:System.Net.NetworkCredential>, доступном через свойство <xref:System.Data.Services.Client.DataServiceContext.Credentials%2A> контекста <xref:System.Data.Services.Client.DataServiceContext>, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="196db-157">When login credentials are required by the data service to authenticate a user, these credentials can be supplied in a <xref:System.Net.NetworkCredential> accessed from the <xref:System.Data.Services.Client.DataServiceContext.Credentials%2A> property of the <xref:System.Data.Services.Client.DataServiceContext>, as in the following example:</span></span>  
  
```csharp  
// Set the client authentication credentials.  
context.Credentials =  
    new NetworkCredential(userName, password, domain);  
```  
  
```vb  
' Set the client authentication credentials.  
context.Credentials = _  
    New NetworkCredential(userName, password, domain)  
```  
  
 <span data-ttu-id="196db-158">Дополнительные сведения см. в разделе [как: укажите учетные данные клиента для данных запроса на обслуживание](../../../../docs/framework/data/wcf/specify-client-creds-for-a-data-service-request-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="196db-158">For more information, see [How to: Specify Client Credentials for a Data Service Request](../../../../docs/framework/data/wcf/specify-client-creds-for-a-data-service-request-wcf.md).</span></span>  
  
 <span data-ttu-id="196db-159">Когда служба данных требует учетные данные входа в систему, которые нельзя указать с помощью объекта <xref:System.Net.NetworkCredential>, например маркер на базе утверждений или файл cookie, необходимо вручную задать заголовки в HTTP-запросе, обычно это заголовки `Authorization` и `Cookie`.</span><span class="sxs-lookup"><span data-stu-id="196db-159">When the data service requires login credentials that cannot be specified by using a <xref:System.Net.NetworkCredential> object, such as a claims-based token or cookie, you must manually set headers in the HTTP request, usually the `Authorization` and `Cookie` headers.</span></span> <span data-ttu-id="196db-160">Дополнительные сведения об этом сценарии проверки подлинности см. в публикации [OData and Authentication: Client-Side Hooks](https://go.microsoft.com/fwlink/?LinkID=200385).</span><span class="sxs-lookup"><span data-stu-id="196db-160">For more information about this kind of authentication scenario, see the post [OData and Authentication: Client-Side Hooks](https://go.microsoft.com/fwlink/?LinkID=200385).</span></span> <span data-ttu-id="196db-161">Пример задания HTTP-заголовков в сообщении запроса, см. в разделе [как: задать заголовки в клиентском запросе](../../../../docs/framework/data/wcf/how-to-set-headers-in-the-client-request-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="196db-161">For an example of how to set HTTP headers in a request message, see [How to: Set Headers in the Client Request](../../../../docs/framework/data/wcf/how-to-set-headers-in-the-client-request-wcf-data-services.md).</span></span>  
  
## <a name="impersonation"></a><span data-ttu-id="196db-162">Олицетворение</span><span class="sxs-lookup"><span data-stu-id="196db-162">Impersonation</span></span>  
 <span data-ttu-id="196db-163">Как правило, служба данных обращается к требуемым ресурсам, например к файлам на сервере или к базе данных, с использованием учетных данных рабочего процесса, в котором размещается служба данных.</span><span class="sxs-lookup"><span data-stu-id="196db-163">Generally, the data service accesses required resources, such as files on the server or a database, by using the credentials of the worker process that is hosting the data service.</span></span> <span data-ttu-id="196db-164">При использовании олицетворения приложения [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] могут выполняться с удостоверением Windows (учетной записью) пользователя, выполняющего запрос.</span><span class="sxs-lookup"><span data-stu-id="196db-164">When using impersonation, [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] applications can execute with the Windows identity (user account) of the user making the request.</span></span> <span data-ttu-id="196db-165">Олицетворение обычно используется в приложениях, которым проверку подлинности пользователя обеспечивают службы IIS, а учетные данные участника используются для доступа к требуемым ресурсам.</span><span class="sxs-lookup"><span data-stu-id="196db-165">Impersonation is commonly used in applications that rely on IIS to authenticate the user, and the credentials of this principle are used to access the required resources.</span></span> <span data-ttu-id="196db-166">Дополнительные сведения см. в разделе [олицетворение ASP.NET](https://msdn.microsoft.com/library/a0cb3024-562f-4184-9d3c-095504787d3d).</span><span class="sxs-lookup"><span data-stu-id="196db-166">For more information, see [ASP.NET Impersonation](https://msdn.microsoft.com/library/a0cb3024-562f-4184-9d3c-095504787d3d).</span></span>  
  
## <a name="configuring-data-service-authorization"></a><span data-ttu-id="196db-167">Настройка авторизации службы данных</span><span class="sxs-lookup"><span data-stu-id="196db-167">Configuring Data Service Authorization</span></span>  
 <span data-ttu-id="196db-168">Авторизация — это предоставление доступа к ресурсам приложений участнику или процессу, определяемому на основе успешно выполненной до этого проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="196db-168">Authorization is the granting of access to application resources to a principle or process that is identified based on a previously successful authentication.</span></span> <span data-ttu-id="196db-169">Как правило, для выполнения операций, которые требуются клиентским приложениям, нужно лишь предоставить достаточные права пользователям службы данных.</span><span class="sxs-lookup"><span data-stu-id="196db-169">As a general practice, you should only grant sufficient rights to users of the data service to perform the operations required by client applications.</span></span>  
  
### <a name="restrict-access-to-data-service-resources"></a><span data-ttu-id="196db-170">Ограничение доступа к ресурсам службы данных</span><span class="sxs-lookup"><span data-stu-id="196db-170">Restrict Access to Data Service Resources</span></span>  
 <span data-ttu-id="196db-171">По умолчанию в [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] можно предоставлять общий доступ на чтение и запись для ресурсов служб данных (набора сущностей и операций службы) любому пользователю, у которого есть доступ к службе данных.</span><span class="sxs-lookup"><span data-stu-id="196db-171">By default, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] enables you to grant common read and write access against data service resources (entity set and service operations) to any user that is able to access the data service.</span></span> <span data-ttu-id="196db-172">Правила, определяющие доступ для чтения и записи, можно задавать отдельно для каждого набора сущностей, предоставляемого службой данных, а также для любой операции службы.</span><span class="sxs-lookup"><span data-stu-id="196db-172">Rules that define read and write access can be defined separately for each entity set exposed by the data service, as well as to any service operations.</span></span> <span data-ttu-id="196db-173">Рекомендуется ограничить доступ для чтения и записи только теми ресурсами, которые необходимы клиентскому приложению.</span><span class="sxs-lookup"><span data-stu-id="196db-173">We recommend limiting both read and write access to only the resources required by the client application.</span></span> <span data-ttu-id="196db-174">Дополнительные сведения см. в разделе [минимальные требования к доступа ресурсов](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md#accessRequirements).</span><span class="sxs-lookup"><span data-stu-id="196db-174">For more information, see [Minimum Resource Access Requirements](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md#accessRequirements).</span></span>  
  
### <a name="implement-role-based-interceptors"></a><span data-ttu-id="196db-175">Реализация перехватчиков на базе ролей</span><span class="sxs-lookup"><span data-stu-id="196db-175">Implement Role-Based Interceptors</span></span>  
 <span data-ttu-id="196db-176">Перехватчики позволяют перехватывать запросы к ресурсам службы данных до того, как они будут обработаны службой данных.</span><span class="sxs-lookup"><span data-stu-id="196db-176">Interceptors enable you to intercept requests against data service resources before they are acted on by the data service.</span></span> <span data-ttu-id="196db-177">Дополнительные сведения см. в разделе [перехватчики](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="196db-177">For more information, see [Interceptors](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md).</span></span> <span data-ttu-id="196db-178">Перехватчики позволяют принимать решения об авторизации с учетом того, какой пользователь, прошедший проверку подлинности, выполняет запрос.</span><span class="sxs-lookup"><span data-stu-id="196db-178">Interceptors enable you to make authorization decisions based the authenticated user that is making the request.</span></span> <span data-ttu-id="196db-179">Например, как ограничить доступ к ресурсам службы данных на основе удостоверения пользователя, прошедшего аутентификацию, см. в разделе [как: перехватывать сообщения службы данных](../../../../docs/framework/data/wcf/how-to-intercept-data-service-messages-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="196db-179">For an example of how to restrict access to data service resources based on an authenticated user identity, see [How to: Intercept Data Service Messages](../../../../docs/framework/data/wcf/how-to-intercept-data-service-messages-wcf-data-services.md).</span></span>  
  
### <a name="restrict-access-to-the-persisted-data-store-and-local-resources"></a><span data-ttu-id="196db-180">Ограничение доступа к хранилищу материализованных данных и локальным ресурсам</span><span class="sxs-lookup"><span data-stu-id="196db-180">Restrict Access to the Persisted Data Store and Local Resources</span></span>  
 <span data-ttu-id="196db-181">Учетным записям, используемым для доступа к хранилищу материализованных данных, должны быть предоставлены только те права в базе данных или файловой системе, которых достаточно для выполнения требований службы данных.</span><span class="sxs-lookup"><span data-stu-id="196db-181">The accounts that are used to access the persisted store should be granted only enough rights in a database or the file system to support the requirements of the data service.</span></span> <span data-ttu-id="196db-182">При использовании анонимной проверки подлинности это будет учетная запись, под которой запущено приложение размещения.</span><span class="sxs-lookup"><span data-stu-id="196db-182">When anonymous authentication is used, this is the account used to run the hosting application.</span></span> <span data-ttu-id="196db-183">Для получения дополнительной информации см. [Практическое руководство. Разработка службы данных WCF Data Service, работающей на IIS](../../../../docs/framework/data/wcf/how-to-develop-a-wcf-data-service-running-on-iis.md).</span><span class="sxs-lookup"><span data-stu-id="196db-183">For more information, see [How to: Develop a WCF Data Service Running on IIS](../../../../docs/framework/data/wcf/how-to-develop-a-wcf-data-service-running-on-iis.md).</span></span> <span data-ttu-id="196db-184">При использовании олицетворения пользователям, прошедшим проверку подлинности, должен предоставляться доступ к этим ресурсам — как правило, в рамках группы Windows.</span><span class="sxs-lookup"><span data-stu-id="196db-184">When impersonation is used, authenticated users must be granted access to these resources, usually as part of a Windows group.</span></span>  
  
## <a name="other-security-considerations"></a><span data-ttu-id="196db-185">Другие вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="196db-185">Other Security Considerations</span></span>  
  
### <a name="secure-the-data-in-the-payload"></a><span data-ttu-id="196db-186">Защита полезных данных</span><span class="sxs-lookup"><span data-stu-id="196db-186">Secure the Data in the Payload</span></span>  
 <span data-ttu-id="196db-187">В основе [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] лежит протокол HTTP.</span><span class="sxs-lookup"><span data-stu-id="196db-187">[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] is based on the HTTP protocol.</span></span> <span data-ttu-id="196db-188">Заголовок HTTP-сообщения может содержать полезные учетные данные пользователя в зависимости от типа проверки подлинности, реализуемого службой данных.</span><span class="sxs-lookup"><span data-stu-id="196db-188">In an HTTP message, the header may contain valuable user credentials, depending on the authentication implemented by the data service.</span></span> <span data-ttu-id="196db-189">Текст сообщения может также содержать полезные пользовательские данные, которые могут требовать защиты.</span><span class="sxs-lookup"><span data-stu-id="196db-189">The message body may also contain valuable customer data that must be protected.</span></span> <span data-ttu-id="196db-190">В обоих случаях рекомендуется защищать передачу этих сведений по сети с помощью SSL.</span><span class="sxs-lookup"><span data-stu-id="196db-190">In both of these cases, we recommend that you use SSL to protect this information over the wire.</span></span>  
  
### <a name="ignored-message-headers-and-cookies"></a><span data-ttu-id="196db-191">Пропускаемые заголовки сообщений и файлы cookie</span><span class="sxs-lookup"><span data-stu-id="196db-191">Ignored Message Headers and Cookies</span></span>  
 <span data-ttu-id="196db-192">Заголовки HTTP-запросов, отличные от объявляющих типы содержимого и расположения ресурсов, пропускаются и никогда не задаются службой данных.</span><span class="sxs-lookup"><span data-stu-id="196db-192">HTTP request headers, other than those that declare content types and resource locations, are ignored and are never set by the data service.</span></span>  
  
 <span data-ttu-id="196db-193">Файлы cookie можно использовать в составе схемы проверки подлинности, например при проверке подлинности [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] с помощью форм.</span><span class="sxs-lookup"><span data-stu-id="196db-193">Cookies can be used as part of an authentication scheme, such as with [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Forms Authentication.</span></span> <span data-ttu-id="196db-194">Однако любые файлы cookie HTTP, заданные во входящем запросе, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] пропускает.</span><span class="sxs-lookup"><span data-stu-id="196db-194">However, any HTTP cookies set on an incoming request are ignored by [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)].</span></span> <span data-ttu-id="196db-195">Сервер, на котором размещена служба данных, может обрабатывать файл cookie, но среда выполнения [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] никогда не анализирует и не возвращает файлы cookie.</span><span class="sxs-lookup"><span data-stu-id="196db-195">The host of a data service may process the cookie, but the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] runtime never analyzes or returns cookies.</span></span> <span data-ttu-id="196db-196">Клиентская библиотека [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] также не обрабатывает файлы cookie, присланные в ответе.</span><span class="sxs-lookup"><span data-stu-id="196db-196">The [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library also does not process cookies sent in the response.</span></span>  
  
### <a name="custom-hosting-requirements"></a><span data-ttu-id="196db-197">Требования к пользовательскому размещению</span><span class="sxs-lookup"><span data-stu-id="196db-197">Custom Hosting Requirements</span></span>  
 <span data-ttu-id="196db-198">По умолчанию [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] создается как приложение [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)], размещаемое в службах IIS.</span><span class="sxs-lookup"><span data-stu-id="196db-198">By default, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] is created as an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] application hosted in IIS.</span></span> <span data-ttu-id="196db-199">Это позволяет службе данных использовать методы защиты этой платформы.</span><span class="sxs-lookup"><span data-stu-id="196db-199">This enables the data service to leverage the secure behaviors of this platform.</span></span> <span data-ttu-id="196db-200">Можно определить приложения [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] как размещаемые на пользовательском узле.</span><span class="sxs-lookup"><span data-stu-id="196db-200">You can define [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] that are hosted by a custom host.</span></span> <span data-ttu-id="196db-201">Дополнительные сведения см. в разделе [размещение служб данных](../../../../docs/framework/data/wcf/hosting-the-data-service-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="196db-201">For more information, see [Hosting the Data Service](../../../../docs/framework/data/wcf/hosting-the-data-service-wcf-data-services.md).</span></span> <span data-ttu-id="196db-202">Компоненты и платформа, на которой размещается служба данных, должны поддерживать приведенные ниже методы защиты для предотвращения атак на службу данных.</span><span class="sxs-lookup"><span data-stu-id="196db-202">The components and platform hosting a data service must ensure the following security behaviors to prevent attacks on the data service:</span></span>  
  
-   <span data-ttu-id="196db-203">Ограничение длины URI, принимаемого в запросе к службе данных для всех возможных операций.</span><span class="sxs-lookup"><span data-stu-id="196db-203">Limit the length of the URI accepted in a data service request for all possible operations.</span></span>  
  
-   <span data-ttu-id="196db-204">Ограничение размера как входящих, так и исходящих HTTP-сообщений.</span><span class="sxs-lookup"><span data-stu-id="196db-204">Limit the size of both incoming and outgoing HTTP messages.</span></span>  
  
-   <span data-ttu-id="196db-205">Ограничение общего числа необработанных запросов в любой момент времени.</span><span class="sxs-lookup"><span data-stu-id="196db-205">Limit the total number of outstanding requests at any given time.</span></span>  
  
-   <span data-ttu-id="196db-206">Ограничение размера HTTP-заголовков и их значений, а также доступ [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] к данным заголовков.</span><span class="sxs-lookup"><span data-stu-id="196db-206">Limit the size of HTTP headers and their values, and provide [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] access to header data.</span></span>  
  
-   <span data-ttu-id="196db-207">Определение и отражение известных атак, например TCP SYN и атак повторной передачи ранее переданных сообщений.</span><span class="sxs-lookup"><span data-stu-id="196db-207">Detect and counter known attacks, such as TCP SYN and message replay attacks.</span></span>  
  
### <a name="values-are-not-further-encoded"></a><span data-ttu-id="196db-208">Отсутствие дальнейшего кодирования значений</span><span class="sxs-lookup"><span data-stu-id="196db-208">Values Are Not Further Encoded</span></span>  
 <span data-ttu-id="196db-209">Среда выполнения [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] не выполняет дальнейшего кодирования значений свойств, отправляемых в службу данных.</span><span class="sxs-lookup"><span data-stu-id="196db-209">Property values sent to the data service are not further encoded by the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] runtime.</span></span> <span data-ttu-id="196db-210">Например, если строковое свойство сущности содержит отформатированное HTML-содержимое, теги не кодируются службой данных в HTML.</span><span class="sxs-lookup"><span data-stu-id="196db-210">For example, when a string property of an entity contains formatted HTML content, the tags are not HTML encoded by the data service.</span></span> <span data-ttu-id="196db-211">Кроме того, служба данных не выполняет дальнейшего кодирования значений свойств в ответе.</span><span class="sxs-lookup"><span data-stu-id="196db-211">The data service also does not further encode property values in the response.</span></span> <span data-ttu-id="196db-212">Клиентская библиотека также не выполняет дополнительного кодирования.</span><span class="sxs-lookup"><span data-stu-id="196db-212">The client library also does not perform any additional encoding.</span></span>  
  
### <a name="considerations-for-client-applications"></a><span data-ttu-id="196db-213">Замечания по клиентским приложениям</span><span class="sxs-lookup"><span data-stu-id="196db-213">Considerations for Client Applications</span></span>  
 <span data-ttu-id="196db-214">Следующие замечания по безопасности относятся к приложениям, в которых клиент [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] используется для доступа к службам [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="196db-214">The following security considerations apply to applications that use the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client to access [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] services:</span></span>  
  
-   <span data-ttu-id="196db-215">Клиентская библиотека предполагает, что протоколы, используемые для доступа к службам данных, обеспечивают требуемый уровень безопасности.</span><span class="sxs-lookup"><span data-stu-id="196db-215">The client library assumes that the protocols used to access the data service provide an appropriate level of security.</span></span>  
  
-   <span data-ttu-id="196db-216">Клиентская библиотека использует значения по умолчанию для всех параметров времени ожидания и синтаксического анализа базовых транспортных стеков, предоставленных платформой.</span><span class="sxs-lookup"><span data-stu-id="196db-216">The client library uses all the default values for timeouts and parsing options of the underlying platform-provided transport stacks.</span></span>  
  
-   <span data-ttu-id="196db-217">Клиентская библиотека не считывает никакие параметры из файлов конфигурации приложения.</span><span class="sxs-lookup"><span data-stu-id="196db-217">The client library does not read any settings from application configuration files.</span></span>  
  
-   <span data-ttu-id="196db-218">В клиентской библиотеке не реализовано никаких механизмов междоменного доступа.</span><span class="sxs-lookup"><span data-stu-id="196db-218">The client library does not implement any cross domain access mechanisms.</span></span> <span data-ttu-id="196db-219">Вместо этого механизмы предоставляются базовым стеком HTTP.</span><span class="sxs-lookup"><span data-stu-id="196db-219">Instead, it relies on the mechanisms provided by the underlying HTTP stack.</span></span>  
  
-   <span data-ttu-id="196db-220">Клиентская библиотека не имеет элементов пользовательского интерфейса и никогда не пытается отобразить или вывести получаемые или отправляемые данные.</span><span class="sxs-lookup"><span data-stu-id="196db-220">The client library has no user interface elements, and it never tries to display or render the data that it receives or sends.</span></span>  
  
-   <span data-ttu-id="196db-221">Рекомендуется, чтобы клиентские приложения всегда проверяли вводимые пользователем данные, а также все данные, принимаемые от недоверенных служб.</span><span class="sxs-lookup"><span data-stu-id="196db-221">We recommend that client applications always validate user input as well as data accepted from untrusted services.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="196db-222">См. также</span><span class="sxs-lookup"><span data-stu-id="196db-222">See Also</span></span>  
 [<span data-ttu-id="196db-223">Определение служб данных WCF</span><span class="sxs-lookup"><span data-stu-id="196db-223">Defining WCF Data Services</span></span>](../../../../docs/framework/data/wcf/defining-wcf-data-services.md)  
 [<span data-ttu-id="196db-224">Библиотека клиентов служб данных WCF</span><span class="sxs-lookup"><span data-stu-id="196db-224">WCF Data Services Client Library</span></span>](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)
