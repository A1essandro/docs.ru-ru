---
title: Размещение служб
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- hosting services [WCF]
ms.assetid: 192be927-6be2-4fda-98f0-e513c4881acc
caps.latest.revision: 31
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: 8311c558c180de5010850a982dc4cca7576382a3
ms.sourcegitcommit: 03ee570f6f528a7d23a4221dcb26a9498edbdf8c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
---
# <a name="hosting-services"></a>Размещение служб
Для активации службы ее необходимо разместить в среде выполнения, которая создает эту службу и управляет ее контекстом и временем существования. Службы[!INCLUDE[indigo1](../../../includes/indigo1-md.md)] предназначены для выполнения в любом процессе Windows, который поддерживает управляемый код.  
  
 [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] обеспечивает единую модель программирования для построения сервисноориентированных приложений. Эта модель программирования остается согласованной и не зависит от среды выполнения, в которой развертывается служба. На практике это означает, что код службы всегда выглядит практически одинаково, независимо от вариантов размещения.  
  
 Варианты размещения могут самыми различными - от выполнения внутри консольного приложения до серверных сред, таких как службы Windows, выполняемых внутри рабочего процесса, который управляется службами IIS или службой активации Windows (WAS). Разработчики могут выбрать среду размещения, которая соответствует требованиям по развертыванию службы. Эти требования могут определяться платформой, на которой развертывается приложение, транспортом, с помощью которого оно должно отправлять и принимать сообщения, или типом перезапуска процессов и другими механизмами управления процессами, необходимыми для обеспечения нужного уровня доступности службы, а также другими требованиями по управлению и надежности. В следующем разделе приведены сведения и инструкции по применению различных вариантов размещения.  
  
## <a name="hosting-options"></a>Варианты размещения  
  
#### <a name="self-hosting-in-a-managed-application"></a>Резидентное размещение в управляемом приложении  
 Службы[!INCLUDE[indigo2](../../../includes/indigo2-md.md)] можно разместить в любом управляемом приложении. Это наиболее гибкий вариант, поскольку он почти не требует развертывания инфраструктуры. Код службы внедряется в код управляемого приложения, после чего создается и открывается экземпляр класса <xref:System.ServiceModel.ServiceHost> , чтобы служба стала доступной. Дополнительные сведения см. в разделе [как: размещение службы WCF в приложениях, управляемых](../../../docs/framework/wcf/how-to-host-a-wcf-service-in-a-managed-application.md).  
  
 Этот параметр поддерживает два распространенных сценария: [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] службы, выполняющиеся внутри консольных приложений и отметить функционально насыщенные клиентские приложения, например на основе Windows Presentation Foundation (WPF) или Windows Forms (WinForms). Размещение службы [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] внутри консольного приложения обычно бывает удобным на этапе разработки приложения. В этом случае приложение легко отлаживать, удобно получать данные трассировки, чтобы узнать, что происходит внутри приложения, и удобно копировать приложение в другие расположения. Кроме того, этот вариант размещения упрощает взаимодействие функционально насыщенных клиентских приложений, таких как приложения [!INCLUDE[avalon2](../../../includes/avalon2-md.md)] и WinForms, с внешними системами. Например, одноранговый клиент для совместной работы может использовать в качестве пользовательского интерфейса [!INCLUDE[avalon2](../../../includes/avalon2-md.md)] и размещать службу [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] , позволяющую другим клиентам подключаться к нему и обмениваться с ним информацией.  
  
#### <a name="managed-windows-services"></a>Управляемые службы Windows  
 Этот вариант размещения предполагает регистрацию домена приложения, в котором служба [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] размещается в качестве управляемой службы Windows (прежнее название - служба NT), так что время существования процесса службы контролируется диспетчером служб для служб Windows. Как и в случае резидентного размещения, в данном случае код размещения является частью приложения. Служба реализуется в качестве службы Windows и в качестве службы [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] , в результате чего она наследует классу <xref:System.ServiceProcess.ServiceBase> и интерфейсу контракта службы [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] . Таким образом, объект <xref:System.ServiceModel.ServiceHost> создается и открывается с помощью переопределенного метода <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> и закрывается с помощью переопределенного метода <xref:System.ServiceProcess.ServiceBase.OnStop> . Кроме того, необходимо реализовать класс установщика, наследующий классу <xref:System.Configuration.Install.Installer> , чтобы программу можно было устанавливать в качестве службы Windows с помощью средства Installutil.exe. Дополнительные сведения см. в разделе [как: размещение службы WCF в службе Windows, управляемых](../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-a-managed-windows-service.md). Сценарий, реализуемый с помощью варианта размещения в управляемой службе Windows, представляет собой работающую в течение продолжительного времени службу [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] , которая размещается за пределами служб IIS в защищенной среде, которая не активируется сообщениями. Вместо этого время существования службы контролируется операционной системой. Данный вариант размещения доступен во всех версиях Windows.  
  
#### <a name="internet-information-services-iis"></a>службы IIS  
 Вариант размещения в службах IIS интегрирован с [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] и использует возможности, предоставляемые этими технологиями, например перезапуск процессов, завершение при ожидании, мониторинг работоспособности процессов и активацию с помощью сообщений. В операционных системах [!INCLUDE[wxp](../../../includes/wxp-md.md)] и [!INCLUDE[ws2003](../../../includes/ws2003-md.md)] этот вариант является предпочтительным при размещении приложений веб-служб, которым требуется высокий уровень доступности и масштабируемости. Кроме того, службы IIS обеспечивают встроенные возможности управления, которые обычно присущи серверным продуктам корпоративного уровня. Для реализации этого варианта размещения требуется правильно настроить службу IIS, но не требуется включать в приложение код размещения. [!INCLUDE[crabout](../../../includes/crabout-md.md)] настройке служб IIS для размещения службы [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] см. в разделе [How to: Host a WCF Service in IIS](../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-iis.md).  
  
 Обратите внимание, что службы, размещаемые в IIS, могут использовать только транспорт HTTP. Реализация в IIS 5.1 накладывает некоторые ограничения при использовании [!INCLUDE[wxp](../../../includes/wxp-md.md)]. Активация на основе сообщений для служб [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] в IIS 5.1 на [!INCLUDE[wxp](../../../includes/wxp-md.md)] не позволяет никаким другим резидентным службам [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] , размещенным на том же компьютере, использовать для взаимодействия порт 80. Службы[!INCLUDE[indigo2](../../../includes/indigo2-md.md)] могут выполняться в одном домене приложения, пуле приложений или рабочем процессе наравне с другими приложениями, если они размещаются в [!INCLUDE[iis601](../../../includes/iis601-md.md)] на [!INCLUDE[ws2003](../../../includes/ws2003-md.md)]. Но поскольку в [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] и [!INCLUDE[iis601](../../../includes/iis601-md.md)] используются стек HTTP режима ядра (HTTP.sys), службы [!INCLUDE[iis601](../../../includes/iis601-md.md)] могут использовать порт 80 совместно с другими размещенными резидентно службами [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] , выполняющимися на том же компьютере, в отличие от служб IIS 5.1.  
  
#### <a name="windows-process-activation-service-was"></a>Служба активации Windows (WAS)  
 Служба активации Windows (WAS) - это новый механизм активации процессов для [!INCLUDE[lserver](../../../includes/lserver-md.md)] , который также доступен в [!INCLUDE[wv](../../../includes/wv-md.md)]. Он сохраняет привычную модель процессов [!INCLUDE[iis601](../../../includes/iis601-md.md)] (с использованием пулов приложений и активации процессов с помощью сообщений) и функции размещения (например, быструю отработку сбоев, мониторинг работоспособности служб и их перезапуск), однако его архитектура активации уже не зависит от протокола HTTP. [!INCLUDE[iisver](../../../includes/iisver-md.md)] использует архитектуру WAS для выполнения активации на основе сообщений по протоколу HTTP. Кроме того, к службе WAS подключаются дополнительные компоненты [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] для реализации активации с помощью сообщений с использованием других протоколов, поддерживаемых в [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] , например TCP, MSMQ и именованных каналов. Это позволяет приложениям, которые используют протоколы взаимодействия, использовать функции IIS, такие как перезапуск процессов, быструю защиту от сбоев и систему стандартных конфигураций, которые ранее были доступны только приложениям, работающим на базе протокола HTTP.  
  
 Для реализации этого варианта размещения требуется правильно настроить службу WAS, но не требуется включать в приложение код размещения. [!INCLUDE[crabout](../../../includes/crabout-md.md)] настройке размещения в WAS см. в разделе [How to: Host a WCF Service in WAS](../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-was.md).  
  
## <a name="choosing-a-hosting-environment"></a>Выбор среды размещения  
 В следующей таблице описаны некоторые ключевые преимущества и сценарии, связанные с каждым из вариантов размещения.  
  
|Среда размещения|Стандартные сценарии|Ключевые преимущества и ограничения|  
|-------------------------|----------------------|----------------------------------|  
|Управляемое приложение (резидентное размещение)|-Консольное приложение, используемое во время разработки.<br />-Насыщенное WinForm и [!INCLUDE[avalon2](../../../includes/avalon2-md.md)] клиентских приложений, получающих доступ к службам.|-Гибкий.<br />-Просты в развертывании.<br />-Не решение уровня предприятия для службы.|  
|Службы Windows (прежнее название - службы NT)|-Долго выполняющимся [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] служб, размещенных вне IIS.|-Существования процесса службы контролируется операционной системой, не активируется сообщениями.<br />— Поддерживают все версии Windows.<br />— Безопасная среда.|  
|IIS 5.1, [!INCLUDE[iis601](../../../includes/iis601-md.md)]|-Выполнение [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] службы рядом с [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] содержимого в Интернете с использованием протокола HTTP.|-Перезапуск процессов.<br />-Shutdown простоя.<br />— Мониторинг работоспособности процессов.<br />Активация с помощью сообщений.<br />-HTTP.|  
|Служба активации Windows (WAS)|-Выполнение [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] службы без установки IIS в Интернете с использованием различных транспортных протоколов.|-IIS не является обязательным.<br />-Перезапуск процессов.<br />-Shutdown простоя.<br />— Мониторинг работоспособности процессов.<br />Активация с помощью сообщений.<br />-Работает с HTTP, TCP, именованные каналы и MSMQ.|  
|IIS 7.0|-Выполнение [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] с [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] содержимого.<br />-Выполнение [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] службы в Интернете с использованием различных транспортных протоколов.|-Это приложение было преимущества.<br />-Интегрированные с [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] содержимым IIS и.|  
  
 Выбор среды размещения зависит от версии Windows, в которой она развертывается, транспортных протоколов, с помощью которых требуется отправлять сообщения, и необходимого типа перезапуска процессов и доменов приложений. В следующей таблице приведены сведения, относящиеся к этим требованиям.  
  
|Среда размещения|Доступность платформы|Поддерживаемые транспортные протоколы|Перезапуск процессов и доменов приложений|  
|-------------------------|---------------------------|--------------------------|-------------------------------------|  
|Управляемые приложения (резидентное размещение)|[!INCLUDE[wxp](../../../includes/wxp-md.md)], [!INCLUDE[ws2003](../../../includes/ws2003-md.md)], [!INCLUDE[wv](../../../includes/wv-md.md)],<br /><br /> [!INCLUDE[lserver](../../../includes/lserver-md.md)]|HTTP,<br /><br /> net.tcp,<br /><br /> net.pipe,<br /><br /> net.msmq|Нет|  
|Службы Windows (прежнее название - службы NT)|[!INCLUDE[wxp](../../../includes/wxp-md.md)], [!INCLUDE[ws2003](../../../includes/ws2003-md.md)], [!INCLUDE[wv](../../../includes/wv-md.md)],<br /><br /> [!INCLUDE[lserver](../../../includes/lserver-md.md)]|HTTP,<br /><br /> net.tcp,<br /><br /> net.pipe,<br /><br /> net.msmq|Нет|  
|IIS 5,1|[!INCLUDE[wxp](../../../includes/wxp-md.md)]|HTTP|Да|  
|[!INCLUDE[iis601](../../../includes/iis601-md.md)]|[!INCLUDE[ws2003](../../../includes/ws2003-md.md)]|HTTP|Да|  
|Служба активации Windows (WAS)|[!INCLUDE[wv](../../../includes/wv-md.md)], [!INCLUDE[lserver](../../../includes/lserver-md.md)]|HTTP,<br /><br /> net.tcp,<br /><br /> net.pipe,<br /><br /> net.msmq|Да|  
  
 Важно отметить, что при запуске службы или любого расширения от недоверенного узла нарушается безопасность. Кроме того, следует иметь в ввиду, что при открытии объекта <xref:System.ServiceModel.ServiceHost> при олицетворении приложение должно следить, чтобы пользователь не вышел из системы, например путем кэширования объекта <xref:System.Security.Principal.WindowsIdentity> этого пользователя.  
  
## <a name="see-also"></a>См. также  
 [Требования к системе](../../../docs/framework/wcf/wcf-system-requirements.md)  
 [Базовый жизненный цикл программирования](../../../docs/framework/wcf/basic-programming-lifecycle.md)  
 [Реализация контрактов служб](../../../docs/framework/wcf/implementing-service-contracts.md)  
 [Практическое руководство. Размещение службы WCF в IIS](../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-iis.md)  
 [Практическое руководство. Размещение службы WCF в WAS](../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-was.md)  
 [Практическое руководство. Размещение службы WCF в управляемой службе Windows](../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-a-managed-windows-service.md)  
 [Практическое руководство. Размещение службы WCF в управляемом приложении](../../../docs/framework/wcf/how-to-host-a-wcf-service-in-a-managed-application.md)
