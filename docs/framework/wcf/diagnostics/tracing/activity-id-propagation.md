---
title: "Распространение ИД действия"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: cd1c1ae5-cc8a-4f51-90c9-f7b476bcfe70
caps.latest.revision: "6"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 6c61087102148688678d868ce25a9cb63315ed65
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="activity-id-propagation"></a>Распространение ИД действия
Распространение происходит при включении трассировки действий ServiceModel (распространение ServiceModel) или ее выключении (распространение действий от пользователя к пользователю).  
  
## <a name="servicemodel-activity-tracing-is-enabled"></a>Трассировка действий ServiceModel включена  
 Если трассировка действий ServiceModel включена, между действиями ProcessAction осуществляется распространение.  
  
### <a name="server"></a>Сервер  
 Когда `propagateActivity` атрибута задано значение `true` на клиенте и сервере, идентификатор `ProcessAction` действия на сервере идентичен Идентификатору в распространенном `ActivityId` заголовка сообщения.  
  
 Если аргумент `ActivityId` заголовок в сообщении (то есть `propagateActivity` = `false` на стороне клиента), или когда `propagateActivity` = `false` на сервере, сервер создает новый идентификатор действия.  
  
### <a name="client"></a>"Клиент";  
 Если клиент синхронно однопоточный, он игнорирует любые параметры `propagateActivity` на уровне клиента или сервера. Вместо этого ответ обрабатывается действием запроса. Если клиент асинхронный или синхронный многопоточный, `propagateActivity` = `true` на клиенте и имеется заголовок идентификатора действия в сообщении, отправленном сервером, клиент извлекает из сообщения идентификатор действия и передает Действие Process Action, содержащее распространенный идентификатор действия. Иначе клиент передает его из действия Process Action в новое действие Process Action. Такая дополнительная передача в новое действие Process Action осуществляется для обеспечения согласованности. В этом действии клиент извлекает идентификатор действия BeginCall из контекста локального потока, когда выделяется поток для обработки ответного сообщения. После этого осуществляется передача в первоначальное действие Process Action.  
  
 Если клиент дуплексный, он действует в качестве сервера для получения сообщения.  
  
### <a name="propagation-in-fault-messages"></a>Распространение в сообщениях об ошибках  
 Разницы в обработке допустимых сообщений и сообщений об ошибках нет. Если `propagateActivity` = `true`, идентификатор действия, добавляемый в заголовки сообщений об ошибках SOAP идентична внешнего действия.  
  
## <a name="servicemodel-activity-tracing-is-disabled"></a>Трассировка действий ServiceModel отключена  
 Если трассировка действий ServiceModel отключена, распространение осуществляется непосредственно между действиями пользовательского кода, минуя действия ServiceModel. Идентификатор пользовательского действия также распространяется через заголовок идентификатора действия сообщения.  
  
 Если `propagateActivity` = `true` и `ActivityTracing` = `off` для прослушивателя трассировки ServiceModel (независимо от того, включена ли трассировка в ServiceModel) на стороне клиента или сервера происходит следующее:  
  
-   При запросе операции или отправке ответа идентификатор действия в TLS распространяется из пользовательского кода, пока не будет сформировано сообщение. Заголовок идентификатора действия также вставляется в сообщение перед отправкой.  
  
-   При получении запроса или ответа идентификатор действия извлекается из заголовка сообщения сразу после создания объекта полученного сообщения. Идентификатор действия в TLS распространяется сразу после исчезновения сообщения из области, пока не будет достигнут пользовательский код.  
  
 Такие действия гарантируют, что при включенном распространении пользовательские трассировки появятся в том же действии. Однако гарантии в отношении трассировок ServiceModel отсутствуют. Трассировки ServiceModel возникают в действии пользовательского кода, только если обработка таких трассировок выполняется в том же потоке, в котором было задано действие пользовательского кода.  
  
 Как правило, трассировки ServiceModel находятся в следующих местах.  
  
-   Если трассировка ServiceModel отключена, все выданные трассировки находятся в действиях пользователя. Если включено распространение на сервере и клиенте, эти трассировки будут находиться в том же действии.  
  
-   Если включена трассировка ServiceModel, но ActivityTracing отключена, пользовательские трассировки находятся в том же действии, если для обеих сторон включено распространение. Трассировки ServiceModel появляются в действии по умолчанию 0000, пока они не возникнут в том же потоке, где выполняется обработка пользовательского кода с первоначально заданным действием.  
  
-   Если включены трассировка ServiceModel и ActivityTracing, пользовательские трассировки находятся в пользовательских действиях, а трассировка ServiceModel - в действиях, определенных ServiceModel. Распространение осуществляется на уровне ServiceModel.
