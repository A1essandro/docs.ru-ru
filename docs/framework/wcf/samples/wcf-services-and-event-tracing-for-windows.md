---
title: "Службы WCF и средство отслеживания событий для Windows | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework-4.6"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: eda4355d-0bd0-4dc9-80a2-d2c832152272
caps.latest.revision: 15
author: "Erikre"
ms.author: "erikre"
manager: "erikre"
caps.handback.revision: 15
---
# Службы WCF и средство отслеживания событий для Windows
Этот образец демонстрирует использование аналитического отслеживания в [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] для передачи событий в средство отслеживания событий для Windows \(ETW\).  Аналитические трассировки представляют собой события, возникающие в ключевых точках стека [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] и позволяющие отлаживать службы [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] в рабочей среде.  
  
 Аналитическое отслеживание служб [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] можно включить в рабочей среде, оказывая минимальное воздействие на производительность.  Отслеживаемые события передаются в сеанс трассировки событий Windows.  
  
 Данный образец включает базовую службу [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], события из которой передаются в журнал событий, который можно просмотреть с помощью средства просмотра событий.  Можно также запустить выделенный сеанс трассировки событий Windows, который будет прослушивать события от этой службы [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].  Данный образец включает скрипт для создания выделенного сеанса трассировки событий Windows, хранящего события в двоичном файле, который можно прочесть с помощью средства просмотра событий.  
  
#### Использование этого образца  
  
1.  Откройте в среде [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] файл решения EtwAnalyticTraceSample.sln.  
  
2.  Для построения решения нажмите CTRL\+SHIFT\+B.  
  
3.  Чтобы запустить решение, нажмите клавиши CTRL\+F5.  
  
     В веб\-браузере щелкните файл **Calculator.svc**.  В браузере должен появиться URI WSDL\-документа для службы.  Скопируйте этот URI.  
  
     По умолчанию служба начинает прослушивание запросов на порту 1378 \(http:\/\/localhost:1378\/Calculator.svc\).  
  
4.  Запустите тестовый клиент [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] \(WcfTestClient.exe\).  
  
     Тестовый клиент [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] \(WcfTestClient.exe\) расположен по адресу \<[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]каталог\_установки\>\\Common7\\IDE\\ WcfTestClient.exe \(по умолчанию каталог установки [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] имеет вид C:\\Program Files\\Microsoft Visual Studio 10.0\).  
  
5.  В тестовом клиенте [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] добавьте службу, выбрав в меню **Файл** команду **Добавить службу**.  
  
     Добавьте адрес конечной точки в поле ввода.  Значение по умолчанию равно http:\/\/localhost:1378\/Calculator.svc.  
  
6.  Откройте приложение просмотра событий.  
  
     Перед запуском службы запустите средство просмотра событий и убедитесь, что журнал событий прослушивает события отслеживания, создаваемые в службе [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].  
  
7.  В меню **Пуск** выберите пункт **Администрирование**, а затем пункт **Просмотр событий**.  Включите **Аналитический** и **Отладочный** журналы.  
  
8.  В древовидном представлении средства просмотра событий перейдите последовательно к узлам **Средство просмотра событий**, **Журналы приложений и служб**, **Microsoft**, **Windows** и **Сервер приложений \- приложения**.  Щелкните правой кнопкой мыши пункт **Сервер приложений \- приложения**, выберите пункт **Вид** и пункт **Отобразить аналитический и отладочный журналы**.  
  
     Установите флажок **Отобразить аналитический и отладочный журналы**.  
  
9. Включите **Аналитический** журнал.  
  
     В древовидном представлении средства просмотра событий перейдите последовательно к узлам **Средство просмотра событий**, **Журналы приложений и служб**, **Microsoft**, **Windows** и **Сервер приложений \- приложения**.  Щелкните правой кнопкой мыши пункт **Аналитический** и выберите команду **Включить журнал**.  
  
#### Проверка службы  
  
1.  Переключитесь в тестовый клиент [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], дважды щелкните `Divide` и сохраните значения по умолчанию, в которых задано нулевое значение знаменателя.  
  
     Если знаменатель равен 0, служба выдает ошибку.  
  
2.  Просмотрите события, переданные из службы.  
  
     Вернитесь в средство просмотра событий и перейдите в окно **Средство просмотра событий**, **Журналы приложений и служб**, **Microsoft**, **Windows**, **Сервер приложений \- приложения**.  Щелкните правой кнопкой мыши пункт **Аналитический** и выберите команду **Обновить**.  
  
     События аналитического отслеживания WCF отображаются в средстве просмотра событий.  Обратите внимание, что для возникшей ошибки в средстве просмотра событий отображается событие аналитического отслеживания.  
  
3.  Повторите шаги 1 и 2, используя уже допустимые входные значения.  Значением параметра `N2` может быть любое число, отличное от 0.  
  
     Обновите канал аналитики, чтобы убедиться, что события WCF не включают событий, связанных с ошибкой.  
  
 Образец иллюстрирует передачу событий аналитического отслеживания из службы WCF.  
  
#### Очистка \(необязательно\)  
  
1.  Откройте средство просмотра событий.  
  
2.  Перейдите последовательно к узлам **Средство просмотра событий**, **Журналы приложений и служб**, **Microsoft**, **Windows** и **Сервер приложений \- приложения**.  Щелкните правой кнопкой мыши пункт **Аналитический** и выберите команду **Отключить журнал**.  
  
3.  Перейдите последовательно к узлам **Средство просмотра событий**, **Журналы приложений и служб**, **Microsoft**, **Windows** и **Сервер приложений \- приложения**.  Щелкните правой кнопкой мыши пункт **Аналитический** и выберите команду **Очистить журнал**.  
  
4.  Установите флажок **Очистить**, чтобы очистить события.  
  
> [!IMPORTANT]
>  Образцы уже могут быть установлены на компьютере.  Перед продолжением проверьте следующий каталог \(по умолчанию\).  
>   
>  `<диск_установки>:\WF_WCF_Samples`  
>   
>  Если этот каталог не существует, перейдите на страницу [Образцы Windows Communication Foundation \(WCF\) и Windows Workflow Foundation \(WF\) для .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780), чтобы загрузить все образцы [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] и [!INCLUDE[wf1](../../../../includes/wf1-md.md)].  Этот образец расположен в следующем каталоге.  
>   
>  `<диск_установки>:\WF_WCF_Samples\WCF\Basic\Management\ETWTracing`  
  
## См. также  
 [Образцы наблюдения за AppFabric](http://go.microsoft.com/fwlink/?LinkId=193959)