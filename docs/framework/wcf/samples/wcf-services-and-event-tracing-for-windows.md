---
title: "Службы WCF и средство отслеживания событий для Windows"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: eda4355d-0bd0-4dc9-80a2-d2c832152272
caps.latest.revision: "15"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 809b48a27e5923db585d6125df0d2f55c96a4765
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="wcf-services-and-event-tracing-for-windows"></a>Службы WCF и средство отслеживания событий для Windows
Этот образец демонстрирует использование аналитического отслеживания в [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] для передачи событий в средство отслеживания событий для Windows (ETW). Аналитические трассировки представляют собой события, возникающие в ключевых точках стека [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] и позволяющие отлаживать службы [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] в рабочей среде.  
  
 Аналитическое отслеживание служб [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] можно включить в рабочей среде, оказывая минимальное воздействие на производительность. Отслеживаемые события передаются в сеанс трассировки событий Windows.  
  
 Данный образец включает базовую службу [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], события из которой передаются в журнал событий, который можно просмотреть с помощью средства просмотра событий. Можно также запустить выделенный сеанс трассировки событий Windows, который будет прослушивать события от этой службы [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]. Данный образец включает скрипт для создания выделенного сеанса трассировки событий Windows, хранящего события в двоичном файле, который можно прочесть с помощью средства просмотра событий.  
  
#### <a name="to-use-this-sample"></a>Использование этого образца  
  
1.  Откройте в среде [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] файл решения EtwAnalyticTraceSample.sln.  
  
2.  Для построения решения нажмите CTRL+SHIFT+B.  
  
3.  Чтобы запустить решение, нажмите клавиши CTRL+F5.  
  
     В веб-браузере, щелкните **Calculator.svc**. В браузере должен появиться URI WSDL-документа для службы. Скопируйте этот URI.  
  
     По умолчанию служба начинает прослушивание запросов на порту 1378 (http://localhost:1378/Calculator.svc).  
  
4.  Запустите тестовый клиент [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] (WcfTestClient.exe).  
  
     [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] Тестовый клиент (WcfTestClient.exe) расположен в \< [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] каталог установки > \Common7\IDE\ WcfTestClient.exe (по умолчанию [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] каталог установки — C:\Program Files\Microsoft Visual Studio 10.0).  
  
5.  В пределах [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] тестовый клиент, добавить службу, указав **файл**, а затем **добавить службу**.  
  
     Добавьте адрес конечной точки в поле ввода. Значение по умолчанию равно http://localhost:1378/Calculator.svc.  
  
6.  Откройте приложение просмотра событий.  
  
     Перед запуском службы запустите средство просмотра событий и убедитесь, что журнал событий прослушивает события отслеживания, создаваемые в службе [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].  
  
7.  Из **запустить** последовательно выберите пункты **Администрирование**, а затем **средство просмотра событий**.  Включить **аналитический** и **отладки** журналы.  
  
8.  В представлении дерева в средстве просмотра событий перейдите к **средство просмотра событий**, **журналы приложений и служб**, **Microsoft**, **Windows**, а затем **Сервер приложений-приложения**. Щелкните правой кнопкой мыши **сервер приложений-приложения**выберите **представление**, а затем **Отобразить аналитический и отладочный журналы**.  
  
     Убедитесь, что **Отобразить аналитический и отладочный журналы** флажок.  
  
9. Включить **аналитический** журнала.  
  
     В представлении дерева в средстве просмотра событий перейдите к **средство просмотра событий**, **журналы приложений и служб**, **Microsoft**, **Windows**, а затем **Сервер приложений-приложения**. Щелкните правой кнопкой мыши **аналитический** и выберите **включить журнал**.  
  
#### <a name="to-test-the-service"></a>Проверка службы  
  
1.  Переключитесь в тестовый клиент [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], дважды щелкните `Divide` и сохраните значения по умолчанию, в которых задано нулевое значение знаменателя.  
  
     Если знаменатель равен 0, служба выдает ошибку.  
  
2.  Просмотрите события, переданные из службы.  
  
     Вернитесь в средство просмотра событий и перейдите к **средство просмотра событий**, **журналы приложений и служб**, **Microsoft**, **Windows**, а затем **Сервер приложений-приложения**. Щелкните правой кнопкой мыши **аналитический** и выберите **обновление**.  
  
     События аналитического отслеживания WCF отображаются в средстве просмотра событий. Обратите внимание, что для возникшей ошибки в средстве просмотра событий отображается событие аналитического отслеживания.  
  
3.  Повторите шаги 1 и 2, используя уже допустимые входные значения. Значением параметра `N2` может быть любое число, отличное от 0.  
  
     Обновите канал аналитики, чтобы убедиться, что события WCF не включают событий, связанных с ошибкой.  
  
 Образец иллюстрирует передачу событий аналитического отслеживания из службы WCF.  
  
#### <a name="to-cleanup-optional"></a>Очистка (необязательно)  
  
1.  Откройте средство просмотра событий.  
  
2.  Перейдите к **средство просмотра событий**, **журналы приложений и служб**, **Microsoft**, **Windows**, а затем  **Сервер приложений приложения**. Щелкните правой кнопкой мыши **аналитический** и выберите **отключить журнал**.  
  
3.  Перейдите к **средство просмотра событий**, **журналы приложений и служб**, **Microsoft**, **Windows**, а затем  **Сервер приложений приложения**. Щелкните правой кнопкой мыши **аналитический** и выберите **очистить журнал**.  
  
4.  Выберите **снимите** параметр, чтобы очистить события.  
  
> [!IMPORTANT]
>  Образцы уже могут быть установлены на компьютере. Перед продолжением проверьте следующий каталог (по умолчанию).  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  Если этот каталог не существует, перейдите на страницу [Примеры Windows Communication Foundation (WCF) и Windows Workflow Foundation (WF) для .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) , чтобы скачать все примеры [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] . Этот образец расположен в следующем каталоге.  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Management\ETWTracing`  
  
## <a name="see-also"></a>См. также  
 [Примеры мониторинга AppFabric](http://go.microsoft.com/fwlink/?LinkId=193959)
