---
title: Образец прокси-сервера обнаружения
ms.date: 03/30/2017
ms.assetid: 1dfa02df-15b1-4e97-9c8e-f5f2772711b0
ms.openlocfilehash: e9cbfcb717f502a849d4d508d13df6c00b95db58
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
---
# <a name="discovery-proxy-sample"></a><span data-ttu-id="17685-102">Образец прокси-сервера обнаружения</span><span class="sxs-lookup"><span data-stu-id="17685-102">Discovery Proxy Sample</span></span>
<span data-ttu-id="17685-103">Этот образец демонстрирует создание реализации прокси-сервера обнаружения для хранения сведений о существующих службах, а также то, как клиенты могут запрашивать сведения у этого прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="17685-103">This sample shows how to create an implementation of a Discovery proxy to store information about existing services and how clients can query that proxy for information.</span></span> <span data-ttu-id="17685-104">Этот образец состоит из трех проектов.</span><span class="sxs-lookup"><span data-stu-id="17685-104">This sample consists of three projects:</span></span>  
  
-   <span data-ttu-id="17685-105">**Служба**: простой службы калькулятора Windows Communication Foundation (WCF), которая регистрирует себя с прокси-сервера обнаружения.</span><span class="sxs-lookup"><span data-stu-id="17685-105">**Service**: A simple Windows Communication Foundation (WCF) calculator service that registers itself with the discovery proxy.</span></span>  
  
-   <span data-ttu-id="17685-106">**Прокси-сервер обнаружения**: реализация службы прокси-сервера обнаружения.</span><span class="sxs-lookup"><span data-stu-id="17685-106">**Discovery Proxy**: The implementation of a discovery proxy service.</span></span>  
  
-   <span data-ttu-id="17685-107">**Клиент**: клиентское приложение WCF, который вызывает прокси-сервер обнаружения для поиска служб.</span><span class="sxs-lookup"><span data-stu-id="17685-107">**Client**: A WCF client application that calls the discovery proxy to search for services.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="17685-108">Демонстрации</span><span class="sxs-lookup"><span data-stu-id="17685-108">Demonstrates</span></span>  
 <span data-ttu-id="17685-109">Реализация прокси-сервера обнаружения</span><span class="sxs-lookup"><span data-stu-id="17685-109">Discovery proxy implementation</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="17685-110">Образцы уже могут быть установлены на компьютере.</span><span class="sxs-lookup"><span data-stu-id="17685-110">The samples may already be installed on your machine.</span></span> <span data-ttu-id="17685-111">Перед продолжением проверьте следующий каталог (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="17685-111">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="17685-112">Если этот каталог не существует, перейдите к [Windows Communication Foundation (WCF) и образцы Windows Workflow Foundation (WF) для .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) для загрузки всех Windows Communication Foundation (WCF) и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] образцов.</span><span class="sxs-lookup"><span data-stu-id="17685-112">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="17685-113">Этот образец расположен в следующем каталоге.</span><span class="sxs-lookup"><span data-stu-id="17685-113">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Discovery\DiscoveryProxy`  
  
## <a name="discoveryproxy"></a><span data-ttu-id="17685-114">DiscoveryProxy</span><span class="sxs-lookup"><span data-stu-id="17685-114">DiscoveryProxy</span></span>  
 <span data-ttu-id="17685-115">С помощью метода `Main` из файла Program.cs демонстрируется размещение службы типа <xref:System.ServiceModel.Discovery.DiscoveryProxy>.</span><span class="sxs-lookup"><span data-stu-id="17685-115">In the `Main` method of the Program.cs file, the sample shows how a service of type <xref:System.ServiceModel.Discovery.DiscoveryProxy> is hosted.</span></span> <span data-ttu-id="17685-116">Он предоставляет две конечные точки, одна из них имеет тип <xref:System.ServiceModel.Discovery.DiscoveryEndpoint>, другая - <xref:System.ServiceModel.Discovery.AnnouncementEndpoint>.</span><span class="sxs-lookup"><span data-stu-id="17685-116">It exposes two endpoints, one of type <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> and another of type <xref:System.ServiceModel.Discovery.AnnouncementEndpoint>.</span></span> <span data-ttu-id="17685-117">Обе конечные точки в качестве транспорта используют протокол TCP.</span><span class="sxs-lookup"><span data-stu-id="17685-117">Both of the endpoints use TCP as a transport.</span></span> <span data-ttu-id="17685-118">Конечная точка <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> прослушивает URI, указанный параметром `probeEndpointAddress`, именно сюда клиенты могут отправлять сообщения зонда для запроса данных прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="17685-118">The <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> is listening at the URI specified by the `probeEndpointAddress` parameter, this is where clients can send probe messages to query the proxy for its data.</span></span> <span data-ttu-id="17685-119">Конечная точка <xref:System.ServiceModel.Discovery.AnnouncementEndpoint> прослушивает URI, указанный параметром `announcementEndpointAddress`.</span><span class="sxs-lookup"><span data-stu-id="17685-119">The <xref:System.ServiceModel.Discovery.AnnouncementEndpoint> is listening at the URI specified by the `announcementEndpointAddress` parameter.</span></span> <span data-ttu-id="17685-120">Здесь прокси-сервер ожидает получения объявлений.</span><span class="sxs-lookup"><span data-stu-id="17685-120">This is where the proxy listens to for announcements.</span></span> <span data-ttu-id="17685-121">При получении объявления о входе в сеть прокси-сервер добавляет в свой кэш службу, а при получении объявления о выходе из сети он удаляет эту службу из кэша.</span><span class="sxs-lookup"><span data-stu-id="17685-121">When an online announcement is received, the proxy adds the service to its cache and when an offline announcement is received it removes the service from its cache.</span></span>  
  
 <span data-ttu-id="17685-122">В файле DiscoveryProxy.cs имеется реализация <xref:System.ServiceModel.Discovery.DiscoveryProxy>.</span><span class="sxs-lookup"><span data-stu-id="17685-122">The DiscoveryProxy.cs contains the implementation of the <xref:System.ServiceModel.Discovery.DiscoveryProxy>.</span></span> <span data-ttu-id="17685-123">Прокси-сервер должен наследовать от класса <xref:System.Object>, кроме того, ему требуется реализация <xref:System.Runtime.Remoting.Messaging.AsyncResult>.</span><span class="sxs-lookup"><span data-stu-id="17685-123">The Proxy must inherit from the <xref:System.Object> class and requires an implementation of <xref:System.Runtime.Remoting.Messaging.AsyncResult>.</span></span> <span data-ttu-id="17685-124">При установке прокси-сервера создается новый словарь <xref:System.Collections.Generic.Dictionary%602>, в котором сервер сохраняет известные ему элементы.</span><span class="sxs-lookup"><span data-stu-id="17685-124">At instantiation, the Proxy creates a new <xref:System.Collections.Generic.Dictionary%602>, which it uses to store elements it knows about.</span></span>  
  
 <span data-ttu-id="17685-125">Файл подразделяется на две области: методы кэша прокси-сервера и реализация прокси-сервера обнаружения.</span><span class="sxs-lookup"><span data-stu-id="17685-125">The file is divided into two regions, Proxy Cache Methods and Discovery Proxy Implementation.</span></span> <span data-ttu-id="17685-126">Область методов кэша прокси-сервера содержит методы, которые используются для обновления словаря <xref:System.Collections.Generic.Dictionary%602>, выполняет запросы к словарю <xref:System.Collections.Generic.Dictionary%602> и печатает данные для пользователей.</span><span class="sxs-lookup"><span data-stu-id="17685-126">The Proxy Cache Methods region contains methods used to update the <xref:System.Collections.Generic.Dictionary%602>, perform queries against the <xref:System.Collections.Generic.Dictionary%602>, and print the data for users.</span></span> <span data-ttu-id="17685-127">Область реализации прокси-сервера обнаружения содержит переопределенные методы, которые требуются для функциональных средств объявлений и зондов.</span><span class="sxs-lookup"><span data-stu-id="17685-127">The Discovery Proxy Implementation region contains the overridden methods required for the Announcement and Probe functionality.</span></span> <span data-ttu-id="17685-128">Они определяют действия, которые прокси-сервер выполняет после получения объявления о входе в сеть, объявления о выходе из сети или сообщения зонда.</span><span class="sxs-lookup"><span data-stu-id="17685-128">They define the actions taken by a proxy after receiving an Online Announcement, an Offline Announcement, or a Probe message.</span></span>  
  
## <a name="service"></a><span data-ttu-id="17685-129">Служба</span><span class="sxs-lookup"><span data-stu-id="17685-129">Service</span></span>  
 <span data-ttu-id="17685-130">В проекте «Служба» из файла Program.cs для конечной точки объявлений используется такой же URI, как и для прокси-сервера обнаружения.</span><span class="sxs-lookup"><span data-stu-id="17685-130">In the Program.cs file in the Service project, the same URI is used for its announcement endpoint as the discovery proxy.</span></span> <span data-ttu-id="17685-131">Сделано это потому, что служба использует конечную точку для отправки объявлений, а прокси-сервер с ее помощью получает эти сообщения.</span><span class="sxs-lookup"><span data-stu-id="17685-131">This is because service uses the endpoint for sending the announcements, while the proxy uses it for receiving them.</span></span> <span data-ttu-id="17685-132">Служба использует объект <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior> и добавляет в него конечную точку объявлений.</span><span class="sxs-lookup"><span data-stu-id="17685-132">The service uses the <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior> and adds an announcement endpoint to it.</span></span>  
  
## <a name="client"></a><span data-ttu-id="17685-133">"Клиент";</span><span class="sxs-lookup"><span data-stu-id="17685-133">Client</span></span>  
 <span data-ttu-id="17685-134">В проекте «Клиент» для конечной точки зонда используется такой же URI, как и для прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="17685-134">The Client project uses the same URI for its probe endpoint as the Proxy.</span></span> <span data-ttu-id="17685-135">Сделано это потому, что в этом сценарии зонды также одноадресно доставляются именно в конечную точку, имеющуюся на прокси-сервере.</span><span class="sxs-lookup"><span data-stu-id="17685-135">This is because the probes in this scenario are also being unicast specifically to the endpoint available on the proxy.</span></span> <span data-ttu-id="17685-136">Клиент соединяется с этим хорошо известным адресом, а затем запрашивает службу.</span><span class="sxs-lookup"><span data-stu-id="17685-136">The Client connects to this well-known address and then queries it for the service.</span></span> <span data-ttu-id="17685-137">Обнаружив службу, он устанавливает соединение с ней.</span><span class="sxs-lookup"><span data-stu-id="17685-137">Once it has found the service it connects to it.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="17685-138">Использование этого образца</span><span class="sxs-lookup"><span data-stu-id="17685-138">To use this sample</span></span>  
  
1.  <span data-ttu-id="17685-139">Загрузите решение проекта в среду [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] и постройте проект.</span><span class="sxs-lookup"><span data-stu-id="17685-139">Load the project solution in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] and build the project.</span></span>  
  
2.  <span data-ttu-id="17685-140">Сначала запустите приложение Discovery Proxy, сформированное в папке «[основной каталог решения]\DiscoveryProxy\bin\debug».</span><span class="sxs-lookup"><span data-stu-id="17685-140">First run the Discovery Proxy application, generated in [solution base directory]\DiscoveryProxy\bin\debug.</span></span> <span data-ttu-id="17685-141">Приложение Discovery Proxy необходимо запустить первым, поскольку конечные точки объявлений TCP должны работать, чтобы служба могла отправлять свои объявления.</span><span class="sxs-lookup"><span data-stu-id="17685-141">The Discovery Proxy must run first because TCP announcement endpoints must be up for the service to send its announcements.</span></span>  
  
3.  <span data-ttu-id="17685-142">Затем запустите приложение службы, созданное в «[основной каталог решения]\Service\bin\debug».</span><span class="sxs-lookup"><span data-stu-id="17685-142">Second, run the service application generated in [solution base directory]\Service\bin\debug.</span></span> <span data-ttu-id="17685-143">При запуске служба отправляет объявление в конечную точку объявлений прокси-сервера обнаружения и создается в кэше прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="17685-143">At start-up, the service sends an announcement to the announcement endpoint of the discovery proxy and is registered in the proxy’s cache.</span></span>  
  
4.  <span data-ttu-id="17685-144">Затем запустите клиентское приложение, созданное в папке «[основной каталог решения]\Client\bin\debug».</span><span class="sxs-lookup"><span data-stu-id="17685-144">Next, run the client application, generated in [solution base directory]\Client\bin\debug.</span></span> <span data-ttu-id="17685-145">Клиент запрашивает прокси-сервер, возвращает адрес службы, а затем устанавливает с ней соединение.</span><span class="sxs-lookup"><span data-stu-id="17685-145">The client queries the proxy, gets the service address and then connects to the service.</span></span>  
  
5.  <span data-ttu-id="17685-146">Наконец, завершите клиент, службу, а затем и прокси-сервер.</span><span class="sxs-lookup"><span data-stu-id="17685-146">Lastly, terminate the client, service and then the proxy.</span></span> <span data-ttu-id="17685-147">Прокси-сервер должен работать, чтобы он мог получить объявление о выходе службы из сети.</span><span class="sxs-lookup"><span data-stu-id="17685-147">The proxy must be running for it to receive the service's offline announcement.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="17685-148">См. также</span><span class="sxs-lookup"><span data-stu-id="17685-148">See Also</span></span>
