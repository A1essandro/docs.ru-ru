---
title: "Пользовательские критерии поиска"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b2723929-8829-424d-8015-a37ba2ab4f68
caps.latest.revision: "10"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: b57a9535b34441a8f1c86beeffa94046cf8944f7
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2017
---
# <a name="custom-find-criteria"></a>Пользовательские критерии поиска
В этом образце показано, как создать логику сопоставления пользовательских областей и реализовать пользовательскую службу обнаружения. Клиенты используют функции сопоставления пользовательских областей, чтобы расширить функции поиска, предоставляемые системой WCF Discovery. В этом образце реализован следующий сценарий.  
  
1.  Клиент ищет службу калькулятора.  
  
2.  Чтобы уточнить поиск, клиент должен использовать правило сопоставления пользовательских областей.  
  
3.  Согласно этому правилу, служба отвечает клиенту, если ее конечная точка совпадает с любой из областей, указанных клиентом.  
  
## <a name="demonstrates"></a>Демонстрации  
  
-   Создание пользовательской службы обнаружения.  
  
-   Реализация сопоставления пользовательских областей по алгоритму.  
  
## <a name="discussion"></a>Обсуждение  
 Клиент выполняет поиск «Или» тип, соответствующий критериям. Служба отвечает, если области в ее конечных точках совпадают с любыми из областей, предоставленных клиентом. В этом случае клиент ищет службу калькулятора, любая из областей которой принадлежит следующему списку.  
  
1.  `net.tcp://Microsoft.Samples.Discovery/RedmondLocation`  
  
2.  `net.tcp://Microsoft.Samples.Discovery/SeattleLocation`  
  
3.  `net.tcp://Microsoft.Samples.Discovery/PortlandLocation`  
  
 Для этого клиент направляет службы в правило сопоставления пользовательских областей, передавая пользовательскую область по URI. Чтобы упростить сопоставление пользовательских областей, служба должна использовать пользовательскую службу обнаружения, которая поддерживает правило сопоставления пользовательских областей и в которой реализована соответствующая логика сопоставления.  
  
 В клиентском проекте откройте файл Program.cs. Заметьте, что в поле `ScopeMatchBy` объекта `FindCriteria` задается определенный URI. Этот идентификатор отправляется в службу. Если служба не поддерживает это правило, то она не обрабатывает клиентский запрос поиска.  
  
 Откройте проект службы. Для реализации пользовательской службы обнаружения используются три файла.  
  
1.  **AsyncResult.cs**: это реализация `AsyncResult` , необходимые при использовании методов обнаружения.  
  
2.  **CustomDiscoveryService.cs**: этот файл реализует пользовательскую службу обнаружения. В реализации расширяется класс <xref:System.ServiceModel.Discovery.DiscoveryService> и переопределяются необходимые методы. Обратите внимание на реализацию метода <xref:System.ServiceModel.Discovery.DiscoveryService.OnBeginFind%2A>. Метод проверяет, задано ли клиентом правило сопоставления пользовательских областей. Это тот же пользовательский URI, который клиент указывал ранее. Если указано пользовательское правило, следует путь кода, в которой реализована логика сопоставления «Или».  
  
     Эта пользовательская логика проходит по всем областям в каждой из конечных точек, входящих в службу. Если области конечной точки совпадают с любыми из областей, указанных клиентом, служба обнаружения добавляет конечную точку в ответ, который отправляется обратно клиенту.  
  
3.  **CustomDiscoveryExtension.cs**: последний шаг в реализации службы обнаружения является подключение этой реализации пользовательской службы обнаружения к узлу службы. Здесь используется вспомогательный класс `CustomDiscoveryExtension`. Этот класс расширяет класс <xref:System.ServiceModel.Discovery.DiscoveryServiceExtension>. Пользователь должен переопределить метод <xref:System.ServiceModel.Discovery.DiscoveryServiceExtension.GetDiscoveryService%2A>. В этом случае метод возвращает экземпляр пользовательской службы обнаружения, который был создан ранее. `PublishedEndpoints` - коллекция <xref:System.Collections.ObjectModel.ReadOnlyCollection%601>, которая содержит все конечные точки приложения, добавленные в <xref:System.ServiceModel.ServiceHost>. Пользовательская служба обнаружения использует эту коллекцию для заполнения внутреннего списка. Пользователь может добавлять и другие метаданные конечных точек.  
  
 Наконец, откройте файл Program.cs. Заметьте, что в узел добавляются объекты <xref:System.ServiceModel.Discovery.ServiceDiscoveryBehavior> и `CustomDiscoveryExtension`. После этого, когда в узле есть конечная точка, через которую принимаются сообщения обнаружения, приложение может использовать пользовательскую службу обнаружения.  
  
 Заметьте, что клиенту удается найти службу, не зная ее адреса.  
  
#### <a name="to-set-up-build-and-run-the-sample"></a>Настройка, сборка и выполнение образца  
  
1.  Откройте решение, содержащее проект.  
  
2.  Выполните построение проекта.  
  
3.  Запустите приложение службы.  
  
4.  Запустите клиентское приложение.  
  
> [!IMPORTANT]
>  Образцы уже могут быть установлены на компьютере. Перед продолжением проверьте следующий каталог (по умолчанию).  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  Если этот каталог не существует, перейдите на страницу [Примеры Windows Communication Foundation (WCF) и Windows Workflow Foundation (WF) для .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) , чтобы скачать все примеры [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] . Этот образец расположен в следующем каталоге.  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Discovery\CustomFindCriteria`
