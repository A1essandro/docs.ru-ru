---
title: Использование моста и обработка ошибок
ms.date: 03/30/2017
ms.assetid: 4ae87d1a-b615-4014-a494-a53f63ff0137
ms.openlocfilehash: f13a55704422e8a958e55c489f6db11108b03c90
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
---
# <a name="bridging-and-error-handling"></a>Использование моста и обработка ошибок
В этом примере показано, как служба маршрутизации Windows Communication Foundation (WCF) используется для обеспечения связи между клиентом и службой, которые используют разные привязки. В этом образце также показано, как использовать резервную службу в случае перехода на другой ресурс. Служба маршрутизации - это компонент [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], который упрощает включение маршрутизатора на основе содержимого в приложение. В этом образце стандартный образец [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] Calculator применяется для связи с использованием службы маршрутизации.  
  
> [!IMPORTANT]
>  Образцы уже могут быть установлены на компьютере. Перед продолжением проверьте следующий каталог (по умолчанию).  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  Если этот каталог не существует, перейдите к [Windows Communication Foundation (WCF) и образцы Windows Workflow Foundation (WF) для .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) для загрузки всех Windows Communication Foundation (WCF) и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] образцов. Этот образец расположен в следующем каталоге.  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\RoutingServices\ErrorHandlingAndBridging`  
  
## <a name="sample-details"></a>Подробные сведения об образце  
 В этом образце клиент ская часть калькулятора настраивается для отправки сообщений в конечную точку, доступ к которой предоставляется маршрутизатором. Служба маршрутизации настроена на прием всех отправляемых ей сообщений и перенаправление их в конечную точку, которая соответствует службе калькулятора. Далее приведено описание конфигурации основной службы калькулятора, резервной службы калькулятора и клиентской части калькулятора, а также обеспечения связи между клиентом и службой с помощью службы маршрутизации.  
  
-   Клиентская часть калькулятора настроена для использования BasicHttpBinding, а служба калькулятора - NetTcpBinding. По необходимости служба маршрутизации автоматически преобразует сообщения перед их отправкой службе калькулятора. Она также преобразует ответы с тем, чтобы клиентская часть калькулятора могла получить к ним доступ.  
  
-   Службе маршрутизации известны две службы калькулятора: основная служба калькулятора и резервная служба калькулятора. Сначала служба маршрутизации пытается связаться с конечной точкой основной службы калькулятора. Если эта попытка завершается неудачей, поскольку конечная точка остановлена, то служба маршрутизации пытается связаться с конечной точкой резервной службы калькулятора.  
  
 Таким образом сообщения, отправленные клиентом и полученные маршрутизатором, перенаправляются фактической службе калькулятора. Если конечная точка службы калькулятора остановлена, служба маршрутизации направляет сообщение конечной точке резервной службы калькулятора. Сообщения от резервной службы калькулятора отправляются назад службе маршрутизатора, которая, в свою очередь, передает их клиентской части калькулятора.  
  
> [!NOTE]
>  В списке резервных служб можно указать несколько конечных точек. В этом случае, если конечная точка резервной службы остановлена, служба маршрутизации пытается подключиться к следующей резервной конечной точкой из списка, пока соединение ни будет успешно установлено.  
  
#### <a name="to-use-this-sample"></a>Использование этого образца  
  
1.  Откройте файл RouterBridgingAndErrorHandling.sln с помощью [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)].  
  
2.  В среде Visual Studio нажмите клавишу F5 или сочетание клавиш CTRL+SHIFT+B  
  
    1.  Если вы хотите автоматически загружались все необходимые проекты при нажатии клавиши F5, щелкните правой кнопкой мыши решение, выберите **свойства**и в **запускаемый проект** узле **общие свойства**выберите **несколько запускаемых проектов**и всем проектам задайте значение **запустить**.  
  
    2.  Если проект строится при помощи клавиш CTRL+SHIFT+B, запустите следующие приложения.  
  
        1.  Клиентская часть калькулятора (./CalculatorClient/bin/client.exe)  
  
        2.  Служба калькулятора (./CalculatorService/bin/service.exe)  
  
        3.  Служба маршрутизации (./RoutingService/bin/RoutingService.exe)  
  
3.  В клиентской части калькулятора нажмите клавишу ВВОД, чтобы запустить клиент.  
  
     Должны выводиться следующие данные:  
  
    ```Output  
    Add(100,15.99) = 115.99  
    Subtract(145,76.54) = 68.46  
    Multiply(9,81.25) = 731.25  
    Divide(22,7) = 3.14285714285714  
    ```  
  
## <a name="configurable-via-code-or-appconfig"></a>Настраивается в коде или в файле App.config  
 В поставляемой конфигурации образца поведение маршрутизатора определяется в файле App.config. Кроме того, можно изменить имя файла App.config на другое, чтобы он не был распознан, и удалить метки комментария с вызова метода `ConfigureRouterViaCode()`. Поведение маршрутизатора будет одинаковым для обоих методов.  
  
### <a name="scenario"></a>Сценарий  
 В этом образце демонстрируется маршрутизатор служб, действующий как мост между протоколами и обработчиком ошибок. В этом случае маршрутизация на основе содержимого не выполняется. Служба маршрутизации действует, как прозрачный узел-посредник, настроенный передавать сообщения непосредственно заданному набору конечных точек назначения. Кроме того, служба маршрутизации выполняет дополнительные действия по прозрачной обработке ошибок, возникающих при попытке отправить сообщение в заданные конечные точки. Действуя как мост между протоколами, служба маршрутизации позволяет пользователю определять один протокол для внешней связи, а другой протокол - для внутренней.  
  
### <a name="real-world-scenario"></a>Реальный сценарий  
 Компании Contoso требуется предоставить конечную точку службы для взаимодействия с внешним миром, обеспечив при этом оптимизацию производительности внутри организации. Так, компания предоставляет доступ к своим службам для внешнего мира через конечную точку с использованием BasicHttpBinding. Внутри же организации используется служба маршрутизации для установления соединения с конечной точкой NetTcpBinding, которую используют службы компании. Более того, компания Contoso хочет, чтобы временные сбои не отражались на ее предложении услуг внешним пользователям. Для этого компания виртуализует несколько конечных точек за службой маршрутизации с помощью ее функций обработки ошибок для автоматического перехода на другой ресурс к резервным конечным точкам, когда это необходимо.  
  
## <a name="see-also"></a>См. также  
 [Образцы размещения и сохраняемости образцы](http://go.microsoft.com/fwlink/?LinkId=193961)
