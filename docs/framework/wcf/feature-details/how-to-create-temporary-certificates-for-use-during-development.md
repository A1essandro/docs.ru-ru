---
title: "Практическое руководство. Создание временных сертификатов для использования во время разработки | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework-4.6"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "сертификаты [WCF], создание временных сертификатов"
  - "временные сертификаты [WCF]"
ms.assetid: bc5f6637-5513-4d27-99bb-51aad7741e4a
caps.latest.revision: 14
author: "Erikre"
ms.author: "erikre"
manager: "erikre"
caps.handback.revision: 14
---
# Практическое руководство. Создание временных сертификатов для использования во время разработки
При разработке безопасной службы или клиента с помощью [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] часто необходимо использовать сертификат X.509 в качестве учетных данных. Обычно этот сертификат является частью цепи сертификатов, корневой центр которых находится в хранилище «Доверенные корневые центры сертификации» на компьютере. Наличие цепи сертификатов позволяет ограничить набор сертификатов, корневой центр которых, как правило, принадлежит организации или подразделению. Для эмуляции этого во время разработки можно создать два сертификата, чтобы выполнить требования безопасности. Первый сертификат является самозаверяющим и помещается в хранилище «Доверенные корневые центры сертификации». Второй сертификат создается из первого и помещается как в хранилище «Личное» на локальном компьютере, так и в хранилище «Личное» текущего пользователя. В этом разделе описывается процедура создания этих двух сертификатов с помощью [инструмента для создания сертификатов \(MakeCert.exe\)](http://go.microsoft.com/fwlink/?LinkId=248185) в пакете SDK [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)].  
  
> [!IMPORTANT]
>  Сертификаты, создаваемые средством для создания сертификатов, предоставляются только для проверки. При развертывании службы или клиента убедитесь, что используется соответствующий сертификат, предоставленный центром сертификации. Этот сертификат может предоставляться сервером сертификации [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)] организации или третьей стороны.  
>   
>  По умолчанию [Makecert.exe \(Certificate Creation Tool\)](../Topic/Makecert.exe%20\(Certificate%20Creation%20Tool\).md) создает сертификаты, корневой центр которых называется "Корневое агентство**".** Поскольку «Корневое агентство» не является хранилищем «Доверенные корневые центры сертификации», сертификаты не защищены. Создание самозаверяющего сертификата, помещенного в хранилище «Доверенные корневые центры сертификации», позволяет создать среду разработки, более точно моделирующую среду развертывания.  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)] создании и использовании сертификатов см. в разделе [Работа с сертификатами](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).[!INCLUDE[crabout](../../../../includes/crabout-md.md)] использовании сертификата в качестве учетных данных см. в разделе [Защита служб и клиентов](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md). Руководство по использованию технологии Microsoft Authenticode см. в разделе, посвященном [общим сведениям и учебникам по Authenticode](http://go.microsoft.com/fwlink/?LinkId=88919).  
  
### Создание самозаверяющего сертификата корневого центра и экспорт закрытого ключа  
  
1.  Используйте средство MakeCert.exe со следующими коммутаторами.  
  
    1.  `-n` `subjectName`. Задает имя субъекта. Согласно правилам, к имени субъекта добавляется префикс "CN \= " для "Common Name".  
  
    2.  `-r`. Указывает, что сертификат самозаверяющий.  
  
    3.  `-sv` `privateKeyFile`. Указывает файл, содержащий контейнер закрытого ключа.  
  
     Например, следующая команда создает самозаверяющий сертификат с именем субъекта "CN\=TempCA".  
  
    ```  
    makecert -n "CN=TempCA" -r -sv TempCA.pvk TempCA.cer  
    ```  
  
     Будет предложено указать пароль для защиты закрытого ключа. Этот пароль необходим при создании сертификата, подписанного этим корневым сертификатом.  
  
### Создание нового сертификата, подписанного сертификатом корневого центра  
  
1.  Используйте средство MakeCert.exe со следующими коммутаторами.  
  
    1.  `-sk` `subjectKey`. Расположение контейнера ключей субъекта, содержащего закрытый ключ. Если контейнер ключей не существует, он будет создан. Если ни один из параметров \(\-sk и sv\) не используется, контейнер ключей с именем JoeSoft создается по умолчанию.  
  
    2.  `-n` `subjectName`. Задает имя субъекта. Согласно правилам, к имени субъекта добавляется префикс "CN \= " для "Common Name".  
  
    3.  `-iv` `issuerKeyFile`. Задает файл закрытого ключа издателя.  
  
    4.  `-ic` `issuerCertFile`. Задает расположение сертификата издателя.  
  
     Например, следующая команда создает сертификат, подписанный сертификатом корневого центра `TempCA`, с именем субъекта `"CN=SignedByCA"`, используя закрытый ключ издателя.  
  
    ```  
    makecert -sk SignedByCA -iv TempCA.pvk -n "CN=SignedByCA" -ic TempCA.cer SignedByCA.cer -sr currentuser -ss My  
    ```  
  
## Установка сертификата в хранилище «Доверенные корневые центры сертификации»  
 После создания самозаверяющего сертификата его можно установить в хранилище «Доверенные корневые центры сертификации». Компьютер доверяет любым сертификатам, подписанным этим сертификатом в этой точке. Поэтому удалите сертификат из хранилища, если он больше не требуется. При удалении этого сертификата корневого центра все другие сертификаты, подписанные им, становятся неавторизованными. Сертификаты корневого центра представляют собой лишь механизм, с помощью которого при необходимости можно ограничить группу сертификатов. Например, в одноранговых приложениях обычно нет необходимости использовать корневой центр, поскольку идентификация отдельного элемента просто доверяется в предоставленном с ним сертификате.  
  
#### Установка самозаверяющего сертификата в хранилище «Доверенные корневые центры сертификации»  
  
1.  Откройте оснастку сертификата.[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)] [Как просматривать сертификаты с помощью оснастки консоли MMC](../../../../docs/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in.md).  
  
2.  Откройте папку, чтобы сохранить сертификат: **Локальный компьютер** либо **Текущий пользователь**.  
  
3.  Откройте папку **Доверенные корневые центры сертификации**.  
  
4.  Щелкните правой кнопкой мыши папку **Сертификаты**, выберите пункт **Все задачи**, а затем выберите **Импортировать**.  
  
5.  Следуйте инструкциям мастера на экране, чтобы импортировать TempCa.cer в хранилище.  
  
## Использование сертификатов с WCF  
 После настройки временных сертификатов их можно использовать для разработки решений WCF, задающих сертификаты как тип учетных данных клиента. Например, в следующей конфигурации XML в качестве типа учетных данных клиента задается безопасность сообщения и сертификат.  
  
#### Задание сертификата как типа учетных данных клиента  
  
-   В файле конфигурации для службы используйте следующий XML, чтобы настроить режим безопасности сообщения и задать тип учетных данных клиента для сертификата.  
  
    ```xml  
    <bindings>       
      <wsHttpBinding>  
        <binding name="CertificateForClient">  
          <security>  
            <message clientCredentialType="Certificate" />  
          </security>  
        </binding>  
      </wsHttpBinding>  
    </bindings>  
  
    ```  
  
 В файле конфигурации для клиента используйте следующий XML для указания того, что сертификат найден в хранилище пользователя и может быть найден посредством поиска значения "CohoWinery" в поле SubjectName.  
  
```xml  
  
<behaviors>  
  <endpointBehaviors>  
    <behavior name="CertForClient">  
      <clientCredentials>  
        <clientCertificate findValue="CohoWinery" x509FindType="FindBySubjectName" />  
       </clientCredentials>  
     </behavior>  
   </endpointBehaviors>  
</behaviors>  
```  
  
 Дополнительные сведения об использовании сертификатов в WCF см. в разделе [Работа с сертификатами](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).  
  
## Безопасность платформы .NET Framework  
 Не забудьте удалить любые временные сертификаты корневого центра из папки **Доверенные корневые центры сертификации** и папки **Личное**, щелкнув правой кнопкой мыши сертификат и выбрав **Удалить**.  
  
## См. также  
 [Работа с сертификатами](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)   
 [Как просматривать сертификаты с помощью оснастки консоли MMC](../../../../docs/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in.md)   
 [Защита служб и клиентов](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)