---
title: "Использование клиентского канала обнаружения"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 1494242a-1d64-4035-8ecd-eb4f06c8d2ba
caps.latest.revision: "6"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 9d0aede489c6b5db029a9df37f84d0a067bbf836
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="using-the-discovery-client-channel"></a><span data-ttu-id="76d84-102">Использование клиентского канала обнаружения</span><span class="sxs-lookup"><span data-stu-id="76d84-102">Using the Discovery Client Channel</span></span>
<span data-ttu-id="76d84-103">При написании клиентского приложения WCF необходимо знать адрес конечной точки вызываемой службы.</span><span class="sxs-lookup"><span data-stu-id="76d84-103">When writing a WCF client application you need to know the endpoint address of the service you are calling.</span></span> <span data-ttu-id="76d84-104">Во многих случаях адрес конечной точки службы неизвестен заранее или может измениться со временем.</span><span class="sxs-lookup"><span data-stu-id="76d84-104">In many situations the endpoint address of a service is not known in advance or the address of the service changes over time.</span></span> <span data-ttu-id="76d84-105">Клиентский канал обнаружения позволяет создать клиентское приложение WCF, описать службу, которую необходимо вызвать, после чего клиентский канал автоматически отправит зондирующий запрос.</span><span class="sxs-lookup"><span data-stu-id="76d84-105">The Discovery Client Channel allows you to write a WCF client application, describe the service you want to call, and the client channel automatically sends a probe request.</span></span> <span data-ttu-id="76d84-106">После ответа службы клиентский канал обнаружения извлекает адрес конечной точки службы из ответа запроса и пользуется им для вызова службы.</span><span class="sxs-lookup"><span data-stu-id="76d84-106">When a service responds, the discovery client channel retrieves the endpoint address for the service from the probe response and uses it to call the service.</span></span>  
  
## <a name="using-the-discovery-client-channel"></a><span data-ttu-id="76d84-107">Использование клиентского канала обнаружения</span><span class="sxs-lookup"><span data-stu-id="76d84-107">Using the Discovery Client Channel</span></span>  
 <span data-ttu-id="76d84-108">Чтобы задействовать клиентский канал обнаружения, добавьте экземпляр <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> в стек клиентских каналов.</span><span class="sxs-lookup"><span data-stu-id="76d84-108">To use the Discovery Client Channel, add an instance of the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> to your client channel stack.</span></span> <span data-ttu-id="76d84-109">Можно также использовать конечную точку <xref:System.ServiceModel.Discovery.DynamicEndpoint>, в этом случае элемент <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> будет автоматически добавляться к привязке, если он еще не присутствует.</span><span class="sxs-lookup"><span data-stu-id="76d84-109">Alternatively you can use the <xref:System.ServiceModel.Discovery.DynamicEndpoint> and a <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is automatically added to your binding if not already present.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="76d84-110">Рекомендуется в качестве самого верхнего элемента в стеке клиентских каналов задать <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="76d84-110">It is recommended that the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is the top-most element on your client channel stack.</span></span> <span data-ttu-id="76d84-111">Для всех элементов привязки, добавляемых поверх <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement>, убедитесь, что ни <xref:System.ServiceModel.ChannelFactory>, ни создаваемый им канал не используют адрес конечной точки или адрес `Via` (передаваемый методу `CreateChannel`), поскольку правильный адрес в них может отсутствовать.</span><span class="sxs-lookup"><span data-stu-id="76d84-111">Any binding element that is added on top of the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must make sure that the <xref:System.ServiceModel.ChannelFactory> or channel it creates does not use the endpoint address or `Via` address (passed to the `CreateChannel` method) because they may not contain the correct address.</span></span>  
  
 <span data-ttu-id="76d84-112">Класс <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> содержит два открытых свойства.</span><span class="sxs-lookup"><span data-stu-id="76d84-112">The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> class contains two public properties:</span></span>  
  
1.  <span data-ttu-id="76d84-113"><xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A>, которое используется для описания вызываемой службы.</span><span class="sxs-lookup"><span data-stu-id="76d84-113"><xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A>, which is used to describe the service you want to call.</span></span>  
  
2.  <!--zz <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpoint%2A>  --> `DiscoveryEndpoint`, which specifies the discovery endpoint to send discovery messages to.  
  
 <span data-ttu-id="76d84-114">Свойство <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A> позволяет указать искомый контракт службы, все необходимые URI области и максимальное количество попыток открытия канала.</span><span class="sxs-lookup"><span data-stu-id="76d84-114">The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A> property allows you to specify the service contract you are searching for, any required scope URIs, and the maximum number of time to attempt to open the channel.</span></span> <span data-ttu-id="76d84-115">Тип контракта указывается путем вызова конструктора <<!--zz <xref:System.ServiceModel.Discovery.FindCriteria%2A>  --> `FindCriteria`>.</span><span class="sxs-lookup"><span data-stu-id="76d84-115">The contract type is specified by calling the constructor <<!--zz <xref:System.ServiceModel.Discovery.FindCriteria%2A>  --> `FindCriteria`> .</span></span> <span data-ttu-id="76d84-116">URI области могут быть добавлены в свойство <xref:System.ServiceModel.Discovery.FindCriteria.Scopes%2A>.</span><span class="sxs-lookup"><span data-stu-id="76d84-116">Scope URIs can be added to the <xref:System.ServiceModel.Discovery.FindCriteria.Scopes%2A> property.</span></span> <span data-ttu-id="76d84-117">Свойство <xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A> позволяет задать максимальное количество результатов, с которыми клиент пытается установить соединение.</span><span class="sxs-lookup"><span data-stu-id="76d84-117">The <xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A> property allows you to specify the maximum number of results to which the client tries to connect to.</span></span> <span data-ttu-id="76d84-118">При получении ответа на зондирующий запрос клиент выполняет попытку открытия канала по адресу конечной точки, полученному из ответа запроса.</span><span class="sxs-lookup"><span data-stu-id="76d84-118">When a probe response is received the client attempts to open the channel using the endpoint address from the probe response.</span></span> <span data-ttu-id="76d84-119">Если возникло исключение, то клиент переходит к следующему ответу зондирующего запроса и при необходимости ожидает получения дополнительных ответов.</span><span class="sxs-lookup"><span data-stu-id="76d84-119">If an exception occurs the client moves on to the next probe response, waiting for more responses to be received if necessary.</span></span> <span data-ttu-id="76d84-120">Это продолжается до тех пор, пока не будет успешно открыт канал или достигнуто максимальное количество результатов.</span><span class="sxs-lookup"><span data-stu-id="76d84-120">It continues to do this until the channel is successfully opened or the maximum number of results is reached.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="76d84-121">Эти параметры в разделе <<!--zz <xref:System.ServiceModel.Discovery.FindCriteria%2A>  --> `FindCriteria`>.</span><span class="sxs-lookup"><span data-stu-id="76d84-121"> these settings, see <<!--zz <xref:System.ServiceModel.Discovery.FindCriteria%2A>  --> `FindCriteria`>.</span></span>  
  
 <span data-ttu-id="76d84-122"><!--zz <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpoint%2A>  --> `DiscoveryEndpoint%2A>` Свойство позволяет указать конечную точку обнаружения для использования.</span><span class="sxs-lookup"><span data-stu-id="76d84-122">The <!--zz <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpoint%2A>  --> `DiscoveryEndpoint%2A>` property allows you to specify the discovery endpoint to use.</span></span> <span data-ttu-id="76d84-123">Обычно это <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>, но может быть также использована любая действительная конечная точка.</span><span class="sxs-lookup"><span data-stu-id="76d84-123">Normally this is a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>, but it can be any valid endpoint.</span></span>  
  
 <span data-ttu-id="76d84-124">При создании привязки для взаимодействия со службой должна быть указана та же привязку, что и в службе.</span><span class="sxs-lookup"><span data-stu-id="76d84-124">When you are creating the binding to use to communicate with the service, you must be careful to use the exact same binding as the service.</span></span> <span data-ttu-id="76d84-125">Единственное различие заключается в том, что привязка клиента содержит <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> в вершине стека.</span><span class="sxs-lookup"><span data-stu-id="76d84-125">The only difference is the client binding has a <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> on the top of the stack.</span></span> <span data-ttu-id="76d84-126">Если служба использует одну из привязок, предоставленных системой, создайте новую <xref:System.ServiceModel.Channels.CustomBinding> и передайте привязку, предоставленную системой, конструктору <!--zz <xref:System.ServiceModel.CustomBinding.CustomBinding%2A> `CustomBinding` -->.</span><span class="sxs-lookup"><span data-stu-id="76d84-126">If service is using one of the system-provided bindings, create a new <xref:System.ServiceModel.Channels.CustomBinding> and pass in the system-provided binding to the <!--zz <xref:System.ServiceModel.CustomBinding.CustomBinding%2A> `CustomBinding` --> constructor.</span></span> <span data-ttu-id="76d84-127">Затем можно добавить <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> путем вызова `Insert` на <!--zz <xref:System.ServiceModel.Channels.Binding.Elements%2A> --> `Elements` свойство.</span><span class="sxs-lookup"><span data-stu-id="76d84-127">Then you can add the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> by calling `Insert` on the <!--zz <xref:System.ServiceModel.Channels.Binding.Elements%2A> --> `Elements` property.</span></span>  
  
 <span data-ttu-id="76d84-128">После добавления к привязке и настройки <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> можно создать экземпляр класса клиента WCF, открыть его и обращаться к его методам.</span><span class="sxs-lookup"><span data-stu-id="76d84-128">Once you have added the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> to your binding and configured it, you can create an instance of the WCF client class, open it, and call its methods.</span></span> <span data-ttu-id="76d84-129">В следующем примере показан клиентский канал обнаружения для обнаружения службы WCF, которая реализует класс `ICalculator` (используется в учебнике «Приступая к работе с WCF») и вызывает его метод `Add`.</span><span class="sxs-lookup"><span data-stu-id="76d84-129">The following example uses the Discovery Client Channel to discover a WCF service that implements the `ICalculator` class (used in the Getting Started WCF tutorial) and calls its `Add` method.</span></span>  
  
```  
// Create the DiscoveryClientBindingElement  
DiscoveryClientBindingElement bindingElement = new DiscoveryClientBindingElement();  
// Search for a service that implements the ICalculator interface, attempting to open  
// the channel a maximum of 2 times  
bindingElement.FindCriteria = new FindCriteria(typeof(ICalculator)) { MaxResults = 2 };  
// Use the UdpDiscoveryEndpoint  
bindingElement.DiscoveryEndpoint = new UdpDiscoveryEndpoint();  
  
// The service uses the BasicHttpBinding, so use that and insert the DiscoveryClientBindingElement at the   
// top of the stack  
CustomBinding binding = new CustomBinding(new BasicHttpBinding());  
binding.Elements.Insert(0,bindingElement);  
  
try  
{  
    // Create the WCF client and call a method  
    CalculatorClient client = new CalculatorClient(binding, new EndpointAddress("http://schemas.microsoft.com/dynamic"));  
    client.Open();  
    client.Add(1, 1);  
}  
catch (EndpointNotFoundException ex)  
{  
    Console.WriteLine("An exception occurred: " + ex.Message);  
}  
```  
  
## <a name="security-and-the-discovery-client-channel"></a><span data-ttu-id="76d84-130">Безопасность и клиентский канал обнаружения</span><span class="sxs-lookup"><span data-stu-id="76d84-130">Security and the Discovery Client Channel</span></span>  
 <span data-ttu-id="76d84-131">При использовании клиентского канала обнаружения указываются две конечные точки.</span><span class="sxs-lookup"><span data-stu-id="76d84-131">When using the discovery client channel, two endpoints are being specified.</span></span> <span data-ttu-id="76d84-132">Одна из этих точек служит для передачи сообщений обнаружения (обычно это <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>), а другая является конечной точкой приложения.</span><span class="sxs-lookup"><span data-stu-id="76d84-132">One is used for discovery messages, usually <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>, and the other is the application endpoint.</span></span> <span data-ttu-id="76d84-133">При реализации службы безопасности необходимо соблюдать предосторожность и защищать обе конечные точки.</span><span class="sxs-lookup"><span data-stu-id="76d84-133">When implementing a secure service, care must be taken to secure both endpoints.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="76d84-134">безопасность, в разделе [Защита служб и клиентов](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md).</span><span class="sxs-lookup"><span data-stu-id="76d84-134"> security, see [Securing Services and Clients](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md).</span></span>
