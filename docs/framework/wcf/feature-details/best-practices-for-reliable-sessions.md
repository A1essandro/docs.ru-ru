---
title: "Рекомендации по работе с надежными сеансами | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: b94f6e01-8070-40b6-aac7-a2cb7b4cb4f2
caps.latest.revision: 6
author: "Erikre"
ms.author: "erikre"
manager: "erikre"
caps.handback.revision: 6
---
# Рекомендации по работе с надежными сеансами
В этом разделе приводятся рекомендации по работе с надежными сеансами.  
  
## Установка MaxTransferWindowSize  
 Надежные сеансы в [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] используют окно передачи для хранения сообщений в клиенте или в службе.  Настраиваемое свойство <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> указывает количество сообщений, которое может храниться в окне передачи.  
  
 На стороне отправителя оно указывает количество сообщений, которое может храниться в окне передачи во время ожидания подтверждения. На стороне получателя оно указывает количество сообщений для буферизации в службе.  
  
 Выбор правильного размера влияет на эффективность использования сети и оптимальную производительность, с которой выполняется служба.  В следующих разделах приводятся подробные сведения о том, что необходимо учитывать при выборе значения для этого свойства, и о влиянии этого значения.  
  
 Размер окна передачи по умолчанию составляет 8 сообщений.  
  
### Эффективное использование сети  
 В данном случае термин *сеть* соответствует всему, что используется в качестве основы связи между клиентом \(отправителем\) и службой \(получателем\).  Сюда входят подключения транспорта и любые промежуточные компоненты или мосты между ними, включая маршрутизаторы SOAP, прокси\-серверы HTTP или брандмауэры.  
  
 Эффективное использование сети обеспечивает максимальные возможности сети.  На эффективность использования сети влияет как объем данных, который может быть передан в секунду по сети \(называемый *скоростью передачи данных*\), так и время, затрачиваемое на передачу данных от отправителя к получателю \(называемое *задержкой*\).  
  
 На стороне отправителя свойство <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> указывает количество сообщений, которое может храниться в его окне передачи во время ожидания подтверждения.  Таким образом, при высокой задержке сети для обеспечения ответа отправителя и эффективного использования сети необходимо увеличить размер окна передачи.  
  
 Например, даже если отправитель поддерживает скорость передачи данных, задержка может быть высокой, если между отправителем и получателем существует несколько посредников, либо в случае промежуточных компонентов или сетей с потерями.  Таким образом, отправитель должен ждать подтверждения сообщений, находящихся в его окне передачи, прежде чем принять новые сообщения для отправки по сети.  Чем меньше буфер при высокой задержке, тем меньше эффективность использования сети.  С другой стороны, слишком большой размер окна передачи может повлиять на службу, поскольку ей может потребоваться поддерживать высокую скорость передачи данных от клиента.  
  
### Выполнение службы с оптимальной производительностью  
 Как бы эффективно ни использовалась сеть, в идеальном случае требуется, чтобы служба также выполнялась с максимальной производительностью.  Свойство размера окна передачи на стороне получателя указывает количество сообщений, которое получатель может поместить в буфер.  Такая буферизация сообщений помогает не только управлять потоком в сети, но и обеспечивает выполнение службы с максимальной производительностью.  Например, если буфер 1, а скорость поступления сообщений выше скорости их обработки службой, сообщения в сети могут быть удалены, и емкость сети может использоваться напрасно или неполностью.  
  
 При использовании буфера повышается доступность службы, поскольку она одновременно получает и отправляет в буфер сообщение во время обработки полученных ранее сообщений.  
  
 Рекомендуется использовать одинаковый размер окна передачи `MaxTransferWindowSize` как со стороны отправителя, так и со стороны получателя.  
  
### Включение управления потоком  
 Управление потоком \- это механизм, обеспечивающий одинаковую скорость работы отправителя и получателя, т. е. сообщения принимаются и обрабатываются с той же скоростью, с какой создаются.  Размер окна передачи со стороны клиента и службы гарантирует, что отправитель и получатель находятся в разумном окне синхронизации.  
  
 Настоятельно рекомендуется присвоить свойству <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> значение true при установке надежного сеанса между клиентом [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] и службой [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].  
  
## Установка MaxPendingChannels  
 При записи службы, обеспечивающей надежный сеанс передачи данных от разных клиентов, можно задать многим клиентам установить надежный сеанс с одной службой одновременно.  Ответ службы в таких ситуациях зависит от свойства `MaxPendingChannels`.  
  
 Когда отправитель создает канал надежного сеанса для связи с получателем, после подтверждения между ними устанавливается надежный сеанс.  После установки надежного сеанса канал помещается в очередь ожидающих каналов для принятия службой.  Свойство `MaxPendingChannels` указывает количество каналов, которые могут находиться в этом состоянии.  
  
 Служба может находиться в состоянии, в котором она больше не может принимать каналы.  Если очередь заполнена, попытка установки надежного сеанса отклоняется, и клиент должен повторить попытку.  
  
 Также возможна ситуация, когда ожидающие каналы в очереди остаются в ней слишком долго.  Между тем, время ожидания простоя в надежном сеансе может закончиться, в результате чего канал перейдет в состояние сбоя.  
  
 Следовательно, при записи службы, обслуживающей несколько клиентов одновременно, необходимо задать подходящее значение.  Если задать слишком высокое значение для свойства `MaxPendingChannels`, это отрицательно повлияет на рабочий набор.  
  
 Значение по умолчанию для <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> равно 4.  
  
## Надежные сеансы и размещение  
 При размещении на веб\-сервере службы, использующей надежные сеансы, необходимо помнить о следующем.  
  
-   В надежных сеансах можно отследить состояние, которое поддерживается в домене приложения.  Это значит, что все сообщения, являющиеся частью надежного сеанса, необходимо обрабатывать в том же домене приложения.  Веб\-фермы и веб\-сады с размером фермы или сада \> 1 не могут гарантировать соблюдение этого ограничения.  
  
-   Для надежных сеансов, использующих двунаправленные каналы HTTP \(например, использующие `WsDualHttpBinding`\) могут потребоваться дополнительные HTTP\-соединения помимо 2 соединений по умолчанию на одного клиента.  Это значит, что для дуплексного надежного сеанса требуется до 2 соединений в каждую сторону, поскольку сообщения приложения и протокола могут одновременно передаваться в каждую сторону в любой момент.  Это значит, что при определенных условиях, в зависимости от шаблона обмена сообщениями службы, можно взаимозаблокировать службу, размещенную на веб\-сервере, с помощью двойных каналов HTTP и надежных сеансов.  Чтобы увеличить количество допустимых HTTP\-соединений на клиента, добавьте следующее в соответствующий файл конфигурации \(например, файл web.config данной службы.\)  
  
```  
<configuration>  
   <system.net>  
      <connectionManagement>  
         <add name = "*" maxconnection = "XX" />  
      </connectionManagement>  
   </system.net>  
</configuration>  
```  
  
 Где "XX" \- количество требуемых соединений.  В этом случае минимальное количество должно составлять 4.