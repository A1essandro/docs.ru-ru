---
title: "Аудит событий безопасности | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "аудит событий безопасности [WCF]"
ms.assetid: 5633f61c-a3c9-40dd-8070-1c373b66a716
caps.latest.revision: 27
author: "BrucePerlerMS"
ms.author: "bruceper"
manager: "mbaldwin"
caps.handback.revision: 27
---
# Аудит событий безопасности
Приложения, созданные с помощью [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)], могут регистрировать в журнале события, связанные с безопасностью \(успешно, сбой или оба\), используя функцию аудита.События записываются в журнал системных событий Windows, и их можно просматривать при помощи средства просмотра событий.  
  
 Аудит позволяет администраторам обнаруживать уже законченную или происходящую атаку.Кроме того, аудит может помочь разработчику при отладке неполадок, связанных с безопасностью.Например, если в результате ошибки в конфигурации авторизации или политики проверки авторизованному пользователю было отказано в доступе, разработчик может быстро найти и понять причину такой ошибки, изучив журнал событий.  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)] о безопасности в [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] см. в разделе [Общие сведения о безопасности](../../../../docs/framework/wcf/feature-details/security-overview.md).[!INCLUDE[crabout](../../../../includes/crabout-md.md)] о программировании [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] см. в разделе [Базовое программирование WCF](../../../../docs/framework/wcf/basic-wcf-programming.md).  
  
## Уровень и поведение аудита  
 Предусмотрены два уровня аудита безопасности.  
  
-   Уровень авторизации службы, на котором производится авторизация вызывающего абонента.  
  
-   Уровень сообщений, на котором [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] проверяет допустимость сообщений и проверяет подлинность вызывающего абонента.  
  
 Можно проверить результаты аудита обеих уровней \(успех или ошибка\), что называется *поведением аудита*.  
  
## Расположение журнала аудита  
 После определения уровня и поведения аудита, вы \(или администратор\) можете задать расположение журнала аудита.Доступны три варианта: журнал по умолчанию, журнал приложения и журнал безопасности.Если задан журнал по умолчанию, фактический журнал зависит от используемой системы и от того, поддерживает ли система запись в журнал безопасности.[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)] в подразделе «Операционная система» далее в этом разделе.  
  
 Для записи в журнал безопасности требуются привилегии `SeAuditPrivilege`.По умолчанию этой привилегией обладают только учетные записи Local System и Network Service.Для управления функциями `read` и `delete` журнала безопасности требуются привилегии `SeSecurityPrivilege`.По умолчанию эту привилегию имеют только администраторы.  
  
 В отличие от этого, авторизованные пользователи могут производить чтение и запись журнала приложений.[!INCLUDE[wxp](../../../../includes/wxp-md.md)] по умолчанию записывает события аудита в журнал приложения.Этот журнал может также содержать персональный сведения, видимые всем авторизованным пользователям.  
  
## Подавление сбоев аудита  
 При аудите можно также выбрать, следует ли подавлять сбои аудита.По умолчанию сбой аудита не влияет на приложение.Однако при необходимости можно задать для этого параметра значение `false`, что приводит к возникновению исключения.  
  
## Программирование аудита  
 Поведение аудита можно задавать либо путем программирования, либо через конфигурацию.  
  
### Классы аудита  
 В приведенной ниже таблице описаны классы и свойства, используемые для программирования поведения аудита.  
  
|Класс|Описание|  
|-----------|--------------|  
|<xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior>|Позволяет задавать параметры аудита в виде поведения службы.|  
|<xref:System.ServiceModel.AuditLogLocation>|Перечисление для задания журнала, в который требуется производить запись.Предусмотрены значения Default, Application и Security.Если выбрано значение Default, фактическое расположение журнала определяется операционной системой.См. подраздел "Выбор журнала приложения или журнала безопасности" ниже в этом разделе.|  
|<xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.MessageAuthenticationAuditLevel%2A>|Задает тип событий проверки подлинности сообщений для аудита на уровне сообщения.Предусмотрены варианты `None`, `Failure`, `Success` и `SuccessOrFailure`.|  
|<xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.ServiceAuthorizationAuditLevel%2A>|Задает тип событий авторизации службы для аудита на уровне службы.Предусмотрены варианты `None`, `Failure`, `Success` и `SuccessOrFailure`.|  
|<xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.SuppressAuditFailure%2A>|Задает, что происходит с запросом клиента в случае сбоя аудита.Например, если служба пытается произвести запись в журнал безопасности, но не имеет привилегий `SeAuditPrivilege`.Значение по умолчанию `true` означает, что сбои игнорируются и запрос клиента обрабатывается обычным образом.|  
  
 Пример настройки приложения для регистрации событий аудита см. в разделе [Практическое руководство. Аудит событий безопасности](../../../../docs/framework/wcf/feature-details/how-to-audit-wcf-security-events.md).  
  
### Конфигурация  
 Для задания поведения аудита можно также использовать конфигурацию, добавив [\<serviceSecurityAudit\>](../../../../docs/framework/configure-apps/file-schema/wcf/servicesecurityaudit.md) в [\<поведения\>](../../../../docs/framework/configure-apps/file-schema/wcf/behaviors.md).Этот элемент должен быть добавлен в [\<поведение\>](../../../../docs/framework/configure-apps/file-schema/wcf/behavior-of-endpointbehaviors.md), как показано в следующем коде.  
  
```  
<configuration>  
  <system.serviceModel>  
    <behaviors>  
      <behavior>  
        <!— auditLogLocation="Application" or "Security" -—>  
        <serviceSecurityAudit  
                  auditLogLocation="Application"  
                  suppressAuditFailure="true"  
                  serviceAuthorizationAuditLevel="Failure"  
                  messageAuthenticationAuditLevel="SuccessOrFailure" />   
      </behavior>  
    </behaviors>  
  </system.serviceModel>  
</configuration>  
```  
  
 Если аудит включен и параметр `auditLogLocation` не задан, для систем, поддерживающих запись в журнал безопасности, по умолчанию используется журнал "Security"; в противном случае используется журнал "Application".Только операционные системы [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)] и [!INCLUDE[wv](../../../../includes/wv-md.md)] поддерживают запись в журнал безопасности.[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)] в подразделе «Операционная система» далее в этом разделе.  
  
## Вопросы безопасности  
 Если злоумышленник знает о том, что включен аудит, он может отправить недопустимые сообщения, приводящие к внесению записей аудита в журнал.Если это приводит к заполнению журнала аудита, система аудита дает сбой.Для решения этой проблемы задайте свойству <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.SuppressAuditFailure%2A> значение `true` и используйте свойства средства «Просмотр событий» для управления поведением аудита.[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)] в статье службы поддержки Майкрософт, посвященной просмотру и управлению журналами событий с помощью оснастки «Просмотр событий» в Windows XP, статья [Как просматривать и управлять журналами событий в средстве «Просмотр событий» в Windows XP](http://go.microsoft.com/fwlink/?LinkId=89150).  
  
 События аудита, записанные в журнал приложения в [!INCLUDE[wxp](../../../../includes/wxp-md.md)], видны всем авторизованным пользователям.  
  
## Выбор журнала событий приложения или журнала событий безопасности  
 В приведенной ниже таблице приведены сведения, помогающие выбрать журнал для записи событий — журнал событий приложения или журнал событий безопасности.  
  
#### Операционная система  
  
|Система|Журнал приложения|Журнал безопасности|  
|-------------|-----------------------|-------------------------|  
|[!INCLUDE[wxpsp2](../../../../includes/wxpsp2-md.md)] или более поздняя версия|Поддерживается|Не поддерживается|  
|[!INCLUDE[ws2003sp1](../../../../includes/ws2003sp1-md.md)] и [!INCLUDE[wv](../../../../includes/wv-md.md)]|Поддерживается|Контекст потока должен обладать привилегиями `SeAuditPrivilege`|  
  
#### Прочие факторы  
 В дополнение к операционной системе, в следующей таблице описываются другие параметры, влияющие на разрешение регистрации.  
  
|Фактор|Журнал приложения|Журнал безопасности|  
|------------|-----------------------|-------------------------|  
|Управление политикой аудита|Неприменимо.|Помимо конфигурации, журнал безопасности управляется также политикой администратора локальной безопасности \(LSA\).Необходимо также разрешить категорию "Аудит доступа к объектам".|  
|Взаимодействие с пользователем по умолчанию|Все авторизованные пользователи могут производить запись в журнал приложения, поэтому для процессов приложения никакие дополнительные шаги, связанные с разрешениями, не требуются.|Процесс приложения \(контекст\) должен иметь привилегии `SeAuditPrivilege`.|  
  
## См. также  
 <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior>   
 <xref:System.ServiceModel.AuditLogLocation>   
 [Общие сведения о безопасности](../../../../docs/framework/wcf/feature-details/security-overview.md)   
 [Базовое программирование WCF](../../../../docs/framework/wcf/basic-wcf-programming.md)   
 [Практическое руководство. Аудит событий безопасности](../../../../docs/framework/wcf/feature-details/how-to-audit-wcf-security-events.md)   
 [\<serviceSecurityAudit\>](../../../../docs/framework/configure-apps/file-schema/wcf/servicesecurityaudit.md)   
 [\<поведения\>](../../../../docs/framework/configure-apps/file-schema/wcf/behaviors.md)   
 [Модель безопасности для Windows Server App Fabric](http://go.microsoft.com/fwlink/?LinkID=201279&clcid=0x419)