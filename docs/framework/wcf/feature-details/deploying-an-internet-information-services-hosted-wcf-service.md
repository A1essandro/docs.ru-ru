---
title: Развертывание службы WCF, размещенной в IIS
ms.date: 03/30/2017
ms.assetid: 04ebd329-3fbd-44c3-b3ab-1de3517e27d7
ms.openlocfilehash: b2b58de703a0864ac0666cb4738a95726e28bcaf
ms.sourcegitcommit: 3c1c3ba79895335ff3737934e39372555ca7d6d0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/05/2018
ms.locfileid: "43740105"
---
# <a name="deploying-an-internet-information-services-hosted-wcf-service"></a>Развертывание службы WCF, размещенной в IIS
Разработка и развертывание службы Windows Communication Foundation (WCF), который размещается в Internet Information Services (IIS) состоит из следующих задач:  
  
-   Убедитесь, что службы IIS, ASP.NET, WCF и компонента активации WCF службы правильно установлен и зарегистрирован.  
  
-   Создание нового приложения IIS или повторное использование существующего приложения [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] .  
  
-   Создание SVC-файла для службы WCF.  
  
-   Развертывание реализации службы в приложение IIS.  
  
-   Настройка службы WCF.  
  
 Подробное пошаговое руководство для создания службы WCF, размещенной в IIS, см. в разделе [как: размещение службы WCF в IIS](../../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-iis.md).  
  
## <a name="ensure-that-iis-aspnet-and-wcf-are-correctly-installed-and-registered"></a>Проверка правильности установки и регистрации IIS, ASP.NET и WCF  
 Для правильного функционирования служб WCF, размещенной в IIS необходимо установить WCF, IIS и ASP.NET. Процедуры установки WCF (как часть [!INCLUDE[vstecwinfx](../../../../includes/vstecwinfx-md.md)]), ASP.NET и IIS зависят от используемой версии операционной системы. Дополнительные сведения об установке WCF и [!INCLUDE[vstecwinfx](../../../../includes/vstecwinfx-md.md)], см. в разделе [веб-установщик Microsoft .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=201185). Инструкции по установке IIS можно найти в [установка IIS](https://go.microsoft.com/fwlink/?LinkId=201188).  
  
 В процессе установки [!INCLUDE[vstecwinfx](../../../../includes/vstecwinfx-md.md)] автоматически регистрирует WCF с IIS, если службы IIS уже существует на компьютере. Если IIS устанавливается после [!INCLUDE[vstecwinfx](../../../../includes/vstecwinfx-md.md)], дополнительный шаг необходим для регистрации WCF со службами IIS и [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]. Это можно выполнить указанным ниже способом в зависимости от операционной системы.  
  
-   [!INCLUDE[wxpsp2](../../../../includes/wxpsp2-md.md)], Windows 7, и [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)]: использовать [средство регистрации ServiceModel (ServiceModelReg.exe)](../../../../docs/framework/wcf/servicemodelreg-exe.md) средства для регистрации WCF в IIS: чтобы использовать это средство, введите **/i /x для ServiceModelReg.exe** в Visual Studio командную строку. Можно открыть окно командной строки, щелкнув кнопку «Пуск» и выбрав **Все программы**, **Microsoft Visual Studio 2012**, **Набор средств Visual Studio**и **Командная строка Visual Studio**.  
  
-   [!INCLUDE[wv](../../../../includes/wv-md.md)]: установите подкомпонент "Компоненты активации Windows Communication Foundation" платформы [!INCLUDE[vstecwinfx](../../../../includes/vstecwinfx-md.md)]. Для этого на панели управления щелкните **Установка и удаление программ** и затем **добавить\/удаления компонентов Windows**. При этом активируется **Мастер компонентов Windows**.  
  
-   Windows 7:  
  
 Наконец, необходимо убедиться в том, что среда ASP.NET настроена для использования платформы .NET Framework 4. Для этого запустите средство ASPNET_Regiis с параметром -i. Дополнительные сведения см. в разделе [средство регистрации IIS ASP.NET](https://go.microsoft.com/fwlink/?LinkId=201186)  
  
## <a name="create-a-new-iis-application-or-reuse-an-existing-aspnet-application"></a>Создание нового приложения служб IIS или повторное использование существующего приложения ASP.NET  
 Размещенные в IIS службы WCF должны размещаться внутри приложения IIS. Можно создать новое приложение IIS для размещения служб WCF исключительно. Кроме того, можно развернуть службу WCF в существующие приложения, в котором уже размещено [!INCLUDE[vstecasplong](../../../../includes/vstecasplong-md.md)] содержимого (например, страницы ASPX и веб-службы ASP.NET [ASMX]). Дополнительные сведения об этих параметрах см. в разделе «Размещение WCF Side-by-Side с ASP.NET» и «Размещение служб WCF в режиме совместимости с ASP.NET» разделы в [службы WCF и ASP.NET](../../../../docs/framework/wcf/feature-details/wcf-services-and-aspnet.md).  
  
 Обратите внимание, что [!INCLUDE[iis601](../../../../includes/iis601-md.md)] и более поздние версии периодически перезагружают изолированное приложение объектно-ориентированного программирования. Значение по умолчанию — 1740 минут. Максимальное поддерживаемое значение - 71582 минуты. Этот перезапуск можно отключить. Дополнительные сведения об этом свойстве см. в разделе [PeriodicRestartTime](https://go.microsoft.com/fwlink/?LinkId=109968).  
  
## <a name="create-an-svc-file-for-the-wcf-service"></a>Создание SVC-файла для службы WCF  
 Службы WCF, размещенные в IIS отображаются в виде файлов со специальным содержимым (SVC-файлов) внутри приложения IIS. Эта модель подобна модели, согласно которой страницы ASMX представляются внутри приложения IIS в виде ASMX-файлов. SVC-файл содержит директиву обработки конкретных WCF ([\@ServiceHost](../../../../docs/framework/configure-apps/file-schema/wcf-directive/servicehost.md)), позволяет платформе WCF, размещающая инфраструктура, активировать размещенные службы в ответ на входящие сообщения. В приведенном ниже операторе показан наиболее распространенный синтаксис SVC-файла.  
  
```  
<% @ServiceHost Service="MyNamespace.MyServiceImplementationTypeName" %>  
```  
  
 Он состоит из [ \@ServiceHost](../../../../docs/framework/configure-apps/file-schema/wcf-directive/servicehost.md) директивы и один атрибут, `Service`. Значение атрибута `Service` - имя типа среды CLR реализации службы. Использование этой директивы по существу эквивалентно созданию основного приложения службы с помощью следующего кода.  
  
```csharp  
new ServiceHost( typeof( MyNamespace.MyServiceImplementationTypeName ) );  
```  
  
 Можно также создать дополнительную конфигурацию размещения, например список базовых адресов службы. Кроме того, можно применить пользовательскую фабрику <xref:System.ServiceModel.Activation.ServiceHostFactory> , чтобы расширить директиву для использования с пользовательскими решениями по размещению. Приложения IIS, на которых размещены службы WCF не несем ответственность за управление созданием и временем существования <xref:System.ServiceModel.ServiceHost> экземпляров. Управляемая инфраструктура размещения WCF создает необходимые <xref:System.ServiceModel.ServiceHost> экземпляра динамически при получении первого запроса для SVC-файла. Этот экземпляр не освобождается, пока он не будет явно закрыт кодом или не перезапустится приложение.  
  
 Дополнительные сведения о синтаксисе SVC-файлов см. в разделе [ \@ServiceHost](../../../../docs/framework/configure-apps/file-schema/wcf-directive/servicehost.md).  
  
## <a name="deploy-the-service-implementation-to-the-iis-application"></a>Развертывание реализации службы в приложение IIS  
 Службы WCF, размещенные в IIS использовать ту же модель динамической компиляции, что [!INCLUDE[vstecasplong](../../../../includes/vstecasplong-md.md)]. Так же как [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)], можно развернуть код реализации для служб WCF, размещенной в IIS несколькими способами в разных расположениях следующим образом:  
  
-   В виде предкомпилированного DLL-файла, расположенного в глобальном кэше сборок или в каталоге \bin приложения. Предкомпилированные двоичные файлы не обновляются, пока не будет развернута новая версия библиотеки классов.  
  
-   Как нескомпилированных исходных файлов, расположенных в каталоге \App_Code приложения. Исходные файлы, расположенные в этом каталоге, запрашиваются динамически при обработке первого запроса приложения. Любые изменения в файлах в каталоге \App_Code приводят к перезапуску и повторной компиляции всего приложения при получении следующего запроса.  
  
-   Как нескомпилированные код помещен непосредственно в SVC-файла. Код реализации может быть также размещен в SVC-файле службы после \@Директива ServiceHost. Любые изменения во встроенном коде приводят к перезапуску и повторной компиляции приложения при получении следующего запроса.  
  
 Дополнительные сведения о [!INCLUDE[vstecasplong](../../../../includes/vstecasplong-md.md)] модели компиляции см. в разделе [Общие сведения о компиляции ASP.NET](https://go.microsoft.com/fwlink/?LinkId=94773).  
  
## <a name="configure-the-wcf-service"></a>Настройка службы WCF  
 Службы WCF, размещенных в IIS их конфигурация хранится в файле Web.config приложения. Службы, размещаемые в IIS используйте одинаковых элементов конфигурации и синтаксис, как службы WCF, размещенных вне IIS. Однако для среды размещения IIS присущи следующие ограничения.  
  
-   Базовые адреса размещенных в IIS служб.  
  
-   Приложения, размещение служб WCF за пределами IIS можно управлять базовыми адресами служб, размещенных в них, передав набор базовый адрес URI для <xref:System.ServiceModel.ServiceHost> конструктор или предоставив [ \<узла >](../../../../docs/framework/configure-apps/file-schema/wcf/host.md) элемент в Конфигурация службы. Службы, размещенные в IIS, не могут управлять своими базовыми адресами; базовым адресом службы, размещенной в IIS, является адрес ее SVC-файла.  
  
### <a name="endpoint-addresses-for-iis-hosted-services"></a>Адреса конечных точек для служб, размещенных в IIS  
 Будучи размещенными в IIS, адреса конечных точек всегда считаются относительными для адреса SVC-файла, представляющего службу. Например, если базовый адрес службы WCF является http://localhost/Application1/MyService.svc со следующей конфигурацией конечной точки.  
  
```xml  
<endpoint address="anotherEndpoint" .../>  
```  
  
 Это обеспечивает конечную точку, которая можно связаться по адресу "http://localhost/Application1/MyService.svc/anotherEndpoint«.  
  
 Аналогично, элемент конфигурации конечной точки, используется пустая строка, так как относительный адрес предоставляет конечную точку, доступную в http://localhost/Application1/MyService.svc, который является базовым адресом.  
  
```xml  
<endpoint address="" ... />  
```  
  
 Для конечных точек служб, размещенных в IIS, следует всегда использовать относительные адреса. Предоставляет адрес конечной точки, полный (например, http://localhost/MyService.svc) может привести к ошибкам при развертывании службы, если адрес конечной точки не указывает на IIS-приложения, на котором размещена служба, конечную точку. Использование относительных адресов конечных точек для размещенных служб позволяет избежать таких потенциальных конфликтов.  
  
### <a name="available-transports"></a>Доступные типы транспорта  
 Службы WCF, размещенные в IIS 5.1 и [!INCLUDE[iis601](../../../../includes/iis601-md.md)] ограничены с помощью протокола HTTP для взаимодействия. В этих платформах IIS настройка размещенной службы на использование привязки, отличной от HTTP, приводит к ошибке во время активации службы. Для [!INCLUDE[iisver](../../../../includes/iisver-md.md)]поддерживается транспорт HTTP, Net.TCP, Net.Pipe, Net.MSMQ и msmq.formatname для обратной совместимости с существующими приложениями MSMQ.  
  
### <a name="http-transport-security"></a>Безопасность транспорта HTTP  
 Службы WCF, размещенных в IIS можно воспользоваться HTTP-транспорта (например, HTTPS и HTTP схем проверки подлинности как Basic, Digest и встроенная проверка подлинности Windows) до тех пор, пока виртуальный каталог IIS, которая содержит службу поддерживает Параметры. Параметры безопасности транспорта HTTP в привязке размещенной конечной точки должны соответствовать параметрам безопасности транспорта в виртуальном каталоге IIS, который содержит эту привязку.  
  
 Например конечной точки WCF, настроены для использования дайджест-проверка подлинности HTTP должен находиться в виртуальном каталоге IIS, который также настроен на разрешение дайджест-проверка подлинности HTTP. Несоответствующие сочетания параметров IIS и параметры конечной точки WCF привести к ошибке во время активации службы.  
  
## <a name="see-also"></a>См. также  
 [Размещение в службах IIS](../../../../docs/framework/wcf/feature-details/hosting-in-internet-information-services.md)  
 [Рекомендации по размещению в службах IIS](../../../../docs/framework/wcf/feature-details/internet-information-services-hosting-best-practices.md)  
 [Функции размещения фабрики приложений Windows Server](https://go.microsoft.com/fwlink/?LinkId=201276)
