---
title: Защита сообщений с использованием средств обеспечения безопасности сообщений
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: a17ebe67-836b-4c52-9a81-2c3d58e225ee
caps.latest.revision: 16
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.workload:
- dotnet
ms.openlocfilehash: 088b01151d0471527bbfc2ffa04b5b5064700081
ms.sourcegitcommit: 94d33cadc5ff81d2ac389bf5f26422c227832052
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/30/2018
---
# <a name="securing-messages-using-message-security"></a>Защита сообщений с использованием средств обеспечения безопасности сообщений
В этом разделе рассматриваются механизмы обеспечения безопасности сообщений [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] при использовании <xref:System.ServiceModel.NetMsmqBinding>.  
  
> [!NOTE]
>  Перед чтением с этим разделом рекомендуется ознакомиться с [основные понятия безопасности](../../../../docs/framework/wcf/feature-details/security-concepts.md).  
  
 Следующая иллюстрация представляет концептуальную модель взаимодействия с использованием очередей [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]. Для объяснения принципов безопасности транспорта  
  
 используются следующие терминология и рисунки.  
  
 ![Диаграмма приложения в очереди](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "распределенных очереди фигуры")  
  
 При передачи сообщений из очереди с использованием [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] сообщение [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] прикрепляется к телу сообщения очереди сообщений (MSMQ). В то время как безопасность транспорта обеспечивает безопасность всего сообщения MSMQ, безопасность сообщений (или протокол SOAP) обеспечивает безопасность только тела сообщения MSMQ.  
  
 Ключевым принципом безопасности сообщений является обеспечение безопасности сообщения клиентом для принимающего приложения (службы), в отличие от безопасности транспорта, когда клиент обеспечивает безопасность сообщения для целевой очереди. MSMQ как таковая не участвует в обеспечении безопасности сообщения [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] с помощью безопасности сообщений.  
  
 Безопасность сообщений [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] добавляет заголовки безопасности к сообщениям [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], которые интегрируются с существующими инфраструктурами безопасности, такими как сертификат или протокол Kerberos.  
  
## <a name="message-credential-type"></a>Типы учетных данных сообщений  
 С помощью безопасности сообщений служба и клиент могут предоставить учетные данные для двусторонней проверки подлинности. Включить безопасность сообщений можно, установив для режима <xref:System.ServiceModel.NetMsmqBinding.Security%2A> значение `Message` или `Both` (то есть использование и безопасности транспорта, и безопасности сообщений).  
  
 Служба может использовать свойство <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> для проверки учетных данных, подтверждающих подлинность клиента. Это свойство также может использоваться на последующих этапах авторизации, применяемых службой.  
  
 В этом разделе описываются различные типы учетных данных и их использование с очередями.  
  
### <a name="certificate"></a>Сертификат  
 Этот тип учетных данных сертификата использует сертификат X.509 для идентификации службы и клиента.  
  
 В типичном сценарии доверенный центр сертификации издает действительный сертификат для клиента и службы. Затем устанавливается соединение, клиент проверяет допустимость службы, обращаясь к ее сертификату для определения ее надежности. Аналогичным образом служба обращается к сертификату клиента для проверки надежности клиента.  
  
 Так как очереди отключены от сети, клиент и служба могут быть не подключены к сети одновременно. В таком случае клиент и служба должны обмениваться сертификатами по внештатному каналу. В частности, на основании наличия сертификата службы (который может быть привязан к центру сертификации) в доверенном хранилище клиент должен заключить, что взаимодействие осуществляется с нужной службой. Для проверки подлинности клиента служба использует сертификат X.509, прикрепленный к сообщению, для сопоставления его сертификату проверки подлинности клиента в хранилище. Аналогичным образом сертификат должен быть привязан к центру сертификации.  
  
 На компьютере под управлением Windows имеется несколько типов хранилищ сертификатов. Дополнительные сведения о разных хранилищах см. в разделе [хранилища сертификатов](http://go.microsoft.com/fwlink/?LinkId=87787).  
  
### <a name="windows"></a>Windows  
 Тип учетных данных сообщений Windows использует протокол Kerberos.  
  
 Протокол Kerberos является механизмом обеспечения безопасности, проверяющим подлинность пользователей в домене и позволяющим пользователям, прошедшим проверку подлинности, устанавливать защищенные контексты с другими сущностями в домене.  
  
 Проблема, возникающая при применении протокола Kerberos для взаимодействия с использованием очереди, заключается в том, что билеты с учетной записью клиента, выдаваемые центром распространения ключей (KDC), имеют относительно короткое время существования. Объект *время существования* связано с билетом Kerberos, указывающее срок действия билета. Поэтому в случае большой задержки нельзя быть уверенным в том, что маркер еще действителен для службы, выполняющей проверку подлинности клиента.  
  
 Обратите внимание, что при использовании этого типа учетных данных служба должна запускаться из учетной записи службы (SERVICE).  
  
 Протокол Kerberos используется по умолчанию при выборе учетных данных сообщения. Дополнительные сведения см. в разделе [изучение Kerberos-протокола распределенной безопасности в Windows 2000](http://go.microsoft.com/fwlink/?LinkId=87790).  
  
### <a name="username-password"></a>Имя пользователя и пароль  
 С помощью этого свойства клиент может проверить подлинность сервера, используя имя пользователя и пароль в заголовке безопасности сообщения.  
  
### <a name="issuedtoken"></a>IssuedToken  
 Клиент может обратиться к службе маркеров безопасности для получения прикрепляемого к сообщению маркера, с помощью которого служба может проверить подлинность клиента.  
  
## <a name="using-transport-and-message-security"></a>Использование безопасности транспорта и сообщений  
 При применении одновременно и безопасности транспорта, и безопасности сообщений для обеспечения безопасности сообщения как на уровне транспорта, так и на уровне сообщений SOAP должен использоваться один и тот же сертификат.  
  
## <a name="see-also"></a>См. также  
 [Защита сообщений с использованием средств обеспечения безопасности транспорта](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)  
 [Безопасность сообщений при использовании очереди сообщений](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)  
 [Основные понятия безопасности](../../../../docs/framework/wcf/feature-details/security-concepts.md)  
 [Защита служб и клиентов](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)
