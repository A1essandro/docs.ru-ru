---
title: "Как создать службу рабочего процесса с помощью действий обмена сообщениями | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework-4.6"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: 53d094e2-6901-4aa1-88b8-024b27ccf78b
caps.latest.revision: 11
author: "Erikre"
ms.author: "erikre"
manager: "erikre"
caps.handback.revision: 11
---
# Как создать службу рабочего процесса с помощью действий обмена сообщениями
В этом разделе приведены сведения о том, как создать простую службу рабочего процесса с помощью действий обмена сообщениями.  В нем рассматривается механизм создания службы рабочего процесса, когда служба состоит только из действий обмена сообщениями.  В реальных службах рабочий процесс содержит множество других действий.  Служба реализует одну операцию с именем Echo, которая принимает строку и возвращает строку вызывающему коду.  Это первый из двух разделов.  В следующем разделе [Как получить доступ к службе из приложения рабочего процесса](../../../../docs/framework/wcf/feature-details/how-to-access-a-service-from-a-workflow-application.md) рассматривается создание приложения рабочего процесса, способного обращаться к службе, созданной в этом разделе.  
  
### Создание проекта службы рабочего процесса  
  
1.  Запустите [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)].  
  
2.  В меню **Файл** выберите пункт **Создать**, затем выберите пункт **Проект**. В результате этого откроется окно **Создание проекта**.  Из списка установленных шаблонов выберите **Рабочий процесс**. В списке типов проекта выберите **Приложение службы рабочего процесса WCF**.  Назовите проект `MyWFService` и оставьте расположение по умолчанию, как показано на следующем рисунке.  
  
     Нажмите кнопку **ОК**, чтобы закрыть окно **Создание проекта**.  
  
3.  После создания проекта в конструкторе открывается файл Service1.xamlx, как показано на следующем рисунке.  
  
     ![Рабочий процесс по умолчанию, отображаемый в конструкторе](../../../../docs/framework/wcf/feature-details/media/defaultworkflowservice.JPG "DefaultWorkflowService")  
  
     Щелкните правой кнопкой мыши действие **Последовательная служба** и выберите пункт **Удалить**.  
  
### Реализация службы рабочего процесса  
  
1.  Чтобы отобразить область элементов, перейдите на вкладку **Область элементов** в левой части экрана. Чтобы оставить окно открытым, щелкните значок вешки.  Чтобы отобразить действия обмена сообщениями и шаблоны действий обмена сообщениями, разверните в области элементов раздел **Обмен сообщениями**, как показано на следующем рисунке.  
  
     ![Панель элементов с развернутой вкладкой "Обмен сообщениями"](../../../../docs/framework/wcf/feature-details/media/wfdesignertoolbox.JPG "WFDesignerToolbox")  
  
2.  Перетащите шаблон **ReceiveAndSendReply** в конструктор рабочего процесса.  В результате этого будет создано действие <xref:System.ServiceModel.Activities.Sequence>, содержащее действия **Receive** и <xref:System.ServiceModel.Activities.SendReply>, как показано на следующем рисунке.  
  
     ![Шаблон ReceiveAndSendReply в конструкторе](../../../../docs/framework/wcf/feature-details/media/receiveandsendreply.JPG "ReceiveAndSendReply")  
  
     Обратите внимание, что у действия <xref:System.ServiceModel.Activities.SendReply> свойство <xref:System.ServiceModel.Activities.SendReply.Request%2A> имеет значение `Receive`, это имя действия <xref:System.ServiceModel.Activities.Receive>, на которое отвечает действие <xref:System.ServiceModel.Activities.SendReply>.  
  
3.  В действии <xref:System.ServiceModel.Activities.Receive> введите `Echo` в текстовое поле с меткой **OperationName**.  Это задает имя операции, которую реализует служба.  
  
     ![Задание имени операции](../../../../docs/framework/wcf/feature-details/media/defineoperation.JPG "DefineOperation")  
  
4.  Выделите действие <xref:System.ServiceModel.Activities.Receive> и откройте окно свойств, если оно еще не открыто. Для этого в меню **Вид** выберите пункт **Окно свойств**.  В **Окне свойств** прокрутите список вниз до пункта **CanCreateInstance** и установите флажок, как показано на следующем рисунке.  Этот параметр позволяет службе рабочего процесса создавать новый экземпляр службы при получении сообщения \(если это необходимо\).  
  
     ![Свойство CanCreateInstance](../../../../docs/framework/wcf/feature-details/media/cancreateinstance.JPG "CanCreateInstance")  
  
5.  Выделите действие <xref:System.ServiceModel.Activities.Sequence> и нажмите кнопку **Переменные** в левом нижнем углу конструктора.  Откроется редактор переменных.  Чтобы добавить переменную для хранения строки, отправляемой в операции, щелкните ссылку **Создать переменную**.  Назовите переменную `msg`. Затем задайте в поле **Тип переменной** значение String, как показано на следующем рисунке.  
  
     ![Добавление переменной](../../../../docs/framework/wcf/feature-details/media/addvariable.JPG "AddVariable")  
  
     Чтобы закрыть редактор переменных, снова нажмите кнопку **Переменные**.  
  
6.  Щелкните ссылку **Определить…** в текстовом поле **Содержимое** в действии <xref:System.ServiceModel.Activities.Receive>, чтобы открыть диалоговое окно **Определение содержимого**.  Установите переключатель **Параметры**, щелкните ссылку **Добавить новый параметр**, введите `inMsg` в текстовое поле **Имя**. Затем выберите значение **String** в раскрывающемся списке **Тип** и введите `msg` в текстовом поле **Присвоить**, как показано на следующем рисунке.  
  
     ![Добавление содержимого параметров](../../../../docs/framework/wcf/feature-details/media/parameterscontent.jpg "ParametersContent")  
  
     Это указывает, что действие Receive получает строковый параметр, а данные будут привязаны к переменной `msg`.  Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Определение содержимого**.  
  
7.  Щелкните ссылку **Определить…** в поле **Содержимое** в действии <xref:System.ServiceModel.Activities.SendReply>, чтобы открыть диалоговое окно **Определение содержимого**.  Установите переключатель **Параметры**, щелкните ссылку **Добавить новый параметр**, введите `msg` в текстовом поле **Имя**. Затем выберите значение **String** в раскрывающемся списке **Тип** и введите `msg` в текстовое поле **Значение**, как показано на следующем рисунке.  
  
     ![Добавление содержимого параметров](../../../../docs/framework/wcf/feature-details/media/parameterscontent2.jpg "ParametersContent2")  
  
     Это указывает, что действие <xref:System.ServiceModel.Activities.SendReply> отправляет сообщение или тип контракта сообщения, а данные привязаны к переменной `msg`.  Поскольку это действие <xref:System.ServiceModel.Activities.SendReply>, данные в `msg` используются для заполнения сообщения, которое действие возвращает клиенту.  Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Определение содержимого**.  
  
8.  Сохраните и выполните построение решения. Для этого в меню **Построение** выберите пункт **Построение решения**.  
  
## Настройка проекта службы рабочего процесса  
 Служба рабочего процесса создана.  В этом разделе приведены сведения о конфигурации решения службы рабочего процесса, чтобы упростить ее размещение и выполнение.  Для размещения службы в этом решении используется сервер разработки ASP.NET.  
  
#### Задание параметров запуска проекта  
  
1.  В **обозревателе решений** щелкните правой кнопкой мыши **MyWFService** и выберите пункт **Свойства**, чтобы открыть диалоговое окно **Свойства проекта**.  
  
2.  Перейдите на вкладку **Интернет**, в области **Действие при запуске** установите переключатель в значение **Указанная страница** и введите в текстовое поле `Service1.xamlx`, как показано на следующем рисунке.  
  
     ![Диалоговое окно "Свойства проекта"](../../../../docs/framework/wcf/feature-details/media/projectpropertiesdlg.JPG "ProjectPropertiesDlg")  
  
     Служба, которая определена в Service1.xamlx, будет размещена на сервере разработки ASP.NET.  
  
3.  Чтобы запустить службу, нажмите сочетание клавиш CTRL\+F5.  В нижней правой области рабочего стола появится значок сервера разработки ASP.NET, как показано на следующем рисунке.  
  
     ![Значок сервера разработки ASP.NET](../../../../docs/framework/wcf/feature-details/media/aspnetdevservericon.JPG "ASPNETDEVServerIcon")  
  
     Кроме того, в Internet Explorer для службы откроется справочная страница службы WCF.  
  
     ![Страница справки WCF](../../../../docs/framework/wcf/feature-details/media/wcfhelppate.JPG "WCFHelpPate")  
  
4.  Чтобы создать клиент рабочего процесса, вызывающий эту службу, перейдите к разделу [Как получить доступ к службе из приложения рабочего процесса](../../../../docs/framework/wcf/feature-details/how-to-access-a-service-from-a-workflow-application.md).  
  
## См. также  
 [Службы рабочего процесса](../../../../docs/framework/wcf/feature-details/workflow-services.md)   
 [Общие сведения о размещении служб рабочих процессов](../../../../docs/framework/wcf/feature-details/hosting-workflow-services-overview.md)   
 [Действия обмена сообщениями](../../../../docs/framework/wcf/feature-details/messaging-activities.md)