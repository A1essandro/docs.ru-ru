---
title: Очереди в WCF
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e98d76ba-1acf-42cd-b137-0f8214661112
caps.latest.revision: 21
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: 01dc36c73d9e668dd98cb5ba8b275d3d5177ba61
ms.sourcegitcommit: 03ee570f6f528a7d23a4221dcb26a9498edbdf8c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
---
# <a name="queuing-in-wcf"></a><span data-ttu-id="67d47-102">Очереди в WCF</span><span class="sxs-lookup"><span data-stu-id="67d47-102">Queuing in WCF</span></span>
<span data-ttu-id="67d47-103">В данном разделе описывается применение взаимодействия с использованием очередей в [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="67d47-103">This section describes how to use queued communication in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span></span>  
  
## <a name="queues-as-a-wcf-transport-binding"></a><span data-ttu-id="67d47-104">Очереди в качестве привязки транспорта WCF</span><span class="sxs-lookup"><span data-stu-id="67d47-104">Queues as a WCF transport binding</span></span>  
 <span data-ttu-id="67d47-105">В [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] контракты определяют данные, участвующие обмене.</span><span class="sxs-lookup"><span data-stu-id="67d47-105">In [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], the contracts specify what is being exchanged.</span></span> <span data-ttu-id="67d47-106">Контракты представляют собой обмен сообщениями, связанными с бизнес-требованиями или конкретными приложениями.</span><span class="sxs-lookup"><span data-stu-id="67d47-106">Contracts are business-dependent or application-specific message exchanges.</span></span> <span data-ttu-id="67d47-107">Механизм, с помощью которого осуществляется обмен сообщениями, задается в привязках.</span><span class="sxs-lookup"><span data-stu-id="67d47-107">The mechanism used to exchange messages (or the "how") is specified in the bindings.</span></span> <span data-ttu-id="67d47-108">В [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] привязки инкапсулируют сведения об обмене сообщениями.</span><span class="sxs-lookup"><span data-stu-id="67d47-108">Bindings in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] encapsulate details of the message exchange.</span></span> <span data-ttu-id="67d47-109">Они предоставляют доступ к элементам конфигурации, с помощью которых пользователи могут управлять различными аспектами транспорта или протокола, которые представляются привязками.</span><span class="sxs-lookup"><span data-stu-id="67d47-109">They expose configuration knobs for the user to control various aspects of the transport or the protocol that the bindings represent.</span></span> <span data-ttu-id="67d47-110">Очереди в [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] рассматриваются как и любые другие привязки транспорта, что является большим преимуществом для многих приложений, использующих очереди.</span><span class="sxs-lookup"><span data-stu-id="67d47-110">Queuing in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] is treated like any other transport binding, which is a big advantage for many queuing applications.</span></span> <span data-ttu-id="67d47-111">В наше время многие приложения с использованием очередей разрабатываются не так, как другие распределенные приложения на базе удаленного вызова процедур, что затрудняет их понимание и обслуживание.</span><span class="sxs-lookup"><span data-stu-id="67d47-111">Today, many queuing applications are written differently from other remote procedure call (RPC)-style distributed applications, making it harder to follow and maintain.</span></span> <span data-ttu-id="67d47-112">В [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] стиль разработки распределенных приложений во многом одинаков, что упрощает их понимание и обслуживание.</span><span class="sxs-lookup"><span data-stu-id="67d47-112">With [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], the style of writing a distributed application is much the same, making it easier to follow and maintain.</span></span> <span data-ttu-id="67d47-113">Более того, отделение механизма обмена данными от бизнес-логики упрощает настройку транспорта или внесение изменений в него, не затрагивая код, относящийся к предметной области.</span><span class="sxs-lookup"><span data-stu-id="67d47-113">Moreover, by factoring out the mechanism of exchange separately from the business logic, it is easier to configure the transport or make changes to it without affecting application specific code.</span></span> <span data-ttu-id="67d47-114">На следующем рисунке показана структура службы и клиента WCF, которые используют MSMQ в качестве транспорта.</span><span class="sxs-lookup"><span data-stu-id="67d47-114">The following figure illustrates the structure of a WCF service and client using MSMQ as a transport.</span></span>  
  
 <span data-ttu-id="67d47-115">![Диаграмма приложения в очереди](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "распределенных очереди фигуры")</span><span class="sxs-lookup"><span data-stu-id="67d47-115">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="67d47-116">Как видно из этого рисунка, клиент и служба должны определять только семантику приложения, т. е. контракт и реализацию.</span><span class="sxs-lookup"><span data-stu-id="67d47-116">As you can see from the preceding figure, the client and service must define only the application semantics, that is, the contract and implementation.</span></span> <span data-ttu-id="67d47-117">Служба настраивает поддерживающую очереди привязку с использованием нужных параметров.</span><span class="sxs-lookup"><span data-stu-id="67d47-117">The service configures a queued binding with preferred settings.</span></span> <span data-ttu-id="67d47-118">Клиент использует [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) для создания [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] клиента к службе, а также для создания файла конфигурации, который описывает привязок, чтобы использовать для отправки сообщений в службе.</span><span class="sxs-lookup"><span data-stu-id="67d47-118">The client uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to generate a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client to the service and to generate a configuration file that describes the bindings to use to send messages to the service.</span></span> <span data-ttu-id="67d47-119">Таким образом, чтобы отправить сообщение с поддержкой очереди, клиент создает экземпляр клиента [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] и вызывает в нем операцию.</span><span class="sxs-lookup"><span data-stu-id="67d47-119">Thus, to send a queued message, the client instantiates a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client and invokes an operation on it.</span></span> <span data-ttu-id="67d47-120">В результате сообщение отправляется в очередь передачи, а затем передается в целевую очередь.</span><span class="sxs-lookup"><span data-stu-id="67d47-120">This causes the message to be sent to the transmission queue and transferred to the target queue.</span></span> <span data-ttu-id="67d47-121">Все сложные механизмы взаимодействия с использованием очередей оказываются скрытыми от приложения, которое отправляет и получает сообщения.</span><span class="sxs-lookup"><span data-stu-id="67d47-121">All the complexities of queued communication are hidden from the application that is sending and receiving messages.</span></span>  
  
 <span data-ttu-id="67d47-122">Поддерживающие очереди привязки в [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] имеют следующие недостатки:</span><span class="sxs-lookup"><span data-stu-id="67d47-122">Caveats about queued binding in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] include:</span></span>  
  
-   <span data-ttu-id="67d47-123">все операции служб должны быть односторонними, поскольку в [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] поддерживающая очереди привязка по умолчанию не поддерживает дуплексное взаимодействие с использованием очередей.</span><span class="sxs-lookup"><span data-stu-id="67d47-123">All service operations must be one-way because the default queued binding in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] does not support duplex communication using queues.</span></span> <span data-ttu-id="67d47-124">Образец двусторонний обмен данными ([двусторонней связи](../../../../docs/framework/wcf/samples/two-way-communication.md)) показано, как использовать два односторонних контрактов для реализации дуплексного обмена данными с использованием очередей.</span><span class="sxs-lookup"><span data-stu-id="67d47-124">A two-way communication sample ([Two-Way Communication](../../../../docs/framework/wcf/samples/two-way-communication.md)) illustrates how to use two one-way contracts to implement duplex communication using queues.</span></span>  
  
-   <span data-ttu-id="67d47-125">для создания клиента [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] с использованием обмена метаданными требуется дополнительная конечная точка HTTP на стороне службы, чтобы к ней можно было напрямую обращаться с запросами для создания клиента [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] и получения сведений о привязки, необходимых для правильной настройки взаимодействия с использованием очередей;</span><span class="sxs-lookup"><span data-stu-id="67d47-125">To generate a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client using metadata exchange requires an additional HTTP endpoint on the service so that it can be queried directly to generate the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client and obtain binding information to appropriately configure queued communication.</span></span>  
  
-   <span data-ttu-id="67d47-126">в зависимости от поддерживающей очереди привязки требуется дополнительная настройка за пределами [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span><span class="sxs-lookup"><span data-stu-id="67d47-126">Based on the queued binding, extra configuration outside of [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] is required.</span></span> <span data-ttu-id="67d47-127">Например, класс <xref:System.ServiceModel.NetMsmqBinding>, входящий в состав [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], требует настройки привязок, а также минимальной настройки MSMQ.</span><span class="sxs-lookup"><span data-stu-id="67d47-127">For example, the <xref:System.ServiceModel.NetMsmqBinding> class that is shipped with [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] requires you to configure the bindings as well as minimally configure Message Queuing (MSMQ).</span></span>  
  
 <span data-ttu-id="67d47-128">В следующих разделах описаны конкретные поддерживающие очереди привязки, входящие в состав [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] и основанные на MSMQ.</span><span class="sxs-lookup"><span data-stu-id="67d47-128">The following sections describe the specific queued bindings shipped with [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], which are based on MSMQ.</span></span>  
  
### <a name="msmq"></a><span data-ttu-id="67d47-129">MSMQ</span><span class="sxs-lookup"><span data-stu-id="67d47-129">MSMQ</span></span>  
 <span data-ttu-id="67d47-130">Основанный на очереди транспорт в [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] использует MSMQ для взаимодействия с использованием очередей.</span><span class="sxs-lookup"><span data-stu-id="67d47-130">The queued transport in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] uses MSMQ for its queued communication.</span></span>  
  
 <span data-ttu-id="67d47-131">MSMQ поставляется как дополнительный компонент Windows и выполняется как служба NT.</span><span class="sxs-lookup"><span data-stu-id="67d47-131">MSMQ ships as an optional component with Windows and runs as an NT service.</span></span> <span data-ttu-id="67d47-132">MSMQ помещает передаваемые сообщения в очередь передачи и доставляет их в целевую очередь.</span><span class="sxs-lookup"><span data-stu-id="67d47-132">It captures messages for transmission in a transmission queue and for delivery in a target queue.</span></span> <span data-ttu-id="67d47-133">Диспетчеры очередей MSMQ реализуют надежный протокол передачи сообщений, благодаря которому сообщения не могут быть потеряны при передаче.</span><span class="sxs-lookup"><span data-stu-id="67d47-133">The MSMQ queue managers implement a reliable message-transfer protocol so that messages are not lost in transmission.</span></span> <span data-ttu-id="67d47-134">Этот протокол может быть собственным или основанным на SOAP, например как протокол SRMP.</span><span class="sxs-lookup"><span data-stu-id="67d47-134">The protocol can be either native or SOAP-based, such as the SOAP Reliable Message Protocol (SRMP).</span></span>  
  
 <span data-ttu-id="67d47-135">В MSMQ, очереди могут быть транзакционными и нетранзакционными.</span><span class="sxs-lookup"><span data-stu-id="67d47-135">In MSMQ, queues can be transactional or non-transactional.</span></span> <span data-ttu-id="67d47-136">Транзакционная очередь позволяет перехватывать и доставлять сообщение в транзакции, а затем продолжительное время хранить его в очереди.</span><span class="sxs-lookup"><span data-stu-id="67d47-136">A transactional queue allows messages to be captured and delivered in a transaction and then stored durably in the queue.</span></span> <span data-ttu-id="67d47-137">Сообщения, отправляемые в транзакционную очередь, передаются только один раз в заданном порядке.</span><span class="sxs-lookup"><span data-stu-id="67d47-137">Messages sent to a transactional queue are transferred exactly once in order.</span></span> <span data-ttu-id="67d47-138">С помощью нетранзакционных очередей можно передавать, как неустойчивые, так и устойчивые сообщения.</span><span class="sxs-lookup"><span data-stu-id="67d47-138">You can use a non-transactional queue to send both volatile and durable messages.</span></span> <span data-ttu-id="67d47-139">Сообщение, переданное в нетранзакционную очередь, не содержит каких-либо механизмов подтверждения надежной передачи, поэтому такое сообщение может быть потеряно.</span><span class="sxs-lookup"><span data-stu-id="67d47-139">A message sent to a non-transactional queue does not carry any reliable transfer assurances; thus, messages can be lost.</span></span>  
  
 <span data-ttu-id="67d47-140">Кроме того, очереди MSMQ можно защищать с помощью удостоверений Windows, зарегистрированных в службе каталогов Active Directory.</span><span class="sxs-lookup"><span data-stu-id="67d47-140">MSMQ queues can also be secured using a Windows identity registered with the Active Directory directory service.</span></span> <span data-ttu-id="67d47-141">При установке MSMQ можно установить интеграцию с Active Directory, для чего компьютер должен входить в домен Windows.</span><span class="sxs-lookup"><span data-stu-id="67d47-141">When installing MSMQ, you can install Active Directory integration, which requires the computer to be part of a Windows domain network.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="67d47-142"> MSMQ, в разделе [Установка Message Queuing (MSMQ)](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md).</span><span class="sxs-lookup"><span data-stu-id="67d47-142"> MSMQ, see [Installing Message Queuing (MSMQ)](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md).</span></span>  
  
### <a name="netmsmqbinding"></a><span data-ttu-id="67d47-143">NetMsmqBinding</span><span class="sxs-lookup"><span data-stu-id="67d47-143">NetMsmqBinding</span></span>  
 <span data-ttu-id="67d47-144">[ \<NetMsmqBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md) является привязке с очередью [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] предоставляет для двух [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] конечные точки для взаимодействия с помощью MSMQ.</span><span class="sxs-lookup"><span data-stu-id="67d47-144">The [\<netMsmqBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md) is the queued binding [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] provides for two [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] endpoints to communicate using MSMQ.</span></span> <span data-ttu-id="67d47-145">Поэтому привязка предоставляет свойства, имеющие отношение к MSMQ.</span><span class="sxs-lookup"><span data-stu-id="67d47-145">The binding, therefore, exposes properties that are specific to MSMQ.</span></span> <span data-ttu-id="67d47-146">Тем не менее в `NetMsmqBinding` доступны не все функции и свойства MSMQ.</span><span class="sxs-lookup"><span data-stu-id="67d47-146">However, not all MSMQ features and properties are exposed in the `NetMsmqBinding`.</span></span> <span data-ttu-id="67d47-147">Компактная привязка `NetMsmqBinding` содержит оптимальный набор функций, которого должно быть достаточно для большинства пользователей.</span><span class="sxs-lookup"><span data-stu-id="67d47-147">The compact `NetMsmqBinding` is designed with an optimal set of features that most customers should find sufficient.</span></span>  
  
 <span data-ttu-id="67d47-148">В `NetMsmqBinding` в виде свойств привязок объявлены базовые принципы работы с очередями, рассмотренные выше.</span><span class="sxs-lookup"><span data-stu-id="67d47-148">The `NetMsmqBinding` manifests the core queuing concepts discussed thus far in the form of properties on the bindings.</span></span> <span data-ttu-id="67d47-149">Эти свойства, в свою очередь, определяют, каким образом сообщения должны передаваться и отправляться с использованием MSMQ.</span><span class="sxs-lookup"><span data-stu-id="67d47-149">These properties, in turn, communicate to MSMQ how to transfer and deliver the messages.</span></span> <span data-ttu-id="67d47-150">Описание категорий свойств содержится в приведенных ниже разделах.</span><span class="sxs-lookup"><span data-stu-id="67d47-150">A discussion of the property categories is in the following sections.</span></span> <span data-ttu-id="67d47-151">Дополнительные сведения см. в разделе Основные разделы, более полно описывающие конкретные свойства.</span><span class="sxs-lookup"><span data-stu-id="67d47-151">For more information, see the conceptual topics that describe specific properties more completely.</span></span>  
  
#### <a name="exactlyonce-and-durable-properties"></a><span data-ttu-id="67d47-152">Свойства ExactlyOnce и Durable</span><span class="sxs-lookup"><span data-stu-id="67d47-152">ExactlyOnce and Durable Properties</span></span>  
 <span data-ttu-id="67d47-153">От значений свойств `ExactlyOnce` и `Durable` зависит то, каким образом сообщения передаются между очередями.</span><span class="sxs-lookup"><span data-stu-id="67d47-153">The `ExactlyOnce` and `Durable` properties affect how messages are transferred between queues:</span></span>  
  
-   <span data-ttu-id="67d47-154">`ExactlyOnce`: если имеет значение `true` (по умолчанию), канал очереди следит за тем, чтобы сообщение доставлялось только один раз.</span><span class="sxs-lookup"><span data-stu-id="67d47-154">`ExactlyOnce`: When set to `true` (the default), the queued channel ensures that the message, if delivered, is not duplicated.</span></span> <span data-ttu-id="67d47-155">Кроме того, он контролирует, чтобы сообщение не было потеряно.</span><span class="sxs-lookup"><span data-stu-id="67d47-155">It also ensures that the message is not lost.</span></span> <span data-ttu-id="67d47-156">Если доставить сообщение не удается или срок жизни сообщения истекает до его доставки, это сообщение, а также причина сбоя при его доставке записываются в очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="67d47-156">If the message cannot be delivered, or the message Time-To Live expires before the message can be delivered, the failed message along with the delivery failure reason is recorded in a dead-letter queue.</span></span> <span data-ttu-id="67d47-157">Если свойство имеет значение `false`, канал очереди пытается передать сообщение.</span><span class="sxs-lookup"><span data-stu-id="67d47-157">When set to `false`, the queued channel makes an effort to transfer the message.</span></span> <span data-ttu-id="67d47-158">В этом случае можно (необязательно) выбрать очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="67d47-158">In this case, you can optionally choose a dead-letter queue.</span></span>  
  
-   <span data-ttu-id="67d47-159">`Durable:` если имеет значение `true` (по умолчанию), канал очереди проверяет, что MSMQ сохраняет сообщение на диск на продолжительное время.</span><span class="sxs-lookup"><span data-stu-id="67d47-159">`Durable:` When set to `true` (the default), the queued channel ensures that MSMQ stores the message durably on disk.</span></span> <span data-ttu-id="67d47-160">Таким образом, если службу MSMQ необходимо остановить и перезапустить, сообщения на диске передаются в целевую очередь или в службу.</span><span class="sxs-lookup"><span data-stu-id="67d47-160">Thus, if the MSMQ service were to stop and restart, the messages on disk is transferred to the target queue or delivered to the service.</span></span> <span data-ttu-id="67d47-161">Если свойство имеет значение `false`, сообщения сохраняются во временном хранилище и теряются в случае остановки и перезапуска службы MSMQ.</span><span class="sxs-lookup"><span data-stu-id="67d47-161">When set to `false`, the messages are stored in volatile store and are lost on stopping and restarting the MSMQ service.</span></span>  
  
 <span data-ttu-id="67d47-162">Для реализации надежной передачи в режиме `ExactlyOnce` служба MSMQ требует, чтобы очередь была транзакционной.</span><span class="sxs-lookup"><span data-stu-id="67d47-162">For `ExactlyOnce` reliable transfer, MSMQ requires the queue to be transactional.</span></span> <span data-ttu-id="67d47-163">Кроме того, служба MSMQ требует чтения транзакции из транзакционной очереди.</span><span class="sxs-lookup"><span data-stu-id="67d47-163">Also, MSMQ requires a transaction to read from a transactional queue.</span></span> <span data-ttu-id="67d47-164">Поэтому при использовании привязки `NetMsmqBinding` следует помнить, что для отправки и получения сообщения требуется транзакция, если свойство `ExactlyOnce` имеет значение `true`.</span><span class="sxs-lookup"><span data-stu-id="67d47-164">As such, when you use the `NetMsmqBinding`, remember that a transaction is required to send or receive messages when `ExactlyOnce` is set to `true`.</span></span> <span data-ttu-id="67d47-165">Аналогично служба MSMQ требует, чтобы очередь была нетранзакционной с гарантией наилучшего из возможного, как например в случаях, когда свойство `ExactlyOnce` равняется `false` или при обмене временными сообщениями.</span><span class="sxs-lookup"><span data-stu-id="67d47-165">Similarly, MSMQ requires the queue to be non-transactional for best-effort assurances, such as when `ExactlyOnce` is `false` and for volatile messaging.</span></span> <span data-ttu-id="67d47-166">Таким образом, если свойство `ExactlyOnce` имеет значение `false` или свойство Durable имеет значение `false`, невозможно осуществлять отправку или получение с использованием транзакций.</span><span class="sxs-lookup"><span data-stu-id="67d47-166">Thus, when setting `ExactlyOnce` to `false` or durable to `false`, you cannot send or receive using a transaction.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="67d47-167">Следите за тем, чтобы создавалась правильная очередь (транзакционная или нетранзакционная) в зависимости от параметров привязок.</span><span class="sxs-lookup"><span data-stu-id="67d47-167">Ensure that the correct queue (transactional or non-transactional) is created based on settings in the bindings.</span></span> <span data-ttu-id="67d47-168">Если свойство `ExactlyOnce` имеет значение `true`, используется транзакционную очередь; в противном случае используется нетранзакционная очередь.</span><span class="sxs-lookup"><span data-stu-id="67d47-168">If `ExactlyOnce` is `true`, use a transactional queue; otherwise, use a non-transactional queue.</span></span>  
  
#### <a name="dead-letter-queue-properties"></a><span data-ttu-id="67d47-169">Свойства очереди недоставленных сообщений</span><span class="sxs-lookup"><span data-stu-id="67d47-169">Dead-Letter Queue Properties</span></span>  
 <span data-ttu-id="67d47-170">Очередь недоставленных сообщений служит для хранения сообщений, которые не удалось доставить.</span><span class="sxs-lookup"><span data-stu-id="67d47-170">The dead-letter queue is used to store messages that fail delivery.</span></span> <span data-ttu-id="67d47-171">Пользователь может написать дополнительные операции по чтению сообщений из очереди недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="67d47-171">The user can write compensating logic that reads messages out of the dead-letter queue.</span></span>  
  
 <span data-ttu-id="67d47-172">Многие системы организации очереди реализуют общесистемную очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="67d47-172">Many queuing systems provide for a system-wide dead-letter queue.</span></span> <span data-ttu-id="67d47-173">Служба MSMQ имеет две общесистемные очереди недоставленных сообщений: общесистемную очередь недоставленных нетранзакционных сообщений, которые не удалось доставить в нетранзакционные очереди, и общесистемную очередь недоставленных транзакционных сообщений, которые не удалось доставить в транзакционные очереди.</span><span class="sxs-lookup"><span data-stu-id="67d47-173">MSMQ provides a system-wide non-transactional dead-letter queue for messages that fail delivery to non-transactional queues and a system-wide transactional dead-letter queue for messages that fail delivery to transactional queues.</span></span>  
  
 <span data-ttu-id="67d47-174">Если несколько клиентов отправляют сообщения в различные целевые очереди с использованием одной службы MSMQ, все отправляемые клиентами сообщения попадают в одну и ту же очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="67d47-174">If multiple clients sending messages to different target queues share the MSMQ service, all messages sent by the clients go to the same dead-letter queue.</span></span> <span data-ttu-id="67d47-175">Это не всегда желательно.</span><span class="sxs-lookup"><span data-stu-id="67d47-175">This is not always preferable.</span></span> <span data-ttu-id="67d47-176">Для лучшей изоляции [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] и MSMQ в [!INCLUDE[wv](../../../../includes/wv-md.md)] предоставляют пользовательскую очередь недоставленных сообщений (или очередь недоставленных сообщений конкретного приложения), в которой пользователи могут сохранять сообщения, которые не удалось доставить.</span><span class="sxs-lookup"><span data-stu-id="67d47-176">For better isolation, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] and MSMQ in [!INCLUDE[wv](../../../../includes/wv-md.md)] provide a custom dead-letter queue (or application-specific dead-letter queue) that the user can specify to store messages that fail delivery.</span></span> <span data-ttu-id="67d47-177">В результате различные клиенты не будут использовать одну и ту же очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="67d47-177">Therefore, different clients do not share the same dead-letter queue.</span></span>  
  
 <span data-ttu-id="67d47-178">У привязок имеются следующие важные свойства.</span><span class="sxs-lookup"><span data-stu-id="67d47-178">The binding has two properties of interest:</span></span>  
  
-   <span data-ttu-id="67d47-179">`DeadLetterQueue`. Это свойство является перечислением, которое указывает, запрошена ли очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="67d47-179">`DeadLetterQueue`: This property is an enumeration that indicates whether a dead-letter queue is requested.</span></span> <span data-ttu-id="67d47-180">Кроме того, в перечислении содержится тип очереди недоставленных сообщений, если она запрошена.</span><span class="sxs-lookup"><span data-stu-id="67d47-180">The enumeration also contains the kind of dead-letter queue, if one is requested.</span></span> <span data-ttu-id="67d47-181">Значениями являются `None`, `System` и `Custom`.</span><span class="sxs-lookup"><span data-stu-id="67d47-181">The values are `None`, `System`, and `Custom`.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="67d47-182"> Интерпретация этих свойств в разделе [с использованием очередей недоставленных сообщений для обработки ошибок передачи сообщений](../../../../docs/framework/wcf/feature-details/using-dead-letter-queues-to-handle-message-transfer-failures.md)</span><span class="sxs-lookup"><span data-stu-id="67d47-182"> the interpretation of these properties, see [Using Dead-Letter Queues to Handle Message Transfer Failures](../../../../docs/framework/wcf/feature-details/using-dead-letter-queues-to-handle-message-transfer-failures.md)</span></span>  
  
-   <span data-ttu-id="67d47-183">`CustomDeadLetterQueue`. Это свойство представляет собой универсальный код ресурса (URI) очереди недоставленных сообщений конкретного приложения.</span><span class="sxs-lookup"><span data-stu-id="67d47-183">`CustomDeadLetterQueue`: This property is the Uniform Resource Identifier (URI) address of the application-specific dead-letter queue.</span></span> <span data-ttu-id="67d47-184">Требуется, если `DeadLetterQueue`.`Custom`</span><span class="sxs-lookup"><span data-stu-id="67d47-184">This is required if `DeadLetterQueue`.`Custom`</span></span> <span data-ttu-id="67d47-185">выбирается.</span><span class="sxs-lookup"><span data-stu-id="67d47-185">is chosen.</span></span>  
  
#### <a name="poison-message-handling-properties"></a><span data-ttu-id="67d47-186">Свойства обработки подозрительных сообщений</span><span class="sxs-lookup"><span data-stu-id="67d47-186">Poison Message Handling properties</span></span>  
 <span data-ttu-id="67d47-187">Когда служба получает сообщение из целевой очереди в рамках транзакции, служба может по какой-либо причине не обработать это сообщение.</span><span class="sxs-lookup"><span data-stu-id="67d47-187">When the service reads messages from the target queue under a transaction, the service may fail to process the message for various reasons.</span></span> <span data-ttu-id="67d47-188">В этом случае сообщение возвращается в очередь, чтобы быть считанными снова.</span><span class="sxs-lookup"><span data-stu-id="67d47-188">The message is then put back into the queue to be read again.</span></span> <span data-ttu-id="67d47-189">Для обработки сообщений, которые часто вызывают сбои, в привязке можно настроить набор свойств обработки подозрительных сообщений.</span><span class="sxs-lookup"><span data-stu-id="67d47-189">To deal with messages that fail repeatedly, a set of poison-message handling properties can be configured in the binding.</span></span> <span data-ttu-id="67d47-190">Есть четыре свойства: `ReceiveRetryCount`, `MaxRetryCycles`, `RetryCycleDelay` и `ReceiveErrorHandling`.</span><span class="sxs-lookup"><span data-stu-id="67d47-190">There are four properties: `ReceiveRetryCount`, `MaxRetryCycles`, `RetryCycleDelay`, and `ReceiveErrorHandling`.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="67d47-191"> Эти свойства в разделе [обработка подозрительных сообщений](../../../../docs/framework/wcf/feature-details/poison-message-handling.md).</span><span class="sxs-lookup"><span data-stu-id="67d47-191"> these properties, see [Poison Message Handling](../../../../docs/framework/wcf/feature-details/poison-message-handling.md).</span></span>  
  
#### <a name="security-properties"></a><span data-ttu-id="67d47-192">Свойства безопасности</span><span class="sxs-lookup"><span data-stu-id="67d47-192">Security Properties</span></span>  
 <span data-ttu-id="67d47-193">Служба MSMQ реализует собственную модель безопасности, например списки управления доступом в очереди или отправку прошедших проверку подлинности сообщений.</span><span class="sxs-lookup"><span data-stu-id="67d47-193">MSMQ exposes its own security model, such as access control lists (ACLs) on a queue or sending authenticated messages.</span></span> <span data-ttu-id="67d47-194">В привязке `NetMsmqBinding` эти свойства безопасности реализованы как часть параметров безопасности транспорта.</span><span class="sxs-lookup"><span data-stu-id="67d47-194">The `NetMsmqBinding` exposes these security properties as part of its transport security settings.</span></span> <span data-ttu-id="67d47-195">В привязке имеется два свойства для обеспечения безопасности транспорта: `MsmqAuthenticationMode` и `MsmqProtectionLevel`.</span><span class="sxs-lookup"><span data-stu-id="67d47-195">There are two properties in the binding for transport security: `MsmqAuthenticationMode` and `MsmqProtectionLevel`.</span></span> <span data-ttu-id="67d47-196">Значения этих свойств зависят от настройки MSMQ.</span><span class="sxs-lookup"><span data-stu-id="67d47-196">Settings in these properties depend on how MSMQ is configured.</span></span> <span data-ttu-id="67d47-197">Дополнительные сведения см. в разделе [защита безопасность транспорта с помощью сообщений](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md).</span><span class="sxs-lookup"><span data-stu-id="67d47-197">For more information, see [Securing Messages Using Transport Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md).</span></span>  
  
 <span data-ttu-id="67d47-198">Помимо безопасности транспорта само сообщение SOAP можно также защитить с помощью механизмов защиты сообщений.</span><span class="sxs-lookup"><span data-stu-id="67d47-198">In addition to transport security, the actual SOAP message itself can be secured using message security.</span></span> <span data-ttu-id="67d47-199">Дополнительные сведения см. в разделе [защита безопасность сообщений с помощью сообщений](../../../../docs/framework/wcf/feature-details/securing-messages-using-message-security.md).</span><span class="sxs-lookup"><span data-stu-id="67d47-199">For more information, see [Securing Messages Using Message Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-message-security.md).</span></span>  
  
 <span data-ttu-id="67d47-200">`MsmqTransportSecurity` также реализует два свойства: `MsmqEncryptionAlgorithm` и `MsmqHashAlgorithm`.</span><span class="sxs-lookup"><span data-stu-id="67d47-200">`MsmqTransportSecurity` also exposes two properties, `MsmqEncryptionAlgorithm` and `MsmqHashAlgorithm`.</span></span> <span data-ttu-id="67d47-201">Это перечисления различных алгоритмов, позволяющее задать шифрование при передаче сообщений между очередями и хэширование сигнатур.</span><span class="sxs-lookup"><span data-stu-id="67d47-201">These are enumerations of different algorithms to choose for queue-to-queue transfer encryption of messages and hashing of the signatures.</span></span>  
  
#### <a name="other-properties"></a><span data-ttu-id="67d47-202">Другие свойства</span><span class="sxs-lookup"><span data-stu-id="67d47-202">Other Properties</span></span>  
 <span data-ttu-id="67d47-203">Помимо описанных выше свойства предоставляемые привязкой свойства MSMQ включают:</span><span class="sxs-lookup"><span data-stu-id="67d47-203">In addition to the preceding properties, other MSMQ-specific properties exposed in the binding include:</span></span>  
  
-   <span data-ttu-id="67d47-204">`UseSourceJournal`: свойство, указывающее, что включено ведение журнала источника.</span><span class="sxs-lookup"><span data-stu-id="67d47-204">`UseSourceJournal`: A property to indicate that source journaling is turned on.</span></span> <span data-ttu-id="67d47-205">Ведение журнала является функцией MSMQ, отслеживающей сообщения, которые были успешно переданы из очереди передачи;</span><span class="sxs-lookup"><span data-stu-id="67d47-205">Source journaling is an MSMQ feature that keeps track of messages that have been successfully transmitted from the transmission queue.</span></span>  
  
-   <span data-ttu-id="67d47-206">`UseMsmqTracing`: свойство, указывающее, что включена трассировка MSMQ.</span><span class="sxs-lookup"><span data-stu-id="67d47-206">`UseMsmqTracing`: A property to indicate that MSMQ tracing is turned on.</span></span> <span data-ttu-id="67d47-207">Функция трассировки MSMQ отправляет сообщение с отчетом в очередь отчетов всякий раз, когда сообщение покидает компьютер с диспетчером очереди MSMQ или приходит на него;</span><span class="sxs-lookup"><span data-stu-id="67d47-207">MSMQ tracing sends report messages to a report queue each time a message leaves or arrives at a machine hosting an MSMQ queue manager.</span></span>  
  
-   <span data-ttu-id="67d47-208">`QueueTransferProtocol`: перечисление протокола, используемого для обмена сообщениями между очередями.</span><span class="sxs-lookup"><span data-stu-id="67d47-208">`QueueTransferProtocol`: An enumeration of the protocol to use for queue-to-queue message transfers.</span></span> <span data-ttu-id="67d47-209">Служба MSMQ реализует собственный протокол передачи сообщений между очередями, а также протокол на базе SOAP (SRMP).</span><span class="sxs-lookup"><span data-stu-id="67d47-209">MSMQ implements a native queue-to-queue transfer protocol and a SOAP-based protocol called SOAP Reliable Messaging Protocol (SRMP).</span></span> <span data-ttu-id="67d47-210">Протокол SRMP используется при передаче сообщений между очередями с помощью протокола HTTP.</span><span class="sxs-lookup"><span data-stu-id="67d47-210">SRMP is used when using HTTP transport for queue-to-queue transfers.</span></span> <span data-ttu-id="67d47-211">Если сообщения между очередями передаются с помощью протокола HTTPS, используется протокол SRMP;</span><span class="sxs-lookup"><span data-stu-id="67d47-211">SRMP secure is used when using HTTPS for queue-to-queue transfers.</span></span>  
  
-   <span data-ttu-id="67d47-212">`UseActiveDirectory`: логическое значение, указывающее, следует ли использовать для разрешения адресов очередей службу каталогов Active Directory.</span><span class="sxs-lookup"><span data-stu-id="67d47-212">`UseActiveDirectory`: A Boolean value to indicate whether the Active Directory must be used for queue address resolution.</span></span> <span data-ttu-id="67d47-213">По умолчанию этот режим отключен.</span><span class="sxs-lookup"><span data-stu-id="67d47-213">By default, this is off.</span></span> <span data-ttu-id="67d47-214">Дополнительные сведения см. в разделе [конечные точки служб и адресация очереди](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md).</span><span class="sxs-lookup"><span data-stu-id="67d47-214">For more information, see [Service Endpoints and Queue Addressing](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md).</span></span>  
  
### <a name="msmqintegrationbinding"></a><span data-ttu-id="67d47-215">MsmqIntegrationBinding</span><span class="sxs-lookup"><span data-stu-id="67d47-215">MsmqIntegrationBinding</span></span>  
 <span data-ttu-id="67d47-216">Привязка `MsmqIntegrationBinding` используется в тех случаях, когда конечная точка [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] должна взаимодействовать с существующим приложением MSMQ, написанном с использованием C, C++, COM или интерфейсов API System.Messaging.</span><span class="sxs-lookup"><span data-stu-id="67d47-216">The `MsmqIntegrationBinding` is used when you want a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] endpoint to communicate with an existing MSMQ application written in C, C++, COM, or System.Messaging APIs.</span></span>  
  
 <span data-ttu-id="67d47-217">Привязка имеет те же свойства, что и `NetMsmqBinding`.</span><span class="sxs-lookup"><span data-stu-id="67d47-217">The binding properties are the same as for `NetMsmqBinding`.</span></span> <span data-ttu-id="67d47-218">Однако имеются следующие различия:</span><span class="sxs-lookup"><span data-stu-id="67d47-218">However, the following differences apply:</span></span>  
  
-   <span data-ttu-id="67d47-219">контракт операции `MsmqIntegrationBinding` может принимать только один параметр типа <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601>, где параметр типа является типом тела;</span><span class="sxs-lookup"><span data-stu-id="67d47-219">The operation contract for `MsmqIntegrationBinding` is restricted to taking a single parameter of type <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> where the type parameter is the body type.</span></span>  
  
-   <span data-ttu-id="67d47-220">большинство свойств собственных сообщений MSMQ доступно в <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601>;</span><span class="sxs-lookup"><span data-stu-id="67d47-220">Much of MSMQ native message properties are exposed in the <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> for use.</span></span>  
  
-   <span data-ttu-id="67d47-221">для сериализации и десериализации тела сообщения предоставляются сериализаторы, например XML и ActiveX.</span><span class="sxs-lookup"><span data-stu-id="67d47-221">To help with serialization and deserialization of the message body, serializers such as XML and ActiveX are provided.</span></span>  
  
### <a name="sample-code"></a><span data-ttu-id="67d47-222">Пример кода</span><span class="sxs-lookup"><span data-stu-id="67d47-222">Sample Code</span></span>  
 <span data-ttu-id="67d47-223">Пошаговые инструкции по созданию служб WCF, использующих MSMQ, см. в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="67d47-223">For step by step instructions on how to write WCF services that use MSMQ see the following topics:</span></span>  
  
-   [<span data-ttu-id="67d47-224">Практическое руководство. Обмен сообщениями с конечными точками WCF и приложениями очереди сообщений</span><span class="sxs-lookup"><span data-stu-id="67d47-224">How to: Exchange Messages with WCF Endpoints and Message Queuing Applications</span></span>](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-with-wcf-endpoints-and-message-queuing-applications.md)  
  
-   [<span data-ttu-id="67d47-225">Практическое руководство. Обмен сообщениями в очереди с конечными точками WCF</span><span class="sxs-lookup"><span data-stu-id="67d47-225">How to: Exchange Queued Messages with WCF Endpoints</span></span>](../../../../docs/framework/wcf/feature-details/how-to-exchange-queued-messages-with-wcf-endpoints.md)  
  
 <span data-ttu-id="67d47-226">Полный образец кода, демонстрирующий использование MSMQ в WCF, см. в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="67d47-226">For a completed code sample illustrating the use of MSMQ in WCF see the following topics:</span></span>  
  
-   [<span data-ttu-id="67d47-227">Привязка MSMQ с поддержкой транзакций</span><span class="sxs-lookup"><span data-stu-id="67d47-227">Transacted MSMQ Binding</span></span>](../../../../docs/framework/wcf/samples/transacted-msmq-binding.md)  
  
-   [<span data-ttu-id="67d47-228">Неустойчивое взаимодействие с использованием очереди</span><span class="sxs-lookup"><span data-stu-id="67d47-228">Volatile Queued Communication</span></span>](../../../../docs/framework/wcf/samples/volatile-queued-communication.md)  
  
-   [<span data-ttu-id="67d47-229">Очереди недоставленных сообщений</span><span class="sxs-lookup"><span data-stu-id="67d47-229">Dead Letter Queues</span></span>](../../../../docs/framework/wcf/samples/dead-letter-queues.md)  
  
-   [<span data-ttu-id="67d47-230">Сеансы и очереди</span><span class="sxs-lookup"><span data-stu-id="67d47-230">Sessions and Queues</span></span>](../../../../docs/framework/wcf/samples/sessions-and-queues.md)  
  
-   [<span data-ttu-id="67d47-231">Двусторонний обмен данными</span><span class="sxs-lookup"><span data-stu-id="67d47-231">Two-Way Communication</span></span>](../../../../docs/framework/wcf/samples/two-way-communication.md)  
  
-   [<span data-ttu-id="67d47-232">Пакетирование с поддержкой транзакций</span><span class="sxs-lookup"><span data-stu-id="67d47-232">Transacted Batching</span></span>](../../../../docs/framework/wcf/samples/transacted-batching.md)  
  
-   [<span data-ttu-id="67d47-233">SRMP</span><span class="sxs-lookup"><span data-stu-id="67d47-233">SRMP</span></span>](../../../../docs/framework/wcf/samples/srmp.md)  
  
-   [<span data-ttu-id="67d47-234">Безопасность сообщений при использовании очереди сообщений</span><span class="sxs-lookup"><span data-stu-id="67d47-234">Message Security over Message Queuing</span></span>](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)  
  
## <a name="see-also"></a><span data-ttu-id="67d47-235">См. также</span><span class="sxs-lookup"><span data-stu-id="67d47-235">See Also</span></span>  
 [<span data-ttu-id="67d47-236">Конечные точки служб и адресация очереди</span><span class="sxs-lookup"><span data-stu-id="67d47-236">Service Endpoints and Queue Addressing</span></span>](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)  
 [<span data-ttu-id="67d47-237">Размещение веб-узлов в приложении, использующем очереди</span><span class="sxs-lookup"><span data-stu-id="67d47-237">Web Hosting a Queued Application</span></span>](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md)
