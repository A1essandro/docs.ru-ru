---
title: "Error handling | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework-4.6"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: c948841a-7db9-40ae-9b78-587d216cbcaf
caps.latest.revision: 3
author: "Erikre"
ms.author: "erikre"
manager: "erikre"
caps.handback.revision: 3
---
# Error handling
## Обработка ошибок в Windows Communication Foundation  
 Есть несколько способов проектирования решений по обработке исключений, когда служба обнаруживает непредвиденное исключение или ошибку.  Хотя нет единственного правильного или рекомендуемого решения, существует ряд проверенных путей, которые следует рассмотреть.  Обычно рекомендуется реализовать одно гибридное решение, объединяющее несколько подходов из приведенного ниже списка, в зависимости от сложности реализации WCF, типа и частоты исключений, разницы между обрабатываемыми и  необрабатываемыми исключениями, а также всех связанных трассировок, журналов или требований политик.  
  
 Эти решения более подробно рассматриваются далее в этом разделе.  
  
### Библиотека Microsoft Enterprise  
 Программный блок обработки исключений библиотеки Microsoft Enterprise помогает реализовать общие принципы проектирования и создать согласованную стратегию обработки исключений, возникающих на всех уровнях архитектуры корпоративного приложения.  Он предназначен для поддержки обычного кода, содержащегося в инструкциях CATCH в компонентах приложения.  Вместо того чтобы повторять этот код \(например, код, который записывает сведения об исключении в журнал\) в двух одинаковых блоках CATCH по всему приложению, можно использовать программный блок обработки исключений, который позволяет разработчикам инкапсулировать эту логику в многократно используемых обработчиках исключений.  
  
 В состав этой библиотеки входит готовый обработчик исключений контрактов ошибок.  Этот обработчик исключений предназначен для использования в пределах службы Windows® Communication Foundation \(WCF\) и создает из исключения новый контракт ошибок.  
  
 Программные блоки предназначены для встраивания широко используемых методов и обеспечивают общий подход к обработке исключений в пределах всего приложения.  С другой стороны, могут быть весьма полезными самостоятельно разрабатываемые пользовательские обработчики ошибок и контракты ошибок.  Например, пользовательские обработчики ошибок предоставляют отличную возможность автоматически повышать все исключения до уровня FaultExceptions, а также добавляют в приложение возможности ведения журналов.  
  
 Дополнительные сведения см. в статье [Библиотека Microsoft Enterprise](http://msdn.microsoft.com/library/ff632023.aspx)  
  
### Работа с ожидаемыми исключениями  
 Правильный порядок действий: перехватывать ожидаемые исключения в каждой операции или в соответствующей точке расширяемости, принимать решение о возможности восстановления и возвращать пользовательскую ошибку в исключении FaultException\<T\>  
  
### Работа с непредвиденными исключениями с помощью IErrorHandler  
 Рекомендуемый порядок действий с непредвиденными исключениями \- подключить IErrorHandler.  Обработчики ошибок могут только перехватывать исключения на уровне среды выполнения WCF \(в режиме «модели службы»\), а не на уровне канала.  Единственным способом подключения IErrorHandler на уровне канала является создание пользовательского канала, что в большинстве случаев делать не рекомендуется.  
  
 «Непредвиденное исключение» обычно не является ни неисправимым, ни исключением при обработке. Оно представляет собой непредвиденное пользовательское исключение.  Неисправимое исключение \(например, исключение при нехватке памяти\), обычно обрабатываемое [обработчиком исключений модели службы](http://msdn.microsoft.com/library/system.servicemodel.dispatcher.exceptionhandler.aspx) автоматически, как правило, не удается обработать правильно. Как правило, обработка такого исключения может осуществляться лишь для создания дополнительных записей в журнале или для возврата клиенту стандартного исключения.  Исключение при обработке возникает при обработке сообщения, например на уровне сериализации, кодировщика или модуля форматирования. Как правило, его нельзя обработать с помощью IErrorHandler, поскольку на момент возникновения таких исключений вмешательство обработчика обычно происходит либо слишком рано, либо слишком поздно.  Аналогичным образом с помощью IErrorHandler нельзя обрабатывать исключения транспорта.  
  
 С помощью IErrorHandler можно явно управлять поведением приложения, когда возникает исключение.  Можно сделать следующее:  
  
1.  Определить, отправлять ли клиенту ошибку  
  
2.  Заменить исключение ошибкой  
  
3.  Заменить ошибку другой ошибкой  
  
4.  Запустить ведение журнала или трассировку  
  
5.  Выполнить другие пользовательские действия  
  
 Можно установить пользовательский обработчик ошибок путем добавления его в свойство ErrorHandlers диспетчеров каналов для данной службы.  Может применяться несколько обработчиков ошибок, и они будут вызываться в порядке добавления в данную коллекцию.  
  
 IErrorHandler.ProvideFault управляет отправкой клиенту сообщений об ошибках.  Этот метод вызывается независимо от типа исключения, возникшего в результате операции в данной службе.  Если здесь не выполняется ни одна операция, WCF предполагает использование режима по умолчанию и продолжает работу, как будто нет никаких пользовательских обработчиков ошибок.  
  
 Одна область, в которой можно использовать этот подход, \- если необходимо создать центральное расположение для преобразования исключений в ошибки, прежде чем они будут отправлены клиенту \(при условии, что экземпляр не удаляется и канал не переходит в состояние «Ошибка»\).  
  
 Метод IErrorHandler.HandleError обычно используется для реализации режимов, связанных с возникновением ошибок, например ведения журнала ошибок, системных уведомлений, завершения работы приложения и т. д.  IErrorHandler.HandleError можно вызывать в нескольких местах внутри службы и в зависимости от того, где возникла ошибка. HandleError может вызваться тем же потоком, что и операция, или другим. В этом отношении нет никаких гарантий.  
  
### Работа с исключениями за пределами WCF  
 Часто исключения конфигурации, исключения строки подключения к базам данных и другие подобные исключения могут возникать в контексте приложения WCF, но сами они не являются исключениями, вызываемыми моделью службы или самой веб\-службой.  Эти исключения являются «стандартными» исключениями, внешними по отношению к веб\-службе, и должны обрабатываться точно так же, как другие внешние исключения в данной среде.  
  
### Трассировка исключений  
 Трассировка \- единственное место, где можно теоретически видеть все исключения.  Дополнительные сведения о трассировке исключений и занесении их в журналы см. в разделе «Трассировка и ведение журнала».  
  
### Ошибки шаблона URI при использовании WebGetAttribute и WebInvokeAttribute  
 Атрибуты WebGet и WebInvoke позволяют указывать шаблон URI, сопоставляющий компоненты адреса запроса с параметрами операции.  Например, шаблон URI «weather\/{state}\/{city}» сопоставляет адрес запроса с литеральными лексемами, параметром «state» и параметром «city».  Затем эти параметры могут быть связаны по имени с некоторым из формальных параметров операции.  
  
 Параметры шаблона отображаются в виде строк в пределах URI, тогда как формальные параметры типизированного контракта могут иметь нестроковые типы.  Таким образом, преобразование должно происходить до вызова операции.  Доступна [таблица форматов преобразования](http://msdn.microsoft.com/library/bb412172.aspx).  
  
 Однако если преобразование выполнить не удалось, то невозможно сообщить операции, что возникло какое\-то нарушение.  Вместо этого преобразование типа проявляется в виде сбоев при подготовке к отправке.  
  
 Наличие ошибок подготовки к отправке при преобразовании типов можно проверить так же, как многие другие типы ошибок отправки \- путем установки обработчика ошибки.  Для обработки исключения уровня службы вызывается точка расширения IErrorHandler.  Там можно выбрать, будет ли ответ отправлен обратно в вызывающий код, или будут выполнены какие\-либо пользовательские задачи или действия с отчетами.  
  
## См. также  
 [Простая обработка ошибок WCF](http://msdn.microsoft.com/library/gg281715.aspx)