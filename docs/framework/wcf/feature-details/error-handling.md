---
title: "Обработка ошибок"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: c948841a-7db9-40ae-9b78-587d216cbcaf
caps.latest.revision: "3"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 308712ed4c8f44740622c57525f152152f7d6c73
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="error-handling"></a>Обработка ошибок
## <a name="error-handling-in-windows-communication-foundation"></a>Обработка ошибок в Windows Communication Foundation  
 Есть несколько способов проектирования решений по обработке исключений, когда служба обнаруживает непредвиденное исключение или ошибку. Хотя нет единственного «правильный» или «рекомендаций» рекомендуемого решения, существует несколько допустимых путей, которые следует рассмотреть. Обычно рекомендуется реализовать гибридное решение, объединяющее несколько подходов из приведенного ниже списка, в зависимости от сложности реализации WCF, типа и частоты исключений, обработанных и необработанных характер исключения и всех связанных трассировок, ведение журнала или требованиям политики.  
  
 Эти решения более подробно рассматриваются далее в этом разделе.  
  
### <a name="the-microsoft-enterprise-library"></a>Библиотека Microsoft Enterprise  
 Программный блок обработки исключений библиотеки Microsoft Enterprise помогает реализовать общие принципы проектирования и создать согласованную стратегию обработки исключений, возникающих на всех уровнях архитектуры корпоративного приложения. Он предназначен для поддержки обычного кода, содержащегося в инструкциях CATCH в компонентах приложения. Вместо того чтобы повторять этот код (например, код, который записывает сведения об исключении в журнал) в двух одинаковых блоках CATCH по всему приложению, можно использовать программный блок обработки исключений, который позволяет разработчикам инкапсулировать эту логику в многократно используемых обработчиках исключений.  
  
 В состав этой библиотеки входит готовый обработчик исключений контрактов ошибок. Этот обработчик исключений предназначен для использования в пределах службы Windows® Communication Foundation (WCF) и создает из исключения новый контракт ошибок.  
  
 Программные блоки предназначены для встраивания широко используемых методов и обеспечивают общий подход к обработке исключений в пределах всего приложения. С другой стороны, могут быть весьма полезными самостоятельно разрабатываемые пользовательские обработчики ошибок и контракты ошибок. Например пользовательские обработчики ошибок предоставляют отличную возможность автоматически повышать все исключения до уровня FaultExceptions, а также для добавления в приложение возможности ведения журнала.  
  
 Дополнительные сведения см. в разделе [Microsoft Enterprise Library](http://msdn.microsoft.com/library/ff632023.aspx).  
  
### <a name="dealing-with-expected-exceptions"></a>Работа с ожидаемыми исключениями  
 Правильный порядок действий: перехватывать ожидаемые исключения в каждой операции или соответствующей точке расширяемости, решите ли они могут быть восстановлены из и возвращать пользовательскую ошибку в исключении FaultException\<T >  
  
### <a name="dealing-with-unexpected-exceptions-using-an-ierrorhandler"></a>Работа с непредвиденными исключениями с помощью IErrorHandler  
 Чтобы справиться с непредвиденными исключениями Рекомендуемое действие является «подключения» IErrorHandler. Обработчики ошибок и перехватывать только исключения на уровне среды выполнения WCF (уровень «модели службы»), а не на уровне канала. Единственным способом подключения IErrorHandler на уровне канала является создание пользовательского канала, что в большинстве случаев делать не рекомендуется.  
  
 «Непредвиденное исключение» обычно является ни неисправимым, ни исключением при обработке; Вместо этого он является собой непредвиденное пользовательское исключение. Неисправимое исключение (например, исключение нехватки памяти) — обычно обрабатываемое [обработчиком исключений модели службы](http://msdn.microsoft.com/library/system.servicemodel.dispatcher.exceptionhandler.aspx) автоматически — не удается обычно быть корректно обработаны и единственная причина для обработки такого исключения Возможно, во всех более подробное ведение журнала выполнения или для возврата клиенту стандартного исключения клиенту. Исключение при обработке возникает при обработке сообщения, например на уровне сериализации, кодировщика или модуля форматирования. Как правило, его нельзя обработать с помощью IErrorHandler, поскольку на момент возникновения таких исключений вмешательство обработчика обычно происходит либо слишком рано, либо слишком поздно. Аналогичным образом с помощью IErrorHandler нельзя обрабатывать исключения транспорта.  
  
 С помощью IErrorHandler можно явно управлять поведением приложения, когда возникает исключение. Можно сделать следующее:  
  
1.  Определить, отправлять ли клиенту ошибку  
  
2.  Заменить исключение ошибкой  
  
3.  Заменить ошибку другой ошибкой  
  
4.  Запустить ведение журнала или трассировку  
  
5.  Выполнить другие пользовательские действия  
  
 Можно установить пользовательский обработчик ошибок путем добавления его в свойство ErrorHandlers диспетчеров каналов для данной службы.  Может применяться несколько обработчиков ошибок, и они будут вызываться в порядке добавления в данную коллекцию.  
  
 IErrorHandler.ProvideFault управляет отправкой клиенту сообщений об ошибках. Этот метод вызывается независимо от типа исключения, возникшего в результате операции в данной службе. Если здесь не выполняется ни одна операция, WCF предполагает использование режима по умолчанию и продолжает работу, как будто нет никаких пользовательских обработчиков ошибок.  
  
 Одна область, в которой можно использовать этот подход, - если необходимо создать центральное расположение для преобразования исключений в ошибки, прежде чем они будут отправлены клиенту (при условии, что экземпляр не удаляется и канал не переходит в состояние «Ошибка»).  
  
 Метод IErrorHandler.HandleError обычно используется для реализации режимов, связанных с возникновением ошибок, например ведения журнала ошибок, системных уведомлений, завершения работы приложения и т. д. IErrorHandler.HandleError можно вызывать в нескольких местах внутри службы и в зависимости от того, где возникла ошибка. HandleError может вызваться тем же потоком, что и операция, или другим. В этом отношении нет никаких гарантий.  
  
### <a name="dealing-with-exceptions-outside-wcf"></a>Работа с исключениями за пределами WCF  
 Часто исключения конфигурации, исключения строки подключения к базам данных и другие подобные исключения могут возникать в контексте приложения WCF, но сами они не являются исключениями, вызываемыми моделью службы или самой веб-службой. Эти исключения являются «стандартными» исключениями, внешними веб-службе и должны обрабатываться так же, как другие внешние исключения в среде обработки.  
  
### <a name="tracing-exceptions"></a>Трассировка исключений  
 Трассировка — это только «универсальным» место, где можно теоретически видеть все исключения. Дополнительные сведения о трассировке исключений и занесении их в журналы см. в разделе «Трассировка и ведение журнала».  
  
### <a name="uri-template-errors-when-using-webgetattribute-and-webinvokeattribute"></a>Ошибки шаблона URI при использовании WebGetAttribute и WebInvokeAttribute  
 Атрибуты WebGet и WebInvoke позволяют указывать шаблон URI, сопоставляющий компоненты адреса запроса с параметрами операции. Например, шаблон URI «weather/{state}/{city}» сопоставляет адрес запроса с литеральными лексемами, параметром «state» и параметром «city». Затем эти параметры могут быть связаны по имени с некоторым из формальных параметров операции.  
  
 Параметры шаблона отображаются в виде строк в пределах URI, тогда как формальные параметры типизированного контракта могут иметь нестроковые типы. Таким образом, преобразование должно происходить до вызова операции. Объект [таблица форматов преобразования](http://msdn.microsoft.com/library/bb412172.aspx) доступен.  
  
 Однако если преобразование выполнить не удалось, то невозможно сообщить операции, что возникло какое-то нарушение. Вместо этого преобразование типа проявляется в виде сбоев при подготовке к отправке.  
  
 Наличие ошибок подготовки к отправке при преобразовании типов можно проверить так же, как многие другие типы ошибок отправки - путем установки обработчика ошибки. Для обработки исключения уровня службы вызывается точка расширения IErrorHandler. Там можно выбрать, будет ли ответ отправлен обратно в вызывающий код, или будут выполнены какие-либо пользовательские задачи или действия с отчетами.  
  
## <a name="see-also"></a>См. также  
 [Простая обработка ошибок WCF](http://msdn.microsoft.com/library/gg281715.aspx)
