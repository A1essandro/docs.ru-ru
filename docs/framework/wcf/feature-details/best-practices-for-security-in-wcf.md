---
title: "Рекомендации по безопасности при использовании WCF | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "рекомендации [WCF], безопасность"
ms.assetid: 3639de41-1fa7-4875-a1d7-f393e4c8bd69
caps.latest.revision: 19
author: "BrucePerlerMS"
ms.author: "bruceper"
manager: "mbaldwin"
caps.handback.revision: 19
---
# Рекомендации по безопасности при использовании WCF
В следующих разделах приводятся рекомендации по созданию безопасных приложений с помощью [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].[!INCLUDE[crabout](../../../../includes/crabout-md.md)] безопасности см. в разделах [Вопросы безопасности](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md), [Вопросы безопасности для данных](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md) и [Вопросы безопасности при использовании метаданных](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md).  
  
## Идентифицируйте службы, проходящие проверку подлинности Windows, с помощью различных SPN.  
 Службы могут идентифицироваться с помощью имен участника\-пользователя \(UPN\) или имен участника\-службы \(SPN\).Службы, выполняемые от имени учетных записей компьютера \(например, сетевые службы\), имеют идентификатор SPN, который совпадает с идентификатором компьютера, на котором они выполняются.Службы, выполняемые от имени учетных записей пользователя, имеют идентификатор UPN, совпадающий с идентификатором пользователя, от имени которого они выполняются, при этом средство `setspn` может использоваться для назначения SPN учетной записи пользователя.Настройка службы, делающая возможной идентификацию службы через SPN, и настройка подключающихся к службе клиентов на использование этого SPN, затрудняют определенные атаки.Это правило действует для привязок, использующих согласование Kerberos или SSPI.Несмотря на это, клиенты должны указывать SPN в случае, если SSPI возвращается к NTLM.  
  
## Проверяйте удостоверения службы в WSDL  
 WS\-SecurityPolicy позволяет службам публиковать информацию о своих удостоверениях в метаданных.Когда идентификационные данные извлекаются через `svcutil` или с помощью других методов, таких как <xref:System.ServiceModel.Description.WsdlImporter>, эти данные преобразуются в параметры удостоверения для адресов конечных точек служб [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].Клиенты, которые не подтверждают правильность и допустимость данных удостоверений службы, эффективно выполняют обход проверки подлинности службы.Вредоносная служба может использовать такие клиенты для перенаправления учетных данных и реализации других атак типа "злоумышленник в середине", изменяя заявленное в WSDL удостоверение.  
  
## Используйте сертификаты X509 вместо протокола NTLM  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] предоставляет два механизма проверки подлинности одноранговых элементов: сертификаты X509 \(используемые одноранговым каналом\) и проверку подлинности Windows, при которой согласование SSPI понижается с протокола Kerberos до протокола NTLM.Проверка подлинности на основании сертификатов с использованием размеров ключа от 1024 битов имеет преимущества по сравнению с проверкой подлинности по протоколу NTLM по следующим причинам:  
  
-   возможность взаимной проверки подлинности,  
  
-   использование усиленных алгоритмов шифрования и  
  
-   затруднение использования перенаправленных учетных данных сертификата X509.  
  
 Общие сведения по атакам перенаправления по протоколу NTLM см. в [http:\/\/msdn.microsoft.com\/msdnmag\/issues\/06\/09\/SecureByDesign\/default.aspx](http://go.microsoft.com/fwlink/?LinkId=109571).  
  
## Всегда отменяйте изменения после олицетворения  
 При использовании интерфейсов API, которые разрешают олицетворение клиента, не забудьте вернуться к исходной идентификации.Например, при работе с <xref:System.Security.Principal.WindowsIdentity> и <xref:System.Security.Principal.WindowsImpersonationContext> воспользуйтесь оператором C\# `using` или оператором `Using`[!INCLUDE[vbprvb](../../../../includes/vbprvb-md.md)], как показано в следующем примере кода.Класс <xref:System.Security.Principal.WindowsImpersonationContext> реализует интерфейс <xref:System.IDisposable>, следовательно, среда CLR автоматически возвращается к исходной идентификации после того, как код выводится из блока `using`.  
  
 [!code-csharp[c_SecurityBestPractices#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securitybestpractices/cs/source.cs#1)]
 [!code-vb[c_SecurityBestPractices#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securitybestpractices/vb/source.vb#1)]  
  
## Используйте олицетворение только при необходимости  
 Метод <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> класса <xref:System.Security.Principal.WindowsIdentity> позволяет осуществлять строгий контроль над использованием олицетворения.В этом заключается отличие от использования свойства <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A><xref:System.ServiceModel.OperationBehaviorAttribute>, которое позволяет использовать олицетворение в рамках всей операции.По возможности контролируйте область применения олицетворения с помощью более точного метода <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A>.  
  
## Получайте метаданные из надежных источников  
 Убедитесь в надежности источника метаданных и в том, что метаданные не были злонамеренно искажены.Метаданные, полученные по протоколу HTTP, передаются открытым текстом и могут быть подделаны.Если в службе используются свойства <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> и <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A>, для загрузки данных по протоколу HTTPS используйте URL\-адрес, предоставленный разработчиком службы.  
  
## Публикуйте метаданные с использованием безопасности  
 Для предотвращения злонамеренного искажения метаданных, опубликованных службой, обеспечьте защиту конечной точки обмена метаданными с помощью безопасности на уровне транспорта или на уровне сообщений.[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Публикация конечных точек метаданных](../../../../docs/framework/wcf/publishing-metadata-endpoints.md) и [Как опубликовать метаданные для службы с использованием кода](../../../../docs/framework/wcf/feature-details/how-to-publish-metadata-for-a-service-using-code.md).  
  
## Разрешите использование локального издателя  
 Если для данной привязки указаны адрес издателя и привязка, локальный издатель не применяется в конечных точках, использующих эту привязку.Клиенты, которые предполагают всегда использовать локальный издатель, должны убедиться, что они не используют такую привязку или что привязка изменена таким образом, что адрес издателя пуст.  
  
## Квоты на размер токенов SAML  
 Когда токены Security Assertion Markup Language \(SAML\) сериализуются в сообщениях, то, независимо от того, выдаются ли они службой токенов безопасности \(STS\) или предоставляются клиентами для служб как часть проверки подлинности, квота на максимальный размер сообщения должна быть достаточно большой, чтобы вместить токен SAML и другие части сообщения.Как правило, по умолчанию квоты на размер сообщения являются достаточными.Однако если большой размер маркера SAML объясняется содержанием в нем сотен утверждений, следует увеличить квоты для выделения места сериализованному маркеру.[!INCLUDE[crabout](../../../../includes/crabout-md.md)] квотах см. в разделе [Вопросы безопасности для данных](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md).  
  
## Задайте параметру SecurityBindingElement.IncludeTimestamp значение True в пользовательских привязках  
 При создании пользовательской привязки следует задать параметру <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> значение `true`.В противном случае, если параметр <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> имеет значение `false`, а клиент использует асимметричный токен на основе ключа, например, сертификат Х509, сообщение не будет подписано.  
  
## См. также  
 [Вопросы безопасности](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)   
 [Вопросы безопасности для данных](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md)   
 [Вопросы безопасности при использовании метаданных](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md)