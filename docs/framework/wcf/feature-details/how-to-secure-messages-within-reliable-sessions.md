---
title: "Как защитить сообщения с помощью надежных сеансов | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework-4.6"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: aee33e50-936f-4486-9ca8-c1520c19a62d
caps.latest.revision: 8
author: "BrucePerlerMS"
ms.author: "bruceper"
manager: "mbaldwin"
caps.handback.revision: 8
---
# Как защитить сообщения с помощью надежных сеансов
В этом разделе описывается обеспечение безопасности на уровне сообщения в ходе надежного сеанса обмена сообщениями с использованием одной из предоставляемых системой привязок, которые поддерживают такие сеансы, но не по умолчанию.Разрешить защищенный, надежный сеанс можно принудительно \(в коде\) или декларативно \(в файле конфигурации\).В этой процедуре для разрешения защищенного, надежного сеанса используются файлы конфигурации клиента и службы.  
  
 Эта процедура включает выполнение трех основных задач, а именно:  
  
1.  необходимо задать, что клиент и служба обмениваются сообщениями в ходе надежного сеанса;  
  
2.  необходимо обеспечить безопасность на уровне сообщения в ходе надежного сеанса;  
  
3.  необходимо задать тип учетных данных клиента, который должен использоваться при проверке подлинности клиента в службе.  
  
 При выполнении первой задачи следует убедиться в том, что элемент конфигурации конечной точки содержит атрибут `bindingConfiguration`, ссылающийся на конфигурацию привязки с именем \(в данном примере\) "MessageSecurity". Затем можно сослаться на это имя с помощью элемента конфигурации [\<привязка\>](../../../../docs/framework/misc/binding.md), чтобы разрешить надежные сеансы, присвоив атрибуту `enabled` элемента [reliableSession](http://msdn.microsoft.com/ru-ru/9c93818a-7dfa-43d5-b3a1-1aafccf3a00b) значение `true`.Можно потребовать гарантии упорядоченной доставки сообщений в ходе надежного сеанса, присвоив атрибуту `ordered` значение `true`.  
  
 Копию исходного кода этого примера, на котором основывается данная процедура конфигурации, см. в разделе [Надежный сеанс WS](../../../../docs/framework/wcf/samples/ws-reliable-session.md).  
  
 Выполнение второй задачи обеспечивается заданием значения `Message` для атрибута `mode` элемента \<`security`\>, который содержится в элементе \<`binding`\> клиента и службы.  
  
 Выполнение третьей задачи обеспечивается заданием значения `Certificate` для атрибута `clientCredentialType` элемента \<`message`\>, который содержится в элементе \<`security`\> клиента и службы.  
  
> [!NOTE]
>  При использовании безопасности сообщения для надежных сеансов в случае, если клиент не проходит проверку подлинности, надежный обмен сообщениями предпринимает попытки провести проверку подлинности клиента до истечения времени ожидания, а не создает исключение после первой неудачной попытки.  
  
### Настройка использования надежного сеанса службой с привязкой WSHttpBinding  
  
1.  Данная процедура описана в разделе [Как обмениваться сообщениями в рамках надежного сеанса](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md).  
  
### Настройка использования надежного сеанса клиентом с привязкой WSHttpBinding  
  
1.  Данная процедура описана в разделе [Как обмениваться сообщениями в рамках надежного сеанса](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md).  
  
### Задание режима и свойства ClientCredentialType в конфигурации  
  
1.  Добавьте соответствующий элемент привязки в элемент [\<привязки\>](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md) файла конфигурации.В следующем примере добавляется элемент [\<wsHttpBinding\>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md).  
  
2.  Добавьте элемент \<`binding`\> и присвойте его атрибуту `name` соответствующее значение.  
  
3.  Добавьте элемент `<security>` и присвойте атрибуту `mode` значение `Message`.  
  
     В следующем примере задается режим `Message`, а затем атрибуту `clientCredentialType` элемента \<`message`\> присваивается значение `Certificate`.  
  
    ```  
    <wsHttpBinding>  
    <binding name="MessageSecurity">  
        <security mode="Message" />  
           <message clientCredentialType = " Certificate" />  
        </security>  
    </binding>  
    </wsHttpBinding >  
    ```