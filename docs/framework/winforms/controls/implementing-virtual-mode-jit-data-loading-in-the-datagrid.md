---
title: "Реализация виртуального режима с JIT-загрузкой данных для элемента управления DataGridView в Windows Forms"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-winforms
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- examples [Windows Forms], just-in-time data loading
- data [Windows Forms], managing large data sets
- DataGridView control [Windows Forms], virtual mode
- just-in-time data loading
- DataGridView control [Windows Forms], large data sets
- virtual mode [Windows Forms], just-in-time data loading
ms.assetid: c2a052b9-423c-4ff7-91dc-d8c7c79345f6
caps.latest.revision: "13"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 2a830c11e8df73b71f16c1b9dfd1007461d910f5
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2017
---
# <a name="implementing-virtual-mode-with-just-in-time-data-loading-in-the-windows-forms-datagridview-control"></a><span data-ttu-id="4fe17-102">Реализация виртуального режима с JIT-загрузкой данных для элемента управления DataGridView в Windows Forms</span><span class="sxs-lookup"><span data-stu-id="4fe17-102">Implementing Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control</span></span>
<span data-ttu-id="4fe17-103">Реализация виртуального режима в одной из причин <xref:System.Windows.Forms.DataGridView> управления является получение данных только по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="4fe17-103">One reason to implement virtual mode in the <xref:System.Windows.Forms.DataGridView> control is to retrieve data only as it is needed.</span></span> <span data-ttu-id="4fe17-104">Это называется *загрузка данных в момент*.</span><span class="sxs-lookup"><span data-stu-id="4fe17-104">This is called *just-in-time data loading*.</span></span>  
  
 <span data-ttu-id="4fe17-105">При работе с очень большими таблицами в удаленной базе данных, например, может потребоваться исключить задержки при запуске, извлекая только данные, необходимые для отображения и извлекая дополнительные данные только в том случае, когда пользователь прокручивает новых строк в представлении.</span><span class="sxs-lookup"><span data-stu-id="4fe17-105">If you are working with a very large table in a remote database, for example, you might want to avoid startup delays by retrieving only the data that is necessary for display and retrieving additional data only when the user scrolls new rows into view.</span></span> <span data-ttu-id="4fe17-106">Если клиентские компьютеры под управлением приложения имеют ограниченный объем памяти для хранения данных, может также потребоваться удаления неиспользуемых данных при извлечении новых значений из базы данных.</span><span class="sxs-lookup"><span data-stu-id="4fe17-106">If the client computers running your application have a limited amount of memory available for storing data, you might also want to discard unused data when retrieving new values from the database.</span></span>  
  
 <span data-ttu-id="4fe17-107">В следующих разделах описаны способы использования <xref:System.Windows.Forms.DataGridView> управления с кэшем на времени.</span><span class="sxs-lookup"><span data-stu-id="4fe17-107">The following sections describe how to use a <xref:System.Windows.Forms.DataGridView> control with a just-in-time cache.</span></span>  
  
 <span data-ttu-id="4fe17-108">Скопируйте код из этой темы, в разделе [как: реализация виртуального режима с JIT-загрузкой данных в элементе управления DataGridView Windows Forms](../../../../docs/framework/winforms/controls/virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md).</span><span class="sxs-lookup"><span data-stu-id="4fe17-108">To copy the code in this topic as a single listing, see [How to: Implement Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control](../../../../docs/framework/winforms/controls/virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md).</span></span>  
  
## <a name="the-form"></a><span data-ttu-id="4fe17-109">Формы</span><span class="sxs-lookup"><span data-stu-id="4fe17-109">The Form</span></span>  
 <span data-ttu-id="4fe17-110">В следующем примере кода определяется форму, содержащую только для чтения <xref:System.Windows.Forms.DataGridView> управления, который взаимодействует с `Cache` посредством <xref:System.Windows.Forms.DataGridView.CellValueNeeded> обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="4fe17-110">The following code example defines a form containing a read-only <xref:System.Windows.Forms.DataGridView> control that interacts with a `Cache` object through a <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event handler.</span></span> <span data-ttu-id="4fe17-111">`Cache` Управляет значениями, хранящимися локально и использует `DataRetriever` объекта для извлечения значения из таблицы Orders учебной базы данных "Борей".</span><span class="sxs-lookup"><span data-stu-id="4fe17-111">The `Cache` object manages the locally stored values and uses a `DataRetriever` object to retrieve values from the Orders table of the sample Northwind database.</span></span> <span data-ttu-id="4fe17-112">`DataRetriever` Объект, который реализует `IDataPageRetriever` интерфейс, необходимый `Cache` класса, также используется для инициализации <xref:System.Windows.Forms.DataGridView> управления строками и столбцами.</span><span class="sxs-lookup"><span data-stu-id="4fe17-112">The `DataRetriever` object, which implements the `IDataPageRetriever` interface required by the `Cache` class, is also used to initialize the <xref:System.Windows.Forms.DataGridView> control rows and columns.</span></span>  
  
 <span data-ttu-id="4fe17-113">`IDataPageRetriever`, `DataRetriever`, И `Cache` типы описаны далее в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="4fe17-113">The `IDataPageRetriever`, `DataRetriever`, and `Cache` types are described later in this topic.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4fe17-114">Хранение конфиденциальных сведений (например, пароля) в строке подключения может повлиять на безопасность приложения.</span><span class="sxs-lookup"><span data-stu-id="4fe17-114">Storing sensitive information, such as a password, within the connection string can affect the security of your application.</span></span> <span data-ttu-id="4fe17-115">Использование проверки подлинности Windows (также называемой встроенными средствами безопасности) — более безопасный способ управления доступом к базе данных.</span><span class="sxs-lookup"><span data-stu-id="4fe17-115">Using Windows Authentication (also known as integrated security) is a more secure way to control access to a database.</span></span> <span data-ttu-id="4fe17-116">Дополнительные сведения см. в разделе [Защита сведений о подключении](../../../../docs/framework/data/adonet/protecting-connection-information.md).</span><span class="sxs-lookup"><span data-stu-id="4fe17-116">For more information, see [Protecting Connection Information](../../../../docs/framework/data/adonet/protecting-connection-information.md).</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#100](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#100)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#100](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#100)]  
  
## <a name="the-idatapageretriever-interface"></a><span data-ttu-id="4fe17-117">Интерфейс IDataPageRetriever</span><span class="sxs-lookup"><span data-stu-id="4fe17-117">The IDataPageRetriever Interface</span></span>  
 <span data-ttu-id="4fe17-118">В следующем примере кода определяется `IDataPageRetriever` интерфейс, который реализуется `DataRetriever` класса.</span><span class="sxs-lookup"><span data-stu-id="4fe17-118">The following code example defines the `IDataPageRetriever` interface, which is implemented by the `DataRetriever` class.</span></span> <span data-ttu-id="4fe17-119">Является единственным методом, объявленным в этом интерфейсе `SupplyPageOfData` метод, который требуется начальный индекс строки и число строк на одной странице данных.</span><span class="sxs-lookup"><span data-stu-id="4fe17-119">The only method declared in this interface is the `SupplyPageOfData` method, which requires an initial row index and a count of the number of rows in a single page of data.</span></span> <span data-ttu-id="4fe17-120">Эти значения используются средством реализации для извлечения подмножества данных из источника данных.</span><span class="sxs-lookup"><span data-stu-id="4fe17-120">These values are used by the implementer to retrieve a subset of data from a data source.</span></span>  
  
 <span data-ttu-id="4fe17-121">Объект `Cache` объект использует реализацию этого интерфейса во время построения для загрузки двух начальных страниц данных.</span><span class="sxs-lookup"><span data-stu-id="4fe17-121">A `Cache` object uses an implementation of this interface during construction to load two initial pages of data.</span></span> <span data-ttu-id="4fe17-122">Каждый раз, когда требуется некэшированные значение, кэш очищает одну из этих страниц и запрашивает новую страницу с значением из `IDataPageRetriever`.</span><span class="sxs-lookup"><span data-stu-id="4fe17-122">Whenever an uncached value is needed, the cache discards one of these pages and requests a new page containing the value from the `IDataPageRetriever`.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#201](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#201)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#201](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#201)]  
  
## <a name="the-dataretriever-class"></a><span data-ttu-id="4fe17-123">Класс DataRetriever</span><span class="sxs-lookup"><span data-stu-id="4fe17-123">The DataRetriever Class</span></span>  
 <span data-ttu-id="4fe17-124">В следующем примере кода определяется `DataRetriever` класса, который реализует `IDataPageRetriever` интерфейс для извлечения страниц данных с сервера.</span><span class="sxs-lookup"><span data-stu-id="4fe17-124">The following code example defines the `DataRetriever` class, which implements the `IDataPageRetriever` interface to retrieve pages of data from a server.</span></span> <span data-ttu-id="4fe17-125">`DataRetriever` Класс также предоставляет `Columns` и `RowCount` свойства, который <xref:System.Windows.Forms.DataGridView> управления используется для создания необходимых столбцов и добавления соответствующего числа пустых строк для <xref:System.Windows.Forms.DataGridView.Rows%2A> коллекции.</span><span class="sxs-lookup"><span data-stu-id="4fe17-125">The `DataRetriever` class also provides `Columns` and `RowCount` properties, which the <xref:System.Windows.Forms.DataGridView> control uses to create the necessary columns and to add the appropriate number of empty rows to the <xref:System.Windows.Forms.DataGridView.Rows%2A> collection.</span></span> <span data-ttu-id="4fe17-126">Добавление пустых строк необходим, чтобы элемент управления будет действует так, будто он содержит все данные в таблице.</span><span class="sxs-lookup"><span data-stu-id="4fe17-126">Adding the empty rows is necessary so that the control will behave as though it contains all the data in the table.</span></span> <span data-ttu-id="4fe17-127">Это означает, что ползунка полосы прокрутки будет иметь соответствующий размер, что пользователь будет иметь доступ к любой строки в таблице.</span><span class="sxs-lookup"><span data-stu-id="4fe17-127">This means that the scroll box in the scroll bar will have the appropriate size, and the user will be able to access any row in the table.</span></span> <span data-ttu-id="4fe17-128">Строки заполняются <xref:System.Windows.Forms.DataGridView.CellValueNeeded> обработчик событий только в том случае, если они находятся в результате прокрутки.</span><span class="sxs-lookup"><span data-stu-id="4fe17-128">The rows are filled by the <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event handler only when they are scrolled into view.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#200](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#200)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#200](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#200)]  
  
## <a name="the-cache-class"></a><span data-ttu-id="4fe17-129">Класс Cache</span><span class="sxs-lookup"><span data-stu-id="4fe17-129">The Cache Class</span></span>  
 <span data-ttu-id="4fe17-130">В следующем примере кода определяется `Cache` класс, который управляет двумя страницами данных заполняется через `IDataPageRetriever` реализации.</span><span class="sxs-lookup"><span data-stu-id="4fe17-130">The following code example defines the `Cache` class, which manages two pages of data populated through an `IDataPageRetriever` implementation.</span></span> <span data-ttu-id="4fe17-131">`Cache` Класс определяет внутреннюю `DataPage` структуру, которая содержит <xref:System.Data.DataTable> для хранения значений в одном кэше страницы и которая вычисляет индексы строк, представляющие верхнюю и нижнюю границы страницы.</span><span class="sxs-lookup"><span data-stu-id="4fe17-131">The `Cache` class defines an inner `DataPage` structure, which contains a <xref:System.Data.DataTable> to store the values in a single cache page and which calculates the row indexes that represent the upper and lower boundaries of the page.</span></span>  
  
 <span data-ttu-id="4fe17-132">`Cache` Класс загружает две страницы данных во время построения.</span><span class="sxs-lookup"><span data-stu-id="4fe17-132">The `Cache` class loads two pages of data at construction time.</span></span> <span data-ttu-id="4fe17-133">Каждый раз, когда <xref:System.Windows.Forms.DataGridView.CellValueNeeded> событий запрашивает значение, `Cache` определяет объект, если значение доступно в одной из двух его страницы, а также, если это так, то возвращает его.</span><span class="sxs-lookup"><span data-stu-id="4fe17-133">Whenever the <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event requests a value, the `Cache` object determines if the value is available in one of its two pages and, if so, returns it.</span></span> <span data-ttu-id="4fe17-134">Если значение локально не доступно, `Cache` определяет, какая из двух страниц дальше всего от текущих отображаемых строк и заменяет страницу новой с запрошенным значением, которое затем возвращается.</span><span class="sxs-lookup"><span data-stu-id="4fe17-134">If the value is not available locally, the `Cache` object determines which of its two pages is farthest from the currently displayed rows and replaces the page with a new one containing the requested value, which it then returns.</span></span>  
  
 <span data-ttu-id="4fe17-135">Предположим, что количество строк на странице данных является таким же, как количество строк, которые отображаются на экране одновременно, эта модель позволяет пользователям постраничного просмотра в таблице эффективно вернуться на страницу Недавно просмотренные.</span><span class="sxs-lookup"><span data-stu-id="4fe17-135">Assuming that the number of rows in a data page is the same as the number of rows that can be displayed on screen at once, this model allows users paging through the table to efficiently return to the most recently viewed page.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#300](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#300)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#300](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#300)]  
  
## <a name="additional-considerations"></a><span data-ttu-id="4fe17-136">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="4fe17-136">Additional Considerations</span></span>  
 <span data-ttu-id="4fe17-137">В предыдущих примерах кода предоставляются в качестве демонстрации загрузка данных в момент.</span><span class="sxs-lookup"><span data-stu-id="4fe17-137">The previous code examples are provided as a demonstration of just-in-time data loading.</span></span> <span data-ttu-id="4fe17-138">Необходимо изменить код для своих потребностей для достижения максимальной эффективности.</span><span class="sxs-lookup"><span data-stu-id="4fe17-138">You will need to modify the code for your own needs to achieve maximum efficiency.</span></span> <span data-ttu-id="4fe17-139">Как минимум необходимо выбрать соответствующее значение для числа строк на странице данных в кэше.</span><span class="sxs-lookup"><span data-stu-id="4fe17-139">At minimum, you will need to choose an appropriate value for the number of rows per page of data in the cache.</span></span> <span data-ttu-id="4fe17-140">Это значение передается в `Cache` конструктора.</span><span class="sxs-lookup"><span data-stu-id="4fe17-140">This value is passed into the `Cache` constructor.</span></span> <span data-ttu-id="4fe17-141">Количество строк на странице должно быть не меньше, чем количество строк, которые могут одновременно отображаться в вашей <xref:System.Windows.Forms.DataGridView> элемента управления.</span><span class="sxs-lookup"><span data-stu-id="4fe17-141">The number of rows per page should be no less than the number of rows that can be displayed simultaneously in your <xref:System.Windows.Forms.DataGridView> control.</span></span>  
  
 <span data-ttu-id="4fe17-142">Для получения наилучших результатов необходимо провести тестирование производительности для определения требований системы и пользователей.</span><span class="sxs-lookup"><span data-stu-id="4fe17-142">For best results, you will need to conduct performance testing and usability testing to determine the requirements of your system and your users.</span></span> <span data-ttu-id="4fe17-143">Несколько факторов, которые необходимо принимать во внимание включают объем памяти в клиентских компьютеров, выполняющих приложение, доступная пропускная способность сетевого подключения и задержки сервера, используемого.</span><span class="sxs-lookup"><span data-stu-id="4fe17-143">Several factors that you will need to take into consideration include the amount of memory in the client machines running your application, the available bandwidth of the network connection used, and the latency of the server used.</span></span> <span data-ttu-id="4fe17-144">Полосы пропускания и задержки должно определяться во время активного использования.</span><span class="sxs-lookup"><span data-stu-id="4fe17-144">The bandwidth and latency should be determined at times of peak usage.</span></span>  
  
 <span data-ttu-id="4fe17-145">Для повышения быстродействия приложения, можно увеличить объем данных, хранящихся локально.</span><span class="sxs-lookup"><span data-stu-id="4fe17-145">To improve the scrolling performance of your application, you can increase the amount of data stored locally.</span></span> <span data-ttu-id="4fe17-146">Чтобы сократить время запуска, однако следует загружать слишком много данных изначально.</span><span class="sxs-lookup"><span data-stu-id="4fe17-146">To improve startup time, however, you must avoid loading too much data initially.</span></span> <span data-ttu-id="4fe17-147">Может потребоваться изменить `Cache` класса, чтобы увеличить число страниц данных, он позволяет хранить.</span><span class="sxs-lookup"><span data-stu-id="4fe17-147">You may want to modify the `Cache` class to increase the number of data pages it can store.</span></span> <span data-ttu-id="4fe17-148">С помощью нескольких страниц данных может повысить эффективность прокрутки, но вам потребуется определить оптимальное количество строк на странице данных, в зависимости от доступной пропускной способности и задержке сервера.</span><span class="sxs-lookup"><span data-stu-id="4fe17-148">Using more data pages can improve scrolling efficiency, but you will need to determine the ideal number of rows in a data page, depending on the available bandwidth and the server latency.</span></span> <span data-ttu-id="4fe17-149">При меньших страницах сервер будет осуществляться чаще, но будет занимать меньше времени, чтобы вернуть запрошенные данные.</span><span class="sxs-lookup"><span data-stu-id="4fe17-149">With smaller pages, the server will be accessed more frequently, but will take less time to return the requested data.</span></span> <span data-ttu-id="4fe17-150">Если задержка больше, чем пропускной способности на проблему, можно использовать страниц данных большего размера.</span><span class="sxs-lookup"><span data-stu-id="4fe17-150">If latency is more of an issue than bandwidth, you may want to use larger data pages.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4fe17-151">См. также</span><span class="sxs-lookup"><span data-stu-id="4fe17-151">See Also</span></span>  
 <xref:System.Windows.Forms.DataGridView>  
 <xref:System.Windows.Forms.DataGridView.VirtualMode%2A>  
 [<span data-ttu-id="4fe17-152">Оптимизация производительности элемента управления DataGridView в Windows Forms</span><span class="sxs-lookup"><span data-stu-id="4fe17-152">Performance Tuning in the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/performance-tuning-in-the-windows-forms-datagridview-control.md)  
 [<span data-ttu-id="4fe17-153">Масштабирование элемента управления DataGridView в Windows Forms</span><span class="sxs-lookup"><span data-stu-id="4fe17-153">Best Practices for Scaling the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/best-practices-for-scaling-the-windows-forms-datagridview-control.md)  
 [<span data-ttu-id="4fe17-154">Виртуальный режим элемента управления DataGridView в Windows Forms</span><span class="sxs-lookup"><span data-stu-id="4fe17-154">Virtual Mode in the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/virtual-mode-in-the-windows-forms-datagridview-control.md)  
 [<span data-ttu-id="4fe17-155">Пошаговое руководство. Реализация виртуального режима для элемента управления DataGridView в Windows Forms</span><span class="sxs-lookup"><span data-stu-id="4fe17-155">Walkthrough: Implementing Virtual Mode in the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/implementing-virtual-mode-wf-datagridview-control.md)  
 [<span data-ttu-id="4fe17-156">Практическое руководство. Реализация виртуального режима с JIT-загрузкой данных для элемента управления DataGridView в Windows Forms</span><span class="sxs-lookup"><span data-stu-id="4fe17-156">How to: Implement Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md)
