---
title: Проверка введенных пользователем данных в Windows Forms
ms.date: 03/30/2017
helpviewer_keywords:
- Windows Forms, validating user input
- validation [Windows Forms], Windows Forms user input
- user input [Windows Forms], validating in Windows Forms
- validating user input [Windows Forms], Windows Forms
ms.assetid: 4ec07681-1dee-4bf9-be5e-718f635a33a1
ms.openlocfilehash: adc138ad1e277f69f27f9f86fc5c3ea28a8d5cce
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
ms.locfileid: "33541811"
---
# <a name="user-input-validation-in-windows-forms"></a>Проверка введенных пользователем данных в Windows Forms
После ввода данных в приложение, может потребоваться Проверьте допустимость данных перед вашим приложением. Может потребоваться, что некоторые текстовые поля не нулевой длины, отформатированы как номер телефона или другой тип данных поля, или что строка содержит любые небезопасных символов, которые могут использоваться для нарушения безопасности базы данных. Windows Forms предоставляет несколько способов для проверки входных данных в приложении.  
  
## <a name="validation-with-the-maskedtextbox-control"></a>Проверка с помощью управления MaskedTextBox  
 Если требуется, чтобы пользователи должны вводить данные в определенном формате, например номер телефона или номер части, вы может сделать быстро и с минимальным объемом кода с помощью <xref:System.Windows.Forms.MaskedTextBox> элемента управления. Объект *маска* представляет собой строку, состоящую из знаков языка масок, указывающее, какие символы могут вводиться в любом заданном положении в текстовом поле. Элемент управления отображает набор приглашений пользователю. Если пользователь вводит неправильную запись, например, пользователь вводит букву, когда требуется цифра, элемент управления автоматически отклонит входных данных.  
  
 Язык маски, используемый <xref:System.Windows.Forms.MaskedTextBox> стал более гибким. Он позволяет указать необходимые знаки, необязательные символы, литеральных символов, такие как дефисы и круглые скобки, знаки валют и разделители компонентов даты. Элемент управления также работает при привязке к источнику данных. <xref:System.Windows.Forms.Binding.Format> Событий для привязки данных можно использовать для формата входящих данных в соответствии с маской и <xref:System.Windows.Forms.Binding.Parse> событий можно использовать для переформатирования выходных данных должна соответствовать спецификациям поля данных.  
  
 Дополнительные сведения см. в разделе [управления MaskedTextBox](../../../docs/framework/winforms/controls/maskedtextbox-control-windows-forms.md).  
  
## <a name="event-driven-validation"></a>Проверка на основе событий  
 Если требуется полный программный контроль над проверкой или необходимо выполнить сложную проверку, следует использовать события проверки, которые встроены в большинство элементов управления Windows Forms. Каждый элемент управления ввода данных пользователем в свободной форме имеет <xref:System.Windows.Forms.Control.Validating> событие, которое будет выполняться каждый раз, когда элементу управления требуется проверка данных. В <xref:System.Windows.Forms.Control.Validating> метод обработки событий, можно проверить пользовательский ввод несколькими способами. Например если у вас есть текстовое поле, которое должно содержать почтовый индекс, можно выполнить проверку следующим образом:  
  
-   Если почтовый индекс должен принадлежать к определенной группе почтовых индексов, можно выполнить сравнение строк выполняется на входных данных для проверки данных, введенных пользователем. Например если почтовый индекс должен быть в наборе {10001, 10002, 10003}, сравнения строк можно использовать для проверки данных.  
  
-   Если почтовый индекс должен быть в определенной форме можно использовать регулярные выражения для проверки данных, введенных пользователем. Например, чтобы проверить формат `#####` или `#####-####`, можно использовать регулярное выражение `^(\d{5})(-\d{4})?$`. Чтобы проверить формат `A#A #A#`, можно использовать регулярное выражение `[A-Z]\d[A-Z] \d[A-Z]\d`. Дополнительные сведения о регулярных выражениях см. в разделе [регулярные выражения .NET Framework](../../../docs/standard/base-types/regular-expressions.md) и [Примеры регулярных выражений](../../../docs/standard/base-types/regular-expression-examples.md).  
  
-   Если почтовый индекс должен быть допустимый почтовый индекс США, можно назвать почтовый индекс веб-службы для проверки данных, введенных пользователем.  
  
 <xref:System.Windows.Forms.Control.Validating> Событий передается объект типа <xref:System.ComponentModel.CancelEventArgs>. Если выяснилось, что данные элемента управления не является допустимым, вы можете отменить <xref:System.Windows.Forms.Control.Validating> событий, установив этот объект <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> свойства `true`. Если вы не установите <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> , Windows Forms будет предполагать, что проверка выполнена успешно, для этого элемента управления и вызвать <xref:System.Windows.Forms.Control.Validated> событий.  
  
 Пример кода, который проверяет адреса электронной почты в <xref:System.Windows.Controls.TextBox>, в разделе <xref:System.Windows.Forms.Control.Validating>.  
  
### <a name="data-binding-and-event-driven-validation"></a>Привязка данных и проверка на основе событий  
 Проверка очень полезна, когда элементы управления привязаны к источнику данных, например в таблице базы данных. С помощью проверки можно убедиться в том, данные элемента управления, удовлетворяющий формат, требуемый источник данных, и что он не содержит специальные символы, такими как кавычки и символы косой черты, может быть небезопасным.  
  
 При использовании привязки данных данные в элементе управления синхронизируются с источником данных во время выполнения <xref:System.Windows.Forms.Control.Validating> событий. Если вы отмените <xref:System.Windows.Forms.Control.Validating> события, данные не будут синхронизированы с источником данных.  
  
> [!IMPORTANT]
>  Если пользовательская проверка, которая выполняется после <xref:System.Windows.Forms.Control.Validating> события, это не повлияет на привязки данных. Например, если у вас есть код <xref:System.Windows.Forms.Control.Validated> событие, которое пытается отменить привязку данных, привязка данных будут выполняться. В этом случае для выполнения проверки в <xref:System.Windows.Forms.Control.Validated> события элемента управления изменяется **режим обновления источника данных** свойство (**в группе (Databindings)**\\ **(Дополнительно)** ) из **OnValidation** для **никогда**и добавьте *управления*`.DataBindings["`*\<YOURFIELD >*  `"].WriteValue()` в код проверки.  
  
### <a name="implicit-and-explicit-validation"></a>Явные и неявные проверки  
 Если данных элемента управления получить проверку? Это зависит от разработчика. Можно использовать явную или неявную проверку, в зависимости от требований приложения.  
  
#### <a name="implicit-validation"></a>Неявная проверка  
 Неявная проверка данные проверяются при нажатии пользователем его. Вы можете проверять данные, как данные, введенные в элемент управления путем чтения клавиш по мере их нажатия и более часто всякий раз, когда пользователь получает фокус ввода от одного элемента управления и переходит к следующему. Этот подход полезен, если вы хотите предоставить пользователю немедленный отклик о данных во время работы.  
  
 Если вы хотите использовать неявную проверку для элемента управления, необходимо задать элемента управления <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> свойства `true`. Если вы отмените <xref:System.Windows.Forms.Control.Validating> событий, поведение элемента управления определяется значением назначен <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>. Если вы назначили <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange>, вызовет отмену события <xref:System.Windows.Forms.Control.Validated> события не возникают. Фокус ввода останется на текущий элемент управления, пока пользователь введет допустимые входные данные. Если вы назначили <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>, <xref:System.Windows.Forms.Control.Validated> событие не происходит при отмене события, но фокус будет по-прежнему изменять к следующему элементу управления.  
  
 Назначение <xref:System.Windows.Forms.AutoValidate.Disable> для <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> свойство полностью запрещает неявные проверки. Чтобы проверить элементы управления, необходимо использовать явную проверку.  
  
#### <a name="explicit-validation"></a>Явную проверку  
 При явной проверке данные проверяются за один раз. Можно проверить данные в ответ на действия пользователя, например нажатие кнопки Сохранить или следующей ссылки. Когда происходит действие пользователя, можно вызвать явную проверку в одном из следующих способов:  
  
-   Вызовите <xref:System.Windows.Forms.ContainerControl.Validate%2A> для проверки последний элемент управления потерял фокус ввода.  
  
-   Вызовите <xref:System.Windows.Forms.ContainerControl.ValidateChildren%2A> для проверки всех дочерних элементов управления в форму или контейнерный элемент управления.  
  
-   Вызовите пользовательский метод для проверки данных в элементах управления вручную.  
  
#### <a name="default-implicit-validation-behavior-for-windows-forms-controls"></a>Неявная проверка по умолчанию для Windows Forms, элементы управления  
 Различные элементы управления Windows Forms имеют различные значения по умолчанию для их <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> свойство. В следующей таблице показаны наиболее распространенных элементов управления и их значения по умолчанию.  
  
|Элемент управления|Поведение проверки по умолчанию|  
|-------------|---------------------------------|  
|<xref:System.Windows.Forms.ContainerControl>|<xref:System.Windows.Forms.AutoValidate.Inherit>|  
|<xref:System.Windows.Forms.Form>|<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>|  
|<xref:System.Windows.Forms.PropertyGrid>|Свойства, которые не представлены в Visual Studio|  
|<xref:System.Windows.Forms.ToolStripContainer>|Свойства, которые не представлены в Visual Studio|  
|<xref:System.Windows.Forms.SplitContainer>|<xref:System.Windows.Forms.AutoValidate.Inherit>|  
|<xref:System.Windows.Forms.UserControl>|<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>|  
  
## <a name="closing-the-form-and-overriding-validation"></a>Закрытие формы и обход проверки  
 Если элемент управления сохраняет фокус, так как данные, содержащиеся в нем недопустимы, пользователь не сможет закрыть родительскую форму одним из обычных способов:  
  
-   Щелкнув **закрыть** кнопки.  
  
-   Выбрав **закрыть** в **системы** меню.  
  
-   Путем вызова <xref:System.Windows.Forms.Form.Close%2A> метод программными средствами.  
  
 Однако в некоторых случаях может потребоваться разрешить пользователю закрыть форму независимо от того, действительны ли значения в элементах управления. Можно обойти проверку и закрыть форму, которая по-прежнему содержит недопустимые данные путем создания обработчика для формы <xref:System.Windows.Forms.Form.Closing> событий. В событии, задайте <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> свойства `false`. Это приводит к закрытию формы. Дополнительные сведения и пример см. в разделе <xref:System.Windows.Forms.Form.Closing?displayProperty=nameWithType>.  
  
> [!NOTE]
>  Принудительное форму, чтобы закрыть таким образом, теряются все данные в элементы управления формы, уже не были сохранены. Кроме того модальные формы не проверяют содержимое элементов управления при их закрытии. Можно по-прежнему использовать проверку элементов управления для блокировки фокус на элементе управления, но не нужно беспокоиться о поведение, связанное с закрытием формы.  
  
## <a name="see-also"></a>См. также  
 <xref:System.Windows.Forms.Control.Validating?displayProperty=nameWithType>  
 <xref:System.Windows.Forms.Form.Closing?displayProperty=nameWithType>  
 <xref:System.ComponentModel.CancelEventArgs?displayProperty=nameWithType>  
 [Элемент управления MaskedTextBox](../../../docs/framework/winforms/controls/maskedtextbox-control-windows-forms.md)  
 [Примеры регулярных выражений](../../../docs/standard/base-types/regular-expression-examples.md)
