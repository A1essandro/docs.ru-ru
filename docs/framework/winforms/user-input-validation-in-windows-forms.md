---
title: "User Input Validation in Windows Forms | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-winforms"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "jsharp"
helpviewer_keywords: 
  - "Windows Forms, validating user input"
  - "validation, Windows Forms user input"
  - "user input, validating in Windows Forms"
  - "validating user input, Windows Forms"
ms.assetid: 4ec07681-1dee-4bf9-be5e-718f635a33a1
caps.latest.revision: 15
author: "dotnet-bot"
ms.author: "dotnetcontent"
manager: "wpickett"
caps.handback.revision: 15
---
# User Input Validation in Windows Forms
При вводе данных пользователем, возможно, требуется проверить их правильность перед тем, как приложение использует их.  Возможно, необходимо, чтобы некоторые текстовые поля не были пустыми, были отформатированы как номер телефона или другой тип данных или чтобы строки не содержали небезопасных знаков, которые могут быть использованы для нарушения безопасности базы данных.  В Windows Forms предусмотрено несколько способов проверки входных данных приложения.  
  
## Проверка с помощью элемента управления MaskedTextBox  
 При необходимости потребовать от пользователя вводить данные в четко определенном формате, таком как номер телефона или номер изделия, это можно сделать быстро и с использованием минимума кода с помощью элемента управления <xref:System.Windows.Forms.MaskedTextBox>.  *Маска* — это строка, которая состоит из знаков языка масок, определяющего, какие знаки могут вводиться в любом заданном положении в текстовом поле.  Элемент управления отображает набор приглашений пользователю.  Если пользователь вводит неправильную запись, например вводит букву, когда требуется цифра, элемент управления автоматически отклонит вводимые данные.  
  
 Язык масок, используемый элементом управления <xref:System.Windows.Forms.MaskedTextBox>, является весьма гибким.  Он позволяет указать обязательные знаки, необязательные знаки, знаки литералов, такие как дефисы и круглые скобки, знаки валют и разделители даты.  Элемент управления также работает при привязке к источнику данных.  Событие <xref:System.Windows.Forms.Binding.Format> привязки данных может использоваться для переформатирования входящих данных в соответствии с маской, а событие <xref:System.Windows.Forms.Binding.Parse> — для переформатирования исходящих данных в соответствии со спецификациями поля данных.  
  
 Дополнительные сведения см. в разделе [Пример элемента управления MaskedTextBox](../../../docs/framework/winforms/controls/maskedtextbox-control-windows-forms.md).  
  
## Проверка на основе событий  
 Если требуется полный программный контроль над проверкой или необходимо выполнить сложную проверку, следует использовать события проверки, встроенные в большинство элементов управления Windows Forms.  Каждый элемент управления, который принимает произвольные данные от пользователя, имеет событие <xref:System.Windows.Forms.Control.Validating>, возникающее всякий раз, когда элементу управления требуется проверка данных.  В методе обработки события <xref:System.Windows.Forms.Control.Validating> данные пользователя можно проверить несколькими способами.  Например, при наличии текстового поля, которое должно содержать почтовый индекс, можно выполнить проверку указанными ниже способами.  
  
-   Если почтовый индекс должен принадлежать к определенной группе почтовых индексов, то можно выполнить сравнение полученной строки, для проверки данных, введенных пользователем.  Например, если почтовый индекс должен быть в наборе {10001 10002, 10003}, можно выполнить сравнение строк для проверки данных.  
  
-   Если почтовый индекс должен вводиться в определенном формате, то для проверки данных, введенных пользователем, можно использовать регулярные выражения.  Например, для проверки того, что почтовый индекс введен в формате `#####` или `#####-####`, можно использовать регулярное выражение `^(\d{5})(-\d{4})?$`.  Чтобы проверить формат `A#A #A#`, можно использовать регулярное выражение `[A-Z]\d[A-Z] \d[A-Z]\d`.  Дополнительные сведения о регулярных выражениях см. в разделах [Регулярные выражения в .NET Framework](../../../docs/standard/base-types/regular-expressions.md) и [Примеры регулярных выражений](../../../docs/standard/base-types/regular-expression-examples.md).  
  
-   Если почтовый индекс должен быть допустимым почтовым индексом США, то для проверки данных, введенных пользователем, можно воспользоваться веб\-службой почтовых индексов.  
  
 Событию <xref:System.Windows.Forms.Control.Validating> предоставляется объект типа <xref:System.ComponentModel.CancelEventArgs>.  Если установлено, что данные элемента управления не являются допустимыми, то можно отменить событие <xref:System.Windows.Forms.Control.Validating>, установив для свойства <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> этого объекта значение `true`.  Если не установить свойство <xref:System.ComponentModel.CancelEventArgs.Cancel%2A>, то Windows Forms будет предполагать, что проверка для данного элемента управления прошла успешно, и вызовет событие <xref:System.Windows.Forms.Control.Validated>.  
  
 Пример кода, который проверяет адреса электронной почты в элементе управления <xref:System.Windows.Controls.TextBox>, содержится в разделе <xref:System.Windows.Forms.Control.Validating>.  
  
### Привязка данных и проверка на основе событий  
 Проверка очень полезна, когда элементы управления привязаны к источнику данных, например к таблице базы данных.  С помощью проверки можно убедиться, что данные элемента управления удовлетворяют формату, требуемому источником данных, и что этот элемент не содержит специальных символов, например кавычек и обратных черт, которые могут быть небезопасными.  
  
 При использовании привязки данных данные в элементе управления синхронизируются с источником данных во время выполнения события <xref:System.Windows.Forms.Control.Validating>.  При отмене события <xref:System.Windows.Forms.Control.Validating> данные не будут синхронизированы с источником данных.  
  
> [!IMPORTANT]
>  Пользовательская проверка, происходящая после события <xref:System.Windows.Forms.Control.Validating> \(если таковая выполняется\), не влияет на привязку данных.  Например, если код события <xref:System.Windows.Forms.Control.Validated> пытается отменить привязку данных, привязка данных все равно произойдет.  В этом случае для выполнения проверки в событии <xref:System.Windows.Forms.Control.Validated> измените свойство **DataSourceUpdateMode** элемента управления \(**в \(DataBindings\)**\\**\(Advanced\)**\) с **OnValidation** на **Never** и добавьте функцию *элемент\_управления*`.DataBindings["`*\<ВАШЕ\_ПОЛЕ\>*`"].WriteValue()` в код проверки.  
  
### Явная и неявная проверка  
 Когда проверяются данные элемента управления?  Это зависит от разработчика.  Можно использовать явную или неявную проверку в зависимости от требований приложения.  
  
#### Неявная проверка  
 При неявной проверке данные проверяются по мере того, как пользователь вводит их.  Можно проверять данные, вводимые пользователем в элемент управления, путем чтения клавиш по мере того, как они нажимаются, или, что более распространено, при переводе фокуса с одного элемента управления к следующему.  Этот подход полезен при необходимости предоставить пользователю немедленный отклик о неправильных данных во время работы.  
  
 Если требуется использовать неявную проверку для элемента управления, следует установить для свойства <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> этого элемента управления значение `true`.  При отмене события <xref:System.Windows.Forms.Control.Validating> поведение элемента управления будет определяться значением свойства <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>.  Если установлено значение <xref:System.Windows.Forms.AutoValidate>, отмена события приведет к тому, что событие <xref:System.Windows.Forms.Control.Validated> не возникнет.  Фокус ввода останется на текущем элементе управления до тех пор, пока пользователь не введет допустимые данные.  Если установлено значение <xref:System.Windows.Forms.AutoValidate>, событие <xref:System.Windows.Forms.Control.Validated> не возникнет при отмене события, но фокус будет по\-прежнему переходить к следующему элементу управления.  
  
 При установке значения <xref:System.Windows.Forms.AutoValidate> свойству <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> неявная проверка будет полностью запрещена.  Чтобы проверить элементы управления, необходимо использовать явную проверку.  
  
#### Явная проверка  
 При явной проверке данные проверяются за один раз.  Можно проверить данные в ответ на такие действия пользователя, как нажатие кнопки "Сохранить" или ссылки "Далее".  Вызвать явную проверку в ответ на действие пользователя можно одним из перечисленных ниже способов.  
  
-   Вызовите метод <xref:System.Windows.Forms.ContainerControl.Validate%2A> для проверки последнего элемента управления, с которого был перемещен фокус.  
  
-   Вызовите метод <xref:System.Windows.Forms.ContainerControl.ValidateChildren%2A> для проверки всех дочерних элементов управления в форме или контейнере.  
  
-   Вызовите пользовательский метод для проверки данных в элементах управления вручную.  
  
#### Поведение неявной проверки по умолчанию для элементов управления Windows Forms  
 Различные элементы управления Windows Forms имеют различные значения по умолчанию для свойства <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>.  В следующей таблице приведены наиболее распространенные элементы управления и их значения по умолчанию.  
  
|Элемент управления|Поведение проверки по умолчанию|  
|------------------------|-------------------------------------|  
|<xref:System.Windows.Forms.ContainerControl>|<xref:System.Windows.Forms.AutoValidate>|  
|<xref:System.Windows.Forms.Form>|<xref:System.Windows.Forms.AutoValidate>|  
|<xref:System.Windows.Forms.PropertyGrid>|Свойство не предоставляется в Visual Studio|  
|<xref:System.Windows.Forms.ToolStripContainer>|Свойство не предоставляется в Visual Studio|  
|<xref:System.Windows.Forms.SplitContainer>|<xref:System.Windows.Forms.AutoValidate>|  
|<xref:System.Windows.Forms.UserControl>|<xref:System.Windows.Forms.AutoValidate>|  
  
## Закрытие формы и обход проверки  
 Если элемент управления сохраняет фокус, поскольку содержит недопустимые данные, невозможно закрыть родительскую форму одним из обычных способов, перечисленных ниже.  
  
-   Нажав кнопку **Закрыть**.  
  
-   Выбрав **Закрыть** в меню **Система**.  
  
-   Вызвав метод <xref:System.Windows.Forms.Form.Close%2A> программными средствами.  
  
 Тем не менее, в некоторых случаях может потребоваться разрешить пользователю закрыть форму вне зависимости от того, ввел ли он в элементы управления допустимые значения.  Можно обойти проверку и закрыть форму, которая по\-прежнему содержит недопустимые данные, путем создания обработчика события <xref:System.Windows.Forms.Form.Closing> формы.  В этом событии задайте свойству <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> значение `false`.  Это приведет к принудительному закрытию формы.  Дополнительные сведения и примеры см. в разделе <xref:System.Windows.Forms.Form.Closing?displayProperty=fullName>.  
  
> [!NOTE]
>  Если закрытие формы осуществляется данным способом, все несохраненные сведения в элементах управления будут потеряны.  Кроме того, модальные формы не проверяют содержимое элементов управления при закрытии.  Можно по\-прежнему использовать проверку элементов управления для того, чтобы блокировать фокус на элементе управления, но нет необходимости задумываться о поведении формы при закрытии.  
  
## См. также  
 <xref:System.Windows.Forms.Control.Validating?displayProperty=fullName>   
 <xref:System.Windows.Forms.Form.Closing?displayProperty=fullName>   
 <xref:System.ComponentModel.CancelEventArgs?displayProperty=fullName>   
 [Пример элемента управления MaskedTextBox](../../../docs/framework/winforms/controls/maskedtextbox-control-windows-forms.md)   
 [Примеры регулярных выражений](../../../docs/standard/base-types/regular-expression-examples.md)