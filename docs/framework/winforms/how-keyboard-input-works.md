---
title: "How Keyboard Input Works | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-winforms"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "jsharp"
helpviewer_keywords: 
  - "keyboard input, about keyboard input"
  - "keyboards, keyboard input"
  - "Windows Forms, keyboard input"
ms.assetid: 9a29433c-a180-49bb-b74c-d187786584c8
caps.latest.revision: 20
author: "dotnet-bot"
ms.author: "dotnetcontent"
manager: "wpickett"
caps.handback.revision: 20
---
# How Keyboard Input Works
Ввод данных с клавиатуры обрабатывается в Windows Forms посредством вызова события клавиатуры в ответ на сообщения Windows.  Большинство приложений Windows Forms обрабатывают ввод данных с клавиатуры только с помощью обработки событий клавиатуры.  Тем не менее, необходимо понимать, как работают сообщения клавиатуры, чтобы иметь возможность реализовать дополнительные сценарии ввода с клавиатуры, например перехват клавиш до поступления соответствующего события в элемент управления.  В этом разделе описываются типы данных о клавишах, которые распознает Windows Forms, и приводится обзор способов перенаправления сообщений клавиатуры.  Сведения о событиях клавиатуры см. в разделе [Using Keyboard Events](../../../docs/framework/winforms/using-keyboard-events.md).  
  
## Типы клавиш  
 Windows Forms идентифицирует ввод данных с клавиатуры как коды виртуальных клавиш, представленные битовым перечислением <xref:System.Windows.Forms.Keys>.  С помощью перечисления <xref:System.Windows.Forms.Keys> можно объединить ряд нажатых клавиш в одиночное значение.  Эти значения соответствуют значениям, сопровождающим сообщения Windows WM\_KEYDOWN и WM\_SYSKEYDOWN.  Нажатие большинства физических клавиш можно обнаружить, обрабатывая событие <xref:System.Windows.Forms.Control.KeyDown> или <xref:System.Windows.Forms.Control.KeyUp>.  Клавиши знаков являются подмножеством перечисления <xref:System.Windows.Forms.Keys> и соответствуют значениям, сопровождающим сообщения Windows WM\_CHAR и WM\_SYSCHAR.  Если сочетание нажатых клавиш образует знак, его можно обнаружить, обрабатывая событие <xref:System.Windows.Forms.Control.KeyPress>.  Кроме того, для обнаружения того, какие клавиши были нажаты и отправлены, можно использовать метод <xref:Microsoft.VisualBasic.Devices.Keyboard>, предоставляемый интерфейсом программирования Visual Basic.  Дополнительные сведения см. в разделе [Доступ к клавиатуре](../Topic/Accessing%20the%20Keyboard%20\(Visual%20Basic\).md).  
  
## Порядок событий клавиатуры  
 Как перечислено выше, существует 3 связанных с клавиатурой события, которые могут возникать в элементе управления.  Следующая последовательность показывает общий порядок возникновения событий.  
  
1.  Пользователь нажимает клавишу "a", соответствующее сообщение предварительно обрабатывается, отправляется, и происходит событие <xref:System.Windows.Forms.Control.KeyDown>.  
  
2.  Пользователь удерживает клавишу "a", соответствующее сообщение предварительно обрабатывается, отправляется, и происходит событие <xref:System.Windows.Forms.Control.KeyPress>.  
  
     Это событие возникает несколько раз, пока пользователь удерживает клавишу.  
  
3.  Пользователь отпускает клавишу "a", соответствующее сообщение предварительно обрабатывается, отправляется, и происходит событие <xref:System.Windows.Forms.Control.KeyUp>.  
  
## Предварительная обработка сообщений клавиатуры  
 Как и другие сообщения, сообщения клавиатуры обрабатываются в методе <xref:System.Windows.Forms.Control.WndProc%2A> формы или элемента управления.  Однако перед обработкой сообщений клавиатуры метод <xref:System.Windows.Forms.Control.PreProcessMessage%2A> вызывает один или несколько методов, которые могут быть переопределены для обработки сообщений клавиш специальных знаков и физических клавиш.  Эти методы можно переопределить для обнаружения и фильтрации определенных клавиш перед обработкой сообщения элементом управления.  В следующей таблице показаны выполняемые действия и связанный с ними метод в том порядке, в котором метод вызывается.  
  
### Предварительная обработка события KeyDown  
  
|Действие|Связанный метод|Примечания|  
|--------------|---------------------|----------------|  
|Проверка управляющих клавиш, например горячих клавиши или сочетаний клавиш меню.|<xref:System.Windows.Forms.Control.ProcessCmdKey%2A>|Этот метод обрабатывает управляющие клавиши, которые имеют приоритет над обычными клавишами.  Если этот метод возвращает значение `true`, сообщение о нажатии клавиши не отправляется и событие клавиатуры не возникает.  Если он возвращает значение `false`, вызывается метод <xref:System.Windows.Forms.Control.IsInputKey%2A>`.`|  
|Проверяет, является ли данная клавиша специальным знаком, требующим предварительной обработки, или это обычная клавиша, которая должна вызвать событие <xref:System.Windows.Forms.Control.KeyDown> и быть отправлена в элемент управления.|<xref:System.Windows.Forms.Control.IsInputKey%2A>|Если этот метод возвращает значение `true`, значит, это обычный знак и возникает событие <xref:System.Windows.Forms.Control.KeyDown>.  Если возвращается значение `false`, вызывается метод <xref:System.Windows.Forms.Control.ProcessDialogKey%2A>. **Note:**  Чтобы убедиться в получении элементом управления клавиши или сочетания клавиш, можно обработать событие <xref:System.Windows.Forms.Control.PreviewKeyDown> и задать для метода <xref:System.Windows.Forms.PreviewKeyDownEventArgs.IsInputKey%2A> класса <xref:System.Windows.Forms.PreviewKeyDownEventArgs> значение `true` для требуемой клавиши или сочетания клавиш.|  
|Проверяет, является ли клавиша клавишей перехода \(ESC, TAB, клавиша Return или клавиши со стрелками\).|<xref:System.Windows.Forms.Control.ProcessDialogKey%2A>|Этот метод обрабатывает физические клавиши, которые имеют специальное действие в элементе управления, такие как переключение фокуса между элементом управления и его родителем.  Если непосредственный элемент управления не обрабатывает клавишу, вызывается метод <xref:System.Windows.Forms.Control.ProcessDialogKey%2A> родительского элемента управления, и эта процедура продолжается до самого верхнего элемента управления в иерархии.  Если этот метод возвращает значение `true`, предварительная обработка завершается, а событие клавиатуры не возникает.  Если возвращается значение `false`, возникает событие <xref:System.Windows.Forms.Control.KeyDown>.|  
  
### Предварительная обработка события KeyPress  
  
|Действие|Связанный метод|Примечания|  
|--------------|---------------------|----------------|  
|Проверяет, является ли клавиша обычным знаком, который должен обрабатываться элементом управления|<xref:System.Windows.Forms.Control.IsInputChar%2A>|Если клавиша является обычным знаком, этот метод возвращает значение `true`, вызывается событие <xref:System.Windows.Forms.Control.KeyPress> и дальнейшая предварительная обработка не происходит.  В противном случае будет вызван метод <xref:System.Windows.Forms.Control.ProcessDialogChar%2A>.|  
|Проверяет, является ли знак сокращением \(как &OK на кнопке\)|<xref:System.Windows.Forms.Control.ProcessDialogChar%2A>|Этот метод аналогичен методу <xref:System.Windows.Forms.Control.ProcessDialogKey%2A>, он будет вызван на более высоком уровне иерархии элементов управления.  Если элемент управления является контейнерным, он проверяет наличие сокращения, вызывая метод <xref:System.Windows.Forms.Control.ProcessMnemonic%2A> у самого себя и своих дочерних элементов.  Если метод <xref:System.Windows.Forms.Control.ProcessDialogChar%2A> возвращает значение `true`, событие <xref:System.Windows.Forms.Control.KeyPress> не возникает.|  
  
## Обработка сообщений клавиатуры  
 После того как сообщения клавиатуры достигают метода <xref:System.Windows.Forms.Control.WndProc%2A> формы или элемента управления, они обрабатываются группой переопределяемых методов.  Каждый из этих методов возвращает значение <xref:System.Boolean>, указывающее, было ли сообщение клавиатуры обработано и получено элементом управления.  Если один из методов возвращает значение `true`, то сообщение считается обработанным и не передается базовому или родительскому элементу управления для дальнейшей обработки.  В противном случае сообщение остается в очереди сообщений и может быть обработано в другом методе базового или родительского элемента управления.  В следующей таблице представлены методы, которые обрабатывают сообщения клавиатуры.  
  
|Метод|Примечания|  
|-----------|----------------|  
|<xref:System.Windows.Forms.Control.ProcessKeyMessage%2A>|Этот метод обрабатывает все сообщения клавиатуры, полученные методом <xref:System.Windows.Forms.Control.WndProc%2A> элемента управления.|  
|<xref:System.Windows.Forms.Control.ProcessKeyPreview%2A>|Этот метод передает сообщение клавиатуры родительскому элементу управления.  Если метод <xref:System.Windows.Forms.Control.ProcessKeyPreview%2A> возвращает значение `true`, событие клавиатуры не создается, в противном случае вызывается метод <xref:System.Windows.Forms.Control.ProcessKeyEventArgs%2A>.|  
|<xref:System.Windows.Forms.Control.ProcessKeyEventArgs%2A>|Этот метод вызывает соответствующие события <xref:System.Windows.Forms.Control.KeyDown>, <xref:System.Windows.Forms.Control.KeyPress> и <xref:System.Windows.Forms.Control.KeyUp>.|  
  
## Переопределение методов клавиатуры  
 При предварительной обработке и обработке сообщений клавиатуры существует много доступных для переопределения методов; однако некоторые методы являются гораздо более удобными, чем другие.  В следующей таблице перечислены задачи, которые, возможно, потребуется выполнить, и оптимальные способы переопределения методов сообщений клавиатуры.  Дополнительные сведения о переопределении методов см. в разделе [NOT IN BUILD: Overriding Properties and Methods](http://msdn.microsoft.com/ru-ru/2167e8f5-1225-4b13-9ebd-02591ba90213).  
  
|Задача|Метод|  
|------------|-----------|  
|Перехват клавиши перехода и вызов события <xref:System.Windows.Forms.Control.KeyDown>.  Например, требуется обработка сообщения клавиши TAB или Return в текстовом поле.|Переопределите метод <xref:System.Windows.Forms.Control.IsInputKey%2A>. **Note:**  Также можно обработать событие <xref:System.Windows.Forms.Control.PreviewKeyDown> и задать для свойства <xref:System.Windows.Forms.PreviewKeyDownEventArgs.IsInputKey%2A> класса <xref:System.Windows.Forms.PreviewKeyDownEventArgs> значение `true` для требуемой клавиши или сочетания клавиш.|  
|Выполнение специального ввода или обработка переходов в элементе управления.  Например, требуется использование клавиш со стрелками в элементе управления списка для изменения выбранного элемента.|Переопределите метод <xref:System.Windows.Forms.Control.ProcessDialogKey%2A>.|  
|Перехват клавиши перехода и вызов события <xref:System.Windows.Forms.Control.KeyPress>.  Например, в элементе управления "Регулятор" может потребоваться несколько нажатий клавиши со стрелкой для ускорения прокрутки между элементами.|Переопределите метод <xref:System.Windows.Forms.Control.IsInputChar%2A>.|  
|Выполнение специального ввода или обработка переходов во время события <xref:System.Windows.Forms.Control.KeyPress>.  Например, в элементе управления списка удержание клавиши "к" пропускает элементы, начинающиеся с буквы "к".|Переопределите метод <xref:System.Windows.Forms.Control.ProcessDialogChar%2A>.|  
|Произведите обработку пользовательских сокращений; например, таким образом, чтобы обрабатывать сокращения рисуемых владельцем кнопок, содержащихся в панели инструментов.|Переопределите метод <xref:System.Windows.Forms.Control.ProcessMnemonic%2A>.|  
  
## См. также  
 <xref:System.Windows.Forms.Keys>   
 <xref:System.Windows.Forms.Control.WndProc%2A>   
 <xref:System.Windows.Forms.Control.PreProcessMessage%2A>   
 [Объект My.Computer.Keyboard](../../../ocs/visual-basic/language-reference/objects/my-computer-keyboard-object.md)   
 [Доступ к клавиатуре](../Topic/Accessing%20the%20Keyboard%20\(Visual%20Basic\).md)   
 [Using Keyboard Events](../../../docs/framework/winforms/using-keyboard-events.md)