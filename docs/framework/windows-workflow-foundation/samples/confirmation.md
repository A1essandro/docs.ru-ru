---
title: Подтверждение
ms.date: 03/30/2017
ms.assetid: 8637aeaf-ac9e-49b8-93f4-da15dee45277
ms.openlocfilehash: caa712aa52da01ce44335a361fd6c9f5215316bf
ms.sourcegitcommit: 5bbfe34a9a14e4ccb22367e57b57585c208cf757
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/17/2018
ms.locfileid: "45964479"
---
# <a name="confirmation"></a><span data-ttu-id="3a654-102">Подтверждение</span><span class="sxs-lookup"><span data-stu-id="3a654-102">Confirmation</span></span>
<span data-ttu-id="3a654-103">В данном образце показаны четыре общих сценария, связанных с использованием <xref:System.Activities.Statements.CompensableActivity> и подтверждением.</span><span class="sxs-lookup"><span data-stu-id="3a654-103">This sample shows four common scenarios surrounding the use of <xref:System.Activities.Statements.CompensableActivity> and confirmation.</span></span> <span data-ttu-id="3a654-104">Для демонстрации подтверждения в образце запускаются четыре рабочих процесса.</span><span class="sxs-lookup"><span data-stu-id="3a654-104">The sample runs four workflows to show confirmation.</span></span> <span data-ttu-id="3a654-105">Доступны декларативная и императивная версии образца.</span><span class="sxs-lookup"><span data-stu-id="3a654-105">This sample is available in declarative and imperative versions.</span></span>  
  
## <a name="confirm-a-compensable-activity"></a><span data-ttu-id="3a654-106">Подтверждение действия, подлежащего компенсации</span><span class="sxs-lookup"><span data-stu-id="3a654-106">Confirm a Compensable Activity</span></span>  
 <span data-ttu-id="3a654-107">Первый рабочий процесс показывает, как подтверждать действие, подлежащее компенсации. Он состоит из двух последовательных экземпляров <xref:System.Activities.Statements.CompensableActivity>.</span><span class="sxs-lookup"><span data-stu-id="3a654-107">The first workflow demonstrates how to confirm a compensable activity and consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity> instances.</span></span> <span data-ttu-id="3a654-108">После завершения второго экземпляра <xref:System.Activities.Statements.CompensableActivity> подтверждается первое действие.</span><span class="sxs-lookup"><span data-stu-id="3a654-108">After the completion of the second <xref:System.Activities.Statements.CompensableActivity> a confirm activity confirms the first activity.</span></span> <span data-ttu-id="3a654-109">После успешного завершения рабочего процесса неподтвержденные и некомпенсированные экземпляры <xref:System.Activities.Statements.CompensableActivity> автоматически подтверждаются в порядке по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="3a654-109">When the workflow successfully completes, all <xref:System.Activities.Statements.CompensableActivity> instances that have not been confirmed or compensated are automatically confirmed using the default order.</span></span> <span data-ttu-id="3a654-110">Без подтверждения второй экземпляр <xref:System.Activities.Statements.CompensableActivity> был бы подтвержден первым.</span><span class="sxs-lookup"><span data-stu-id="3a654-110">Without the confirm, the second <xref:System.Activities.Statements.CompensableActivity> would have been confirmed first.</span></span>  
  
## <a name="explicit-compensation"></a><span data-ttu-id="3a654-111">Явная компенсация</span><span class="sxs-lookup"><span data-stu-id="3a654-111">Explicit Compensation</span></span>  
 <span data-ttu-id="3a654-112">Во втором сценарии показано влияние на подтверждение по умолчанию в случае явной компенсации экземпляра <xref:System.Activities.Statements.CompensableActivity>.</span><span class="sxs-lookup"><span data-stu-id="3a654-112">The second scenario shows the affect on default confirmation when a <xref:System.Activities.Statements.CompensableActivity> is explicitly compensated.</span></span> <span data-ttu-id="3a654-113">Рабочий процесс состоит из двух последовательных действий <xref:System.Activities.Statements.CompensableActivity>. После завершения второго действия первое подвергается явной компенсации.</span><span class="sxs-lookup"><span data-stu-id="3a654-113">The workflow consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity> activities, after the second completes the first is explicitly compensated.</span></span> <span data-ttu-id="3a654-114">В результате, по завершении рабочего процесса подтверждается только второй экземпляр <xref:System.Activities.Statements.CompensableActivity>.</span><span class="sxs-lookup"><span data-stu-id="3a654-114">As a result when the workflow, completes only the second <xref:System.Activities.Statements.CompensableActivity> is confirmed.</span></span>  
  
## <a name="controlling-the-order-of-confirmation-for-nested-compensableactivity-activities"></a><span data-ttu-id="3a654-115">Управление порядком подтверждения для вложенных действий CompensableActivity.</span><span class="sxs-lookup"><span data-stu-id="3a654-115">Controlling the Order of Confirmation for Nested CompensableActivity Activities</span></span>  
 <span data-ttu-id="3a654-116">В третьем сценарии показано, как управлять порядком подтверждения для вложенных действий <xref:System.Activities.Statements.CompensableActivity>CompensableActivity.</span><span class="sxs-lookup"><span data-stu-id="3a654-116">The third scenario shows how to control the order of confirmation for nested <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="3a654-117">Корнем рабочего процесса в сценарии является <xref:System.Activities.Statements.CompensableActivity>.</span><span class="sxs-lookup"><span data-stu-id="3a654-117">The scenario consists of a <xref:System.Activities.Statements.CompensableActivity> as the root of the workflow.</span></span> <span data-ttu-id="3a654-118">Текст корня <xref:System.Activities.Statements.CompensableActivity> представляет собой последовательность из трех <xref:System.Activities.Statements.CompensableActivity>.</span><span class="sxs-lookup"><span data-stu-id="3a654-118">The body of the root <xref:System.Activities.Statements.CompensableActivity> is a sequence of three <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="3a654-119">Обработчик <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> для корня <xref:System.Activities.Statements.CompensableActivity> представляет последовательность, согласно которой подтверждается сначала первый вложенный экземпляр <xref:System.Activities.Statements.CompensableActivity>, а потом второй.</span><span class="sxs-lookup"><span data-stu-id="3a654-119">The <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> for the root <xref:System.Activities.Statements.CompensableActivity> is a sequence that specifies to confirm the first then the second nested <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="3a654-120">По завершении рабочего процесса подтверждается корень <xref:System.Activities.Statements.CompensableActivity>, который затем подтверждает первый, второй и третий вложенные экземпляры <xref:System.Activities.Statements.CompensableActivity> в этом порядке.</span><span class="sxs-lookup"><span data-stu-id="3a654-120">When the workflow completes it confirms the root <xref:System.Activities.Statements.CompensableActivity>, which then confirms the first, second and third nested <xref:System.Activities.Statements.CompensableActivity>, in that order.</span></span> <span data-ttu-id="3a654-121">В результате по умолчанию порядок подтверждения по сути меняется на противоположный.</span><span class="sxs-lookup"><span data-stu-id="3a654-121">As a result, the default confirmation order is essentially reversed.</span></span> <span data-ttu-id="3a654-122">Поскольку третий экземпляр <xref:System.Activities.Statements.CompensableActivity> не подтверждался явно как часть корня <xref:System.Activities.Statements.CompensableActivity> обработчиком <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A>, он подтверждается в порядке по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="3a654-122">Because the third <xref:System.Activities.Statements.CompensableActivity> was not explicitly confirmed as part of the root <xref:System.Activities.Statements.CompensableActivity> by the <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A>, it is confirmed according to the default order.</span></span> <span data-ttu-id="3a654-123">Хотя, поскольку это единственный запрос <xref:System.Activities.Statements.CompensableActivity>, оставшийся неподтвержденным, он просто подтверждается.</span><span class="sxs-lookup"><span data-stu-id="3a654-123">However, because it is the only unconfirmed <xref:System.Activities.Statements.CompensableActivity> this just means it is confirmed.</span></span>  
  
## <a name="scoping-of-variables"></a><span data-ttu-id="3a654-124">Видимость переменных</span><span class="sxs-lookup"><span data-stu-id="3a654-124">Scoping of Variables</span></span>  
 <span data-ttu-id="3a654-125">В четвертом сценарии показано, что время существования переменных, определенные для <xref:System.Activities.Statements.CompensableActivity> или одного из его родительских элементов, остаются в области, даже когда обработчики компенсации <xref:System.Activities.Statements.CompensableActivity.CompensationHandler%2A>, <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> или <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> исполняются после завершения действия или рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="3a654-125">The fourth scenario shows how the lifetime of variables defined for a <xref:System.Activities.Statements.CompensableActivity> or one of their parents are still in scope when the <xref:System.Activities.Statements.CompensableActivity.CompensationHandler%2A>, <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> or <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> handlers are executed even if the activity has completed or the workflow has completed.</span></span> <span data-ttu-id="3a654-126">Рабочий процесс состоит из двух последовательных экземпляров <xref:System.Activities.Statements.CompensableActivity>.</span><span class="sxs-lookup"><span data-stu-id="3a654-126">The workflow consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="3a654-127">В тексте первого переменной `mySum` задается значение, равное 5 + 10 + выведенный результат.</span><span class="sxs-lookup"><span data-stu-id="3a654-127">In the body of the first, the variable `mySum` is set to the sum of 5 and 10 and the result printed.</span></span> <span data-ttu-id="3a654-128">В тексте второго <xref:System.Activities.Statements.CompensableActivity> сумме задается значение, равное готовая сумма + 7 + выведенный результат.</span><span class="sxs-lookup"><span data-stu-id="3a654-128">In the body of the second <xref:System.Activities.Statements.CompensableActivity>, the sum is set to the sum of the existing sum and 7 and the result printed.</span></span> <span data-ttu-id="3a654-129">Для первого экземпляра <xref:System.Activities.Statements.CompensableActivity> задается пользовательский обработчик, который выводит сумму, вычитает из нее 7 и выводит ее заново.</span><span class="sxs-lookup"><span data-stu-id="3a654-129">A custom confirmation handler is defined for the first <xref:System.Activities.Statements.CompensableActivity>, which prints the sum, subtracts 7 and prints the sum again.</span></span> <span data-ttu-id="3a654-130">Анализ выведенной суммы ясно показывает, что переменная остается в области не только для тел обоих экземпляров <xref:System.Activities.Statements.CompensableActivity>, но и для <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A>.</span><span class="sxs-lookup"><span data-stu-id="3a654-130">It is clear by inspecting the printed sums that the variable is in scope not only for the bodies of both <xref:System.Activities.Statements.CompensableActivity> but the <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> as well.</span></span>  
  
#### <a name="to-run-the-sample"></a><span data-ttu-id="3a654-131">Выполнение образца</span><span class="sxs-lookup"><span data-stu-id="3a654-131">To run the sample</span></span>  
  
1.  <span data-ttu-id="3a654-132">Загрузите решение в среде [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3a654-132">Load the solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].</span></span>  
  
2.  <span data-ttu-id="3a654-133">Запустите приложение ConfirmationSample.exe.</span><span class="sxs-lookup"><span data-stu-id="3a654-133">Run the ConfirmationSample.exe application.</span></span>  
  
3.  <span data-ttu-id="3a654-134">Проверьте следующие выходные данные:</span><span class="sxs-lookup"><span data-stu-id="3a654-134">Observe the following output:</span></span>  
  
 <span data-ttu-id="3a654-135">**Явное подтверждение: начало workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: подтверждение HandlerEnd из workflowCompensableActivity2: подтверждение HandlerExplicit compensation: Start workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: HandlerEnd компенсации из workflowCompensableActivity2: подтверждение HandlerCustom подтверждение обработчика: начало workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity3: BodyEnd из workflowCompensableActivity1: подтверждение HandlerCompensableActivity2: подтверждение HandlerCompensableActivity3: подтверждение HandlerVariable доступ в обработчике подтверждения: Начало workflowCompensableActivity1: BodyCompensableActivity1: сумма: 15CompensableActivity2: BodyCompensableActivity2: Добавление 7 к sumCompensableActivity2: теперь является сумма: 22End из workflowCompensableActivity2: подтверждение HandlerCompensableActivity1: Подтверждение HandlerCompensableActivity2: сумма: 22CompensableActivity2: после вычитания 12 сумма является теперь: 10Press ввод для выхода.**</span><span class="sxs-lookup"><span data-stu-id="3a654-135">**Explicit confirmation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Confirmation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerExplicit compensation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Compensation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerCustom confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity3: BodyEnd of workflowCompensableActivity1: Confirmation HandlerCompensableActivity2: Confirmation HandlerCompensableActivity3: Confirmation HandlerVariable access in a confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity1: The sum is: 15CompensableActivity2: BodyCompensableActivity2: Adding 7 to the sumCompensableActivity2: The sum is now: 22End of workflowCompensableActivity2: Confirmation HandlerCompensableActivity1: Confirmation HandlerCompensableActivity2: The sum is: 22CompensableActivity2: After subtracting 12 the sum is now: 10Press ENTER to exit.**</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="3a654-136">Образцы уже могут быть установлены на компьютере.</span><span class="sxs-lookup"><span data-stu-id="3a654-136">The samples may already be installed on your machine.</span></span> <span data-ttu-id="3a654-137">Перед продолжением проверьте следующий каталог (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="3a654-137">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="3a654-138">Если этот каталог не существует, перейдите к [Windows Communication Foundation (WCF) и образцы Windows Workflow Foundation (WF) для .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) для загрузки всех Windows Communication Foundation (WCF) и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] примеры.</span><span class="sxs-lookup"><span data-stu-id="3a654-138">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="3a654-139">Этот образец расположен в следующем каталоге.</span><span class="sxs-lookup"><span data-stu-id="3a654-139">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\Compensation\Confirmation`