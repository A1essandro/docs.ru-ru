---
title: Использование CancellationScope
ms.date: 03/30/2017
ms.assetid: 39c5c338-b316-43d6-b7fe-a543281dd1ec
ms.openlocfilehash: 82d44fff869f207c09dc7685fc3470630e001a59
ms.sourcegitcommit: 3c1c3ba79895335ff3737934e39372555ca7d6d0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/06/2018
ms.locfileid: "43854987"
---
# <a name="using-cancellationscope"></a><span data-ttu-id="af023-102">Использование CancellationScope</span><span class="sxs-lookup"><span data-stu-id="af023-102">Using CancellationScope</span></span>
<span data-ttu-id="af023-103">В данном образце показывается, как с помощью действия <xref:System.Activities.Statements.CancellationScope> отменять работу в приложении.</span><span class="sxs-lookup"><span data-stu-id="af023-103">This sample demonstrates how to use the <xref:System.Activities.Statements.CancellationScope> activity to cancel work in an application.</span></span>  
  
 <span data-ttu-id="af023-104">Во многих компонентах и службах среднего уровня отмена работ зависит от хорошо известных программных конструкций транзакций, которые непосредственно и отрабатывают отмену.</span><span class="sxs-lookup"><span data-stu-id="af023-104">Many middle tier components and services rely on the well-known programming construct of transactions to handle cancellation for them.</span></span>  <span data-ttu-id="af023-105">Тем не менее, во многих случаях требуется отменить работу, которую нельзя совершить в транзакции.</span><span class="sxs-lookup"><span data-stu-id="af023-105">However, there are many situations in which work that cannot be done in a transaction must be canceled.</span></span>  <span data-ttu-id="af023-106">Отменой пользоваться сложнее, чем транзакциями, поскольку отменяемую работу необходимо сначала отследить.</span><span class="sxs-lookup"><span data-stu-id="af023-106">Using cancellation is more difficult than using transactions, because work that must be canceled must first be tracked.</span></span> [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)]<span data-ttu-id="af023-107"> облегчает это, предоставляя действие <xref:System.Activities.Statements.CancellationScope>.</span><span class="sxs-lookup"><span data-stu-id="af023-107"> helps you with this by providing a <xref:System.Activities.Statements.CancellationScope> activity.</span></span>  
  
 <span data-ttu-id="af023-108">Отмену можно запустить как изнутри действия, так и из его родительского элемента.</span><span class="sxs-lookup"><span data-stu-id="af023-108">Cancellation can be triggered either from within an activity or from the activity's parent.</span></span>  <span data-ttu-id="af023-109">Дочерние действия планируются своим родительским действием (например, <xref:System.Activities.Statements.Sequence>, <xref:System.Activities.Statements.Parallel>, <xref:System.Activities.Statements.Flowchart> или пользовательским составным действием).</span><span class="sxs-lookup"><span data-stu-id="af023-109">Child activities are scheduled by their parent activity (such as a <xref:System.Activities.Statements.Sequence>, <xref:System.Activities.Statements.Parallel>, <xref:System.Activities.Statements.Flowchart>, or a custom composite activity).</span></span>  <span data-ttu-id="af023-110">Родительское действие может отменить дочерние действия по любой причине.</span><span class="sxs-lookup"><span data-stu-id="af023-110">The parent activity can cancel child activities for any reason.</span></span>  <span data-ttu-id="af023-111">Например, действие <xref:System.Activities.Statements.Parallel> с тремя дочерними ветвями отменяет остающиеся дочерние ветви, как только хоть одна ветвь будет выполнена и при вычислении выражения <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> будет получено значение `true`.</span><span class="sxs-lookup"><span data-stu-id="af023-111">For example, a <xref:System.Activities.Statements.Parallel> activity with three child branches will cancel the remaining child branches whenever it completes a branch and the <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> expression evaluates to `true`.</span></span> <span data-ttu-id="af023-112">Рабочий процесс можно отменить и извне, вызвав из ведущего приложения метод <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span><span class="sxs-lookup"><span data-stu-id="af023-112">The workflow can also be canceled externally by the host application by calling <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span>  
  
 <span data-ttu-id="af023-113">Чтобы использовать действие <xref:System.Activities.Statements.CancellationScope>, поместите отменяемую работу в <xref:System.Activities.Statements.CancellationScope.Body%2A>, а работу, выполняемую после отмены, в <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>.</span><span class="sxs-lookup"><span data-stu-id="af023-113">To use the <xref:System.Activities.Statements.CancellationScope> activity, put the work that needs to be canceled into the <xref:System.Activities.Statements.CancellationScope.Body%2A> property, and put the work that is performed after cancellation into the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> property.</span></span>  
  
 <span data-ttu-id="af023-114">В образце показана отмена действия из самого действия.</span><span class="sxs-lookup"><span data-stu-id="af023-114">This sample demonstrates cancelling an activity from within the activity itself.</span></span>  
  
 <span data-ttu-id="af023-115">В сценарии, с помощью которого образец демонстрирует действие <xref:System.Activities.Statements.CancellationScope>, клиенту необходимо как можно быстрее купить билет до Майами.</span><span class="sxs-lookup"><span data-stu-id="af023-115">The scenario that the sample uses to demonstrate the <xref:System.Activities.Statements.CancellationScope> activity is a client wanting to buy a ticket to Miami as soon as possible.</span></span> <span data-ttu-id="af023-116">Свои услуги ему предлагают два туристических агентства.</span><span class="sxs-lookup"><span data-stu-id="af023-116">There are two travel agencies that want the business.</span></span> <span data-ttu-id="af023-117">Чтобы смоделировать бизнес-логику процесса, в образце используется две области <xref:System.Activities.Statements.CancellationScope> в действии <xref:System.Activities.Statements.Parallel>.</span><span class="sxs-lookup"><span data-stu-id="af023-117">The sample uses two <xref:System.Activities.Statements.CancellationScope> within a <xref:System.Activities.Statements.Parallel> activity to model this business logic.</span></span> <span data-ttu-id="af023-118">Параметр <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> действия <xref:System.Activities.Statements.Parallel> установлен в значение `true`; поскольку <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> проверяется после выполнения любой из ветвей, оставшаяся ветвь будет отменена после выполнения первой.</span><span class="sxs-lookup"><span data-stu-id="af023-118">The <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> of the <xref:System.Activities.Statements.Parallel> activity is set to `true`; since the <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> is checked after any branch completes, this will cause the remaining branch to be canceled after the first branch completes.</span></span> <span data-ttu-id="af023-119">Клиентское приложение запрашивает оба бюро о покупке билетов, и когда одно из них подтверждает покупку билета, заказ во втором бюро отменяется.</span><span class="sxs-lookup"><span data-stu-id="af023-119">The client application asks both agencies to buy the ticket, and when the first one confirms that the ticket has been bought, the application cancels the order at the other agency.</span></span>  
  
## <a name="to-use-this-sample"></a><span data-ttu-id="af023-120">Использование этого образца</span><span class="sxs-lookup"><span data-stu-id="af023-120">To use this sample</span></span>  
  
1.  <span data-ttu-id="af023-121">Используя [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], откройте файл решения CancelationScopeXAML.sln.</span><span class="sxs-lookup"><span data-stu-id="af023-121">Using [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], open the CancelationScopeXAML.sln solution file.</span></span>  
  
2.  <span data-ttu-id="af023-122">Для построения решения нажмите CTRL+SHIFT+B.</span><span class="sxs-lookup"><span data-stu-id="af023-122">To build the solution, press CTRL+SHIFT+B.</span></span>  
  
3.  <span data-ttu-id="af023-123">Чтобы запустить решение, нажмите клавиши CTRL+F5.</span><span class="sxs-lookup"><span data-stu-id="af023-123">To run the solution, press CTRL+F5.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="af023-124">Образцы уже могут быть установлены на компьютере.</span><span class="sxs-lookup"><span data-stu-id="af023-124">The samples may already be installed on your machine.</span></span> <span data-ttu-id="af023-125">Перед продолжением проверьте следующий каталог (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="af023-125">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="af023-126">Если этот каталог не существует, перейдите к [Windows Communication Foundation (WCF) и образцы Windows Workflow Foundation (WF) для .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) для загрузки всех Windows Communication Foundation (WCF) и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] примеры.</span><span class="sxs-lookup"><span data-stu-id="af023-126">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="af023-127">Этот образец расположен в следующем каталоге.</span><span class="sxs-lookup"><span data-stu-id="af023-127">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\Built-InActivities\CancellationScope`