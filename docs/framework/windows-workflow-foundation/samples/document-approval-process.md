---
title: Процесс утверждения документа
ms.date: 03/30/2017
ms.assetid: 9b240937-76a7-45cd-8823-7f82c34d03bd
ms.openlocfilehash: c28dafd3b0a1cb6dbee37fed2b3df8923ccd82c8
ms.sourcegitcommit: 15109844229ade1c6449f48f3834db1b26907824
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2018
ms.locfileid: "33809496"
---
# <a name="document-approval-process"></a>Процесс утверждения документа
В этом образце демонстрируется использование многих возможностей Windows Workflow Foundation (WF) и Windows Communication Foundation (WCF) друг с другом. Вместе они реализуют сценарий утверждения документов. Клиентское приложение может представлять документы на утверждение и утверждать документы. Диспетчер утверждений облегчает взаимодействие между клиентами и обеспечивает соблюдение порядка утверждения. Утверждение - это рабочий процесс, который может выполняться несколькими способами. Поддерживается единичное утверждение, утверждение кворумом (частью группы утверждающих) и составное утверждение, состоящее из утверждения кворумом и следующего за ним единичного утверждения.  
  
> [!IMPORTANT]
>  Образцы уже могут быть установлены на компьютере. Перед продолжением проверьте следующий каталог (по умолчанию).  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  Если этот каталог не существует, перейдите к [Windows Communication Foundation (WCF) и образцы Windows Workflow Foundation (WF) для .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) для загрузки всех Windows Communication Foundation (WCF) и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] образцов. Этот образец расположен в следующем каталоге.  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Application\DocumentApprovalProcess`  
  
## <a name="sample-details"></a>Подробные сведения об образце  
 На следующем графике представлена схема процесса утверждения документа.  
  
 ![Рабочий процесс утверждения документа](../../../../docs/framework/windows-workflow-foundation/samples/media/approvalprocess.jpg "ApprovalProcess")  
  
 С точки зрения клиента процесс утверждения документа протекает следующим образом.  
  
1.  Клиент отправляет заявку на участие в системе утверждения.  
  
2.  Клиент WCF отправляет службы WCF, размещенной в диспетчере утверждения.  
  
3.  Клиенту возвращается индивидуальный пользовательский идентификатор. Теперь клиент может участвовать в процессе утверждения.  
  
4.  Присоединившись к системе, клиент может отправить документ на единичное утверждение, утверждение кворумом и составное утверждение.  
  
5.  По нажатию кнопки в клиентском интерфейсе запускается экземпляр рабочего процесса, размещенного в клиентском узле службы рабочих процессов.  
  
6.  Рабочий процесс отправляет запрос на утверждение приложению диспетчера утверждения.  
  
7.  Диспетчер рабочего процесса запускает на своем сайте рабочий процесс, представляющий процесс утверждения.  
  
8.  По завершении рабочего процесса утверждения диспетчер возвращает клиенту результаты.  
  
9. Результаты отображаются клиентом.  
  
10. Клиент может получить запрос на утверждение и в любой момент ответить на него.  
  
11. Служба WCF, размещенная в клиенте может получать запрос на утверждение от диспетчера утверждений.  
  
12. Данные о документе представляются на обозрение в клиенте.  
  
13. Пользователь может утвердить или отклонить документ.  
  
14. Клиент WCF используется для отправки ответа обратно в диспетчере утверждения.  
  
 С точки зрения диспетчера утверждений процесс утверждения протекает следующим образом.  
  
1.  Клиент отправляет заявку на участие в системе утверждения.  
  
2.  Служба WCF диспетчера утверждений получает запрос на могут входить в системе утверждения.  
  
3.  Для клиента создается индивидуальный идентификатор. Пользовательские данные сохраняются в базе данных.  
  
4.  Пользователю возвращается индивидуальный идентификатор.  
  
5.  Получение запроса на утверждение. Диспетчер запускает процесс утверждения.  
  
6.  Диспетчер получает запрос на утверждение и начинает новый рабочий процесс.  
  
7.  В зависимости от типа запроса (простое утверждение, утверждение кворумом или составное утверждение) запускается определенное действие.  
  
8.  Действия по отправке и получению с корреляцией используются для отправки запроса на утверждение клиенту на рассмотрения и для получения ответа.  
  
9. Результат рабочего процесса утверждения отправляется клиенту.  
  
## <a name="using-the-sample"></a>Использование образца  
  
##### <a name="to-set-up-the-database"></a>Настройка базы данных  
  
1.  Из командной строки [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], открытой с правами администратора, перейдите в каталог DocumentApprovalProcess и запустите команду Setup.cmd.  
  
##### <a name="to-set-up-the-application"></a>Настройка приложения  
  
1.  Откройте файл решения DocumentApprovalProcess.sln в среде [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].  
  
2.  Для построения решения нажмите CTRL+SHIFT+B.  
  
3.  Чтобы запустить решение, запустите приложение утверждающий, щелкнув правой кнопкой мыши проект ApprovalManager в **обозревателе решений** и щелкнув **отладки**->**запуск**  новый экземпляр из контекстного меню.  
  
     Подождите, пока от диспетчера не придет сообщение о готовности.  
  
##### <a name="to-run-the-single-approval-scenario"></a>Выполнение сценария одиночного утверждения  
  
1.  Откройте командную строку с разрешениями администратора.  
  
2.  Перейдите в каталог, содержащий решение.  
  
3.  Перейдите в папку ApprovalClient\Bin\Debug и запустите два экземпляра ApprovalClient.exe.  
  
4.  Нажмите кнопку **обнаружение**, подождите, пока **подписаться** кнопка включена.  
  
5.  Введите любое имя пользователя и нажмите кнопку **подписаться**. Для первого клиента используйте `UserType1`, а для второго - `UserType2`.  
  
6.  На клиенте `UserType1` выберите один тип подтверждения из раскрывающегося меню и введите имя и содержимое документа. Нажмите кнопку **запросить утверждение**.  
  
7.  В клиенте `UserType2` появится документ, ожидающий утверждения. Выберите его и нажмите клавишу **утвердить** или **Отклонить**. Результаты должны отобразиться на клиенте `UserType1`.  
  
##### <a name="to-run-the-quorum-approval-scenario"></a>Выполнение сценария утверждения кворумом  
  
1.  Откройте командную строку с разрешениями администратора.  
  
2.  Перейдите в каталог, содержащий решение.  
  
3.  Перейдите в папку ApprovalClient\Bin\Debug и запустите три экземпляра ApprovalClient.exe.  
  
4.  Нажмите кнопку **обнаружение**, подождите, пока **подписаться** кнопка включена.  
  
5.  Введите любое имя пользователя и нажмите кнопку **подписаться**. Для одного клиента используйте `UserType1`, а для двух других - `UserType2`.  
  
6.  В клиенте `UserType1` выберите в раскрывающемся меню утверждение кворумом и введите имя и содержимое документа. Нажмите кнопку **запросить утверждение**. В данном случае требуется, чтобы два клиента `UserType2` утвердили или отклонили документ. Хотя ответить должны оба клиента `UserType2`, для утверждения документа достаточно, чтобы его утвердил один из них.  
  
7.  На клиентах `UserType2` появится документ, ожидающий подтверждения. Выберите его и нажмите клавишу **утвердить** или **Отклонить**. Результаты должны отобразиться на клиенте `UserType1`.  
  
##### <a name="to-run-the-complex-approval-scenario"></a>Выполнение сценария составного утверждения  
  
1.  Откройте командную строку с разрешениями администратора.  
  
2.  Перейдите в каталог, содержащий решение.  
  
3.  Перейдите в папку ApprovalClient\Bin\Debug и запустите четыре экземпляра ApprovalClient.exe.  
  
4.  Нажмите кнопку **обнаружение**, подождите, пока **подписаться** кнопка включена.  
  
5.  Введите любое имя пользователя и нажмите кнопку **подписаться**. Для одного клиента используйте `UserType1`, для двух других - `UserType2`, а для последнего - `UserType3`.  
  
6.  На клиенте `UserType1` выберите один тип подтверждения из раскрывающегося меню и введите имя и содержимое документа. Нажмите кнопку **запросить утверждение**.  
  
7.  На клиентах `UserType2` появится документ, ожидающий подтверждения. Выберите его и нажмите клавишу **утвердить**, документ передан `UserType3` клиента.  
  
     Если документ был утвержден первым кворумом `UserType2`, этот документ буден передан клиенту `UserType3`.  
  
8.  Утвердите или отклоните документ, полученный от клиента `UserType3`. Результаты должны отобразиться на клиенте `UserType1`.  
  
##### <a name="to-clean-up"></a>Очистка  
  
1.  В командной строке [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] перейдите в директорию DocumentApprovalProcess и запустите команду Cleanup.cmd.