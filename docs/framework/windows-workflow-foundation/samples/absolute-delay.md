---
title: "Абсолютная задержка"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b483139a-39bb-4560-8003-8969a8fc2cd1
caps.latest.revision: "3"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: ee847a48955e3914d3e0d9a04228c6bc79d7fa70
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="absolute-delay"></a>Абсолютная задержка
Основной сценарий в этом образце - задержка до указанного значения <xref:System.DateTime> с помощью устойчивых таймеров в приложении рабочего процесса. Эффект будет отличаться от применения встроенного действия <xref:System.Activities.Statements.Delay>, так как в этом случае задержка возможна только в течение заданного значения <xref:System.TimeSpan> (или количества минут и секунд).  
  
 В реальной жизни такое разделение может быть реализовано в следующих сценариях.  
  
1.  Требуется отложить отправку почты на 30 секунд, чтобы убедиться, что в сообщении нет ошибок.  
  
2.  Во время сверхурочной работы требуется отложить обработку почты до начала рабочего дня (например, до 8 часов утра).  
  
## <a name="demonstrates"></a>Демонстрации  
  
1.  <xref:System.Activities.Statements.DurableTimerExtension> для реализации абсолютной задержки  
  
2.  Настройка сохранения состояния с помощью устойчивых таймеров <xref:System.Activities.WorkflowApplication>  
  
3.  Использование <xref:System.Activities.NativeActivity%601> для точек расширения  
  
4.  Использование <xref:System.Activities.CodeActivity%601> в действии SendEmail  
  
5.  <xref:System.Activities.Statements.Delay>  
  
6.  Только для рабочего процесса XAML  
  
 В этом образце показано создание пользовательского действия, которое принимает значение <xref:System.DateTime> и использует устойчивые таймеры для регистрации длительности задержки. При использовании устойчивого таймера необходимо создать закладку с помощью <xref:System.Activities.NativeActivity>, так как она должна быть зарегистрирована в расширении таймера. В этом образце по истечении устойчивого таймера будет вызван метод `OnTimerExpired`. Убедитесь, что в событие <xref:System.Activities.NativeActivity%601.CacheMetadata%2A> добавляется расширение таймера, чтобы обеспечить получение этих сведений средой выполнения. Единственное отличие в реализации состоит в том, что потребуется реализовать логику для преобразования <xref:System.DateTime> в <xref:System.TimeSpan>, так как устойчивые таймеры принимают только значения <xref:System.DateTime>. Помните, что при этом возникнет некоторая потеря точности  
  
> [!NOTE]
>  При преобразовании из <xref:System.DateTime> в <xref:System.TimeSpan> произойдет небольшая потеря точности.  
  
 В этом образце также демонстрируется включение сохранения для <xref:System.Activities.WorkflowApplication>. В этом образце мы будем использовать устойчивые таймеры, которые предполагают выгрузку данных рабочего процесса в базу данных сохраняемости во время простоя до истечения срока действия таймера. Эта реализация может быть также использована для других действий сохраняемости. В этом образце показано, как настроить строку подключения сохранения в SQL Server и как создать хранилище экземпляра для сохранения данных экземпляров рабочих процессов. Приведена логика, позволяющая возобновить рабочий процесс после возникновения события, после которого экземпляр рабочего процесса станет готов к запуску.  
  
 При пошаговом выполнении этого образца видно время начала и завершения встроенной задержки, что, в свою очередь, вызовет отправку сообщения по электронной почте. Таким образом, действие AbsoluteDelay создаст задержку до наступления указанного значения <xref:System.DateTime> (или 0 секунд, если срок <xref:System.DateTime> истек), что, в свою очередь, вызовет отправку сообщения после истечения срока. Будет показано два случая применения встроенной функции <xref:System.Activities.Statements.Delay> по сравнению с использованием действия AbsoluteDelay.  
  
#### <a name="to-set-up-build-and-run-the-sample"></a>Настройка, сборка и выполнение образца  
  
1.  Убедитесь, что на компьютере установлен SQL Server Express (или более новая версия).  
  
2.  Запустите файл setup.cmd (из каталога WF/Basic/Services/AbsoluteDelay/CS) в командной строке [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], чтобы создать базу данных AbsoluteDelaySampleDB, схему сохраняемости и логику сохраняемости.  
  
3.  Откройте решение в среде [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].  
  
4.  Укажите длительность действия Delay.  
  
5.  Укажите параметр ExpirationTime в действии AbsoluteDelay.  
  
6.  Обновите поля SendMailTo, SendMailFrom, SendMailSubject, SendMailBody и SmtpHost в действии SendMail.  
  
    > [!NOTE]
    >  Если не указан допустимый узел SMTP, приложение выдаст исключение SMTP.  
  
7.  Постройте решение, выбрав **построения**, **построить решение**.  
  
8.  Запустите решение, нажав клавишу **F5**.  
  
> [!IMPORTANT]
>  Образцы уже могут быть установлены на компьютере. Перед продолжением проверьте следующий каталог (по умолчанию).  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  Если этот каталог не существует, перейдите на страницу [Примеры Windows Communication Foundation (WCF) и Windows Workflow Foundation (WF) для .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) , чтобы скачать все примеры [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] . Этот образец расположен в следующем каталоге.  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\Services\AbsoluteDelay`
