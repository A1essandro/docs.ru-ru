---
title: Решение SQLStoreExtensibility
ms.date: 03/30/2017
ms.assetid: 5da1b5a3-f144-41ba-b9c4-02818b28b15d
ms.openlocfilehash: f49d05244cf9f65a8e06f39c7e40391aaebd9f77
ms.sourcegitcommit: efff8f331fd9467f093f8ab8d23a203d6ecb5b60
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/01/2018
ms.locfileid: "43408769"
---
# <a name="sqlstoreextensibility"></a>Решение SQLStoreExtensibility
Этот образец демонстрирует использование и конфигурацию распространяемых свойств в хранилище экземпляров рабочих процессов SQL. Хранилище экземпляров рабочих процессов SQL - это реализация хранилища экземпляров на основе SQL Server. Это дает экземпляру возможность сохранять свое состояние и загружать свое состояние из базы данных SQL Server или SQL Server Express либо заносить состояние в эту базу данных. Возможность расширения хранилища позволяет пользователю определять свойства, хранимые в хранилище экземпляров. Эти свойства отображаются в представлении распространяемых свойств, которые позволяют пользователю запрашивать их.  
  
 Этот образец состоит из рабочего процесса, реализующего службу счета. После вызова метода запуска службы служба начинает считать от 0 до 29. Значение счетчика увеличивается каждые 2 секунды. Рабочий процесс сохраняется после каждого отсчета. Текущее значение этого счета хранится в хранилище экземпляров в виде распространяемого свойства.  
  
 Рабочий процесс подсчета является резидентным в узле службы рабочих процессов. Метод `Main` программы выполняет следующие действия.  
  
-   Создает экземпляр узла службы рабочих процессов, в котором размещается рабочий процесс подсчета, и определяет конечные точки, в которых может быть достигнут рабочий процесс подсчета.  
  
-   Определяет поведение хранилища экземпляров рабочих процессов SQL, которое используется для настройки экземпляра рабочего процесса SQL. Хранилищу указывается рассматривать `CountStatus` как распространяемое свойство.  
  
-   Создает клиент, который вызывает метод запуска рабочего процесса подсчета.  
  
 После запуска программы счетчик автоматически начинает увеличиваться. Учтите, что на загрузку экземпляра и настройку хранилища экземпляров рабочих процессов SQL может уйти несколько секунд.  
  
 Для продвижения значения подсчета в качестве пользовательского свойства должны быть выполнены следующие шаги.  
  
1.  Класс `CounterStatus` определяет расширение экземпляра типа <xref:System.Activities.Persistence.PersistenceParticipant>, которое используется действиями для предоставления переменных состояния. `Count` определяется как значение, доступное только на запись. Когда экземпляр рабочего процесса достигает точки сохраняемости, расширение экземпляра сохраняет свойство `Count` в коллекцию данных сохраняемости.  
  
2.  При создании хранилища экземпляров новое свойство, `CountStatus`, определяется через метод `store.Promote()`.  
  
3.  Действие `SaveCounter` рабочего процесса присваивает текущее значение подсчета полю состояния `Count`.  
  
### <a name="to-use-this-sample"></a>Использование этого образца  
  
1.  Создайте базу данных хранилища экземпляров.  
  
    1.  Откройте командную строку [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].  
  
    2.  Перейдите в каталог образцов (\WF\Basic\Persistence\SqlStoreExtensibility\CS) и запустите CreateInstanceStore.cmd в командной строке [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].  
  
        > [!WARNING]
        >  Скрипт CreateInstanceStore.cmd создает базу данных в экземпляре SQL Server 2008 Express по умолчанию. Чтобы установить базу данных в другом экземпляре, измените скрипт.  
  
2.  Откройте [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] и загрузите решение SqlStoreExtensibility.sln, после чего выполните его сборку нажатием сочетания клавиш CTRL+SHIFT+B.  
  
    > [!WARNING]
    >  Если база данных установлена в именованном экземпляре SQL Server, обновите строку соединения в коде перед построением решения.  
  
3.  Выполнение примера с правами администратора, перейдите в каталог проекта (\WF\Basic\Persistence\SqlStoreExtensibility\bin\Debug) в [!INCLUDE[fileExplorer](../../../../includes/fileexplorer-md.md)], щелкнув правой кнопкой мыши SqlStoreExtensibility.exe и выберите команду **Запуск от имени Администратор**.  
  
### <a name="to-verify-the-sample-is-working-correctly"></a>Проверка правильности работы образца  
  
1.  Используйте SQL Server Management Studio, чтобы просмотреть содержимое таблицы экземпляров, выбрав **баз данных**, **InstanceStore**, а затем  **System.ServiceModel.Activities.DurableInstancing.InstanceTable** в обозревателе объектов щелкните правой кнопкой мыши **System.ServiceModel.Activities.DurableInstancing.InstanceTable** и выберите  **Выбрать первые 1000 строк**. Дополнительные сведения о SQL Server Management Studio, см. в разделе [Знакомство с SQL Server Management Studio](https://go.microsoft.com/fwlink/?LinkId=165645)  
  
2.  Просмотрите перечисленные экземпляры рабочих процессов.  
  
3.  В командной строке [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] запустите скрипт QueryInstanceStore.cmd, находящийся в каталоге образцов (\WF\Basic\Persistence\SqlStoreExtensibility).  
  
4.  Обратите внимание на значение счетчика, отображаемый под **CountStatus**.  
  
5.  Запустить сценарий несколько раз для см. в разделе **CountStats** изменение значения.  
  
6.  Чтобы завершить приложение рабочего процесса, нажмите клавишу ВВОД.  
  
### <a name="to-uninstall-the-sample"></a>Удаление образца  
  
1.  Удалите базу данных хранилища образцов, запустив скрипт RemoveInstanceStore.cmd, находящийся в каталоге образцов (\WF\Basic\Persistence\SqlStoreExtensibility).  
  
> [!IMPORTANT]
>  Образцы уже могут быть установлены на компьютере. Перед продолжением проверьте следующий каталог (по умолчанию).  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  Если этот каталог не существует, перейдите к [Windows Communication Foundation (WCF) и образцы Windows Workflow Foundation (WF) для .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) для загрузки всех Windows Communication Foundation (WCF) и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] примеры. Этот образец расположен в следующем каталоге.  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\Persistence\SQLStoreExtensibility`  
  
## <a name="see-also"></a>См. также  
 [Сохраняемость рабочих процессов](../../../../docs/framework/windows-workflow-foundation/workflow-persistence.md)  
 [Службы рабочих процессов](../../../../docs/framework/wcf/feature-details/workflow-services.md)  
 [Образцы размещения AppFabric и сохраняемости](https://go.microsoft.com/fwlink/?LinkId=193961)
