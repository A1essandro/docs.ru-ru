---
title: "Как создать рабочий процесс конечного автомата | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: 3ec60e8f-fad4-493e-a426-e7962d7aee8c
caps.latest.revision: 15
author: "Erikre"
ms.author: "erikre"
manager: "erikre"
caps.handback.revision: 15
---
# Как создать рабочий процесс конечного автомата
Рабочие процессы могут создаваться как из встроенных, так и из пользовательских действий.В этом разделе рассматривается последовательность создания рабочего процесса, который использует как встроенные действия \(например, действие <xref:System.Activities.Statements.StateMachine>\), так и пользовательские действия из предыдущего раздела [Как создать действие](../../../docs/framework/windows-workflow-foundation//how-to-create-an-activity.md).Рабочий процесс моделирует игру по угадыванию числа.  
  
> [!NOTE]
>  Каждый раздел в учебнике «Приступая к работе» построен на основе предыдущих разделов.Для изучения этого раздела необходимо сначала пройти раздел [Как создать действие](../../../docs/framework/windows-workflow-foundation//how-to-create-an-activity.md).  
  
> [!NOTE]
>  Чтобы загрузить завершенную версию учебника, см. раздел [Windows Workflow Foundation \(WF45\), учебник «Приступая к работе»](http://go.microsoft.com/fwlink/?LinkID=248976).  
  
### Создание рабочего процесса  
  
1.  Щелкните правой кнопкой мыши **NumberGuessWorkflowActivities** в окне **Обозреватель решений** и выберите **Добавить**, **Новый элемент**.  
  
2.  В узле **Установленные**, **Общие элементы** выберите **Рабочий процесс**.Выберите **Действие** в списке **Рабочий процесс**.  
  
3.  В поле **Имя** введите `StateMachineNumberGuessWorkflow` и нажмите кнопку **Добавить**.  
  
4.  Перетащите действие **Конечный автомат** из раздела **Конечный автомат** в **области элементов** на метку **Перетащите сюда действие** в области конструктора рабочих процессов.  
  
### Создание переменных и аргументов рабочего процесса  
  
1.  Дважды щелкните **StateMachineNumberGuessWorkflow.xaml** в **обозревателе решений**, чтобы отобразить рабочий процесс в конструкторе, если он еще не отображен.  
  
2.  Нажмите кнопку **Аргументы** в нижнем левом углу конструктора рабочих процессов, чтобы показать область **Аргументы**.  
  
3.  Нажмите кнопку **Создать аргумент**.  
  
4.  В поле **Имя** введите `MaxNumber`, в раскрывающемся списке **Направление** выберите значение **Входной**, выберите **Int32** в раскрывающемся списке **Тип аргумента**, а затем нажмите клавишу ВВОД, чтобы сохранить аргумент.  
  
5.  Нажмите кнопку **Создать аргумент**.  
  
6.  В поле **Имя** под только что добавленным аргументом `MaxNumber` введите `Turns`, в раскрывающемся списке **Направление** выберите значение **Выходной**, выберите тип **Int32** в раскрывающемся списке **Тип аргумента**, а затем нажмите клавишу ВВОД.  
  
7.  Нажмите кнопку **Аргументы** в левом нижнем углу конструктора действий, чтобы закрыть область **Аргументы**.  
  
8.  Нажмите кнопку **Переменные** в нижнем левом углу конструктора рабочих процессов, чтобы показать область **Переменные**.  
  
9. Нажмите кнопку **Создать переменную**.  
  
    > [!TIP]
    >  Если поле **Создать переменную** не отображается, щелкните действие <xref:System.Activities.Statements.StateMachine> в области конструктора рабочих процессов, чтобы его выбрать.  
  
10. В поле **Имя** введите `Guess`, в раскрывающемся списке **Тип переменной** выберите **Int32**, а затем нажмите клавишу ВВОД, чтобы сохранить переменную.  
  
11. Нажмите кнопку **Создать переменную**.  
  
12. В поле **Имя** введите `Target`, в раскрывающемся списке **Тип переменной** выберите **Int32**, а затем нажмите клавишу ВВОД, чтобы сохранить переменную.  
  
13. Нажмите кнопку **Переменные** в нижнем левом углу конструктора действий, чтобы закрыть область **Переменные**.  
  
### Добавление действий рабочего процесса  
  
1.  Нажмите **State1**, чтобы его выбрать.В **окне свойств** измените значение **DisplayName** на `Инициализировать целевой объект`.  
  
    > [!TIP]
    >  Если окно **Свойства** не отображается, выберите пункт **Окно свойств** в меню **Вид**.  
  
2.  Дважды щелкните только что переименованное состояние **Инициализировать целевой объект** в конструкторе рабочих процессов, чтобы развернуть его.  
  
3.  Перетащите действие **Assign** из раздела **Примитивыобласти элементов** и разместите его в разделе **Ввод** состояния.Введите `Target` в поле **Назначение** и следующее выражение в поле **Введите выражение C\#** или **Введите выражение VB**.  
  
    ```vb  
    New System.Random().Next(1, MaxNumber + 1)  
    ```  
  
    ```csharp  
    new System.Random().Next(1, MaxNumber + 1)  
    ```  
  
    > [!TIP]
    >  Если окно **Область элементов** не отображается, в меню **Вид** выберите пункт **Область элементов**.  
  
4.  Выполните возврат к общему представлению конечного автомата в конструкторе рабочих процессов, щелкнув **StateMachine** на экране навигатора в верхней части конструктора рабочих процессов.  
  
5.  Перетащите действие **State** из раздела **Конечный автоматобласти элементов** в конструктор рабочих процессов и разместите его над состоянием **Инициализировать целевой объект**.Обратите внимание, что вокруг состояния **Инициализируйте целевой объект** появятся четыре треугольника, когда новое состояние окажется над ним.Поместите новое состояние на треугольник непосредственно под состоянием **Инициализировать целевой объект**.При этом новое состояние помещается в рабочий процесс и выполняется переход из состояния **Инициализировать целевой объект** к новому состоянию.  
  
6.  Щелкните **State1** для его выбора, измените значение **DisplayName** на `Введите ответ`, затем дважды щелкните состояние в конструкторе рабочих процессов, чтобы развернуть его.  
  
7.  Перетащите действие **WriteLine** из раздела **Примитивы** в **области элементов** и разместите его в разделе **Ввод** состояния.  
  
8.  Введите следующее выражение в поле свойства **Текст** в **WriteLine**.  
  
    ```vb  
    "Please enter a number between 1 and " & MaxNumber  
    ```  
  
    ```csharp  
    "Please enter a number between 1 and " + MaxNumber  
    ```  
  
9. Перетащите действие **Assign** из раздела **Примитивыобласти элементов** и разместите его в разделе **Выход** состояния.  
  
10. Введите `Turns` в поле **Назначение** и `Turns + 1` в поле **Введите выражение C\#** или **Введите выражение VB**.  
  
11. Выполните возврат к общему представлению конечного автомата в конструкторе рабочих процессов, щелкнув **StateMachine** на экране навигатора в верхней части конструктора рабочих процессов.  
  
12. Перетащите действие **FinalState** из раздела **Конечный автомат** в **области элементов**, наведите его на состояние **Введите ответ** и поместите его на треугольник, который отображается справа от состояния **Введите ответ** так, чтобы был создан переход между состояниями **Введите ответ** и **FinalState**.  
  
13. По умолчанию имя перехода — **T2**.Щелкните переход в конструкторе рабочих процессов, чтобы выбрать его, и установите для **DisplayName** значение **Правильное пробное значение**.Щелкните **FinalState**, перетащите его вправо так, чтобы освободить пространство для отображения полного имени перехода без наложения его на другие два состояния.Это позволит упростить выполнение оставшихся действий в учебнике.  
  
14. Дважды щелкните только что переименованный переход **Правильное пробное значение** в конструкторе рабочих процессов, чтобы развернуть его.  
  
15. Перетащите действие **ReadInt** из раздела **NumberGuessWorkflowActivities** в **области элементов** и поместите его в раздел **Триггер** перехода.  
  
16. В **окне свойств** для действия **ReadInt** введите `"EnterGuess"` \(включая кавычки\) в поле значения свойства **BookmarkName** и введите `Предположить` в поле значения свойства **Результат**.  
  
17. Введите следующее выражение в поле значения свойства **Условие** перехода **Правильное пробное значение**.  
  
    ```vb  
    Guess = Target  
    ```  
  
    ```csharp  
    Guess == Target  
    ```  
  
18. Выполните возврат к общему представлению конечного автомата в конструкторе рабочих процессов, щелкнув **StateMachine** на экране навигатора в верхней части конструктора рабочих процессов.  
  
    > [!NOTE]
    >  Переход происходит при получении события триггера и оценке <xref:System.Activities.Statements.Transition.Condition%2A> значением `True` \(если оно присутствует\).Для этого перехода, если `Guess` пользователя соответствует случайно созданному `Target`, управление передается **FinalState** и рабочий процесс завершается.  
  
19. В зависимости от того, является ли пробное значение правильным, рабочий процесс должен перейти либо в **FinalState**, либо обратно в состояние **Введите ответ** для другой попытки.Оба перехода совместно используют один и тот же триггер ожидания пробного значения пользователя, получаемого с помощью действия **ReadInt**.Это называется общим переходом.Чтобы создать общий переход, щелкните круг, обозначающий начало перехода **Правильное пробное значение**, и перетащите его в нужное состояние.В этом случае переход является самопереходом, поэтому перетащите начальную точку перехода **Правильное пробное значение** и поместите ее обратно в нижнюю часть состояния **Введите ответ**.После создания перехода выберите его в конструкторе рабочих процессов и присвойте его свойству **DisplayName** значение **Неверное пробное значение**.  
  
    > [!NOTE]
    >  Общие переходы также можно создавать в конструкторе переходов, щелкнув в нижней части конструктора **Добавить общий переход триггера**, а затем выбрав требуемое целевое состояние из раскрывающегося списка **Состояния, доступные для подключения**.  
  
    > [!NOTE]
    >  Обратите внимание, что если состояние <xref:System.Activities.Statements.Transition.Condition%2A> перехода оценивается как `false` \(или все условия общего перехода триггера оцениваются как `false`\), переход не выполняется, а все триггеры для всех переходов из состояния будут запланированы заново.В этом учебнике такая ситуация невозможна из\-за способа настройки условий \(имеются определенные действия для случая, если догадка верна или неверна\).  
  
20. Дважды щелкните переход **Неверное пробное значение** в конструкторе рабочих процессов, чтобы развернуть его.Обратите внимание, что **Триггер** уже установлен на то же действие **ReadInt**, которое было использовано переходом **Правильное пробное значение**.  
  
21. В поле значения свойства **Условие** введите указанное далее выражение.  
  
    ```vb  
    Guess <> Target  
    ```  
  
    ```csharp  
    Guess != Target  
    ```  
  
22. Перетащите действие **If** из раздела **Поток управления** в **области элементов** в раздел **Действие** перехода.  
  
23. Введите следующее выражение в поле значения свойства **Условие** действия **If**.  
  
    ```vb-c#  
    Guess < Target  
    ```  
  
24. Перетащите два действия **WriteLine** из раздела **Примитивыобласти элементов** и разместите их так, чтобы одно находилось в разделе **Тогда** действия **If**, а другое — в разделе **Иначе**.  
  
25. Щелкните действие **WriteLine** в разделе **Тогда**, чтобы выбрать его, и введите следующее выражение в поле значения свойства **Текст**.  
  
    ```vb-c#  
    "Your guess is too low."  
    ```  
  
26. Щелкните действие **WriteLine** в разделе **Иначе**, чтобы выбрать его, и введите следующее выражение в поле значения свойства **Текст**.  
  
    ```vb-c#  
    "Your guess is too high."  
    ```  
  
27. Выполните возврат к общему представлению конечного автомата в конструкторе рабочих процессов, щелкнув **StateMachine** на экране навигатора в верхней части конструктора рабочих процессов.  
  
     В следующем примере показан завершенный рабочий процесс.  
  
     ![Готовый рабочий процесс конечного автомата](../../../docs/framework/windows-workflow-foundation//media/wfstatemachinegettingstartedtutorialcomplete.JPG "WFStateMachineGettingStartedTutorialComplete")  
  
### Построение рабочего процесса  
  
1.  Чтобы построить решение, нажмите CTRL\+SHIFT\+B.  
  
     Указания по запуску рабочего процесса см. в следующем разделе [Как запустить рабочий процесс](../../../docs/framework/windows-workflow-foundation//how-to-run-a-workflow.md).Если вы уже завершили шаг [Как запустить рабочий процесс](../../../docs/framework/windows-workflow-foundation//how-to-run-a-workflow.md) с другим стилем рабочего процесса и планируете запустить его, используя рабочий процесс конечного автомата \(начиная с этого шага\), перейдите к разделу [Сборка и запуск приложения](../../../docs/framework/windows-workflow-foundation//how-to-run-a-workflow.md#BKMK_ToRunTheApplication) в [Как запустить рабочий процесс](../../../docs/framework/windows-workflow-foundation//how-to-run-a-workflow.md).  
  
## См. также  
 <xref:System.Activities.Statements.Flowchart>   
 <xref:System.Activities.Statements.FlowDecision>   
 [Программирование в Windows Workflow Foundation](../../../docs/framework/windows-workflow-foundation//programming.md)   
 [Разработка рабочих процессов](../../../docs/framework/windows-workflow-foundation//designing-workflows.md)   
 [Учебник по началу работы](../../../docs/framework/windows-workflow-foundation//getting-started-tutorial.md)   
 [Как создать действие](../../../docs/framework/windows-workflow-foundation//how-to-create-an-activity.md)   
 [Как запустить рабочий процесс](../../../docs/framework/windows-workflow-foundation//how-to-run-a-workflow.md)