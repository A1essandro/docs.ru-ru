---
title: "SQL Server Programming and Host Protection Attributes | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "SQL Server [.NET Framework]"
  - "permission sets, SQL Server"
  - "SQL Server Programming and Host Protection Attributes"
  - "managed code, SQL Server"
  - "reliability [.NET Framework]"
  - "writing reliable code"
  - "hosts, reliability"
  - "host protection attributes"
  - "HostProtectionAttribute class, reliability"
ms.assetid: 7dfa36b4-e773-4c75-a3ff-ff1af3ce4c4f
caps.latest.revision: 13
author: "mairaw"
ms.author: "mairaw"
manager: "wpickett"
caps.handback.revision: 13
---
# SQL Server Programming and Host Protection Attributes
Возможность загрузки и выполнения управляемого кода в основном приложении SQL Server нуждается в выполнении требований, предъявляемых основным приложением, как к управлению доступом для кода, так и к защите ресурсов основного приложения.  Требования к управлению доступом для кода указаны в одном из трех наборов разрешений SQL: SAFE, EXTERNAL\-ACCESS или UNSAFE.  Код, выполняемый в наборе разрешений SAFE или EXTERNAL\-ACCESS, должен избегать использования определенных типов или элементов, в которых применяется атрибут <xref:System.Security.Permissions.HostProtectionAttribute>.  Атрибут <xref:System.Security.Permissions.HostProtectionAttribute> не является разрешением безопасности, насколько это может быть гарантировано надежностью, так как он определяет некоторые конструкции кода \(типы или методы\), которые могут быть неразрешены в основном приложении.  Использование атрибута <xref:System.Security.Permissions.HostProtectionAttribute> принудительно включает модель программирования, которая способствует обеспечению стабильности основного приложения.  
  
## Атрибуты защиты основного приложения  
 Атрибуты защиты основного приложения идентифицируют типы или элементы, которые не вписываются в модель программирования основного приложения и представляют следующие угрозы безопасности, увеличенные по сравнению со стандартной моделью:  
  
-   В других условиях являются малоэффективными.  
  
-   Могут привести к дестабилизации пользовательского кода, управляемого сервером.  
  
-   Могут привести к дестабилизации самого процесса сервера.  
  
 В SQL Server не разрешено использовать тип или элемент, который имеет атрибут <xref:System.Security.Permissions.HostProtectionAttribute>, указывающий значение <xref:System.Security.Permissions.HostProtectionResource> объектов <xref:System.Security.Permissions.HostProtectionResource>, <xref:System.Security.Permissions.HostProtectionResource>, <xref:System.Security.Permissions.HostProtectionResource> или <xref:System.Security.Permissions.HostProtectionResource>.  Это не дает сборкам вызывать элементы, которые разрешают общее состояние, выполняют синхронизацию, могут привести к утечке ресурсов при завершении или влияют на целостность процесса SQL Server.  
  
### Запрещенные типы и элементы  
 В следующей таблице приведены типы и элементы, значения <xref:System.Security.Permissions.HostProtectionResource> которых запрещены в SQL Server.  
  
|Пространство имен|Тип или элемент|  
|-----------------------|---------------------|  
|`Microsoft.Win32`|Класс <xref:Microsoft.Win32.PowerModeChangedEventArgs><br /><br /> Делегат <xref:Microsoft.Win32.PowerModeChangedEventHandler><br /><br /> Класс <xref:Microsoft.Win32.SessionEndedEventArgs><br /><br /> Делегат <xref:Microsoft.Win32.SessionEndedEventHandler><br /><br /> Класс <xref:Microsoft.Win32.SessionEndingEventArgs><br /><br /> Делегат <xref:Microsoft.Win32.SessionEndingEventHandler><br /><br /> Класс <xref:Microsoft.Win32.SessionSwitchEventArgs><br /><br /> Делегат <xref:Microsoft.Win32.SessionSwitchEventHandler><br /><br /> Класс <xref:Microsoft.Win32.SystemEvents><br /><br /> Класс <xref:Microsoft.Win32.TimerElapsedEventArgs><br /><br /> Делегат <xref:Microsoft.Win32.TimerElapsedEventHandler><br /><br /> Класс <xref:Microsoft.Win32.UserPreferenceChangedEventArgs><br /><br /> Класс <xref:Microsoft.Win32.UserPreferenceChangingEventArgs>|  
|`System.Collections`|Метод <xref:System.Collections.ArrayList.Synchronized%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Collections.Hashtable.Synchronized%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Collections.Queue.Synchronized%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Collections.SortedList.Synchronized%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Collections.Stack.Synchronized%2A?displayProperty=fullName>|  
|`System.ComponentModel`|Класс <xref:System.ComponentModel.AddingNewEventArgs><br /><br /> Делегат <xref:System.ComponentModel.AddingNewEventHandler><br /><br /> Класс <xref:System.ComponentModel.ArrayConverter><br /><br /> Класс <xref:System.ComponentModel.AsyncCompletedEventArgs><br /><br /> Делегат <xref:System.ComponentModel.AsyncCompletedEventHandler><br /><br /> Класс <xref:System.ComponentModel.AsyncOperation><br /><br /> Класс <xref:System.ComponentModel.AsyncOperationManager><br /><br /> Класс <xref:System.ComponentModel.AttributeCollection><br /><br /> Класс <xref:System.ComponentModel.BackgroundWorker><br /><br /> Класс <xref:System.ComponentModel.BaseNumberConverter><br /><br /> Класс <xref:System.ComponentModel.BindingList%601><br /><br /> Класс <xref:System.ComponentModel.BooleanConverter><br /><br /> Класс <xref:System.ComponentModel.ByteConverter><br /><br /> Класс <xref:System.ComponentModel.CancelEventArgs><br /><br /> Делегат <xref:System.ComponentModel.CancelEventHandler><br /><br /> Класс <xref:System.ComponentModel.CharConverter><br /><br /> Класс <xref:System.ComponentModel.CollectionChangeEventArgs><br /><br /> Делегат <xref:System.ComponentModel.CollectionChangeEventHandler><br /><br /> Класс <xref:System.ComponentModel.CollectionConverter><br /><br /> Класс <xref:System.ComponentModel.ComponentCollection><br /><br /> Класс <xref:System.ComponentModel.ComponentConverter><br /><br /> Класс <xref:System.ComponentModel.ComponentEditor><br /><br /> Класс <xref:System.ComponentModel.ComponentResourceManager><br /><br /> Класс <xref:System.ComponentModel.Container><br /><br /> Класс <xref:System.ComponentModel.ContainerFilterService><br /><br /> Класс <xref:System.ComponentModel.CultureInfoConverter><br /><br /> Класс <xref:System.ComponentModel.CustomTypeDescriptor><br /><br /> Класс <xref:System.ComponentModel.DateTimeConverter><br /><br /> Класс <xref:System.ComponentModel.DecimalConverter><br /><br /> Класс <xref:System.ComponentModel.Design.ActiveDesignerEventArgs><br /><br /> Делегат <xref:System.ComponentModel.Design.ActiveDesignerEventHandler><br /><br /> Класс <xref:System.ComponentModel.Design.CheckoutException><br /><br /> Класс <xref:System.ComponentModel.Design.CommandID><br /><br /> Класс <xref:System.ComponentModel.Design.ComponentChangedEventArgs><br /><br /> Делегат <xref:System.ComponentModel.Design.ComponentChangedEventHandler><br /><br /> Класс <xref:System.ComponentModel.Design.ComponentChangingEventArgs><br /><br /> Делегат <xref:System.ComponentModel.Design.ComponentChangingEventHandler><br /><br /> Класс <xref:System.ComponentModel.Design.ComponentEventArgs><br /><br /> Делегат <xref:System.ComponentModel.Design.ComponentEventHandler><br /><br /> Класс <xref:System.ComponentModel.Design.ComponentRenameEventArgs><br /><br /> Делегат <xref:System.ComponentModel.Design.ComponentRenameEventHandler><br /><br /> Класс <xref:System.ComponentModel.Design.DesignerCollection><br /><br /> Класс <xref:System.ComponentModel.Design.DesignerEventArgs><br /><br /> Делегат <xref:System.ComponentModel.Design.DesignerEventHandler><br /><br /> Класс <xref:System.ComponentModel.Design.DesignerOptionService><br /><br /> Класс <xref:System.ComponentModel.Design.DesignerTransaction><br /><br /> Класс <xref:System.ComponentModel.Design.DesignerTransactionCloseEventArgs><br /><br /> Делегат <xref:System.ComponentModel.Design.DesignerTransactionCloseEventHandler><br /><br /> Класс <xref:System.ComponentModel.Design.DesignerVerb><br /><br /> Класс <xref:System.ComponentModel.Design.DesignerVerbCollection><br /><br /> Класс <xref:System.ComponentModel.Design.DesigntimeLicenseContext><br /><br /> Класс <xref:System.ComponentModel.Design.DesigntimeLicenseContextSerializer><br /><br /> Класс <xref:System.ComponentModel.Design.MenuCommand><br /><br /> Класс <xref:System.ComponentModel.Design.Serialization.ComponentSerializationService><br /><br /> Класс <xref:System.ComponentModel.Design.Serialization.ContextStack><br /><br /> Класс <xref:System.ComponentModel.Design.Serialization.DesignerLoader><br /><br /> Класс <xref:System.ComponentModel.Design.Serialization.InstanceDescriptor><br /><br /> Класс <xref:System.ComponentModel.Design.Serialization.MemberRelationshipService><br /><br /> Класс <xref:System.ComponentModel.Design.Serialization.ResolveNameEventArgs><br /><br /> Делегат <xref:System.ComponentModel.Design.Serialization.ResolveNameEventHandler><br /><br /> Класс <xref:System.ComponentModel.Design.Serialization.SerializationStore><br /><br /> Класс <xref:System.ComponentModel.Design.ServiceContainer><br /><br /> Делегат <xref:System.ComponentModel.Design.ServiceCreatorCallback><br /><br /> Класс <xref:System.ComponentModel.Design.StandardCommands><br /><br /> Класс <xref:System.ComponentModel.Design.StandardToolWindows><br /><br /> Класс <xref:System.ComponentModel.DoubleConverter><br /><br /> Класс <xref:System.ComponentModel.DoWorkEventArgs><br /><br /> Делегат <xref:System.ComponentModel.DoWorkEventHandler><br /><br /> Класс <xref:System.ComponentModel.EnumConverter><br /><br /> Класс <xref:System.ComponentModel.EventDescriptor><br /><br /> Класс <xref:System.ComponentModel.EventDescriptorCollection><br /><br /> Класс <xref:System.ComponentModel.EventHandlerList><br /><br /> Класс <xref:System.ComponentModel.ExpandableObjectConverter><br /><br /> Класс <xref:System.ComponentModel.HandledEventArgs><br /><br /> Делегат <xref:System.ComponentModel.HandledEventHandler><br /><br /> Класс <xref:System.ComponentModel.InstanceCreationEditor><br /><br /> Класс <xref:System.ComponentModel.Int16Converter><br /><br /> Класс <xref:System.ComponentModel.Int32Converter><br /><br /> Класс <xref:System.ComponentModel.Int64Converter><br /><br /> Класс <xref:System.ComponentModel.InvalidAsynchronousStateException><br /><br /> Класс <xref:System.ComponentModel.InvalidEnumArgumentException><br /><br /> Метод <xref:System.ComponentModel.ISynchronizeInvoke.BeginInvoke%2A><br /><br /> Класс <xref:System.ComponentModel.License><br /><br /> Класс <xref:System.ComponentModel.LicenseContext><br /><br /> Класс <xref:System.ComponentModel.LicenseException><br /><br /> Класс <xref:System.ComponentModel.LicenseManager><br /><br /> Класс <xref:System.ComponentModel.LicenseProvider><br /><br /> Класс <xref:System.ComponentModel.LicFileLicenseProvider><br /><br /> Класс <xref:System.ComponentModel.ListChangedEventArgs><br /><br /> Делегат <xref:System.ComponentModel.ListChangedEventHandler><br /><br /> Класс <xref:System.ComponentModel.ListSortDescription><br /><br /> Класс <xref:System.ComponentModel.ListSortDescriptionCollection><br /><br /> Класс <xref:System.ComponentModel.MaskedTextProvider><br /><br /> Класс <xref:System.ComponentModel.MemberDescriptor><br /><br /> Класс <xref:System.ComponentModel.MultilineStringConverter><br /><br /> Класс <xref:System.ComponentModel.NestedContainer><br /><br /> Класс <xref:System.ComponentModel.NullableConverter><br /><br /> Класс <xref:System.ComponentModel.ProgressChangedEventArgs><br /><br /> Делегат <xref:System.ComponentModel.ProgressChangedEventHandler><br /><br /> Класс <xref:System.ComponentModel.PropertyChangedEventArgs><br /><br /> Делегат <xref:System.ComponentModel.PropertyChangedEventHandler><br /><br /> Класс <xref:System.ComponentModel.PropertyDescriptor><br /><br /> Класс <xref:System.ComponentModel.PropertyDescriptorCollection><br /><br /> Класс <xref:System.ComponentModel.ReferenceConverter><br /><br /> Класс <xref:System.ComponentModel.RefreshEventArgs><br /><br /> Делегат <xref:System.ComponentModel.RefreshEventHandler><br /><br /> Класс <xref:System.ComponentModel.RunWorkerCompletedEventArgs><br /><br /> Делегат <xref:System.ComponentModel.RunWorkerCompletedEventHandler><br /><br /> Класс <xref:System.ComponentModel.SByteConverter><br /><br /> Класс <xref:System.ComponentModel.SingleConverter><br /><br /> Класс <xref:System.ComponentModel.StringConverter><br /><br /> Класс <xref:System.ComponentModel.SyntaxCheck><br /><br /> Класс <xref:System.ComponentModel.TimeSpanConverter><br /><br /> Класс <xref:System.ComponentModel.TypeConverter><br /><br /> Класс <xref:System.ComponentModel.TypeDescriptionProvider><br /><br /> Класс <xref:System.ComponentModel.TypeDescriptor><br /><br /> Класс <xref:System.ComponentModel.TypeListConverter><br /><br /> Класс <xref:System.ComponentModel.UInt16Converter><br /><br /> Класс <xref:System.ComponentModel.UInt32Converter><br /><br /> Класс <xref:System.ComponentModel.UInt64Converter><br /><br /> Класс <xref:System.ComponentModel.WarningException><br /><br /> Класс <xref:System.ComponentModel.Win32Exception>|  
|`System.Diagnostics`|Свойство <xref:System.Diagnostics.Debug.Listeners%2A?displayProperty=fullName><br /><br /> Свойство <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=fullName><br /><br /> Свойство <xref:System.Diagnostics.EventLog.SynchronizingObject%2A?displayProperty=fullName><br /><br /> Класс <xref:System.Diagnostics.ConsoleTraceListener><br /><br /> Класс <xref:System.Diagnostics.DefaultTraceListener><br /><br /> Класс <xref:System.Diagnostics.DelimitedListTraceListener><br /><br /> Класс <xref:System.Diagnostics.EventLogTraceListener><br /><br /> Класс <xref:System.Diagnostics.PerformanceCounter><br /><br /> Класс <xref:System.Diagnostics.PerformanceCounterCategory><br /><br /> Класс <xref:System.Diagnostics.Process><br /><br /> Класс <xref:System.Diagnostics.ProcessStartInfo><br /><br /> Класс <xref:System.Diagnostics.TextWriterTraceListener><br /><br /> Класс <xref:System.Diagnostics.TraceListener><br /><br /> Класс <xref:System.Diagnostics.XmlWriterTraceListener><br /><br /> Свойство <xref:System.Diagnostics.TraceSource.Listeners%2A?displayProperty=fullName>|  
|`System.IO`|Метод <xref:System.IO.Stream.Synchronized%2A?displayProperty=fullName><br /><br /> Метод <xref:System.IO.TextReader.Synchronized%2A?displayProperty=fullName><br /><br /> Метод <xref:System.IO.TextWriter.Synchronized%2A?displayProperty=fullName>|  
|`System.Reflection.Emit`|Класс <xref:System.Reflection.Emit.ConstructorBuilder><br /><br /> Класс <xref:System.Reflection.Emit.EventBuilder><br /><br /> Класс <xref:System.Reflection.Emit.FieldBuilder><br /><br /> Класс <xref:System.Reflection.Emit.MethodBuilder><br /><br /> Класс <xref:System.Reflection.Emit.CustomAttributeBuilder><br /><br /> Класс <xref:System.Reflection.Emit.MethodRental><br /><br /> Класс <xref:System.Reflection.Emit.ModuleBuilder><br /><br /> Класс <xref:System.Reflection.Emit.PropertyBuilder><br /><br /> Класс <xref:System.Reflection.Emit.TypeBuilder><br /><br /> Класс <xref:System.Reflection.Emit.UnmanagedMarshal>|  
|`System.Text`|Метод <xref:System.Text.RegularExpressions.Group.Synchronized%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Text.RegularExpressions.Match.Synchronized%2A?displayProperty=fullName>|  
|`System.Threading`|Класс <xref:System.Threading.AutoResetEvent><br /><br /> Класс <xref:System.Threading.EventWaitHandle><br /><br /> Класс <xref:System.Threading.ManualResetEvent><br /><br /> Класс <xref:System.Threading.Monitor><br /><br /> Класс <xref:System.Threading.Mutex><br /><br /> Класс <xref:System.Threading.ReaderWriterLock><br /><br /> Класс <xref:System.Threading.Semaphore><br /><br /> Метод <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Threading.Thread.BeginCriticalRegion%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Threading.Thread.EndCriticalRegion%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Threading.Thread.FreeNamedDataSlot%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Threading.Thread.GetData%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Threading.Thread.Join%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Threading.Thread.SetApartmentState%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Threading.Thread.SetData%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Threading.Thread.SpinWait%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Threading.Thread.Start%2A?displayProperty=fullName><br /><br /> Метод <xref:System.Threading.Thread.TrySetApartmentState%2A?displayProperty=fullName><br /><br /> Класс <xref:System.Threading.ThreadPool><br /><br /> Класс <xref:System.Threading.Timer>|  
|`System.Timers`|Класс <xref:System.Timers.Timer>|  
|`System.Web.Configuration`|Класс <xref:System.Web.Configuration.MachineKeyValidationConverter>|  
|`System.Windows.Forms`|Свойство <xref:System.Windows.Forms.AutoCompleteStringCollection.SyncRoot%2A?displayProperty=fullName>|  
  
## Наборы разрешений SQL Server  
 SQL Server позволяет пользователям указывать требования к надежности кода, развернутого в базе данных.  Если сборки выгружены в базу данных, автор сборки может указать один из трех наборов разрешений для этой сборки: SAFE, EXTERNAL\-ACCESS или UNSAFE.  
  
|Набор разрешений|SAFE|EXTERNAL\-ACCESS|UNSAFE|  
|----------------------|----------|----------------------|------------|  
|Управление доступом для кода|Только выполнение|Выполнение и доступ к внешним ресурсам|Unrestricted|  
|Ограничения модели программирования|Да|Да|Без ограничений|  
|Требование проверяемости|Да|Да|Нет|  
|Возможность вызова машинного кода|Нет|Нет|Да|  
  
 SAFE — это наиболее надежный и безопасный режим с соответствующими ограничениями в терминологии разрешенной модели программирования.  Код SAFE имеет функциональные возможности высокой надежности и безопасности.  Сборки SAFE имеют достаточно разрешений для выполнения, вычислений и имеют доступ к локальной базе данных.  Сборки SAFE должны после проверки соответствовать безопасному типу и не могут вызывать неуправляемый код.  
  
 Режим EXTERNAL\-ACCESS предоставляет промежуточный вариант безопасности. При его использовании код может получать доступ к внешним по отношению к базе данных ресурсам, однако имеет надежность и безопасность режима SAFE.  
  
 UNSAFE — это режим для кода с очень высоким уровнем доверия, который может быть создан только администраторами баз данных.  Этот доверенный код не содержит ограничений на доступ кода и может вызывать неуправляемый \(машинный\) код.  
  
 В SQL Server используется уровень политики управления доступом для кода на уровне основного приложения для настройки политики основного приложения, предоставляющей один из трех наборов разрешений в зависимости от набора разрешений, хранящегося в каталогах SQL Server.  Управляемый код, работающий внутри базы данных, всегда получает один из этих наборов разрешений доступа кода.  
  
## Ограничения модели программирования  
 Модель программирования для управляемого кода в SQL Server нуждается в функциях, процедурах и типах, которые не требует использования состояния различных вызовов или использования общего состояния различных пользовательских сеансов.  Более того, как было описано ранее, присутствие общего состояния может привести к возникновению критических исключений, которые повлияют на масштабируемость и надежность приложения.  
  
 Учитывая эти условия, в SQL Server не разрешено использовать статические переменные и статические элементы данных.  Для сборок SAFE и EXTERNAL\-ACCESS SQL Server проверяет метаданные сборки во время CREATE ASSEMBLY и завершает создание таких сборок с ошибкой, если обнаружит использование статических элементов данных и статических переменных.  
  
## См. также  
 <xref:System.Security.Permissions.HostProtectionAttribute>   
 <xref:System.Security.Permissions.HostProtectionResource>