---
title: Взаимодействие WPF и Win32
ms.date: 03/30/2017
helpviewer_keywords:
- hosting WPF content in Win32 window [WPF]
- HWND interop [WPF]
- Win32 code [WPF], WPF interoperation
- interoperability [WPF], Win32
ms.assetid: 0ffbde0d-701d-45a3-a6fa-dd71f4d9772e
ms.openlocfilehash: 8a0e27d46248bdfd782c2cf650faaf8f3bc29960
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
ms.locfileid: "33549426"
---
# <a name="wpf-and-win32-interoperation"></a><span data-ttu-id="f2cf9-102">Взаимодействие WPF и Win32</span><span class="sxs-lookup"><span data-stu-id="f2cf9-102">WPF and Win32 Interoperation</span></span>
<span data-ttu-id="f2cf9-103">В этом разделе приводится общее описание метода обеспечения взаимодействия [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и кода [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-103">This topic provides an overview of how to interoperate [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code.</span></span> <span data-ttu-id="f2cf9-104">Служба [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] предоставляет среду с широкими возможностями для создания приложений.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-104">[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] provides a rich environment for creating applications.</span></span> <span data-ttu-id="f2cf9-105">Однако если имеется сложный код [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)], возможно, более эффективным будет повторное использование части этого кода.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-105">However, when you have a substantial investment in [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] code, it might be more effective to reuse some of that code.</span></span>  
  

  
<a name="basics"></a>   
## <a name="wpf-and-win32-interoperation-basics"></a><span data-ttu-id="f2cf9-106">Основы взаимодействия WPF и Win32</span><span class="sxs-lookup"><span data-stu-id="f2cf9-106">WPF and Win32 Interoperation Basics</span></span>  
 <span data-ttu-id="f2cf9-107">Существуют два основных метода взаимодействия между [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и кодом [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-107">There are two basic techniques for interoperation between [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code.</span></span>  
  
-   <span data-ttu-id="f2cf9-108">Размещение содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] в окне [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-108">Host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="f2cf9-109">С помощью этого способа можно использовать дополнительные графические возможности [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] в структуре стандартных окон и приложений [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-109">With this technique, you can use the advanced graphics capabilities of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] within the framework of a standard [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window and application.</span></span>  
  
-   <span data-ttu-id="f2cf9-110">Размещение окна [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] в содержимом [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-110">Host a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="f2cf9-111">С помощью этого способа можно использовать существующий пользовательский элемент управления [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] в контексте другого содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и передавать данные через границы.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-111">With this technique, you can use an existing custom [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] control in the context of other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and pass data across the boundaries.</span></span>  
  
 <span data-ttu-id="f2cf9-112">Каждый из этих способов детально представлен в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-112">Each of these techniques is conceptually introduced in this topic.</span></span> <span data-ttu-id="f2cf9-113">Дополнительные примеры кода размещения [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] в [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] см. в разделе [Пошаговое руководство. Размещение содержимого WPF в Win32](../../../../docs/framework/wpf/advanced/walkthrough-hosting-wpf-content-in-win32.md).</span><span class="sxs-lookup"><span data-stu-id="f2cf9-113">For a more code-oriented illustration of hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)], see [Walkthrough: Hosting WPF Content in Win32](../../../../docs/framework/wpf/advanced/walkthrough-hosting-wpf-content-in-win32.md).</span></span> <span data-ttu-id="f2cf9-114">Дополнительные примеры кода размещения [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] см. в разделе [Пошаговое руководство. Размещение элемента управления Win32 в WPF](../../../../docs/framework/wpf/advanced/walkthrough-hosting-a-win32-control-in-wpf.md).</span><span class="sxs-lookup"><span data-stu-id="f2cf9-114">For a more code-oriented illustration of hosting [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], see [Walkthrough: Hosting a Win32 Control in WPF](../../../../docs/framework/wpf/advanced/walkthrough-hosting-a-win32-control-in-wpf.md).</span></span>  
  
<a name="projects"></a>   
## <a name="wpf-interoperation-projects"></a><span data-ttu-id="f2cf9-115">Проекты взаимодействия WPF</span><span class="sxs-lookup"><span data-stu-id="f2cf9-115">WPF Interoperation Projects</span></span>  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="f2cf9-116"> [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] являются управляемым кодом, но большинство существующих программ [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] создаются в виде неуправляемого кода [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-116"> [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] are managed code, but most existing [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programs are written in unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].</span></span>  <span data-ttu-id="f2cf9-117">Невозможно вызвать [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] из подлинной неуправляемой программы.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-117">You cannot call [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] from a true unmanaged program.</span></span> <span data-ttu-id="f2cf9-118">Однако используя параметр `/clr` с компилятором [!INCLUDE[TLA#tla_visualcpp](../../../../includes/tlasharptla-visualcpp-md.md)], можно создать смешанную управляемую-неуправляемую программу, где могут равномерно смешиваться управляемые и неуправляемые вызовы [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-118">However, by using the `/clr` option with the [!INCLUDE[TLA#tla_visualcpp](../../../../includes/tlasharptla-visualcpp-md.md)] compiler, you can create a mixed managed-unmanaged program where you can seamlessly mix managed and unmanaged [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] calls.</span></span>  
  
 <span data-ttu-id="f2cf9-119">Существует одна сложность на уровне проекта, которая заключается в том, что нельзя скомпилировать файлы [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] в проект [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-119">One project-level complication is that you cannot compile [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] files into a [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] project.</span></span>  <span data-ttu-id="f2cf9-120">Имеется несколько методов разделения проектов для решения данной проблемы.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-120">There are several project division techniques to compensate for this.</span></span>  
  
-   <span data-ttu-id="f2cf9-121">Создать DLL C#, которая содержит все вашей [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] страницы как скомпилированную сборку и иметь вашей [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] включите в исполняемый файл [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] как ссылка.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-121">Create a C# DLL that contains all your [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages as a compiled assembly, and then have your [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] executable include that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] as a reference.</span></span>  
  
-   <span data-ttu-id="f2cf9-122">Создание на языке C# исполняемый файл для [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого и его ссылки [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] , содержащий [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] содержимого.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-122">Create a C# executable for the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and have it reference a [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] that contains the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] content.</span></span>  
  
-   <span data-ttu-id="f2cf9-123">Используйте <xref:System.Windows.Markup.XamlReader.Load%2A> для загрузки любого [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] во время выполнения, а не компиляции вашей [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-123">Use <xref:System.Windows.Markup.XamlReader.Load%2A> to load any [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] at run time, instead of compiling your [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span>  
  
-   <span data-ttu-id="f2cf9-124">Не используйте [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] вообще и записывайте все вашей [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] в коде, создавая дерево элементов из <xref:System.Windows.Application>.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-124">Do not use [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] at all, and write all your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in code, building up the element tree from <xref:System.Windows.Application>.</span></span>  
  
 <span data-ttu-id="f2cf9-125">Используйте любой наиболее подходящий способ.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-125">Use whatever approach works best for you.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f2cf9-126">Если вы еще не пользовались [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)], то можете заметить некоторые "новые" ключевые слова, например `gcnew` и `nullptr`, в примерах кода взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-126">If you have not used [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] before, you might notice some "new" keywords such as `gcnew` and `nullptr` in the interoperation code examples.</span></span> <span data-ttu-id="f2cf9-127">Эти ключевые слова заменяют более старый синтаксис с двойным подчеркиванием (`__gc`) и обеспечивают более естественный синтаксис для управляемого кода в [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-127">These keywords supersede the older double-underscore syntax (`__gc`) and provide a more natural syntax for managed code in [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].</span></span>  <span data-ttu-id="f2cf9-128">Дополнительные сведения о возможностях управляемого кода [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] см. в статьях [Расширения компонентов для платформ среды выполнения](/cpp/windows/component-extensions-for-runtime-platforms) и [Знакомство с C ++/ CLI](http://go.microsoft.com/fwlink/?LinkId=98739).</span><span class="sxs-lookup"><span data-stu-id="f2cf9-128">To learn more about the [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] managed features, see [Component Extensions for Runtime Platforms](/cpp/windows/component-extensions-for-runtime-platforms) and [Hello, C++/CLI](http://go.microsoft.com/fwlink/?LinkId=98739).</span></span>  
  
<a name="hwnds"></a>   
## <a name="how-wpf-uses-hwnds"></a><span data-ttu-id="f2cf9-129">Как в WPF используются дескрипторы HWND</span><span class="sxs-lookup"><span data-stu-id="f2cf9-129">How WPF Uses Hwnds</span></span>  
 <span data-ttu-id="f2cf9-130">Для эффективного использования взаимодействия HWND в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] необходимо понимать, как в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] используются дескрипторы HWND.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-130">To make the most of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] "HWND interop", you need to understand how [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses HWNDs.</span></span> <span data-ttu-id="f2cf9-131">Для любого HWND нельзя смешивать отрисовку [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] с отрисовкой [!INCLUDE[TLA2#tla_dx](../../../../includes/tla2sharptla-dx-md.md)] или отрисовкой [!INCLUDE[TLA2#tla_gdi](../../../../includes/tla2sharptla-gdi-md.md)] / [!INCLUDE[TLA2#tla_gdiplus](../../../../includes/tla2sharptla-gdiplus-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-131">For any HWND, you cannot mix [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] rendering with [!INCLUDE[TLA2#tla_dx](../../../../includes/tla2sharptla-dx-md.md)] rendering or [!INCLUDE[TLA2#tla_gdi](../../../../includes/tla2sharptla-gdi-md.md)] / [!INCLUDE[TLA2#tla_gdiplus](../../../../includes/tla2sharptla-gdiplus-md.md)] rendering.</span></span> <span data-ttu-id="f2cf9-132">Это имеет ряд последствий.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-132">This has a number of implications.</span></span> <span data-ttu-id="f2cf9-133">В первую очередь для смешивания этих моделей отрисовки необходимо создать решение взаимодействия и использовать специальные сегменты взаимодействия для каждой модели отрисовки, которая выбрана для использования.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-133">Primarily, in order to mix these rendering models at all, you must create an interoperation solution, and use designated segments of interoperation for each rendering model that you choose to use.</span></span> <span data-ttu-id="f2cf9-134">Кроме того, получаемое при отрисовке изображение создает ограничение airspace для решения взаимодействия, которое можно применить.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-134">Also, the rendering behavior creates an "airspace" restriction for what your interoperation solution can accomplish.</span></span> <span data-ttu-id="f2cf9-135">Концепция airspace более подробно рассматривается в разделе [Общие сведения об областях применения технологий](../../../../docs/framework/wpf/advanced/technology-regions-overview.md).</span><span class="sxs-lookup"><span data-stu-id="f2cf9-135">The "airspace" concept is explained in greater detail in the topic [Technology Regions Overview](../../../../docs/framework/wpf/advanced/technology-regions-overview.md).</span></span>  
  
 <span data-ttu-id="f2cf9-136">Все элементы [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] на экране в конечном счете поддерживаются дескриптором окна HWND.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-136">All [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements on the screen are ultimately backed by a HWND.</span></span> <span data-ttu-id="f2cf9-137">При создании [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window>, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] создает HWND верхнего уровня и использует <xref:System.Windows.Interop.HwndSource> поместить <xref:System.Windows.Window> и его [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимое внутри HWND.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-137">When you create a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window>, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] creates a top-level HWND, and uses an <xref:System.Windows.Interop.HwndSource> to put the <xref:System.Windows.Window> and its [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content inside the HWND.</span></span>  <span data-ttu-id="f2cf9-138">Остальная часть содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] в приложении также использует этот единственный дескриптор HWND.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-138">The rest of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in the application shares that singular HWND.</span></span> <span data-ttu-id="f2cf9-139">Исключением являются меню, поля с раскрывающимся списком и другие всплывающие окна.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-139">An exception is menus, combo box drop downs, and other pop-ups.</span></span> <span data-ttu-id="f2cf9-140">Эти элементы создают свое собственное окно верхнего уровня, поэтому меню [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] может выйти за край HWND окна, которое его содержит.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-140">These elements create their own top-level window, which is why a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] menu can potentially go past the edge of the window HWND that contains it.</span></span> <span data-ttu-id="f2cf9-141">При использовании <xref:System.Windows.Interop.HwndHost> для размещения HWND внутри [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] сообщает [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] как разместить новый дочерний HWND относительно [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window> HWND.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-141">When you use <xref:System.Windows.Interop.HwndHost> to put an HWND inside [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] informs [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] how to position the new child HWND relative to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window> HWND.</span></span>  
  
 <span data-ttu-id="f2cf9-142">С HWND связано понятие прозрачности внутри и между каждым дескриптором HWND.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-142">A related concept to HWND is transparency within and between each HWND.</span></span> <span data-ttu-id="f2cf9-143">Оно также рассматривается в разделе [Общие сведения об областях применения технологий](../../../../docs/framework/wpf/advanced/technology-regions-overview.md).</span><span class="sxs-lookup"><span data-stu-id="f2cf9-143">This is also discussed in the topic [Technology Regions Overview](../../../../docs/framework/wpf/advanced/technology-regions-overview.md).</span></span>  
  
<a name="hosting_a_wpf_page"></a>   
## <a name="hosting-wpf-content-in-a-microsoft-win32-window"></a><span data-ttu-id="f2cf9-144">Размещение содержимого WPF в окне Microsoft Win32</span><span class="sxs-lookup"><span data-stu-id="f2cf9-144">Hosting WPF Content in a Microsoft Win32 Window</span></span>  
 <span data-ttu-id="f2cf9-145">Ключом к размещению [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] на [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] окно <xref:System.Windows.Interop.HwndSource> класса.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-145">The key to hosting a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] on a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window is the <xref:System.Windows.Interop.HwndSource> class.</span></span> <span data-ttu-id="f2cf9-146">Этот класс заключает содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] в окно [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] таким образом, что содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] может быть включено в [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] в качестве дочернего окна.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-146">This class wraps the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window, so that the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content can be incorporated into your [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] as a child window.</span></span> <span data-ttu-id="f2cf9-147">Следующий подход объединяет [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] и [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] в одном приложении.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-147">The following approach combines the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in a single application.</span></span>  
  
1.  <span data-ttu-id="f2cf9-148">Реализуйте содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] (содержимое корневого элемента) в виде управляемого класса.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-148">Implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content (the content root element) as a managed class.</span></span> <span data-ttu-id="f2cf9-149">Как правило, этот класс наследует от одного из классов, которые может содержать несколько дочерних элементов и/или использовать в качестве корневого элемента, такие как <xref:System.Windows.Controls.DockPanel> или <xref:System.Windows.Controls.Page>.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-149">Typically, the class inherits from one of the classes that can contain multiple child elements and/or used as a root element, such as <xref:System.Windows.Controls.DockPanel> or <xref:System.Windows.Controls.Page>.</span></span> <span data-ttu-id="f2cf9-150">В последующих шагах этот класс называется классом содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], а его экземпляры называются объектами содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-150">In subsequent steps, this class is referred to as the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class, and instances of the class are referred to as [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content objects.</span></span>  
  
2.  <span data-ttu-id="f2cf9-151">Реализуйте приложение [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] с помощью [!INCLUDE[TLA2#tla_cppcli](../../../../includes/tla2sharptla-cppcli-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-151">Implement a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application with [!INCLUDE[TLA2#tla_cppcli](../../../../includes/tla2sharptla-cppcli-md.md)].</span></span> <span data-ttu-id="f2cf9-152">При запуске существующего неуправляемого приложения [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)], как правило, можно разрешить ему вызывать управляемый код путем изменения параметров проекта с целью включения флага компилятора `/clr` (полное описание объектов, необходимых для поддержки компиляции `/clr`, в этом разделе не приводится).</span><span class="sxs-lookup"><span data-stu-id="f2cf9-152">If you are starting with an existing unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] application, you can usually enable it to call managed code by changing your project settings to include the `/clr` compiler flag (the full scope of what might be necessary to support `/clr` compilation is not described in this topic).</span></span>  
  
3.  <span data-ttu-id="f2cf9-153">Установите в качестве потоковой модели однопотоковое подразделение (STA).</span><span class="sxs-lookup"><span data-stu-id="f2cf9-153">Set the threading model to Single Threaded Apartment (STA).</span></span> <span data-ttu-id="f2cf9-154">Эта потоковая модель используется [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-154">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses this threading model.</span></span>  
  
4.  <span data-ttu-id="f2cf9-155">Обработайте уведомления WM_CREATE в процедуре окна.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-155">Handle the WM_CREATE notification in your window procedure.</span></span>  
  
5.  <span data-ttu-id="f2cf9-156">В обработчике (или функции, которую вызывает обработчик) выполните указанные ниже действия.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-156">Within the handler (or a function that the handler calls), do the following:</span></span>  
  
    1.  <span data-ttu-id="f2cf9-157">Создайте новый <xref:System.Windows.Interop.HwndSource> объект HWND родительского окна как его `parent` параметра.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-157">Create a new <xref:System.Windows.Interop.HwndSource> object with the parent window HWND as its `parent` parameter.</span></span>  
  
    2.  <span data-ttu-id="f2cf9-158">Создайте экземпляр вашего класса содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-158">Create an instance of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class.</span></span>  
  
    3.  <span data-ttu-id="f2cf9-159">Присвойте ссылку [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] объект содержимого <xref:System.Windows.Interop.HwndSource> объекта <xref:System.Windows.Interop.HwndSource.RootVisual%2A> свойство.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-159">Assign a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object to the <xref:System.Windows.Interop.HwndSource> object <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property.</span></span>  
  
    4.  <span data-ttu-id="f2cf9-160"><xref:System.Windows.Interop.HwndSource> Объекта <xref:System.Windows.Interop.HwndSource.Handle%2A> свойство содержит дескриптор (HWND).</span><span class="sxs-lookup"><span data-stu-id="f2cf9-160">The <xref:System.Windows.Interop.HwndSource> object <xref:System.Windows.Interop.HwndSource.Handle%2A> property contains the window handle (HWND).</span></span> <span data-ttu-id="f2cf9-161">Чтобы получить HWND, который можно использовать в неуправляемой части приложения, приведите `Handle.ToPointer()` к HWND.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-161">To get an HWND that you can use in the unmanaged part of your application, cast `Handle.ToPointer()` to an HWND.</span></span>  
  
6.  <span data-ttu-id="f2cf9-162">Реализуйте управляемый класс, содержащий статическое поле, которое хранит ссылку на объект содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-162">Implement a managed class that contains a static field that holds a reference to your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object.</span></span> <span data-ttu-id="f2cf9-163">Этот класс позволяет получить ссылку на [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого объекта из вашего [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] код, но более важно, защищает вашей <xref:System.Windows.Interop.HwndSource> от случайного удаления сбора мусора.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-163">This class allows you to get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code, but more importantly it prevents your <xref:System.Windows.Interop.HwndSource> from being inadvertently garbage collected.</span></span>  
  
7.  <span data-ttu-id="f2cf9-164">Получите уведомления от объекта содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], присоединив обработчик к одному или нескольким событиям объекта содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-164">Receive notifications from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object by attaching a handler to one or more of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object events.</span></span>  
  
8.  <span data-ttu-id="f2cf9-165">Для взаимодействия с объектом содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] используйте ссылку, которую сохранили в статическом поле, чтобы задать свойства, методы вызова и т. д.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-165">Communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object by using the reference that you stored in the static field to set properties, call methods, etc.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f2cf9-166">Определить класс содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] для шага 1 можно частично или полностью в [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] с помощью разделяемого класса по умолчанию класса содержимого. Для этого нужно создать отдельную сборку и сослаться на нее.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-166">You can do some or all of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class definition for Step One in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] using the default partial class of the content class, if you produce a separate assembly and then reference it.</span></span> <span data-ttu-id="f2cf9-167">Несмотря на то, что обычно включают <xref:System.Windows.Application> объекта в процессе компиляции [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] в сборку, вы не приводят к использованию <xref:System.Windows.Application> как часть взаимодействие, просто используйте один или несколько корневых классов для [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] называется файлов к приложению и ссылаться на их разделяемые классы.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-167">Although you typically include an <xref:System.Windows.Application> object as part of compiling the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] into an assembly, you do not end up using that <xref:System.Windows.Application> as part of the interoperation, you just use one or more of the root classes for [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files referred to by the application and reference their partial classes.</span></span> <span data-ttu-id="f2cf9-168">Оставшаяся часть процедуры практически аналогична описанной выше.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-168">The remainder of the procedure is essentially similar to that outlined above.</span></span>  
>   
>  <span data-ttu-id="f2cf9-169">Каждое из этих действий будет показано в коде в разделе [Пошаговое руководство. Размещение содержимого WPF в Win32](../../../../docs/framework/wpf/advanced/walkthrough-hosting-wpf-content-in-win32.md).</span><span class="sxs-lookup"><span data-stu-id="f2cf9-169">Each of these steps is illustrated through code in the topic [Walkthrough: Hosting WPF Content in Win32](../../../../docs/framework/wpf/advanced/walkthrough-hosting-wpf-content-in-win32.md).</span></span>  
  
<a name="hosting_an_hwnd"></a>   
## <a name="hosting-a-microsoft-win32-window-in-wpf"></a><span data-ttu-id="f2cf9-170">Размещение окна Microsoft Win32 в WPF</span><span class="sxs-lookup"><span data-stu-id="f2cf9-170">Hosting a Microsoft Win32 Window in WPF</span></span>  
 <span data-ttu-id="f2cf9-171">Ключом к размещению [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] окна в другие [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимое <xref:System.Windows.Interop.HwndHost> класса.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-171">The key to hosting a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window within other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is the <xref:System.Windows.Interop.HwndHost> class.</span></span> <span data-ttu-id="f2cf9-172">Он заключает окно в элемент [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], который можно добавить в дерево элементов [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-172">This class wraps the window in a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element which can be added to a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element tree.</span></span> <span data-ttu-id="f2cf9-173"><xref:System.Windows.Interop.HwndHost> также поддерживает [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] , которые позволяют выполнять такие задачи, как обработка сообщений для размещенного окна.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-173"><xref:System.Windows.Interop.HwndHost> also supports [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] that allow you to do such tasks as process messages for the hosted window.</span></span> <span data-ttu-id="f2cf9-174">Ниже описываются основные действия.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-174">The basic procedure is:</span></span>  
  
1.  <span data-ttu-id="f2cf9-175">Создайте дерево элементов для приложения [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] (посредством кода или разметки).</span><span class="sxs-lookup"><span data-stu-id="f2cf9-175">Create an element tree for a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application (can be through code or markup).</span></span> <span data-ttu-id="f2cf9-176">Найдите соответствующую и допустимую точку в дереве элементов где <xref:System.Windows.Interop.HwndHost> реализация может быть добавлен как дочерний элемент.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-176">Find an appropriate and permissible point in the element tree where the <xref:System.Windows.Interop.HwndHost> implementation can be added as a child element.</span></span> <span data-ttu-id="f2cf9-177">В оставшихся действиях процедуры этот элемент называется элементом резервирования.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-177">In the remainder of these steps, this element is referred to as the reserving element.</span></span>  
  
2.  <span data-ttu-id="f2cf9-178">Являются производными от <xref:System.Windows.Interop.HwndHost> для создания объекта, содержащего вашей [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] содержимого.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-178">Derive from <xref:System.Windows.Interop.HwndHost> to create an object that holds your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] content.</span></span>  
  
3.  <span data-ttu-id="f2cf9-179">В этом классе узла переопределить <xref:System.Windows.Interop.HwndHost> метод <xref:System.Windows.Interop.HwndHost.BuildWindowCore%2A>.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-179">In that host class, override the <xref:System.Windows.Interop.HwndHost> method <xref:System.Windows.Interop.HwndHost.BuildWindowCore%2A>.</span></span> <span data-ttu-id="f2cf9-180">Возвратите HWND размещенного окна.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-180">Return the HWND of the hosted window.</span></span> <span data-ttu-id="f2cf9-181">Вероятно, вам может потребоваться заключить существующие элементы управления в дочернее окно возвращаемого окна. Заключение элементов управления в основное окно представляет собой простой способ получения уведомлений от элементов управления для содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-181">You might want to wrap the actual control(s) as a child window of the returned window; wrapping the controls in a host window provides a simple way for your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to receive notifications from the controls.</span></span> <span data-ttu-id="f2cf9-182">Этот способ позволяет избежать некоторых проблем [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)], касающихся обработки сообщений на границе размещаемых элементов управления.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-182">This technique helps correct for some [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] issues regarding message handling at the hosted control boundary.</span></span>  
  
4.  <span data-ttu-id="f2cf9-183">Переопределить <xref:System.Windows.Interop.HwndHost> методы <xref:System.Windows.Interop.HwndHost.DestroyWindowCore%2A> и <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-183">Override the <xref:System.Windows.Interop.HwndHost> methods <xref:System.Windows.Interop.HwndHost.DestroyWindowCore%2A> and <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span></span> <span data-ttu-id="f2cf9-184">Цель этого — выполнить очистку и удалить ссылки на размещаемое содержимое, особенно если созданы ссылки на неуправляемые объекты.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-184">The intention here is to process cleanup and remove references to the hosted content, particularly if you created references to unmanaged objects.</span></span>  
  
5.  <span data-ttu-id="f2cf9-185">В файле кода программной части создайте экземпляр класса, размещающего элемент управления, и сделайте его дочерним классом элемента резервирования.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-185">In your code-behind file, create an instance of the control hosting class and make it a child of the reserving element.</span></span> <span data-ttu-id="f2cf9-186">Обычно следует использовать обработчик событий, таких как <xref:System.Windows.FrameworkElement.Loaded>, или используйте конструктор разделяемого класса.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-186">Typically you would use an event handler such as <xref:System.Windows.FrameworkElement.Loaded>, or use the partial class constructor.</span></span> <span data-ttu-id="f2cf9-187">Но можно также добавить содержимое взаимодействия с помощью поведения среды выполнения.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-187">But you could also add the interoperation content through a runtime behavior.</span></span>  
  
6.  <span data-ttu-id="f2cf9-188">Обработайте сообщения выбранного окна, такие как уведомления элементов управления.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-188">Process selected window messages, such as control notifications.</span></span> <span data-ttu-id="f2cf9-189">Существуют два подхода.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-189">There are two approaches.</span></span> <span data-ttu-id="f2cf9-190">Оба предоставляют идентичный доступ к потоку сообщений, поэтому выбор во многом определяется удобством программирования.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-190">Both provide identical access to the message stream, so your choice is largely a matter of programming convenience.</span></span>  
  
    -   <span data-ttu-id="f2cf9-191">Реализуйте обработку сообщений для всех сообщений (не только сообщений о завершении работы) в переопределении <xref:System.Windows.Interop.HwndHost> метод <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-191">Implement message processing for all messages (not just shutdown messages) in your override of the <xref:System.Windows.Interop.HwndHost> method <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span></span>  
  
    -   <span data-ttu-id="f2cf9-192">Разместите [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] обработку сообщения путем обработки элемента <xref:System.Windows.Interop.HwndHost.MessageHook> событий.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-192">Have the hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element process the messages by handling the <xref:System.Windows.Interop.HwndHost.MessageHook> event.</span></span> <span data-ttu-id="f2cf9-193">Это событие вызывается для каждого сообщения, которое отправляется в главную процедуру размещенного окна.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-193">This event is raised for every message that is sent to the main window procedure of the hosted window.</span></span>  
  
    -   <span data-ttu-id="f2cf9-194">Не удается обработать сообщения от windows, которые находятся вне процесса с помощью <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-194">You cannot process messages from windows that are out of process using <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span></span>  
  
7.  <span data-ttu-id="f2cf9-195">Для взаимодействия с размещенным окном используйте вызов неуправляемого кода с целью вызова неуправляемой функции `SendMessage`.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-195">Communicate with the hosted window by using platform invoke to call the unmanaged `SendMessage` function.</span></span>  
  
 <span data-ttu-id="f2cf9-196">Следующие действия создают приложение, которое работает с вводом мыши.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-196">Following these steps creates an application that works with mouse input.</span></span> <span data-ttu-id="f2cf9-197">Вы можете добавить поддержку при нажатии клавиши TAB для размещенного путем реализации <xref:System.Windows.Interop.IKeyboardInputSink> интерфейса.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-197">You can add tabbing support for your hosted window by implementing the <xref:System.Windows.Interop.IKeyboardInputSink> interface.</span></span>  
  
 <span data-ttu-id="f2cf9-198">Каждое из этих действий будет показано в коде в разделе [Пошаговое руководство. Размещение элемента управления Win32 в WPF](../../../../docs/framework/wpf/advanced/walkthrough-hosting-a-win32-control-in-wpf.md).</span><span class="sxs-lookup"><span data-stu-id="f2cf9-198">Each of these steps is illustrated through code in the topic [Walkthrough: Hosting a Win32 Control in WPF](../../../../docs/framework/wpf/advanced/walkthrough-hosting-a-win32-control-in-wpf.md).</span></span>  
  
### <a name="hwnds-inside-wpf"></a><span data-ttu-id="f2cf9-199">Дескрипторы HWND внутри WPF</span><span class="sxs-lookup"><span data-stu-id="f2cf9-199">Hwnds Inside WPF</span></span>  
 <span data-ttu-id="f2cf9-200">Можно представить <xref:System.Windows.Interop.HwndHost> как специальные элементы управления.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-200">You can think of <xref:System.Windows.Interop.HwndHost> as a special control.</span></span> <span data-ttu-id="f2cf9-201">(Технически <xref:System.Windows.Interop.HwndHost> — <xref:System.Windows.FrameworkElement> производного класса не <xref:System.Windows.Controls.Control> производного класса, но его можно считать элемент управления в целях взаимодействия.) <xref:System.Windows.Interop.HwndHost> выделяет базовый [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] характера размещенного содержимого таким образом, что остальная часть [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] считает размещенное содержимое другим объектом, схожих с элементами управления, который должен отображать и обрабатывать входные данные.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-201">(Technically, <xref:System.Windows.Interop.HwndHost> is a <xref:System.Windows.FrameworkElement> derived class, not a <xref:System.Windows.Controls.Control> derived class, but it can be considered a control for purposes of interoperation.) <xref:System.Windows.Interop.HwndHost> abstracts the underlying [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] nature of the hosted content such that the remainder of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] considers the hosted content to be another control-like object, which should render and process input.</span></span> <span data-ttu-id="f2cf9-202"><xref:System.Windows.Interop.HwndHost> обычно ведет себя как любой другой [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.FrameworkElement>, хотя существуют некоторые важные различия вокруг выходные данные (рисования и графики) и может поддерживать ввода (клавиатуры и мыши) в зависимости от ограничения базового HWND.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-202"><xref:System.Windows.Interop.HwndHost> generally behaves like any other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.FrameworkElement>, although there are some important differences around output (drawing and graphics) and input (mouse and keyboard) based on limitations of what the underlying HWNDs can support.</span></span>  
  
#### <a name="notable-differences-in-output-behavior"></a><span data-ttu-id="f2cf9-203">Важные различия в режиме вывода</span><span class="sxs-lookup"><span data-stu-id="f2cf9-203">Notable Differences in Output Behavior</span></span>  
  
-   <span data-ttu-id="f2cf9-204"><xref:System.Windows.FrameworkElement>, который является <xref:System.Windows.Interop.HwndHost> базового класса, имеет несколько свойств, которые подразумевают изменение пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-204"><xref:System.Windows.FrameworkElement>, which is the <xref:System.Windows.Interop.HwndHost> base class, has quite a few properties that imply changes to the UI.</span></span> <span data-ttu-id="f2cf9-205">К ним относятся свойства, такие как <xref:System.Windows.FrameworkElement.FlowDirection%2A?displayProperty=nameWithType>, которые меняют расположение элементов внутри этого элемента в качестве родительского.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-205">These include properties such as <xref:System.Windows.FrameworkElement.FlowDirection%2A?displayProperty=nameWithType>, which changes the layout of elements within that element as a parent.</span></span> <span data-ttu-id="f2cf9-206">Однако большая часть этих свойств не сопоставляется с возможными эквивалентами [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)], даже если такие эквиваленты могут существовать.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-206">However, most of these properties are not mapped to possible [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] equivalents, even if such equivalents might exist.</span></span> <span data-ttu-id="f2cf9-207">Многие из этих свойств и их значений слишком специфичны для технологии отрисовки, чтобы сопоставление было целесообразным.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-207">Too many of these properties and their meanings are too rendering-technology specific for mappings to be practical.</span></span> <span data-ttu-id="f2cf9-208">Таким образом, такие как установка свойств <xref:System.Windows.FrameworkElement.FlowDirection%2A> на <xref:System.Windows.Interop.HwndHost> не делает ничего.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-208">Therefore, setting properties such as <xref:System.Windows.FrameworkElement.FlowDirection%2A> on <xref:System.Windows.Interop.HwndHost> has no effect.</span></span>  
  
-   <span data-ttu-id="f2cf9-209"><xref:System.Windows.Interop.HwndHost> не может быть поворачивать, масштабированная, становятся ассиметричные или иным образом затронутых преобразованием.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-209"><xref:System.Windows.Interop.HwndHost> cannot be rotated, scaled, skewed, or otherwise affected by a Transform.</span></span>  
  
-   <span data-ttu-id="f2cf9-210"><xref:System.Windows.Interop.HwndHost> не поддерживает <xref:System.Windows.UIElement.Opacity%2A> свойство (альфа-смешение).</span><span class="sxs-lookup"><span data-stu-id="f2cf9-210"><xref:System.Windows.Interop.HwndHost> does not support the <xref:System.Windows.UIElement.Opacity%2A> property (alpha blending).</span></span> <span data-ttu-id="f2cf9-211">Если содержимое внутри <xref:System.Windows.Interop.HwndHost> выполняет <xref:System.Drawing> операций, которые включают данные альфа-канала, который сам не является нарушением, но <xref:System.Windows.Interop.HwndHost> как единое целое, поддерживает только Opacity = 1.0 (100%).</span><span class="sxs-lookup"><span data-stu-id="f2cf9-211">If content inside the <xref:System.Windows.Interop.HwndHost> performs <xref:System.Drawing> operations that include alpha information, that is itself not a violation, but the <xref:System.Windows.Interop.HwndHost> as a whole only supports Opacity = 1.0 (100%).</span></span>  
  
-   <span data-ttu-id="f2cf9-212"><xref:System.Windows.Interop.HwndHost> отобразится в верхней части других [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] элементов в окно верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-212"><xref:System.Windows.Interop.HwndHost> will appear on top of other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements in the same top-level window.</span></span> <span data-ttu-id="f2cf9-213">Тем не менее <xref:System.Windows.Controls.ToolTip> или <xref:System.Windows.Controls.ContextMenu> созданное меню — это отдельное окно верхнего уровня и поэтому будет работать правильно с <xref:System.Windows.Interop.HwndHost>.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-213">However, a <xref:System.Windows.Controls.ToolTip> or <xref:System.Windows.Controls.ContextMenu> generated menu is a separate top-level window, and so will behave correctly with <xref:System.Windows.Interop.HwndHost>.</span></span>  
  
-   <span data-ttu-id="f2cf9-214"><xref:System.Windows.Interop.HwndHost> не поддерживает Кадрирование области родительского <xref:System.Windows.UIElement>.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-214"><xref:System.Windows.Interop.HwndHost> does not respect the clipping region of its parent <xref:System.Windows.UIElement>.</span></span> <span data-ttu-id="f2cf9-215">Это проблема потенциально при попытке поместить <xref:System.Windows.Interop.HwndHost> классов внутри области прокрутки или <xref:System.Windows.Controls.Canvas>.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-215">This is potentially an issue if you attempt to put an <xref:System.Windows.Interop.HwndHost> class inside a scrolling region or <xref:System.Windows.Controls.Canvas>.</span></span>  
  
#### <a name="notable-differences-in-input-behavior"></a><span data-ttu-id="f2cf9-216">Важные различия в режиме ввода</span><span class="sxs-lookup"><span data-stu-id="f2cf9-216">Notable Differences in Input Behavior</span></span>  
  
-   <span data-ttu-id="f2cf9-217">В общем случае, когда устройства ввода находятся в пределах <xref:System.Windows.Interop.HwndHost> размещенных [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] области, события ввода перейти сразу к [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-217">In general, while input devices are scoped within the <xref:System.Windows.Interop.HwndHost> hosted [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] region, input events go directly to [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span></span>  
  
-   <span data-ttu-id="f2cf9-218">Когда указатель мыши находится над <xref:System.Windows.Interop.HwndHost>, приложение не получает [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] события мыши, а значение [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] свойство <xref:System.Windows.UIElement.IsMouseOver%2A> будет `false`.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-218">While the mouse is over the <xref:System.Windows.Interop.HwndHost>, your application does not receive [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] mouse events, and the value of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property <xref:System.Windows.UIElement.IsMouseOver%2A> will be `false`.</span></span>  
  
-   <span data-ttu-id="f2cf9-219">Хотя <xref:System.Windows.Interop.HwndHost> фокус клавиатуры, ваше приложение не получит [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] клавиатуры, события и значение [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] свойство <xref:System.Windows.UIElement.IsKeyboardFocusWithin%2A> будет `false`.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-219">While the <xref:System.Windows.Interop.HwndHost> has keyboard focus, your application will not receive [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] keyboard events and the value of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property <xref:System.Windows.UIElement.IsKeyboardFocusWithin%2A> will be `false`.</span></span>  
  
-   <span data-ttu-id="f2cf9-220">Если фокус находится в <xref:System.Windows.Interop.HwndHost> и изменения в другой элемент управления внутри <xref:System.Windows.Interop.HwndHost>, приложение не получит [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] событий <xref:System.Windows.UIElement.GotFocus> или <xref:System.Windows.UIElement.LostFocus>.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-220">When focus is within the <xref:System.Windows.Interop.HwndHost> and changes to another control inside the <xref:System.Windows.Interop.HwndHost>, your application will not receive the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] events <xref:System.Windows.UIElement.GotFocus> or <xref:System.Windows.UIElement.LostFocus>.</span></span>  
  
-   <span data-ttu-id="f2cf9-221">Связанные свойства пера и события являются аналогами и не предоставляют отчет, когда перо находится над <xref:System.Windows.Interop.HwndHost>.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-221">Related stylus properties and events are analogous, and do not report information while the stylus is over <xref:System.Windows.Interop.HwndHost>.</span></span>  
  
<a name="tabbing_mnemonics_accelerators"></a>   
## <a name="tabbing-mnemonics-and-accelerators"></a><span data-ttu-id="f2cf9-222">Переходы, назначенные клавиши и сочетания клавиш</span><span class="sxs-lookup"><span data-stu-id="f2cf9-222">Tabbing, Mnemonics, and Accelerators</span></span>  
 <span data-ttu-id="f2cf9-223"><xref:System.Windows.Interop.IKeyboardInputSink> И <xref:System.Windows.Interop.IKeyboardInputSite> интерфейсы позволяют создавать более прозрачную клавиатуры возможности для смешанного [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] приложений:</span><span class="sxs-lookup"><span data-stu-id="f2cf9-223">The <xref:System.Windows.Interop.IKeyboardInputSink> and <xref:System.Windows.Interop.IKeyboardInputSite> interfaces allow you to create a seamless keyboard experience for mixed [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] applications:</span></span>  
  
-   <span data-ttu-id="f2cf9-224">Переход между компонентами [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] и [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</span><span class="sxs-lookup"><span data-stu-id="f2cf9-224">Tabbing between [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] components</span></span>  
  
-   <span data-ttu-id="f2cf9-225">Назначенные клавиши и сочетания клавиш, которые работают, когда фокус находится внутри компонента Win32 или WPF.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-225">Mnemonics and accelerators that work both when focus is within a Win32 component and when it is within a WPF component.</span></span>  
  
 <span data-ttu-id="f2cf9-226"><xref:System.Windows.Interop.HwndHost> И <xref:System.Windows.Interop.HwndSource> классы обеспечивают реализацию <xref:System.Windows.Interop.IKeyboardInputSink>, но они могут обрабатывать входящие сообщения, необходимые для более сложных сценариев.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-226">The <xref:System.Windows.Interop.HwndHost> and <xref:System.Windows.Interop.HwndSource> classes both provide implementations of <xref:System.Windows.Interop.IKeyboardInputSink>, but they may not handle all the input messages that you want for more advanced scenarios.</span></span> <span data-ttu-id="f2cf9-227">Переопределите соответствующие методы, чтобы получить нужное поведение клавиатуры.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-227">Override the appropriate methods to get the keyboard behavior you want.</span></span>  
  
 <span data-ttu-id="f2cf9-228">Интерфейсы обеспечивают поддержку только для событий перехода между областями [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f2cf9-228">The interfaces only provide support for what happens on the transition between the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] regions.</span></span> <span data-ttu-id="f2cf9-229">Внутри области [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] поведение перехода полностью контролируется логикой перехода, реализованной в [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)], если таковая имеется.</span><span class="sxs-lookup"><span data-stu-id="f2cf9-229">Within the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] region, tabbing behavior is entirely controlled by the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] implemented logic for tabbing, if any.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f2cf9-230">См. также</span><span class="sxs-lookup"><span data-stu-id="f2cf9-230">See Also</span></span>  
 <xref:System.Windows.Interop.HwndHost>  
 <xref:System.Windows.Interop.HwndSource>  
 <xref:System.Windows.Interop>  
 [<span data-ttu-id="f2cf9-231">Пошаговое руководство. Размещение элемента управления Win32 в WPF</span><span class="sxs-lookup"><span data-stu-id="f2cf9-231">Walkthrough: Hosting a Win32 Control in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-hosting-a-win32-control-in-wpf.md)  
 [<span data-ttu-id="f2cf9-232">Пошаговое руководство. Размещение содержимого WPF в Win32</span><span class="sxs-lookup"><span data-stu-id="f2cf9-232">Walkthrough: Hosting WPF Content in Win32</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-hosting-wpf-content-in-win32.md)
