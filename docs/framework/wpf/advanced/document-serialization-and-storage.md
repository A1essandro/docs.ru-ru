---
title: "Сериализация и хранение документов | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-wpf"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "документы, сериализация"
  - "документы, storage"
  - "сериализация документов"
  - "хранение документов"
ms.assetid: 4839cd87-e206-4571-803f-0200098ad37b
caps.latest.revision: 24
author: "dotnet-bot"
ms.author: "dotnetcontent"
manager: "wpickett"
caps.handback.revision: 23
---
# Сериализация и хранение документов
Платформа [!INCLUDE[TLA#tla_winfx](../../../../includes/tlasharptla-winfx-md.md)] предоставляет мощную среду для создания и отображения документов высокого качества.  Улучшенные возможности, поддерживающие фиксированные и потоковые документы, улучшенные элементы управления для просмотра, объединенные с мощными возможностями двумерной и трехмерной графики, выводят приложения платформы [!INCLUDE[TLA2#tla_winfx](../../../../includes/tla2sharptla-winfx-md.md)] на новый уровень по качеству и удобству использования.  Ключевая возможность платформы [!INCLUDE[TLA2#tla_winfx](../../../../includes/tla2sharptla-winfx-md.md)] — способность гибко управлять представлением документа в памяти. Эффективное сохранение и загрузка документов из хранилища данных также востребованы практически в каждом приложении.  Процесс преобразования документа из внутреннего представления в памяти во внешнее хранилище данных называется [сериализацией](GTMT).  Обратный процесс чтения из хранилища данных и повторного создания исходного экземпляра в памяти называется десериализацией.  
  
   
  
<a name="AboutSerialization"></a>   
## О сериализации документов  
 В идеальном случае процесс [сериализации](GTMT) и десериализации документов из памяти и обратно в нее является понятным для приложения.  Приложение вызывает метод "write" сериализатора для сохранения документа, а метод "read" десериализатора получает доступ к хранилищу данных и воссоздает исходный экземпляр в памяти.  Формат, в котором хранятся данные, обычно не имеет значения для приложения при условии, что процесс сериализации и десериализации воссоздает документ в исходном виде.  
  
 Приложения часто предоставляют несколько параметров сериализации, которые позволяют пользователям сохранять документы на другом носителе или в другом формате.  Например, приложение может предложить варианты "Сохранить как" для сохранения документа в файле на диске, в базе данных или веб\-службе.  Точно так же разные сериализаторы могут сохранять документ в различных форматах, например в HTML, RTF, XML, XPS или в ином, стороннем формате.  Для приложения сериализация определяет интерфейс, который изолирует сведения о носителе в реализации каждого определенного сериализатора.  Дополнительно к преимуществам инкапсулируемых сведений о хранилище [!INCLUDE[TLA2#tla_winfx](../../../../includes/tla2sharptla-winfx-md.md)] <xref:System.Windows.Documents.Serialization> [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] предоставляет несколько других важных возможностей.  
  
### Возможности сериализаторов документов платформы .NET Framework версии 3.0  
  
-   Прямой доступ к объектам документа высокого уровня \([логическому дереву](GTMT) и графическим компонентам\) позволяет обеспечить эффективное хранение страничного содержимого, двумерных и трехмерных элементов, изображений, мультимедийных данных, гиперссылок, примечаний и другого дополнительного содержимого.  
  
-   [Синхронное](GTMT) и [асинхронное](GTMT) выполнение.  
  
-   Поддержка подключаемых модулей сериализаторов с расширенными возможностями:  
  
    -   Доступ ко всей системе, который может использоваться всеми приложениями платформы [!INCLUDE[TLA2#tla_winfx](../../../../includes/tla2sharptla-winfx-md.md)].  
  
    -   Простое обнаружение подключаемых модулей приложения.  
  
    -   Простое развертывание, установка и обновление пользовательских подключаемых модулей сторонних разработчиков.  
  
    -   Поддержка пользовательским интерфейсом настраиваемых параметров во время выполнения.  
  
### Процесс печати с использованием XPS  
 При печати с использованием [!INCLUDE[TLA#tla_winfx](../../../../includes/tlasharptla-winfx-md.md)] [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)] обеспечивается расширяемый механизм создания документов посредством вывода на печать.  [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)] служит как формат файла документа и собственный формат очереди печати [!INCLUDE[TLA#tla_winvista](../../../../includes/tlasharptla-winvista-md.md)].  Документы [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)] можно передавать напрямую в принтеры, совместимые с [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)], без преобразования в промежуточный формат.  Дополнительные сведения о параметрах и возможностях вывода на печать см. в разделе общих сведений [Общие сведения о печати](../../../../docs/framework/wpf/advanced/printing-overview.md).  
  
<a name="PluginSerializers"></a>   
## Подключаемые модули сериализаторов  
 Интерфейсы API <xref:System.Windows.Documents.Serialization> обеспечивают поддержку подключаемых модулей сериализаторов и связанных сериализаторов, которые устанавливаются отдельно от приложения, привязываются во время выполнения и доступ к ним осуществляется с помощью механизма обнаружения <xref:System.Windows.Documents.Serialization.SerializerProvider>.  Подключаемые модули сериализаторов предоставляют дополнительные преимущества для простоты развертывания и использования в масштабе всей системы.  Связанные сериализаторы также можно реализовать для сред [частичного доверия](GTMT), например для [!INCLUDE[TLA#tla_xbap#plural](../../../../includes/tlasharptla-xbapsharpplural-md.md)], где недоступны подключаемые модули сериализаторов.  Связанные сериализаторы, основанные на производной реализации класса <xref:System.Windows.Documents.Serialization.SerializerWriter>, компилируются и связываются непосредственно в приложении.  Подключаемые модули сериализаторов и связанные сериализаторы работают через одни и те же открытые методы и события, что позволяет легко использовать один или оба типа сериализаторов в одном и том же приложении.  
  
 Подключаемые модули сериализаторов помогают разработчикам приложений, предоставляя расширяемость новым разработкам хранилищ и форматам файлов без непосредственного написания кода для всех возможных форматов во время построения.  Подключаемые модули сериализаторов также предоставляют преимущества сторонним разработчикам, предоставляя стандартизированные средства для развертывания, установки и обновления системных доступных подключаемых модулей для пользовательских или собственных форматов файлов.  
  
### Использование подключаемых модулей сериализаторов  
 Подключаемые модули сериализаторов просты в использовании.  Класс <xref:System.Windows.Documents.Serialization.SerializerProvider> перечисляет объект <xref:System.Windows.Documents.Serialization.SerializerDescriptor> для каждого подключаемого модуля, установленного в системе.  Свойство <xref:System.Windows.Documents.Serialization.SerializerDescriptor.IsLoadable%2A> фильтрует установленные подключаемые модули на основе текущей конфигурации и проверяет, может ли приложение загрузить и использовать сериализатор.  <xref:System.Windows.Documents.Serialization.SerializerDescriptor> также предоставляет другие свойства, такие как <xref:System.Windows.Documents.Serialization.SerializerDescriptor.DisplayName%2A> и <xref:System.Windows.Documents.Serialization.SerializerDescriptor.DefaultFileExtension%2A>, которые приложение может использовать, чтобы предложить пользователю выбрать сериализатор для доступного выходного формата.  Подключаемый по умолчанию модуль сериализатора для [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)] предоставляется вместе с [!INCLUDE[TLA2#tla_winfx](../../../../includes/tla2sharptla-winfx-md.md)] и всегда учитывается в перечислении.  После того, как пользователь выбирает выходной формат, используется метод <xref:System.Windows.Documents.Serialization.SerializerProvider.CreateSerializerWriter%2A>, чтобы создать <xref:System.Windows.Documents.Serialization.SerializerWriter> для определенного формата.  Затем можно вызвать метод <xref:System.Windows.Documents.Serialization.SerializerWriter>.<xref:System.Windows.Documents.Serialization.SerializerWriter.Write%2A> для вывода потока документа в хранилище данных.  
  
 В следующем примере показано приложение, использующее метод <xref:System.Windows.Documents.Serialization.SerializerProvider> в свойстве PlugInFileFilter.  Свойство PlugInFileFilter перечисляет установленные подключаемые модули и создает строку фильтра с доступными параметрами файла для <xref:Microsoft.Win32.SaveFileDialog>.  
  
 [!code-csharp[DocumentSerialize#DocSerializeFileFilter](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DocumentSerialize/CSharp/ThumbViewer.cs#docserializefilefilter)]  
  
 После указания пользователем имени выходного файла, следующий пример показывает использование метода <xref:System.Windows.Documents.Serialization.SerializerProvider.CreateSerializerWriter%2A> для сохранения полученного документа в указанном формате.  
  
 [!code-csharp[DocumentSerialize#DocSerializePlugIn](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DocumentSerialize/CSharp/ThumbViewer.cs#docserializeplugin)]  
  
<a name="InstallingPluginSerializers"></a>   
### Установка подключаемых модулей сериализаторов  
 Класс <xref:System.Windows.Documents.Serialization.SerializerProvider> предоставляет интерфейс приложения верхнего уровня для обнаружения и осуществления доступа к подключаемому модулю сериализатора.  <xref:System.Windows.Documents.Serialization.SerializerProvider> находит сериализаторы и предоставляет приложению список установленных и доступных в системе сериализаторов.  Особенности установленных сериализаторов определяются через параметры реестра.  Подключаемые модули сериализаторов можно добавить в реестр с помощью метода <xref:System.Windows.Documents.Serialization.SerializerProvider.RegisterSerializer%2A>; или, если [!INCLUDE[TLA2#tla_winfx](../../../../includes/tla2sharptla-winfx-md.md)] еще не установлен, установочный скрипт подключаемого модуля может непосредственно задать значения реестра.  Метод <xref:System.Windows.Documents.Serialization.SerializerProvider.UnregisterSerializer%2A> можно использовать для удаления ранее установленного подключаемого модуля или параметры реестра также могут быть сброшены с помощью скрипта удаления.  
  
### Создание подключаемых модулей сериализаторов  
 Подключаемые модули сериализаторов и связанные сериализаторы используют одни и те же предоставленные открытые методы и события, и так же могут быть настроены на [синхронное](GTMT) или [асинхронное](GTMT) выполнение.  Существуют три основных шага для создания подключаемого модуля сериализатора:  
  
1.  Реализация и отладка сериализатора сначала в виде связанного сериализатора.  Первоначальное создание сериализатора, компилируемого и связываемого непосредственно в тестовом приложении предоставляет полный доступ к точкам останова и другим средствам отладки, полезным для проверки.  
  
2.  После полной проверки сериализатора, к нему добавляется интерфейс <xref:System.Windows.Documents.Serialization.ISerializerFactory>, чтобы создать подключаемый модуль.  Интерфейс <xref:System.Windows.Documents.Serialization.ISerializerFactory> предоставляет полный доступ ко всем объектам [!INCLUDE[TLA2#tla_winfx](../../../../includes/tla2sharptla-winfx-md.md)], включая логическое дерево, объекты <xref:System.Windows.UIElement>, <xref:System.Windows.Documents.IDocumentPaginatorSource> и элементы <xref:System.Windows.Media.Visual>.  Кроме того, <xref:System.Windows.Documents.Serialization.ISerializerFactory> предоставляет одинаковые синхронные и асинхронные методы и события, используемые связанными сериализаторами.  Поскольку вывод больших документов может занимать много времени, рекомендуется использовать асинхронные операции для поддержки быстродействующего взаимодействия с пользователем и предоставлять вариант "Отмена" при возникновении проблем с хранилищем данных.  
  
3.  После создания подключаемого модуля сериализатора реализуется установочный скрипт для распространения и установки \(и удаления\) подключаемого модуля \(см. выше в подразделе [Установка подключаемых модулей сериализаторов](#InstallingPluginSerializers)\).  
  
## См. также  
 <xref:System.Windows.Documents.Serialization>   
 <xref:System.Windows.Xps.XpsDocumentWriter>   
 <xref:System.Windows.Xps.Packaging.XpsDocument>   
 [Документы в WPF](../../../../docs/framework/wpf/advanced/documents-in-wpf.md)   
 [Общие сведения о печати](../../../../docs/framework/wpf/advanced/printing-overview.md)   
 [XML Paper Specification: Overview](http://go.microsoft.com/fwlink/?LinkID=106246)