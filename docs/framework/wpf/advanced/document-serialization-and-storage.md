---
title: Сериализация и хранение документов
ms.date: 03/30/2017
helpviewer_keywords:
- 'serialization of documents [WPF], , '
- documents [WPF], storage
- documents [WPF], serialization
ms.assetid: 4839cd87-e206-4571-803f-0200098ad37b
ms.openlocfilehash: 8ee8acb95aa4a7c8dd80ea88594e582f05b71611
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
---
# <a name="document-serialization-and-storage"></a>Сериализация и хранение документов
Microsoft .NET Framework предоставляет мощную среду для создания и отображения документов высокого качества.  Улучшенные возможности, поддерживающие фиксированные и потоковые документы, улучшенные элементы управления, для просмотра в сочетании с мощными возможностями двумерной и трехмерной графики возможности выполните приложений .NET Framework на новый уровень качества и взаимодействия с пользователем.  Возможность гибко управлять представлением данных в памяти документа — это ключевой компонент .NET Framework, и не сможет эффективно сохранять и загружать документы из хранилища данных необходимость почти у каждого приложения.  Процесс преобразования документа из внутреннего представления в памяти во внешнее хранилище данных называется сериализацией.  Обратный процесс чтения хранилища данных и воссоздания исходного экземпляра в памяти называется десериализацией.  
  
 
  
<a name="AboutSerialization"></a>   
## <a name="about-document-serialization"></a>О сериализации документов  
 В идеальном случае процесс сериализации и десериализации документа из памяти и в память прозрачен для приложения.  Приложение вызывает метод write сериализатора для сохранения документа, в то время как метод read десериализатора осуществляет доступ к хранилищу данных и воссоздает исходный экземпляр в памяти.  Как правило, формат хранения данных не имеет значения для приложения при условии, что в процессе сериализации и десериализации воссоздается документ в исходной форме.  
  
 Приложения часто предоставляют несколько параметров сериализации, которые позволяют пользователям сохранять документы на другом носителе или в другом формате.  Например, приложение может предложить варианты "Сохранить как" для сохранения документа в файл на диске, базу данных или веб-службу.  Аналогичным образом разные сериализаторы могут сохранять документ в различных форматах, например в HTML, RTF, XML, XPS или в ином стороннем формате.  Для приложения сериализация определяет интерфейс, который изолирует сведения о носителе в реализации каждого определенного сериализатора.  Помимо преимуществ инкапсуляции сведения о хранилище, .NET Framework <xref:System.Windows.Documents.Serialization> [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] обладают рядом важных возможностей.  
  
### <a name="features-of-net-framework-30-document-serializers"></a>Компоненты сериализаторов документов .NET Framework 3.0  
  
-   Прямой доступ к высокоуровневым объектам документа (логическое дерево и визуальные элементы) позволяет эффективно хранить разделенное на страницы содержимое, двухмерные и трехмерные элементы, изображения, мультимедиа, гиперссылки, аннотации и другое содержимое поддержки.  
  
-   Синхронные и асинхронные операции.  
  
-   Поддержка сериализаторов подключаемых модулей с расширенными возможностями:  
  
    -   Доступ на уровне системы для использования приложениями .NET Framework.  
  
    -   Удобное обнаружение подключаемых модулей приложения.  
  
    -   Простое развертывание, установка и обновление пользовательских подключаемых модулей сторонних производителей.  
  
    -   Поддержка интерфейса пользователя для пользовательских параметров и настроек среды выполнения.  
  
### <a name="xps-print-path"></a>Способ печати XPS  
 Microsoft .NET Framework [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)] путь печати также предоставляет расширяемый механизм создания документов посредством вывода на печать.  [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)] служит как формат файла документа и имеет собственный формат очереди печати для [!INCLUDE[TLA#tla_winvista](../../../../includes/tlasharptla-winvista-md.md)].  Документы [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)] можно отправлять непосредственно на совместимые с [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)] принтеры, без преобразования в промежуточный формат.  См. дополнительные сведения о параметрах и возможностях вывода пути печати в разделе [Общие сведения о печати](../../../../docs/framework/wpf/advanced/printing-overview.md).  
  
<a name="PluginSerializers"></a>   
## <a name="plug-in-serializers"></a>Подключаемые сериализаторы  
 <xref:System.Windows.Documents.Serialization> API обеспечивают поддержку подключаемые модули сериализаторов и связанные сериализаторы, которые устанавливаются отдельно от приложения, привязка во время выполнения и осуществляется с помощью <xref:System.Windows.Documents.Serialization.SerializerProvider> механизм обнаружения.  Подключаемые сериализаторы обеспечивают расширенные преимущества для простоты развертывания и использования в масштабах системы.  Связанные сериализаторы также можно реализовать для сред с частичным доверием, таких как [!INCLUDE[TLA#tla_xbap#plural](../../../../includes/tlasharptla-xbapsharpplural-md.md)], где подключаемые сериализаторы недоступны.  Связанные сериализаторы, основанные на производной реализации <xref:System.Windows.Documents.Serialization.SerializerWriter> класса, компилируются и связываются непосредственно в приложении.  Подключаемые и связанные сериализаторы функционируют через идентичные открытые методы и события, упрощающие использование любого из этих типов сериализаторов (или обоих типов) в приложении.  
  
 Подключаемые сериализаторы помогают разработчикам приложений, обеспечивая расширяемость новых проектируемых систем хранения и файловых форматов и избавляя от необходимости создавать код напрямую для каждого потенциального формата во время создания.  Подключаемые сериализаторы помогают и сторонним разработчикам, предоставляя стандартизированные средства развертывания, установки и обновления доступных системе подключаемых модулей для пользовательских или собственных форматов файлов.  
  
### <a name="using-a-plug-in-serializer"></a>Использование подключаемого сериализатора  
 Использовать подключаемые сериализаторы достаточно просто.  <xref:System.Windows.Documents.Serialization.SerializerProvider> Перечисляет класс <xref:System.Windows.Documents.Serialization.SerializerDescriptor> объекта для каждого подключаемого модуля, установленного в системе.  <xref:System.Windows.Documents.Serialization.SerializerDescriptor.IsLoadable%2A> Свойство фильтрует установленные подключаемые модули, на основе текущей конфигурации и проверяет, что сериализатор можно загрузить и используемые приложением.  <xref:System.Windows.Documents.Serialization.SerializerDescriptor> Также предоставляет другие свойства, такие как <xref:System.Windows.Documents.Serialization.SerializerDescriptor.DisplayName%2A> и <xref:System.Windows.Documents.Serialization.SerializerDescriptor.DefaultFileExtension%2A>, который можно использовать приложение, чтобы предложить пользователю выбрать сериализатор для доступного выходного формата.  Подключаемый модуль сериализатора по умолчанию для [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)] входит в состав .NET Framework и всегда учитывается в перечислении.  После выбора пользователем формате, <xref:System.Windows.Documents.Serialization.SerializerProvider.CreateSerializerWriter%2A> метод используется для создания <xref:System.Windows.Documents.Serialization.SerializerWriter> для определенного формата.  Языковой элемент <xref:System.Windows.Documents.Serialization.SerializerWriter>.<xref:System.Windows.Documents.Serialization.SerializerWriter.Write%2A> Затем, метод может вызываться для вывода потока документа в хранилище данных.  
  
 В следующем примере показано приложение, использующее <xref:System.Windows.Documents.Serialization.SerializerProvider> метод в свойстве «Свойство PlugInFileFilter».  Свойство PlugInFileFilter перечисляет установленные подключаемые модули и создает строку фильтра с доступными параметрами файла для <xref:Microsoft.Win32.SaveFileDialog>.  
  
 [!code-csharp[DocumentSerialize#DocSerializeFileFilter](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DocumentSerialize/CSharp/ThumbViewer.cs#docserializefilefilter)]  
  
 После выбора пользователем имя выходного файла в следующем примере показано использование <xref:System.Windows.Documents.Serialization.SerializerProvider.CreateSerializerWriter%2A> для сохранения данного документа в указанном формате.  
  
 [!code-csharp[DocumentSerialize#DocSerializePlugIn](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DocumentSerialize/CSharp/ThumbViewer.cs#docserializeplugin)]  
  
<a name="InstallingPluginSerializers"></a>   
### <a name="installing-plug-in-serializers"></a>Установка подключаемых сериализаторов  
 <xref:System.Windows.Documents.Serialization.SerializerProvider> Класс предоставляет интерфейс приложения верхнего уровня для подключаемого модуля сериализатора обнаружения и доступа.  <xref:System.Windows.Documents.Serialization.SerializerProvider> Находит и предоставляет приложению список установленных и доступных в системе сериализаторов.  Особенности установленных сериализаторов определяются через параметры реестра.  Подключаемые модули сериализаторов можно добавить в реестр с помощью <xref:System.Windows.Documents.Serialization.SerializerProvider.RegisterSerializer%2A> метода; или если .NET Framework еще не установлена, сценарий установки подключаемого модуля может непосредственно задать реестра значения.  <xref:System.Windows.Documents.Serialization.SerializerProvider.UnregisterSerializer%2A> Метод может использоваться для удаления ранее установленного подключаемого модуля, или параметров реестра могут быть сброшены с помощью скрипта удаления.  
  
### <a name="creating-a-plug-in-serializer"></a>Создание подключаемого сериализатора  
 Подключаемые и связанные сериализаторы используют одинаковые предоставленные открытые методы и события, и их также можно настроить для синхронной и асинхронной работы.  Для создания подключаемого сериализатора, как правило, требуется выполнить три шага.  
  
1.  Реализация и отладка сериализатора сначала в виде связанного сериализатора.  Изначально создание сериализатора, скомпилированного и связанного непосредственно в тестовом приложении, предоставляет полный доступ к точкам останова и другим полезным для тестирования отладочным службам.  
  
2.  После полной проверки сериализатора, <xref:System.Windows.Documents.Serialization.ISerializerFactory> добавляется интерфейс для создания подключаемого модуля.  <xref:System.Windows.Documents.Serialization.ISerializerFactory> Интерфейс предоставляет полный доступ ко всем объектам .NET Framework, включающее логическое дерево <xref:System.Windows.UIElement> объектов, <xref:System.Windows.Documents.IDocumentPaginatorSource>, и <xref:System.Windows.Media.Visual> элементы.  Кроме того <xref:System.Windows.Documents.Serialization.ISerializerFactory> предоставляет такие же синхронные и асинхронные методы и события, используемые связанными сериализаторами.  Поскольку на вывод крупных документов может потребоваться время, рекомендуется использовать асинхронные операции, чтобы сохранить возможность взаимодействия с пользователем и предоставить возможность отмены, если с источником данных произойдет проблема.  
  
3.  После создания подключаемого сериализатора сценарий установки реализуется для распространения и установки (и удаления) подключаемого модуля (см. [Установка подключаемых сериализаторов](#InstallingPluginSerializers) выше).  
  
## <a name="see-also"></a>См. также  
 <xref:System.Windows.Documents.Serialization>  
 <xref:System.Windows.Xps.XpsDocumentWriter>  
 <xref:System.Windows.Xps.Packaging.XpsDocument>  
 [Документы в WPF](../../../../docs/framework/wpf/advanced/documents-in-wpf.md)  
 [Общие сведения о печати](../../../../docs/framework/wpf/advanced/printing-overview.md)  
 [Общие сведения о формате XPS (XML Paper Specification)](http://go.microsoft.com/fwlink?LinkID=106246)
