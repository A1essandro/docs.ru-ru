---
title: "Вопросы производительности, связанные с взаимодействием Direct3D9 и WPF"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-wpf
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- WPF [WPF], Direct3D9 interop performance
- Direct3D9 [WPF interoperability], performance
ms.assetid: ea8baf91-12fe-4b44-ac4d-477110ab14dd
caps.latest.revision: "19"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 8142125eae26b15f12652d28fdf0c34f19d49c4e
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2017
---
# <a name="performance-considerations-for-direct3d9-and-wpf-interoperability"></a>Вопросы производительности, связанные с взаимодействием Direct3D9 и WPF
Содержимое Direct3D9 можно разместить с использованием <xref:System.Windows.Interop.D3DImage> класса. Размещение содержимого Direct3D9 может повлиять на производительность приложения. В этом разделе приводятся рекомендации по оптимизации производительности при размещении содержимого Direct3D9 в приложении Windows Presentation Foundation (WPF). Эти советы и рекомендации о том, как использовать <xref:System.Windows.Interop.D3DImage> и рекомендации, когда вы используете Windows Vista, Windows XP и нескольких мониторов.  
  
> [!NOTE]
>  Примеры кода, демонстрирующие эти советы и рекомендации см. в разделе [WPF и взаимодействие Direct3D9](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).  
  
## <a name="use-d3dimage-sparingly"></a>Как можно реже используйте D3DImage  
 Содержимое Direct3D9, размещенное в <xref:System.Windows.Interop.D3DImage> отображается не так быстро, как чистые приложения Direct3D. Копирование поверхности и очистка буфера команд могут быть ресурсоемкими операциями. Количеству <xref:System.Windows.Interop.D3DImage> экземпляров становится причиной повышения очистки буфера и приводит к снижению производительности. Таким образом, следует использовать <xref:System.Windows.Interop.D3DImage> только в случае необходимости.  
  
## <a name="best-practices-on-windows-vista"></a>Рекомендации в Windows Vista  
 Для обеспечения максимальной производительности в Windows Vista с отображением, настроенный на использование модели драйвер WDDM, создайте поверхность Direct3D9 на `IDirect3DDevice9Ex` устройства. Это позволит совместно использовать поверхность. Видеоадаптер должен поддерживать `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` и `D3DCAPS2_CANSHARERESOURCE` возможности драйверов Windows Vista. Все прочие параметры привести к рабочей области для копирования программно, что значительно снижает производительность.  
  
> [!NOTE]
>  Если Windows Vista используется дисплей, настроенный для использования Windows XP отображения драйвер модели (XDDM), поверхность всегда копируется программно, независимо от параметров. Правильные параметры и видеоадаптеров вы увидите более высокую производительность в Windows Vista при использовании модели WDDM, поскольку копирование поверхностей выполняется в оборудовании.  
  
## <a name="best-practices-on-windows-xp"></a>Советы и рекомендации для Windows XP  
 Для обеспечения максимальной производительности в Windows XP, который использует Windows XP отображения драйвер модели (XDDM), создайте блокируемую поверхность, которая правильно работает при `IDirect3DSurface9::GetDC` вызывается метод. На внутреннем уровне `BitBlt` метод переносит поверхность между устройствами. `GetDC` Метод всегда работает на поверхностях XRGB. Тем не менее, если клиентский компьютер работает под управлением Windows XP с пакетом обновления 3 или с пакетом обновления 2 и клиента установлено исправление для функции многоуровневых окон, этот метод работает только на поверхностях ARGB. Видеоадаптер должен поддерживать `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` возможность драйвера.  
  
 Глубина отображения рабочего стола 16-разрядное может значительно снизить производительность. Рекомендуется использовать 32-разрядную глубину.  
  
 При разработке для Windows Vista и Windows XP, тестирование производительности в Windows XP. Нехватки памяти в Windows XP является серьезной проблемой. Кроме того <xref:System.Windows.Interop.D3DImage> в Windows XP использует больше памяти и пропускной способности, чем Windows Vista WDDM, из-за необходимости копирования дополнительной видеопамяти. Таким образом можно ожидать производительности скорее всего, будет в Windows XP, чем в Windows Vista для того же видеоустройства.  
  
> [!NOTE]
>  XDDM доступна в Windows XP и Windows Vista; Однако WDDM доступна только в Windows Vista.  
  
## <a name="general-best-practices"></a>Общие рекомендации  
 При создании устройства используйте `D3DCREATE_MULTITHREADED` флагом создания. Это снижает производительность, но система отрисовки WPF вызывает методы для этого устройства из другого потока. Необходимо правильно, выполните протокол блокировки, чтобы доступ к устройству двух потоков одновременно.  
  
 Если визуализация выполняется в управляемом потоке WPF, настоятельно рекомендуется создать устройство с `D3DCREATE_FPU_PRESERVE` флагом создания. Без этого параметра визуализации D3D может снизить точность операций WPF двойной точности и вызвать проблемы отрисовки.  
  
 Мозаичное заполнение <xref:System.Windows.Interop.D3DImage> очень быстро, за исключением заполнения не pow2 поверхности без аппаратной поддержки, либо <xref:System.Windows.Media.DrawingBrush> или <xref:System.Windows.Media.VisualBrush> , содержащий <xref:System.Windows.Interop.D3DImage>.  
  
## <a name="best-practices-for-multi-monitor-displays"></a>Рекомендации при использовании нескольких мониторов  
 При использовании компьютера, который имеет несколько мониторов, должны следовать выше рекомендациям. Существуют также дополнительные рекомендации для нескольких мониторов.  
  
 При создании заднего буфера он создается для конкретного устройства и адаптера, но WPF может отобразить кадровый буфер на одном адаптере. Копирование между адаптерами с целью обновления кадрового буфера может быть очень дорого. В Windows Vista, настроенный на использование модели WDDM с несколькими видеоадаптерами и `IDirect3DDevice9Ex` устройства, если кадровый буфер на другой адаптер, но по-прежнему же видеоадаптере, производительность снижается, нет. Однако в Windows XP и XDDM с несколькими видеоадаптерами, имеется к значительному снижению производительности при отображении кадровый буфер на разных адаптерах заднего буфера. Дополнительные сведения см. в разделе [WPF и взаимодействие Direct3D9](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).  
  
## <a name="performance-summary"></a>Сводка по производительности  
 В следующей таблице показаны производительность при обновлении кадрового буфера как функция операционной системы, формата пикселей и поверхности. Чтобы быть на одном адаптере предполагается кадровый буфер и заднего буфера. В зависимости от конфигурации адаптера обновления оборудования обычно намного быстрее, чем обновлений программного обеспечения.  
  
|Формат пикселей поверхности|Windows Vista, WDDM и 9Ex|Другие конфигурации Windows Vista|Windows XP с пакетом обновления 3 или с пакетом обновления 2, установленным исправлением|Windows XP с пакетом обновления 2 (SP2)|  
|--------------------------|---------------------------------|----------------------------------------|--------------------------------------|--------------------|  
|D3DFMT_X8R8G8B8 (не блокируемый)|**Обновление оборудования**|Обновление программного обеспечения|Обновление программного обеспечения|Обновление программного обеспечения|  
|D3DFMT_X8R8G8B8 (блокируемый)|**Обновление оборудования**|Обновление программного обеспечения|**Обновление оборудования**|**Обновление оборудования**|  
|D3DFMT_A8R8G8B8 (не блокируемый)|**Обновление оборудования**|Обновление программного обеспечения|Обновление программного обеспечения|Обновление программного обеспечения|  
|D3DFMT_A8R8G8B8 (блокируемый)|**Обновление оборудования**|Обновление программного обеспечения|**Обновление оборудования**|Обновление программного обеспечения|  
  
## <a name="see-also"></a>См. также  
 <xref:System.Windows.Interop.D3DImage>  
 [Взаимодействие WPF и Direct3D9](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md)  
 [Пошаговое руководство. Создание содержимого Direct3D9 для размещения в WPF](../../../../docs/framework/wpf/advanced/walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md)  
 [Пошаговое руководство. Размещение содержимого Direct3D9 в WPF](../../../../docs/framework/wpf/advanced/walkthrough-hosting-direct3d9-content-in-wpf.md)
