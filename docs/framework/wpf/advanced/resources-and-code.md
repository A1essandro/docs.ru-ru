---
title: "Ресурсы и код | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-wpf"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "ключи, использование объектов в качестве"
  - "процедурный код, доступ к ресурсам"
  - "процедурный код, создание ресурсов"
  - "ресурсы, доступ из процедурного кода"
  - "ресурсы, создание с помощью процедурного кода"
ms.assetid: c1cfcddb-e39c-41c8-a7f3-60984914dfae
caps.latest.revision: 14
author: "dotnet-bot"
ms.author: "dotnetcontent"
manager: "wpickett"
caps.handback.revision: 13
---
# Ресурсы и код
Этот обзор сосредоточен на том, как [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] ресурсы могут быть доступны или созданы с помощью кода, а не синтаксиса [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)].  Дополнительные сведения об общем использовании ресурсов и ресурсов с точки зрения синтаксиса [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] см. в разделе [Ресурсы XAML](../../../../docs/framework/wpf/advanced/xaml-resources.md).  
  
   
  
<a name="accessing"></a>   
## Доступ к ресурсам из кода  
 Ключи, определяющие ресурсы, если они определены через [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], также используются для извлечения определенных ресурсов, если в коде запрашивается ресурс.  Самым простым способом извлечения ресурсов с помощью кода является вызов либо метода <xref:System.Windows.FrameworkElement.FindResource%2A>, либо метода <xref:System.Windows.FrameworkElement.TryFindResource%2A> из объектов уровня структуры в приложении.  Различие в поведении этих методов заключается в том, что произойдет, если требуемый ключ не будет найден.  Метод <xref:System.Windows.FrameworkElement.FindResource%2A> вызывает исключение, а метод <xref:System.Windows.FrameworkElement.TryFindResource%2A> не вызывает исключение, но возвращает значение `null`.  Каждый метод принимает ключ ресурса в качестве входного параметра и возвращает слабо типизированный объект.  Обычно ключ ресурса является строкой, но иногда используются ключи не в виде строки; дополнительные сведения см. в разделе [Использование объектов в качестве ключей](#objectaskey).  Обычно возвращаемый объект приводится к типу, необходимому свойству, которое устанавливается при запросе ресурса.  Логика поиска для разрешения источника кода такая же, как в случае с динамической ссылкой на ресурс [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].  Поиск ресурсов начинается с вызывающего элемента, затем продолжается на последовательных родительских элементах в [логическом дереве](GTMT).  При необходимости, поиск продолжается в ресурсах приложения, темах и системных ресурсах.  Запрос кодом ресурса будет правильно учитываться для изменений времени выполнения в словарях ресурсов, которые могут быть сделаны после того, как словарь ресурсов будет загружен из [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], а также для изменения системных ресурсов времени выполнения.  
  
 Ниже приведен краткий пример кода, который находит ресурс по ключу и использует возвращаемое значение для установки свойства, реализованного как обработчик событий <xref:System.Windows.Controls.Primitives.ButtonBase.Click>.  
  
 [!code-csharp[PropertiesOvwSupport#ResourceProceduralGet](../../../../samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page3.xaml.cs#resourceproceduralget)]
 [!code-vb[PropertiesOvwSupport#ResourceProceduralGet](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page3.xaml.vb#resourceproceduralget)]  
  
 Альтернативным способом назначения ссылки ресурса является <xref:System.Windows.FrameworkElement.SetResourceReference%2A>.  Этот метод принимает два параметра: ключ ресурса и идентификатор для конкретного свойства зависимостей, которое присутствует в экземпляре элемента, которому должно быть назначено значение ресурса.  Функционально, этот метод аналогичен и имеет преимущество в том, что не требует приведения возвращаемых значений.  
  
 Другим способом для получения программного доступа к ресурсам по\-прежнему является доступ к содержимому свойства <xref:System.Windows.FrameworkElement.Resources%2A> в качестве словаря.  Доступ к словарю, содержащегося в этом свойстве, также является способом, с помощью которого можно добавить новые ресурсы в существующие коллекции, проверить, существует ли в коллекции данное имя ключа, и выполнить другие операции с коллекциями\/словарями.  При написании приложения [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] целиком в коде можно также создать всю коллекцию в коде, назначить для нее клавиши и затем присвоить завершенную коллекцию свойству <xref:System.Windows.FrameworkElement.Resources%2A> установленного элемента.  Это будет описано в следующем разделе.  
  
 Можно индексировать любую заданную коллекцию <xref:System.Windows.FrameworkElement.Resources%2A>, используя определенный ключ в качестве индекса, но нужно знать, что доступ к ресурсу таким образом не соответствует обычным правилам времени выполнения разрешения ресурсов.  Осуществляется доступ только к этой конкретной коллекции.  Если не был найден допустимый объект по запрашиваемому ключу, то поиск ресурса не будет проходить область или приложение до корневого элемента.  Однако этот подход может иметь преимущество в производительности в некоторых случаях, поскольку область поиска ключа более ограничена.  Дополнительные сведения о работе со словарями ресурсов напрямую см. в описании класса <xref:System.Windows.ResourceDictionary>.  
  
<a name="creating"></a>   
## Создание ресурсов с помощью кода  
 Если необходимо создать приложение [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] целиком в коде, может потребоваться создавать ресурсы в этом приложении также в коде.  Для этого создайте новый экземпляр <xref:System.Windows.ResourceDictionary>, а затем добавьте все ресурсы в словарь, последовательно вызывая <xref:System.Windows.ResourceDictionary.Add%2A?displayProperty=fullName>.  Затем используйте созданный таким образом объект <xref:System.Windows.ResourceDictionary>, чтобы задать свойство <xref:System.Windows.FrameworkElement.Resources%2A> элемента, который присутствует в области страницы, или свойство <xref:System.Windows.Application.Resources%2A?displayProperty=fullName>.  Можно также хранить <xref:System.Windows.ResourceDictionary> в качестве автономного объекта, без добавления его в элемент.  Тем не менее, если это выполняется, необходимо получить доступ к его внутренним ресурсам по ключу элемента, как если бы это был универсальный словарь.  Словарь <xref:System.Windows.ResourceDictionary>, который не присоединен к свойству `Resources` элемента, не будет существовать как часть дерева элементов и не будет иметь область в последовательности поиска, которая может использоваться объектом <xref:System.Windows.FrameworkElement.FindResource%2A> и соответствующими методами.  
  
<a name="objectaskey"></a>   
## Использование объектов в качестве ключей  
 В большинстве случаев использования ресурсов задается ключ ресурса в виде строки.  Однако различные функции [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] намеренно не используют строковый тип для указания ключей, вместо этого параметр является объектом.  Возможность определения ресурса по ключу с помощью объекта используется поддержкой стиля [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и тем.  Стили в темах, которые становятся стилем по умолчанию для элемента управления без стиля, определяются по ключу с помощью <xref:System.Type> элемента управления, к которому они применяются.  Поиск по ключу с помощью типа предоставляет надежный механизм поиска, который работает с экземплярами по умолчанию каждого типа элемента управления, а тип может быть определен с помощью отражения и использован для стилизации производных классов, даже через производный тип, который не имеет стиля по умолчанию.  Можно указать ключ <xref:System.Type> для ресурса, определенного в [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] с помощью [Расширение разметки x:Type](../../../../docs/framework/xaml-services/x-type-markup-extension.md).  Аналогичные расширения существуют для других случаев использований нестрокового ключа, который поддерживает функции [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], такие как [Расширение разметки ComponentResourceKey](../../../../docs/framework/wpf/advanced/componentresourcekey-markup-extension.md).  
  
## См. также  
 [Ресурсы XAML](../../../../docs/framework/wpf/advanced/xaml-resources.md)   
 [Стилизация и использование шаблонов](../../../../docs/framework/wpf/controls/styling-and-templating.md)