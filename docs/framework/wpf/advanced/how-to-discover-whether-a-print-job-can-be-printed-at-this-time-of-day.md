---
title: Практическое руководство. Определение возможности печати в заданное время суток
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-wpf
ms.tgt_pltfrm: ''
ms.topic: article
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- print queues [WPF], timing
- printers [WPF], availability
- print jobs [WPF], timing
ms.assetid: 7e9c8ec1-abf6-4b3d-b1c6-33b35d3c4063
caps.latest.revision: 9
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: eef74cfa290614e530fa22a34533c7924d4af1b4
ms.sourcegitcommit: 86adcc06e35390f13c1e372c36d2e044f1fc31ef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/26/2018
---
# <a name="how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day"></a><span data-ttu-id="a65d9-102">Практическое руководство. Определение возможности печати в заданное время суток</span><span class="sxs-lookup"><span data-stu-id="a65d9-102">How to: Discover Whether a Print Job Can Be Printed At This Time of Day</span></span>
<span data-ttu-id="a65d9-103">Очереди печати не всегда доступны на 24 часа в сутки.</span><span class="sxs-lookup"><span data-stu-id="a65d9-103">Print queues are not always available for 24 hours a day.</span></span> <span data-ttu-id="a65d9-104">Они имеют свойства времени начала и окончания, можно задать, чтобы сделать недоступным в определенное время дня.</span><span class="sxs-lookup"><span data-stu-id="a65d9-104">They have start and end time properties that can be set to make them unavailable at certain times of day.</span></span> <span data-ttu-id="a65d9-105">Эта функция используется, например, чтобы зарезервировать принтер для монопольного использования определенным отделом после 17: 00.</span><span class="sxs-lookup"><span data-stu-id="a65d9-105">This feature can be used, for example, to reserve a printer for the exclusive use of a certain department after 5 P.M..</span></span> <span data-ttu-id="a65d9-106">Этот отдел будет иметь другой очереди обслуживания принтера от других отделов используйте.</span><span class="sxs-lookup"><span data-stu-id="a65d9-106">That department would have a different queue servicing the printer than other departments use.</span></span> <span data-ttu-id="a65d9-107">Будет иметь значение в очередь для других отделов станет недоступной после 17: 00, пока очередь для привилегированного отдела может быть задано равным доступны в любое время.</span><span class="sxs-lookup"><span data-stu-id="a65d9-107">The queue for the other departments would be set to be unavailable after 5 P.M., while queue for the favored department could be set to be available at all times.</span></span>  
  
 <span data-ttu-id="a65d9-108">Кроме того задания печати, сами можно задать для печати только в указанный промежуток времени.</span><span class="sxs-lookup"><span data-stu-id="a65d9-108">Moreover, print jobs themselves can be set to be printable only within a specified span of time.</span></span>  
  
 <span data-ttu-id="a65d9-109"><xref:System.Printing.PrintQueue> И <xref:System.Printing.PrintSystemJobInfo> классы представлены в [!INCLUDE[TLA#tla_api#plural](../../../../includes/tlasharptla-apisharpplural-md.md)] платформы Microsoft .NET Framework предоставляют средства для удаленной проверки, является ли данное задание печати можно напечатать из данной очереди в настоящее время.</span><span class="sxs-lookup"><span data-stu-id="a65d9-109">The <xref:System.Printing.PrintQueue> and <xref:System.Printing.PrintSystemJobInfo> classes exposed in the [!INCLUDE[TLA#tla_api#plural](../../../../includes/tlasharptla-apisharpplural-md.md)] of Microsoft .NET Framework provide a means for remotely checking whether a given print job can print on a given queue at the current time.</span></span>  
  
## <a name="example"></a><span data-ttu-id="a65d9-110">Пример</span><span class="sxs-lookup"><span data-stu-id="a65d9-110">Example</span></span>  
 <span data-ttu-id="a65d9-111">В приведенном ниже примере — это пример, можно диагностировать проблемы с задание печати.</span><span class="sxs-lookup"><span data-stu-id="a65d9-111">The example below is a sample that can diagnose problems with a print job.</span></span>  
  
 <span data-ttu-id="a65d9-112">Существует два основных действия для этого вида функции следующим образом.</span><span class="sxs-lookup"><span data-stu-id="a65d9-112">There are two major steps for this kind of function as follows.</span></span>  
  
1.  <span data-ttu-id="a65d9-113">Чтение <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> и <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> свойства <xref:System.Printing.PrintQueue> , чтобы определить, является ли текущее время между ними.</span><span class="sxs-lookup"><span data-stu-id="a65d9-113">Read the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties of the <xref:System.Printing.PrintQueue> to determine whether the current time is between them.</span></span>  
  
2.  <span data-ttu-id="a65d9-114">Чтение <xref:System.Printing.PrintSystemJobInfo.StartTimeOfDay%2A> и <xref:System.Printing.PrintSystemJobInfo.UntilTimeOfDay%2A> свойства <xref:System.Printing.PrintSystemJobInfo> , чтобы определить, является ли текущее время между ними.</span><span class="sxs-lookup"><span data-stu-id="a65d9-114">Read the <xref:System.Printing.PrintSystemJobInfo.StartTimeOfDay%2A> and <xref:System.Printing.PrintSystemJobInfo.UntilTimeOfDay%2A> properties of the <xref:System.Printing.PrintSystemJobInfo> to determine whether the current time is between them.</span></span>  
  
 <span data-ttu-id="a65d9-115">Сложности возникают из-за того, эти свойства не являются <xref:System.DateTime> объектов.</span><span class="sxs-lookup"><span data-stu-id="a65d9-115">But complications arise from the fact that these properties are not <xref:System.DateTime> objects.</span></span> <span data-ttu-id="a65d9-116">Вместо этого они являются <xref:System.Int32> объектами, представляющими время суток как число минут, прошедших с полуночи.</span><span class="sxs-lookup"><span data-stu-id="a65d9-116">Instead they are <xref:System.Int32> objects that express the time of day as the number of minutes since midnight.</span></span> <span data-ttu-id="a65d9-117">Кроме того это не полуночи в текущем часовом поясе, но в полночь по времени UTC (время по Гринвичу).</span><span class="sxs-lookup"><span data-stu-id="a65d9-117">Moreover, this is not midnight in the current time zone, but midnight UTC (Coordinated Universal Time).</span></span>  
  
 <span data-ttu-id="a65d9-118">В первом примере кода представлен статический метод **ReportQueueAndJobAvailability**, который передается <xref:System.Printing.PrintSystemJobInfo> и вызывает вспомогательные методы для определения, может ли задание печати в настоящее время и, если нет, когда можно напечатать.</span><span class="sxs-lookup"><span data-stu-id="a65d9-118">The first code example presents the static method **ReportQueueAndJobAvailability**, which is passed a <xref:System.Printing.PrintSystemJobInfo> and calls helper methods to determine whether the job can print at the current time and, if not, when it can print.</span></span> <span data-ttu-id="a65d9-119">Обратите внимание, что <xref:System.Printing.PrintQueue> не передается в метод.</span><span class="sxs-lookup"><span data-stu-id="a65d9-119">Notice that a <xref:System.Printing.PrintQueue> is not passed to the method.</span></span> <span data-ttu-id="a65d9-120">Это вызвано <xref:System.Printing.PrintSystemJobInfo> включает ссылку на очередь в его <xref:System.Printing.PrintSystemJobInfo.HostingPrintQueue%2A> свойство.</span><span class="sxs-lookup"><span data-stu-id="a65d9-120">This is because the <xref:System.Printing.PrintSystemJobInfo> includes a reference to the queue in its <xref:System.Printing.PrintSystemJobInfo.HostingPrintQueue%2A> property.</span></span>  
  
 <span data-ttu-id="a65d9-121">Перечислены перегруженные методы, подчиненных **ReportAvailabilityAtThisTime** метод, который может принимать <xref:System.Printing.PrintQueue> или <xref:System.Printing.PrintSystemJobInfo> как параметр.</span><span class="sxs-lookup"><span data-stu-id="a65d9-121">The subordinate methods include the overloaded **ReportAvailabilityAtThisTime** method which can take either a <xref:System.Printing.PrintQueue> or a <xref:System.Printing.PrintSystemJobInfo> as a parameter.</span></span> <span data-ttu-id="a65d9-122">Имеется также **TimeConverter.ConvertToLocalHumanReadableTime**.</span><span class="sxs-lookup"><span data-stu-id="a65d9-122">There is also a **TimeConverter.ConvertToLocalHumanReadableTime**.</span></span> <span data-ttu-id="a65d9-123">Все эти методы описаны ниже.</span><span class="sxs-lookup"><span data-stu-id="a65d9-123">All of these methods are discussed below.</span></span>  
  
 <span data-ttu-id="a65d9-124">**ReportQueueAndJobAvailability** метода начинается с проверки, если очередь или задание печати недоступна в данный момент.</span><span class="sxs-lookup"><span data-stu-id="a65d9-124">The **ReportQueueAndJobAvailability** method begins by checking to see if either the queue or the print job is unavailable at this time.</span></span> <span data-ttu-id="a65d9-125">Если любое из них недоступен, затем проверяется на предмет очередь недоступной.</span><span class="sxs-lookup"><span data-stu-id="a65d9-125">If either of them is unavailable, it then checks to see if the queue unavailable.</span></span> <span data-ttu-id="a65d9-126">Если она недоступна, метод сообщает этот факт и время, когда очередь снова станут доступны.</span><span class="sxs-lookup"><span data-stu-id="a65d9-126">If it is not available, then the method reports this fact and the time when the queue will become available again.</span></span> <span data-ttu-id="a65d9-127">Затем он проверяет, задания и если он недоступен, сообщает в следующий раз span при его при печати.</span><span class="sxs-lookup"><span data-stu-id="a65d9-127">It then checks the job and if it is unavailable, it reports the next time span when it when it can print.</span></span> <span data-ttu-id="a65d9-128">Наконец метод сообщает самое раннее время, когда задание можно напечатать.</span><span class="sxs-lookup"><span data-stu-id="a65d9-128">Finally, the method reports the earliest time when the job can print.</span></span> <span data-ttu-id="a65d9-129">Это более поздним два раза, приведенному ниже.</span><span class="sxs-lookup"><span data-stu-id="a65d9-129">This is the later of following two times.</span></span>  
  
-   <span data-ttu-id="a65d9-130">Время, когда очередь печати Далее доступен.</span><span class="sxs-lookup"><span data-stu-id="a65d9-130">The time when the print queue is next available.</span></span>  
  
-   <span data-ttu-id="a65d9-131">Время, когда задание печати Далее будет доступен.</span><span class="sxs-lookup"><span data-stu-id="a65d9-131">The time when the print job is next available.</span></span>  
  
 <span data-ttu-id="a65d9-132">При сообщении времени суток, <xref:System.DateTime.ToShortTimeString%2A> метод также вызывается этот метод отменяет года, месяца и дня из выходных данных.</span><span class="sxs-lookup"><span data-stu-id="a65d9-132">When reporting times of day, the <xref:System.DateTime.ToShortTimeString%2A> method is also called because this method suppresses the years, months, and days from the output.</span></span> <span data-ttu-id="a65d9-133">Нельзя ограничить доступность очереди печати или задания печати для определенного года, месяцев или дней.</span><span class="sxs-lookup"><span data-stu-id="a65d9-133">You cannot restrict the availability of either a print queue or a print job to particular years, months, or days.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](../../../../samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#reportqueueandjobavailability)]
 [!code-csharp[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#reportqueueandjobavailability)]
 [!code-vb[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#reportqueueandjobavailability)]  
  
 <span data-ttu-id="a65d9-134">Два перегрузки **ReportAvailabilityAtThisTime** метод идентичны за исключением типа, переданный в них, таким образом, только <xref:System.Printing.PrintQueue> версии представлена ниже.</span><span class="sxs-lookup"><span data-stu-id="a65d9-134">The two overloads of the **ReportAvailabilityAtThisTime** method are identical except for the type passed to them, so only the <xref:System.Printing.PrintQueue> version is presented below.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a65d9-135">Тот факт, что методы идентичны за исключением типа, вызывает вопрос, почему в примере не создается универсальный метод **ReportAvailabilityAtThisTime\<T >**.</span><span class="sxs-lookup"><span data-stu-id="a65d9-135">The fact that the methods are identical except for type raises the question of why the sample does not create a generic method **ReportAvailabilityAtThisTime\<T>**.</span></span> <span data-ttu-id="a65d9-136">Причина заключается в том, что этот метод будет иметь должны быть ограничены классом, имеющим **StartTimeOfDay** и **UntilTimeOfDay** только можно ограничить свойства, которые вызывает метод, но универсальный метод один класс и единственным общим для обоих <xref:System.Printing.PrintQueue> и <xref:System.Printing.PrintSystemJobInfo> в цепочке наследования дерево является <xref:System.Printing.PrintSystemObject> которого не имеет таких свойств.</span><span class="sxs-lookup"><span data-stu-id="a65d9-136">The reason is that such a method would have to be restricted to a class that has the **StartTimeOfDay** and **UntilTimeOfDay** properties that the method calls, but a generic method can only be restricted to a single class and the only class common to both <xref:System.Printing.PrintQueue> and <xref:System.Printing.PrintSystemJobInfo> in the inheritance tree is <xref:System.Printing.PrintSystemObject> which has no such properties.</span></span>  
  
 <span data-ttu-id="a65d9-137">**ReportAvailabilityAtThisTime** метод (представленных в следующем примере кода) начинается путем инициализации <xref:System.Boolean> sentinel переменной `true`.</span><span class="sxs-lookup"><span data-stu-id="a65d9-137">The **ReportAvailabilityAtThisTime** method (presented in the code example below) begins by initializing a <xref:System.Boolean> sentinel variable to `true`.</span></span> <span data-ttu-id="a65d9-138">Оно будет сброшено в `false`, если очередь не доступна.</span><span class="sxs-lookup"><span data-stu-id="a65d9-138">It will be reset to `false`, if the queue is not available.</span></span>  
  
 <span data-ttu-id="a65d9-139">Затем метод проверяет начала а «до «раз идентичны.</span><span class="sxs-lookup"><span data-stu-id="a65d9-139">Next, the method checks to see if the start and "until" times are identical.</span></span> <span data-ttu-id="a65d9-140">Если это так, очередь доступна всегда, поэтому метод возвращает `true`.</span><span class="sxs-lookup"><span data-stu-id="a65d9-140">If they are, the queue is always available, so the method returns `true`.</span></span>  
  
 <span data-ttu-id="a65d9-141">Если очередь не доступны все время, метод использует статический <xref:System.DateTime.UtcNow%2A> свойства, чтобы получить текущее время как <xref:System.DateTime> объект.</span><span class="sxs-lookup"><span data-stu-id="a65d9-141">If the queue is not available all the time, the method uses the static <xref:System.DateTime.UtcNow%2A> property to get the current time as a <xref:System.DateTime> object.</span></span> <span data-ttu-id="a65d9-142">(Так как не требуется местное время <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> и <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> используют формат времени в формате UTC.)</span><span class="sxs-lookup"><span data-stu-id="a65d9-142">(We do not need local time because the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties are themselves in UTC time.)</span></span>  
  
 <span data-ttu-id="a65d9-143">Тем не менее, эти два свойства не являются <xref:System.DateTime> объектов.</span><span class="sxs-lookup"><span data-stu-id="a65d9-143">However, these two properties are not <xref:System.DateTime> objects.</span></span> <span data-ttu-id="a65d9-144">Они являются <xref:System.Int32>задающими время как число минут после полуночи в формате UTC.</span><span class="sxs-lookup"><span data-stu-id="a65d9-144">They are <xref:System.Int32>s expressing the time as the number of minutes-after-UTC-midnight.</span></span> <span data-ttu-id="a65d9-145">Поэтому необходимо преобразовать нашей <xref:System.DateTime> объекта в минутах после полуночи.</span><span class="sxs-lookup"><span data-stu-id="a65d9-145">So we do have to convert our <xref:System.DateTime> object to minutes-after-midnight.</span></span> <span data-ttu-id="a65d9-146">Когда это будет сделано, метод просто проверяет ли «сейчас» между начала очереди, а также время наборы не попадает в два раза флаг в значение false, если «сейчас» и возвращает этот флаг «до».</span><span class="sxs-lookup"><span data-stu-id="a65d9-146">When that is done, the method simply checks to see whether "now" is between the queue's start and "until" times, sets the sentinel to false if "now" is not between the two times, and returns the sentinel.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#PrintQueueStartUntil](../../../../samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#printqueuestartuntil)]
 [!code-csharp[DiagnoseProblematicPrintJob#PrintQueueStartUntil](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#printqueuestartuntil)]
 [!code-vb[DiagnoseProblematicPrintJob#PrintQueueStartUntil](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#printqueuestartuntil)]  
  
 <span data-ttu-id="a65d9-147">**TimeConverter.ConvertToLocalHumanReadableTime** метод (представленных в следующем примере кода) не использует все методы, появившиеся в Microsoft .NET Framework, поэтому краткое описание.</span><span class="sxs-lookup"><span data-stu-id="a65d9-147">The **TimeConverter.ConvertToLocalHumanReadableTime** method (presented in the code example below) does not use any methods introduced with Microsoft .NET Framework, so the discussion is brief.</span></span> <span data-ttu-id="a65d9-148">Этот метод имеет задачу двойного преобразования: он должен принимать целое число минут после полуночи выражения и преобразовать его в удобное для восприятия времени, и его необходимо преобразовать в местное время.</span><span class="sxs-lookup"><span data-stu-id="a65d9-148">The method has a double conversion task: it must take an integer expressing minutes-after-midnight and convert it to a human-readable time and it must convert this to the local time.</span></span> <span data-ttu-id="a65d9-149">Это делается путем первоначального создания <xref:System.DateTime> объекта, устанавливается значение полуночи в формате UTC, а затем использует <xref:System.DateTime.AddMinutes%2A> метод, чтобы добавить минут, которые были переданы в метод.</span><span class="sxs-lookup"><span data-stu-id="a65d9-149">It accomplishes this by first creating a <xref:System.DateTime> object that is set to midnight UTC and then it uses the <xref:System.DateTime.AddMinutes%2A> method to add the minutes that were passed to the method.</span></span> <span data-ttu-id="a65d9-150">Возвращает новый <xref:System.DateTime> содержащий исходное время, которое было передано в метод.</span><span class="sxs-lookup"><span data-stu-id="a65d9-150">This returns a new <xref:System.DateTime> expressing the original time that was passed to the method.</span></span> <span data-ttu-id="a65d9-151"><xref:System.DateTime.ToLocalTime%2A> Метод затем преобразует это в местное время.</span><span class="sxs-lookup"><span data-stu-id="a65d9-151">The <xref:System.DateTime.ToLocalTime%2A> method then converts this to local time.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#TimeConverter](../../../../samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#timeconverter)]
 [!code-csharp[DiagnoseProblematicPrintJob#TimeConverter](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#timeconverter)]
 [!code-vb[DiagnoseProblematicPrintJob#TimeConverter](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#timeconverter)]  
  
## <a name="see-also"></a><span data-ttu-id="a65d9-152">См. также</span><span class="sxs-lookup"><span data-stu-id="a65d9-152">See Also</span></span>  
 <xref:System.DateTime>  
 <xref:System.Printing.PrintSystemJobInfo>  
 <xref:System.Printing.PrintQueue>  
 [<span data-ttu-id="a65d9-153">Документы в WPF</span><span class="sxs-lookup"><span data-stu-id="a65d9-153">Documents in WPF</span></span>](../../../../docs/framework/wpf/advanced/documents-in-wpf.md)  
 [<span data-ttu-id="a65d9-154">Общие сведения о печати</span><span class="sxs-lookup"><span data-stu-id="a65d9-154">Printing Overview</span></span>](../../../../docs/framework/wpf/advanced/printing-overview.md)
