---
title: "Обработка событий в Visual Basic и WPF | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-wpf"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "обработчики событий, Visual Basic"
  - "Visual Basic, обработчики событий"
ms.assetid: ad4eb9aa-3afc-4a71-8cf6-add3fbea54a1
caps.latest.revision: 12
author: "dotnet-bot"
ms.author: "dotnetcontent"
manager: "wpickett"
caps.handback.revision: 11
---
# Обработка событий в Visual Basic и WPF
Специально для языка [!INCLUDE[TLA#tla_visualbnet](../../../../includes/tlasharptla-visualbnet-md.md)] можно использовать ключевое слово \(конкретно для этого языка\) `Handles`, чтобы связать обработчики событий с экземплярами, вместо присоединения обработчиков событий с атрибутами или использования метода <xref:System.Windows.UIElement.AddHandler%2A>.  Однако метод присоединения обработчиков к экземплярам `Handles` имеет некоторые ограничения, так как синтаксис `Handles` не поддерживает некоторые возможности [маршрутизируемых событий](GTMT) системы событий [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].  
  
## Использование ключевого слова «Handles» в приложениях WPF  
 Все обработчики событий, которые подключены к экземплярам и событиям с помощью `Handles`, должны быть определены внутри объявления частичного класса экземпляра, который также является требованием для обработчиков событий, назначенных с помощью значений атрибутов в элементах.  Можно указать только `Handles` для элемента на странице, который имеет значение свойства <xref:System.Windows.FrameworkContentElement.Name%2A> \(или объявлен [Директива x:Name](../../../../docs/framework/xaml-services/x-name-directive.md)\).  Это происходит потому, что свойство <xref:System.Windows.FrameworkContentElement.Name%2A> в [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] создает ссылку на экземпляр, необходимую для поддержки формата ссылки *Instance.Event*, который требуется синтаксисом `Handles`.  Единственный элемент, который можно использовать для `Handles` без ссылки на <xref:System.Windows.FrameworkContentElement.Name%2A>, является экземпляром корневого элемента, который определяет частичный класс.  
  
 Можно назначить один и тот же обработчик для нескольких элементов, разделяя запятыми ссылки *Instance.Event* после `Handles`.  
  
 Можно использовать `Handles` для назначения более одного обработчика для той же ссылки *Instance.Event*.  Не следует придавать значения порядку, в котором приведены обработчики в ссылке `Handles`; предполагается, что обработчики, обрабатывающие одно и тоже событие, могут вызываться в любом порядке.  
  
 Чтобы удалить обработчик, который был добавлен с `Handles` в объявлении, можно вызвать <xref:System.Windows.UIElement.RemoveHandler%2A>.  
  
 Можно использовать `Handles` для присоединения обработчиков для [маршрутизированных событий](GTMT) до тех пор, пока обработчики присоединяются к экземплярам, которые определяют обрабатываемое в таблицах элементов событие.  Обработчики для [маршрутизированных событий](GTMT), присоединенные с помощью `Handles`, следуют тем же правилам маршрутизации, что и обработчики, присоединенные как атрибуты [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], или с общей сигнатурой <xref:System.Windows.UIElement.AddHandler%2A>.  Это означает, что если событие уже помечено как обрабатываемое \(свойству <xref:System.Windows.RoutedEventArgs.Handled%2A> в данных события присвоено значение `True`\), то обработчики, присоединенные с помощью `Handles`, не вызываются в ответ на этот экземпляр события.  Событие не может быть помечено как обрабатываемое обработчиками экземпляров из другого элемента маршрута, или обработкой класса либо из текущего элемента, либо из более ранних элементов маршрута.  Для событий ввода, которые поддерживают события восходящей и нисходящей маршрутизации, нисходящая маршрутизация может пометить пару событий как обрабатываемую.  Дополнительные сведения о маршрутизируемых событиях см. в разделе [Общие сведения о перенаправленных событиях](../../../../docs/framework/wpf/advanced/routed-events-overview.md).  
  
## Ограничения ключевого слова «Handles» при добавления обработчиков  
 Ключевое слово `Handles` не может ссылаться на обработчики для [вложенных событий](GTMT).  Необходимо использовать метод доступа `add` для вложенных событий или атрибуты события *typename.eventname* в [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].  Дополнительные сведения см. в разделе [Общие сведения о перенаправленных событиях](../../../../docs/framework/wpf/advanced/routed-events-overview.md).  
  
 Для [маршрутизированных событий](GTMT) можно использовать `Handles` только для назначения обработчиков экземплярам, в которых это событие существует в таблице элементов экземпляра.  Однако в общем случае маршрутизации событий, родительский элемент может быть слушателем события от дочерних элементов, даже если этого события нет в таблице элементов родительского элемента.  В синтаксисе атрибута это можно указать через форму атрибута *typename.membername*, которая определяет, какой тип фактически определяет обрабатываемое событие.  Например, родительская `Page` \(без определенного события `Click`\) может прослушивать события нажатий кнопки путем назначения атрибута обработчика в форме `Button.Click`.  Но, `Handles` не поддерживает форму *typename.membername*, так как он должен поддерживать конфликтующую форму *Instance.Event*.  Дополнительные сведения см. в разделе [Общие сведения о перенаправленных событиях](../../../../docs/framework/wpf/advanced/routed-events-overview.md).  
  
 `Handles` не может присоединить обработчики, вызывающиеся для событий, которые уже отмечены как обрабатываемые.  Вместо этого необходимо использовать код и вызвать перегрузку `handledEventsToo` метода <xref:System.Windows.UIElement.AddHandler%28System.Windows.RoutedEvent%2CSystem.Delegate%2CSystem.Boolean%29>.  
  
> [!NOTE]
>  Не используйте синтаксис `Handles` в коде [!INCLUDE[vb_current_short](../../../../includes/vb-current-short-md.md)], если требуется задать обработчик событий для того же события в XAML.  В таком случае обработчик событий вызывается дважды.  
  
## Как в WPF реализуются функциональные возможности ключевого слова «Handles»  
 После компиляции страницы [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] промежуточный файл объявляет ссылки `Friend` `WithEvents` на каждый элемент страницы, для которого задано свойство <xref:System.Windows.FrameworkContentElement.Name%2A> \(или объявлен [Директива x:Name](../../../../docs/framework/xaml-services/x-name-directive.md)\).  Каждый именованный экземпляр является потенциальным элементом, который можно присвоить обработчику с помощью `Handles`.  
  
> [!NOTE]
>  В [!INCLUDE[TLA#tla_visualstu](../../../../includes/tlasharptla-visualstu-md.md)] [!INCLUDE[TLA2#tla_intellisense](../../../../includes/tla2sharptla-intellisense-md.md)] может показать варианты завершения элементами, доступными для ссылки `Handles` на странице.  Но для того, чтобы промежуточный файл смог заполнить все ссылки `Friends`, может потребоваться один проход компиляции.  
  
## См. также  
 <xref:System.Windows.UIElement.AddHandler%2A>   
 [Маркировка перенаправленных событий как обработанных и обработка классов](../../../../docs/framework/wpf/advanced/marking-routed-events-as-handled-and-class-handling.md)   
 [Общие сведения о перенаправленных событиях](../../../../docs/framework/wpf/advanced/routed-events-overview.md)   
 [Общие сведения о языке XAML \(WPF\)](../../../../docs/framework/wpf/advanced/xaml-overview-wpf.md)