---
title: "Общие сведения о вложенных свойствах зависимостей | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-wpf"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "вложенные свойства зависимостей [конструктор WPF]"
ms.assetid: 75928354-dc01-47e8-a018-8409aec1f32d
caps.latest.revision: 28
author: "dotnet-bot"
ms.author: "dotnetcontent"
manager: "wpickett"
caps.handback.revision: 27
---
# Общие сведения о вложенных свойствах зависимостей
Вложенное свойство является понятием, определенным в XAML.  Вложенное свойство предназначено для использования в качестве типа глобального свойства, которое может быть задано для любого объекта.  IN [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]обладающие свойствами, обычно определяются как специализированная форма свойства зависимости, которое не содержит программу\-оболочку обычное свойство "".  
  
 [!INCLUDE[autoOutline](../Token/autoOutline_md.md)]  
  
<a name="prerequisites"></a>   
## Предварительные требования  
 В этом разделе предполагается знакомство с принципом работы свойств зависимостей с точки зрения потребителя существующих свойств зависимостей классов [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]; кроме того, следует прочесть раздел [Общие сведения о свойствах зависимости](../../../../docs/framework/wpf/advanced/dependency-properties-overview.md).  Чтобы выполнить примеры в этом подразделе, следует также понимать XAML и знать, как писать [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] приложения.  
  
<a name="attached_properties_usage"></a>   
## Зачем использовать вложенные свойства?  
 Одним из назначений вложенного свойства является разрешение различным дочерним элементам задавать уникальные значения для свойства, которое фактически определено в родительском элементе.  Конкретным применением этого скрипта является предписание дочерним элементам информировать родительский элемент о порядке их представления в [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)].  Одним из примеров является свойство <xref:System.Windows.Controls.DockPanel.Dock%2A?displayProperty=fullName>.  Свойство <xref:System.Windows.Controls.DockPanel.Dock%2A?displayProperty=fullName> создается как вложенное свойство, поскольку оно предназначено для элементов, содержащихся в <xref:System.Windows.Controls.DockPanel>, а не для самого <xref:System.Windows.Controls.DockPanel>.  Класс <xref:System.Windows.Controls.DockPanel> определяет статическое поле <xref:System.Windows.DependencyProperty> с именем <xref:System.Windows.Controls.DockPanel.DockProperty>, а затем предоставляет методы <xref:System.Windows.Controls.DockPanel.GetDock%2A> и <xref:System.Windows.Controls.DockPanel.SetDock%2A> как открытые методы доступа для [вложенного свойства](GTMT).  
  
<a name="attached_properties_xaml"></a>   
## Вложенные свойства в XAML  
 В XAML вложенные свойства задаются с использованием синтаксиса *поставщик\_вложенного\_свойства*.*имя\_свойства*  
  
 Ниже приведен пример задания свойства <xref:System.Windows.Controls.DockPanel.Dock%2A?displayProperty=fullName> в XAML:  
  
 [!code-xml[PropertiesOvwSupport#APBasicUsage](../../../../samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page4.xaml#apbasicusage)]  
  
 Обратите внимание, что данное использование в чем\-то похоже на статическое свойство; всегда используется ссылка на тип <xref:System.Windows.Controls.DockPanel>, который является владельцем и регистрирует [вложенное свойство](GTMT), а не ссылка на экземпляр по указанному имени.  
  
 Кроме того, поскольку присоединенное свойство в языке XAML атрибут, заданные в разметку, задается операция содержит только любую релевантность.  Невозможно непосредственно получить свойство в XAML, хотя некоторые косвенные механизмы для сравнения значения, такие как триггеры в стилях \(дополнительные сведения см. в разделе [Стилизация и использование шаблонов](../../../../docs/framework/wpf/controls/styling-and-templating.md)\).  
  
### Реализация вложенного свойства в WPF  
 IN [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)], большинство из присоединенных свойств, которые существуют в on  [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] типы, относящиеся к презентации пользовательского интерфейса реализованы как свойства зависимостей.  Присоединенные свойства понятия XAML, тогда как свойства зависимостей a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] понятие.  Поскольку [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] присоединенные свойства зависимостей, они поддерживают концепции свойства зависимостей, как метаданные свойства и значения по умолчанию из метаданных свойства.  
  
<a name="howused"></a>   
## Как вложенные свойства зависимостей используются типом\-владельцем  
 Хотя вложенные свойства могут устанавливаться для любого объекта, это не означает, что установка свойства приведет к ощутимому результату, или что заданное значение вообще будет использоваться другим объектом.  Как правило, вложенные свойства планируются таким образом, чтобы каждый объект, поступающий из разнообразных иерархий классов или логических связей, смог передавать общую информацию типу, который определяет вложенное свойство.  Тип, определяющий вложенное свойство, обычно следует одной из моделей:  
  
-   Тип, который определяет вложенное свойство, разработан таким образом, что он может быть родительским элементом для элементов, которые будут задавать значения для вложенного свойства.  Затем тип с помощью внутренней логики проходит по своим дочерним объектам в соответствии со структурой дерева объектов, получает значения и выполняет некоторые действия с этими значениями.  
  
-   Тип, который определяет вложенное свойство, будет использоваться в качестве дочернего элемента всевозможных родительских элементов и моделей содержимого.  
  
-   Тип, который определяет вложенное свойство, представляет службу.  Другие типы устанавливают значения для вложенного свойства.  Затем, когда задающий свойство элемент вычисляется в контексте службы, получение значений вложенных свойств выполняется с помощью внутренней логики класса службы.  
  
### Пример вложенного свойства, определенного родительским элементом  
 Наиболее типичным для [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] является скрипт определения вложенного свойства, когда родительский элемент поддерживает коллекцию дочерних элементов, а также реализует поведение, при котором особенности поведения передаются отдельно для каждого дочернего элемента.  
  
 <xref:System.Windows.Controls.DockPanel> определяет вложенное свойство <xref:System.Windows.Controls.DockPanel.Dock%2A?displayProperty=fullName>, а <xref:System.Windows.Controls.DockPanel> содержит код на уровне класса как часть логики отрисовки \(в частности, <xref:System.Windows.Controls.DockPanel.MeasureOverride%2A> и <xref:System.Windows.Controls.DockPanel.ArrangeOverride%2A>\).  Экземпляр <xref:System.Windows.Controls.DockPanel> будет всегда проверять, установил ли какой\-либо непосредственный дочерний элемент значение для <xref:System.Windows.Controls.DockPanel.Dock%2A?displayProperty=fullName>.  Если значения установлены, они становятся входными данными для логики отрисовки, применяемой к соответствующему дочернему элементу.  Каждый вложенный экземпляр <xref:System.Windows.Controls.DockPanel> интерпретирует коллекции своих непосредственных дочерних элементов, но это поведение зависит от реализации того, как <xref:System.Windows.Controls.DockPanel> обрабатывает значения <xref:System.Windows.Controls.DockPanel.Dock%2A?displayProperty=fullName>.  Теоретически возможно иметь вложенные свойства, оказывающие влияние на элементы за пределами непосредственного родителя.  Если вложенное свойство <xref:System.Windows.Controls.DockPanel.Dock%2A?displayProperty=fullName> установлено для элемента, который не имеет действующего на него родительского элемента <xref:System.Windows.Controls.DockPanel>, ошибка или исключение не возникает.  Это означает лишь, что было задано глобальное значение свойства, но оно не имеет текущего родительского элемента <xref:System.Windows.Controls.DockPanel>, который мог бы использовать эту информацию.  
  
<a name="attached_properties_code"></a>   
## Вложенные свойства в коде  
 Вложенные свойства в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] не имеют обычной [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] "оболочки" методов доступа Get\/Set.  Это обусловлено тем, что вложенное свойство не обязательно является частью пространства имен [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] для экземпляров, в которых оно задано.  Однако процессор XAML должен иметь возможность задавать эти значения, когда язык XAML анализируется.  Чтобы обеспечить эффективное потребление присоединенного свойства, тип владельца присоединенного свойства, должен реализовывать специальные методы доступа в форме `Получить`*propertyName* и `Установка`*propertyName*.  Эти выделенные методы доступа также используются для получения или задания вложенного свойства в коде.  С точки зрения кода вложенное свойство идентично резервному полю, имеющему метод доступа вместо метода доступа к свойству, и это резервное поле может существовать для любого объекта, не требуя специального определения.  
  
 Следующий пример показывает, как можно задать вложенное свойство в коде.  В этом примере `myCheckBox` представляет собой экземпляр класса <xref:System.Windows.Controls.CheckBox>.  
  
 [!code-csharp[PropertiesOvwSupport#APCode](../../../../samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page4.xaml.cs#apcode)]
 [!code-vb[PropertiesOvwSupport#APCode](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page4.xaml.vb#apcode)]  
  
 Аналогично случаю XAML, если `myCheckBox` еще не добавлен в качестве дочернего элемента  `myDockPanel` третьей строке кода, четвертая строка кода не вызвала бы исключение, но значение свойства не взаимодействовало с a  <xref:System.Windows.Controls.DockPanel> родительский элемент и, таким образом, не будет ничего.  Только значение <xref:System.Windows.Controls.DockPanel.Dock%2A?displayProperty=fullName>, заданное для дочернего элемента, в сочетании с наличием родительского элемента <xref:System.Windows.Controls.DockPanel>, будет влиять на поведение в отображаемом приложении.  \(В этом случае, вы можете задать вложенное свойство и затем присоединить его к дереву.  Или вы можете присоединить его к дереву, а затем задать вложенное свойство.  Любая последовательность действий приведет к одному и тому же результату.\)  
  
<a name="attached_properties_metadata"></a>   
## Метаданные вложенного свойства  
 При регистрации свойства задаются метаданные <xref:System.Windows.FrameworkPropertyMetadata>, указывающие характеристики свойства, такие как наличие влияния данного свойства на отрисовку, размеры и т. д.  Метаданные для [вложенного свойства](GTMT) обычно не отличаются от метаданных [свойства зависимости](GTMT).  Если в переопределении метаданных вложенного свойства задать значение по умолчанию, оно станет значением по умолчанию неявно вложенного свойства для экземпляров переопределяющего класса.  В частности, значение по умолчанию передается, если некоторый процесс запрашивает значение вложенного свойства с помощью метода доступа `Get` для этого свойства, указывая экземпляр класса, в котором указаны метаданные, и значение для этого вложенного свойства не было задано другим способом.  
  
 Если требуется разрешить наследование значения свойства, следует использовать вложенные свойства вместо неприсоединяемых свойств зависимости.  Дополнительные сведения см. в разделе [Наследование значения свойства](../../../../docs/framework/wpf/advanced/property-value-inheritance.md).  
  
<a name="custom"></a>   
## Пользовательские вложенные свойства  
  
<a name="create_attached_properties"></a>   
### Когда следует создавать вложенное свойство  
 [Вложенное свойство](GTMT) можно создать при наличии потребности в механизме задания свойств, доступного для классов, отличных от определяющего класса.  Чаще всего этого требует макет.  Примерами существующих свойств макета являются <xref:System.Windows.Controls.DockPanel.Dock%2A?displayProperty=fullName>, <xref:System.Windows.Controls.Panel.ZIndex%2A?displayProperty=fullName> и <xref:System.Windows.Controls.Canvas.Top%2A?displayProperty=fullName>.  В данном случае элементы, которые существуют как дочерние для элементов управления макетом, имеют возможность индивидуально выражать требования макета к своим родительским элементам макета, задавая значение свойства, определяемое родительским элементом как вложенное свойство.  
  
 Другим случаем для использования вложенных свойств является случай, когда класс предоставляет службу, и требуется, чтобы классы могли более прозрачно интегрировать эту службу.  
  
 Еще одним случаем является получение поддержки [!INCLUDE[vs_orcas_long](../../../../includes/vs-orcas-long-md.md)] [!INCLUDE[wpfdesigner_current_short](../../../../includes/wpfdesigner-current-short-md.md)], например, для редактирования окнасвойств.  Дополнительные сведения см. в разделе [Общие сведения о разработке управления](../../../../docs/framework/wpf/controls/control-authoring-overview.md).  
  
 Как уже отмечалось ранее, при необходимости использовать наследование значения свойства следует зарегистрировать его как вложенное свойство.  
  
<a name="how_do_i_create_attached_properties"></a>   
### Как создать вложенное свойство  
 Если класс определяет [вложенное свойство](GTMT) исключительно для использования на других типах, он не обязательно должен быть производным от <xref:System.Windows.DependencyObject>.  Однако необходимо наследовать из <xref:System.Windows.DependencyObject> если следовать прозодеждой  [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] модель иметь свое присоединенное свойство также свойство зависимостей.  
  
 Определите вложенное свойство как свойство зависимостей, объявив поле `public` `static` `readonly`  типа <xref:System.Windows.DependencyProperty>.  Для определения этого поля используется возвращаемое значение метода <xref:System.Windows.DependencyProperty.RegisterAttached%2A>.  Имя поля должно совпадать с именем вложенного свойства с добавлением строки `Property`, чтобы следовать установленному шаблону именования идентифицирующих полей [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и свойств, которые они представляют.  Поставщик должен также предоставить статический присоединенного свойства `Получить`*propertyName* и `Установка`*propertyName* методы как методы доступа для присоединенного свойства. не удастся выполнить это приведет к системе свойств не может использовать свое присоединенное свойство.  
  
> [!NOTE]
>  Если опустить метод доступа Get вложенного свойства, привязка данных для этого свойства не будет действовать в средствах разработки, таких как [!INCLUDE[vsprvs](../../../../includes/vsprvs-md.md)] и Expression Blend.  
  
#### Метод доступа Get  
 Подпись `Получить`*propertyName* метод доступа должен быть:  
  
 `public static object Get` *ИмяСвойства* `(object`  `target` `)`  
  
-   Объект `target` может быть задан в реализации как более конкретный тип.  Например, метод <xref:System.Windows.Controls.DockPanel.GetDock%2A?displayProperty=fullName> определяет тип параметра как <xref:System.Windows.UIElement>, поскольку только вложенное свойство предназначено для установки только на экземплярах <xref:System.Windows.UIElement>.  
  
-   Возвращаемое значение может быть задано в реализации как более конкретный тип.  Например, метод <xref:System.Windows.Controls.DockPanel.GetDock%2A> определяет его тип как <xref:System.Windows.Controls.Dock>, поскольку в качестве значения может быть установлена только это перечисление.  
  
#### Метод доступа Set  
 Подпись `Установка`*propertyName* метод доступа должен быть:  
  
 `public static void Set` *ИмяСвойства* `(object`  `target` `, object`  `value` `)`  
  
-   Объект `target` может быть задан в реализации как более конкретный тип.  Например, метод <xref:System.Windows.Controls.DockPanel.SetDock%2A> определяет тип параметра как <xref:System.Windows.UIElement>, поскольку только вложенное свойство предназначено для установки только на экземплярах <xref:System.Windows.UIElement>.  
  
-   Объект `value` может быть задан в реализации как более конкретный тип.  Например, метод <xref:System.Windows.Controls.DockPanel.SetDock%2A> определяет его тип как <xref:System.Windows.Controls.Dock>, поскольку в качестве значения может быть установлена только это перечисление.  Помните, что значение для данного метода ввода, поступающих от загрузчика XAML при обнаружении ваше присоединенное свойство на потреблении присоединенного свойства в разметке.  Что вход значение, указанное в качестве значения атрибута XAML в разметке.  Поэтому должно существовать такое преобразование типов, сериализатор значения или поддержка расширения макета для используемого типа, чтобы можно было создать соответствующий тип из значения атрибута \(которое в конечном счете является строкой\).  
  
 В следующем примере показана регистрация свойства зависимостей \(использование <xref:System.Windows.DependencyProperty.RegisterAttached%2A> метод\), а также `Получить`*propertyName* и `Установка`*propertyName* методы доступа.  В этом примере вложенное свойство имеет имя `IsBubbleSource`.  Следовательно, методы доступа должны иметь имена `GetIsBubbleSource` и `SetIsBubbleSource`.  
  
 [!code-csharp[WPFAquariumSln#RegisterAttachedBubbler](../../../../samples/snippets/csharp/VS_Snippets_Wpf/WPFAquariumSln/CSharp/WPFAquariumObjects/Class1.cs#registerattachedbubbler)]
 [!code-vb[WPFAquariumSln#RegisterAttachedBubbler](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/WPFAquariumSln/visualbasic/wpfaquariumobjects/class1.vb#registerattachedbubbler)]  
  
#### Атрибуты вложенного свойства  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] определяет несколько [!INCLUDE[TLA2#tla_netframewkattr#plural](../../../../includes/tla2sharptla-netframewkattrsharpplural-md.md)], которые предназначены для предоставления сведений о вложенных свойствах процессам отражения и обычным пользователям отражения и сведений о свойствах, таким как конструкторы.  Поскольку присоединенные свойства имеют тип неограниченной области, конструкторам, необходим способ избежать подавляющие пользователи с глобальным списком всех присоединенных свойств, определенных в конкретной реализации технологии, которая использует XAML.  [!INCLUDE[TLA2#tla_netframewkattr#plural](../../../../includes/tla2sharptla-netframewkattrsharpplural-md.md)], определяемый [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] для вложенных свойств, может быть использован для ситуаций, когда данное вложенное свойство должно отображаться в окне свойств.  Можно также применить эти атрибуты для собственных пользовательских вложенных свойств.  Назначение и синтаксис [!INCLUDE[TLA2#tla_netframewkattr#plural](../../../../includes/tla2sharptla-netframewkattrsharpplural-md.md)] описаны на соответствующих страницах справочника:  
  
-   <xref:System.Windows.AttachedPropertyBrowsableAttribute>  
  
-   <xref:System.Windows.AttachedPropertyBrowsableForChildrenAttribute>  
  
-   <xref:System.Windows.AttachedPropertyBrowsableForTypeAttribute>  
  
-   <xref:System.Windows.AttachedPropertyBrowsableWhenAttributePresentAttribute>  
  
<a name="more"></a>   
## Дополнительные сведения о вложенных свойствах зависимостей  
  
-   Дополнительные сведения о создании присоединенное свойство см. в разделе [Регистрация вложенного свойства зависимостей](../../../../docs/framework/wpf/advanced/how-to-register-an-attached-property.md).  
  
-   Дополнительные случаи использования свойств зависимостей и вложенных свойств зависимостей см. в разделе [Пользовательские свойства зависимостей](../../../../docs/framework/wpf/advanced/custom-dependency-properties.md).  
  
-   Можно также зарегистрировать свойство как вложенное свойство и как свойство зависимости, но затем по\-прежнему предоставлять реализации "оболочки".  В этом случае свойство может быть установлено в этом элементе или на любом элементе с помощью синтаксиса присоединенного свойства XAML.  Примером свойства с соответствующим скриптом для стандартного и вложенного использования является <xref:System.Windows.FrameworkElement.FlowDirection%2A?displayProperty=fullName>.  
  
## См. также  
 <xref:System.Windows.DependencyProperty>   
 [Общие сведения о свойствах зависимости](../../../../docs/framework/wpf/advanced/dependency-properties-overview.md)   
 [Пользовательские свойства зависимостей](../../../../docs/framework/wpf/advanced/custom-dependency-properties.md)   
 [Общие сведения о языке XAML \(WPF\)](../../../../docs/framework/wpf/advanced/xaml-overview-wpf.md)   
 [Регистрация вложенного свойства зависимостей](../../../../docs/framework/wpf/advanced/how-to-register-an-attached-property.md)