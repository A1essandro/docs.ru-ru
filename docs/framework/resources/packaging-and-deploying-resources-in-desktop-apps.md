---
title: "Упаковка и развертывание ресурсов в приложениях для настольных систем | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-bcl"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "развертывание приложений [платформа .NET Framework], ресурсы"
  - "файлы ресурсов, развертывание"
  - "модель развертывания ресурсов "звезда""
  - "файлы ресурсов, упаковка"
  - "ресурсы приложений, упаковка"
  - "единственная сборка ресурсов"
  - "вспомогательные сборки"
  - "язык и региональные параметры по умолчанию для приложения"
  - "имена [платформа .NET Framework], ресурсы"
  - "процесс использования резервных ресурсов"
  - "группы языков и региональных параметров"
  - "ресурсы приложений, развертывание"
  - "ресурсы приложений, соглашения об именовании"
  - "язык и региональные параметры, упаковка и развертывание ресурсов"
  - "файлы ресурсов, соглашения об именовании"
  - "упаковка ресурсов приложений"
  - "ресурсы приложений, процессы использования резервных ресурсов"
  - "файлы ресурсов, процессы использования резервных ресурсов"
  - "локализация ресурсов"
  - "нейтральные языки и региональные параметры"
ms.assetid: b224d7c0-35f8-4e82-a705-dd76795e8d16
caps.latest.revision: 26
author: "rpetrusha"
ms.author: "ronpet"
manager: "wpickett"
caps.handback.revision: 26
---
# Упаковка и развертывание ресурсов в приложениях для настольных систем
Приложения зависят от диспетчера ресурсов платформы .NET Framework, представленного классом <xref:System.Resources.ResourceManager>, для извлечения локализованных ресурсов.  Диспетчер ресурсов предполагает, что модель "звезда" используется для упаковки и развертывания ресурсов.  Центр в этой модели — основная сборка, которая содержит нелокализуемый исполняемый код и ресурсы для единственного языка и региона, называемого нейтральным или языком и регионом по умолчанию.  Региональные параметры по умолчанию являются резервными региональными параметрами; это региональные параметры, чьи ресурсы используются при невозможности найти локализованные ресурсы.  Каждый луч звезды ведет к вспомогательной сборке, которая содержит ресурсы для одного языка и региона, но не содержит кода.  
  
 У этой модели несколько преимуществ:  
  
-   После развертывания приложения в него можно последовательно добавлять ресурсы для новых языков и регионов.  Так как разработка ресурсов для конкретных языков и регионов может занять продолжительное время, эта модель дает возможность сначала выпустить главное приложение, а в дальнейшем постепенно дополнять его ресурсами для других языков и регионов.  
  
-   Вспомогательные сборки приложения можно обновлять и изменять без перекомпиляции всего приложения.  
  
-   В приложение можно загружать только те вспомогательные сборки, которые содержат ресурсы, необходимые для конкретного языка.  Такой подход существенно снижает затраты системных ресурсов.  
  
 Тем не менее, у этой модели существует ряд недостатков:  
  
-   Необходимо управлять множеством наборов ресурсов.  
  
-   Увеличиваются первоначальные затраты ресурсов на тестирование приложения, поскольку требуется проверять несколько конфигураций.  Следует заметить, что в долгосрочной перспективе проще и дешевле протестировать одно основное приложение и ряд вспомогательных сборок, чем тестировать и сопровождать несколько параллельных версий на разных языках.  
  
## Соглашения об именовании ресурсов  
 В процессе упаковки ресурсов приложения им необходимо присваивать имена в соответствии с соглашениями об именовании, которые применяются в среде CLR.  Среда определяет ресурс по имени региональных параметров.  Каждому языку и региону присваивается уникальное имя, которое обычно представляет собой сочетание имени языка из двух строчных букв, и \(при необходимости\) имени региона из двух прописных букв, обозначающего данную страну или регион.  Имя субкультуры следует за именем языка через дефис \(\-\).  Примеры включают ja\-JP для Японии \(японский язык\), en\-US для США \(английский язык\), de\-DE для Германии \(немецкий язык\) или de\-AT для Австрии \(немецкий язык\).  См. [Справочник по API поддержки национальных языков \(NLS\)](http://go.microsoft.com/fwlink/?LinkId=200048) в центре разработчиков Go Global для получения полного списка региональных параметров.  
  
> [!NOTE]
>  Дополнительные сведения о создании файлов ресурсов см. [Создание файлов ресурсов](../../../docs/framework/resources/creating-resource-files-for-desktop-apps.md) и [Создание вспомогательных сборок](../../../docs/framework/resources/creating-satellite-assemblies-for-desktop-apps.md) в библиотеке MSDN.  
  
<a name="cpconpackagingdeployingresourcesanchor1"></a>   
## Процесс использования резервных ресурсов  
 В звездообразной модели упаковки и развертывания ресурсов для поиска подходящих ресурсов используется процесс перехода к резервному ресурсу.  Если приложения запрашивает локализованный ресурс, который оказывается недоступен, то среда CLR просматривает иерархию языков и регионов для резервного ресурса, который наиболее точно отвечает запросу пользователя, и только в крайнем случае генерирует исключение.  На каждом уровне иерархии производится поиск, и, если подходящий ресурс найден, среда выполнения использует его.  Если ресурс не найден, поиск продолжается на следующем уровне.  
  
 Чтобы повысить эффективность поиска, примените атрибут <xref:System.Resources.NeutralResourcesLanguageAttribute> к главной сборке и передайте его имени нейтрального языка, который будет использоваться с главной сборкой.  
  
> [!TIP]
>  Можно использовать конфигурационный элемент [\<relativeBindForResources\>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md), чтобы оптимизировать процесс использования резервных ресурсов и процесс, с помощью которого среда выполнения осуществляет проверку сборок ресурсов.  Дополнительные сведения см. в разделе [Оптимизация процесса использования резервных ресурсов](../../../docs/framework/resources/packaging-and-deploying-resources-in-desktop-apps.md#Optimizing).  
  
 Процесс использования резервных ресурсов включает следующие шаги:  
  
1.  В первую очередь среда выполнения проверяет [глобальный кэш сборок](../../../docs/framework/app-domains/gac.md) на наличие сборки соответствующей приложению по региональным параметрам.  
  
     Глобальный кэш сборок может хранить сборки ресурсов, которые используются несколькими приложениями.  Это избавляет от необходимости включать конкретные наборы ресурсов в структуру каталогов для каждого разрабатываемого приложения.  Если среда выполнения находит ссылку на сборку, она просматривает эту сборку в поисках требуемого ресурса.  Если среда выполнения обнаруживает в сборке нужную запись, она использует запрошенный ресурс.  Если она не находит записи, поиск продолжается.  
  
2.  Затем среда выполнения проверяет каталог выполняемой в данный момент сборки на наличие каталога, соответствующего запрошенному языку и региональным параметрам.  Если каталог найден, среда выполнения ищет в нем допустимую вспомогательную сборку для запрошиваемого языка и региона.  Далее она просматривает вспомогательную сборку в поисках запрошенного ресурса.  Если ресурс обнаружен в сборке, среда выполнения использует его.  Если ресурс не найден, поиск продолжается.  
  
3.  Далее среда выполнения запрашивает установщик Windows определить, должна ли вспомогательная сборка быть установлена по требованию.  В таком случае производится обработка установки, загрузка сборки и поиск ее или запрошенных ресурсов.  Если ресурс обнаружен в сборке, среда выполнения использует его.  Если ресурс не найден, поиск продолжается.  
  
4.  Среда выполнения вызывает событие <xref:System.AppDomain.AssemblyResolve?displayProperty=fullName>, чтобы указать, что не удалось найти вспомогательную сборку.  При обработки события обработчик событий может возвратить ссылку на вспомогательную сборку, чьи ресурсы будут использованы для поиска.  В противном случае обработчик событий возвращает `null` и продолжается поиск.  
  
5.  Затем среда выполнения снова просматривает глобальный кэш сборок, на этот раз в поисках родительской сборки запрошенных региональных параметров.  Если родительская сборка присутствует в глобальном кэше сборок, среда выполнения ищет в ней ресурс.  
  
     Родительские региональные параметры принимаются в качестве подходящих резервных региональных параметров.  Родительские сборки используются в качестве резервных ресурсов, поскольку предоставление любых ресурсов является более желательным, чем порождение исключения.  Этот процесс позволяет многократно использовать ресурсы.  Включать ресурс на родительском уровне следует только в том случае, если дочерняя культурная среда не требует локализации запрошенного ресурса.  Например, если заданы вспомогательные сборки для культурных сред "en" \(нейтральный английский\), "en\-GB" \(английский, используемый в Великобритании\) и "en\-US" \(английский, используемый в США\), то сборка "en" будет содержать общие термины, а в сборках "en\-GB" и "en\-US" достаточно переопределить только те термины, которые отличаются в этих языках.  
  
6.  Затем среда выполнения проверяет каталог текущей сборки на наличие родительского каталога.  Если родительский каталог существует, среда выполнения ищет в нем допустимую вспомогательную сборку для родительского языка и региона.  Если сборка найдена, среда выполнения просматривает ее в поисках запрошенного ресурса.  Если ресурс обнаружен, он используется.  Если ресурс не найден, поиск продолжается.  
  
7.  Далее среда выполнения запрашивает установщик Windows для определения, является ли родительская вспомогательная сборка установленной по требованию.  В таком случае производится обработка установки, загрузка сборки и поиск ее или запрошенных ресурсов.  Если ресурс обнаружен в сборке, среда выполнения использует его.  Если ресурс не найден, поиск продолжается.  
  
8.  Среда выполнения вызывает событие <xref:System.AppDomain.AssemblyResolve?displayProperty=fullName>, чтобы указать, что не удалось найти подходящий резервный ресурс.  При обработки события обработчик событий может возвратить ссылку на вспомогательную сборку, чьи ресурсы будут использованы для поиска.  В противном случае обработчик событий возвращает `null` и продолжается поиск.  
  
9. Далее среда выполнения просматривает родительские сборки по нескольким уровням, выполняя на каждом из них те же действия, что и на предыдущем шаге.  Каждый региональный параметр имеет только одного родителя, который определен с помощью свойства <xref:System.Globalization.CultureInfo.Parent%2A?displayProperty=fullName>, при этом родитель может иметь собственного родителя.  Поиск родительских региональных параметров останавливается, когда свойство <xref:System.Globalization.CultureInfo.Parent%2A> региональных параметров возвращает <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=fullName>; для перехода к резервным ресурсам инвариантные региональные ресурсы не должны являться родительскими региональными параметрами или региональными параметрами, которые могут иметь ресурсы.  
  
10. Если после просмотра первоначально заданного языка и региона и всех родительских сред ресурс не найден, используется ресурс стандартной \(запасной\) культурной среды.  Обычно ресурсы для региональных параметров по умолчанию включены в основную сборку приложения.  Однако можно задать значение <xref:System.Resources.UltimateResourceFallbackLocation> для свойства <xref:System.Resources.NeutralResourcesLanguageAttribute.Location%2A> атрибута <xref:System.Resources.NeutralResourcesLanguageAttribute>, чтобы указать, что окончательное расположение резервных ресурсов скорее всего является вспомогательной сборкой, а не основной сборкой.  
  
    > [!NOTE]
    >  Стандартный ресурс является единственным ресурсом, компилируемым вместе с основной сборкой.  Если с помощью атрибута <xref:System.Resources.NeutralResourcesLanguageAttribute> в качестве конечного расположения запасных ресурсов не задана вспомогательная сборка, в качестве такого расположения \(конечного родительского объекта\) используется основная сборка.  Поэтому рекомендуется всегда включать стандартный набор ресурсов в основную сборку.  Это помогает избежать появления исключений.  Стандартный файл ресурсов обеспечивает запасной вариант для всех ресурсов и гарантирует, что пользователю всегда будет предоставлен хотя бы один ресурс, даже если он не связан с определенной культурной средой.  
  
11. В конечном итоге, если среда выполнения не находит ресурса для стандартного \(резервного\) языка и региона, порождается исключение <xref:System.Resources.MissingManifestResourceException> или <xref:System.Resources.MissingSatelliteAssemblyException>, указывающее на то, что ресурс не может быть найден.  
  
 Например, предположим, что приложение запрашивает ресурс, локализованный для испанского языка \(Мексика\) \(региональные параметры es\-MX\).  Сначала среда выполнения осуществит поиск в глобальном кэше сборок для сборки, которая соответствует es\-MX, но не обнаружит ее.  Затем, не найдя такой сборки, среда выполнения ищет каталог "es\-MX" в каталоге выполняемой в данной момент сборки.  Если этот поиск также не приносит результатов, среда выполнения снова просматривает глобальный кэш сборок в поисках родительской сборки соответствующей резервному языку, в данном случае — es \(испанский язык\).  Если родительская сборка не найдена, среда выполнения просматривает все возможные уровни родительских сборок для языка и региона "es\-MX", пока не найдет соответствующий ресурс.  Если ресурс не будет найден, среда выполнения использует ресурс для языка и региональных параметров по умолчанию.  
  
<a name="Optimizing"></a>   
### Оптимизация процесса использования резервных ресурсов  
 В следующих случаях можно оптимизировать процесс, с помощью которых среда выполнения ищет ресурсы во вспомогательных сборках  
  
-   Вспомогательные сборки развертываются в том же месте, что и сборка кода.  Если сборка кода установлена в [глобальный кэш сборок](../../../docs/framework/app-domains/gac.md), то вспомогательные сборки также установлены в глобальном кэше сборок.  Если сборка кода установлена в каталоге, то вспомогательные сборки установлены в папках региональных параметров данного каталога.  
  
-   Вспомогательные сборки не установлены по требованию.  
  
-   Код приложения не обрабатывает событие <xref:System.AppDomain.AssemblyResolve?displayProperty=fullName>.  
  
 Оптимизируйте зонд для вспомогательных сборок, включив элемент [\<relativeBindForResources\>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md) и установив его атрибут `enabled` в `true` в файле конфигурации приложения, как показано в следующем примере.  
  
```  
  
<configuration>  
   <runtime>  
      <relativeBindForResources enabled="true" />  
   </runtime>  
</configuration>  
  
```  
  
 Оптимизированная зонд для вспомогательных сборок — функция по требованию.  Иными словами, среда выполнения выполняет действия, указанные в [Процесс использования резервных ресурсов](../../../docs/framework/resources/packaging-and-deploying-resources-in-desktop-apps.md#cpconpackagingdeployingresourcesanchor1), если элемент [\<relativeBindForResources\>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md) не представлен в файле конфигурации приложения и его атрибут `enabled` не установлен в `true`.  Если это так, то процесс проверки вспомогательной сборки изменен следующим образом:  
  
-   Среда выполнения использует расположение родительской сборки кода для проверки вспомогательной сборки.  Если родительская сборка установлена в глобальном кэше сборок, среда выполнения проверяет кэш, но не в папке приложения.  Если родительская сборка установлена в каталоге приложения, среда выполнения проверяет в каталоге приложения, но не в глобальном кэше сборок.  
  
-   Среда выполнения не запрашивает установщик Windows для установки вспомогательных сборок по требованию.  
  
-   Если поиск конкретной сборки ресурсов завершается неудачей, то среда выполнения не вызывает событие <xref:System.AppDomain.AssemblyResolve?displayProperty=fullName>.  
  
### Определение вспомогательной сборки в качестве конечного расположения запасных ресурсов  
 При необходимости можно удалить ресурсы из основной сборки и указать, что среда выполнения должна загрузить обычные резервные ресурсы из вспомогательной сборки, которая соответствует определенным региональным параметрам.  Для управления процессом перехода на запасные ресурсы используется конструктор <xref:System.Resources.NeutralResourcesLanguageAttribute.%23ctor%28System.String%2CSystem.Resources.UltimateResourceFallbackLocation%29?displayProperty=fullName> и указывается значение для параметра <xref:System.Resources.UltimateResourceFallbackLocation>, указывающее, должен ли диспетчер ресурсов извлечь резервные ресурсы из основной сборки или из вспомогательной сборки.  
  
 В следующем примере используется атрибут <xref:System.Resources.NeutralResourcesLanguageAttribute> для резервного хранения ресурсов приложения во вспомогательной сборке для французского языка \(fr\).  Пример содержит два текстовых файла ресурсов, которые определяют одиночный строковый ресурс `Greeting`.  Первый, resources.fr.txt содержит французский языковой ресурс.  
  
```  
Greeting=Bon jour!  
```  
  
 Второй, resources.ru.txt содержит русский языковой ресурс.  
  
```  
Greeting=Добрый день  
```  
  
 Эти два файла компилированы в файлы .resources путем запуска [генератора файловых ресурсов \(Resgen.exe\)](../../../docs/framework/tools/resgen-exe-resource-file-generator.md) из командной строки.  Для ресурса французского языкового команда выглядит следующим образом:  
  
 **resgen.exe resources.fr.txt**  
  
 Для ресурса русского языка команда выглядит следующим образом:  
  
 **resgen.exe resources.ru.txt**  
  
 Resources\-файлы внедрены в библиотеки динамической компоновки при помощи запуска из командной строки [компоновщика сборок \(Al.exe\)](../../../docs/framework/tools/al-exe-assembly-linker.md) для ресурса французского языка следующим образом:  
  
 **al \/t:lib \/embed:resources.fr.resources \/culture:fr \/out:fr\\Example1.resources.dll**  
  
 и для ресурса русского языка — следующим образом:  
  
 **al \/t:lib \/embed:resources.ru.resources \/culture:ru \/out:ru\\Example1.resources.dll**  
  
 Исходный код приложения находится в файле с именем Example1.cs или Example1.vb.  Он содержит атрибут <xref:System.Resources.NeutralResourcesLanguageAttribute> для указания, что по умолчанию ресурс приложения в подкаталоге fr.  Он создает диспетчер ресурсов, получает значение ресурса `Greeting`, и выводит его на консоль.  
  
 [!code-csharp[Conceptual.Resources.Packaging#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.resources.packaging/cs/example1.cs#1)]
 [!code-vb[Conceptual.Resources.Packaging#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.resources.packaging/vb/example1.vb#1)]  
  
 Можно компилировать исходный код C\# в командной строке следующим образом:  
  
 **csc Example1.cs**  
  
 Команда для компилятора Visual Basic очень похожа:  
  
 **vbc Example1.vb**  
  
 Так как нет никаких ресурсов, внедренные в основную сборку, не нужно компилировать с помощью переключателя `/resource`.  
  
 При запуске примера из системы , язык которой является отличным от русского языка, он выводит следующие результаты:  
  
```  
Bon jour!  
```  
  
## Предлагаемые альтернативные методы упаковки  
 Финансовые или временные ограничения могут помешать создать набора ресурсов для каждого региона, который поддерживается этим приложением.  Вместо этого можно создать одну вспомогательную сборку для родительских региональных параметров, которую могут использовать все связанные регионы.  Например, можно создать одну вспомогательную сборку для английского языка \(en\), которая будет вызываться пользователями при запросе англоязычных ресурсов для конкретного региона, и одну сборку на немецком \(de\) для пользователей, запрашивающих ресурсы немецкоязычной версии для определенного региона.  Так, запросы ресурсов для немецкоязычной версии Германии \(de\-DE\), немецкоязычной версии Австрии \(de\-AT\) и немецкоязычной версии Швейцарии \(de\-CH\) будут переданы во вспомогательную сборку для немецкого языка \(de\).  Стандартные ресурсы представляют собой окончательные запасные варианты, поэтому в этом качестве следует использовать ресурсы, которые будут запрашиваться большинством пользователей создаваемого приложения, поэтому необходимо выбирать эти ресурсы внимательно.  В данном подходе будут задействованы ресурсы более общего характера, что позволит существенно снизить затраты на локализацию приложения.  
  
## См. также  
 [Ресурсы в приложениях для настольных систем](../../../docs/framework/resources/index.md)   
 [глобальный кэш сборок](../../../docs/framework/app-domains/gac.md)   
 [Создание файлов ресурсов](../../../docs/framework/resources/creating-resource-files-for-desktop-apps.md)   
 [Создание вспомогательных сборок](../../../docs/framework/resources/creating-satellite-assemblies-for-desktop-apps.md)