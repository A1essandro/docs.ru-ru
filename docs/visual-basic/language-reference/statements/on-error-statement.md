---
title: Оператор On Error (Visual Basic)
ms.date: 07/20/2015
f1_keywords:
- vb.OnError
helpviewer_keywords:
- Visual Basic code, control flow
- Resume Next statement [Visual Basic]
- errors [Visual Basic], trapping
- error handling, On Error statement
- Next statement [Visual Basic], On Error
- control flow [Visual Basic], branching
- Error keyword [Visual Basic]
- execution [Visual Basic], conditional
- Resume statement [Visual Basic], and On Error statement
- Error statement [Visual Basic], and On Error statement
- GoTo statement [Visual Basic], and On Error statement
- branching [Visual Basic], on error
- conditional statements [Visual Basic], On Error
- On Error statement [Visual Basic], syntax
- On keyword [Visual Basic]
- run-time errors [Visual Basic], handling
- On Error statement [Visual Basic]
ms.assetid: ff947930-fb84-40cf-bd66-1ea219561d5c
ms.openlocfilehash: b2e32dcca2e29a178af6dc985da536b47f0ebae6
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
---
# <a name="on-error-statement-visual-basic"></a>Оператор On Error (Visual Basic)
Включает процедуру обработки ошибок и определяет местоположение этой подпрограммы в процедуре. может также использоваться для отключения подпрограммы обработки ошибок.  
  
 Без обработки ошибок, любая ошибка во время выполнения, возникает неустранимая: отображается сообщение об ошибке, и выполнение будет остановлено.  
  
 По возможности рекомендуется использовать структурированных исключений в коде обработку, вместо использования неструктурированной обработки исключений и `On Error` инструкции. Дополнительные сведения см. в разделе [Оператор Try...Catch...Finally](../../../visual-basic/language-reference/statements/try-catch-finally-statement.md).  
  
> [!NOTE]
>  `Error` Также используется ключевое слово в [оператор Error](../../../visual-basic/language-reference/statements/error-statement.md), который поддерживается для обратной совместимости.  
  
## <a name="syntax"></a>Синтаксис  
  
```  
On Error { GoTo [ line | 0 | -1 ] | Resume Next }  
```  
  
## <a name="parts"></a>Части  
  
|Термин|Определение|  
|---|---|  
|`GoTo` `line`|Включает подпрограмму обработки ошибок, которая начинается со строки, указанной в обязательном `line` аргумент. `line` Аргумент является любую метку или номер строки. При возникновении ошибки во время выполнения, управлять указанную строку, что делает активным обработчик ошибок. Указанная строка должна быть в той же процедуре `On Error` произойдет инструкции или ошибка времени компиляции.|  
|`GoTo` 0|Отключает активированный обработчик ошибок в текущей процедуре и сбрасывает его в `Nothing`.|  
|`GoTo` -1|Отключает включенные исключения в текущей процедуре и сбрасывает его в `Nothing`.|  
|`Resume Next`|Указывает, что при возникновении ошибки во время выполнения элемент управления передается оператору, сразу после инструкции, где возникла ошибка, и выполнение продолжается с этой точки. Используйте эту форму, а не `On Error GoTo` при доступе к объектам.|  
  
## <a name="remarks"></a>Примечания  
  
> [!NOTE]
>  Мы рекомендуем использовать структурированная обработка исключений в коде, когда это возможно, вместо использования неструктурированной обработки исключений и `On Error` инструкции. Дополнительные сведения см. в разделе [Оператор Try...Catch...Finally](../../../visual-basic/language-reference/statements/try-catch-finally-statement.md).  
  
 Обработчик ошибок «enabled» понимается, которая включена по `On Error` инструкции. Обработчик ошибок «active» — включенный обработчик, который находится в процессе обработки ошибки.  
  
 Если возникает ошибка во время активности обработчика ошибок (между возникновением ошибки и `Resume`, `Exit Sub`, `Exit Function`, или `Exit Property` инструкции), обработчик ошибок текущей процедуры не может обработать ошибку. Управление возвращается в вызывающую процедуру.  
  
 Если у вызывающей процедуры есть включенный обработчик ошибок, он активируется для обработки ошибки. Если обработчик ошибок вызывающей процедуры уже активен, управление передается обратно через предыдущих вызовах процедур, пока не будет найден обработчик ошибок включено, но неактивный. При обнаружении такой обработчик ошибок, в точке, где она реально возникла неустранимая ошибка.  
  
 Каждый раз, когда обработчик ошибок передает управление обратно вызывающей процедуре, эта процедура становится текущей процедуры. После обработки ошибки обработчиком любой из процедур, выполнение возобновляется в текущей процедуре в той точке, назначенному с помощью `Resume` инструкции.  
  
> [!NOTE]
>  Подпрограммы обработки ошибок не `Sub` процедуры или `Function` процедуры. Это раздел кода, помеченный меткой строки или номер строки.  
  
## <a name="number-property"></a>Свойство номера  
 Подпрограммы обработки ошибок используют значение в `Number` свойство `Err` объекта, чтобы определить причину ошибки. Подпрограммы, следует проверить или сохранить соответствующие значения свойства в `Err` объекта перед любой другой ошибки или до процедуры, которая может вызвать ошибку вызова. Значения в `Err` объекта отражают только самую последнюю ошибку. Об ошибке, связанное с `Err.Number` содержится в `Err.Description`.  
  
## <a name="throw-statement"></a>Оператор Throw  
 Ошибка, вызвавшая с `Err.Raise` метода задает `Exception` свойства в только что созданный экземпляр <xref:System.Exception> класса. Для обеспечения вызова исключений производных типов, `Throw` инструкция поддерживается в языке. Это принимает один параметр, являющийся экземпляром исключение. Следующий пример показывает, как эти функции можно использовать с существующей системой обработки исключений:  
  
 [!code-vb[VbVbalrErrorHandling#17](../../../visual-basic/language-reference/statements/codesnippet/VisualBasic/on-error-statement_1.vb)]  
  
 Обратите внимание, что `On Error GoTo` оператор перехватывает все ошибки, независимо от класса exception.  
  
## <a name="on-error-resume-next"></a>On Error Resume Next  
 `On Error Resume Next` прерывает выполнение продолжить сразу после инструкции, вызвавшей ошибку во время выполнения инструкции или с помощью инструкции следующего за последним вызовом к процедуре, содержащей `On Error Resume Next` инструкции. Эта инструкция позволяет продолжить выполнение несмотря на ошибки во время выполнения. Можно поместить процедуру обработки ошибок, где возникнет ошибка, не передавая управление в другое место внутри процедуры. `On Error Resume Next` Оператор становится неактивным при вызове другой процедуры, поэтому следует выполнять `On Error Resume Next` оператор в каждой вызывается процедура, если нужно встроить ошибок обработки в рамках этой процедуры.  
  
> [!NOTE]
>  `On Error Resume Next` Конструкция может оказаться предпочтительнее `On Error GoTo` при обработке ошибок, формируемых во время доступа к другим объектам. Проверка `Err` после каждого взаимодействия с объектом позволяет избежать неоднозначности, о том, какие обращения к объекту с помощью кода. Можно быть уверенным, какой объект поместил код ошибки в `Err.Number`, а также какой объект первоначально создал ошибку (объект, указанный в `Err.Source`).  
  
## <a name="on-error-goto-0"></a>На Error GoTo 0  
 `On Error GoTo 0` отключает обработку ошибок в текущей процедуре. Он не определяет строку 0 как начало кода обработки ошибок, даже если процедура содержит строку с номером 0. Без `On Error GoTo 0` инструкции, обработчик ошибок автоматически отключается при выходе из процедуры.  
  
## <a name="on-error-goto--1"></a>На Error GoTo -1  
 `On Error GoTo -1` Отключает исключения в текущей процедуре. Оно указывает строки -1 как начало кода обработки ошибок, даже если процедура содержит строку с номером -1. Без `On Error GoTo -1` инструкции исключение автоматически отключается при выходе из процедуры.  
  
 Чтобы предотвратить выполнение при отсутствии ошибок кода обработки ошибок, поместите `Exit Sub`, `Exit Function`, или `Exit Property` инструкции непосредственно перед процедуру обработки ошибок, как показано в следующем фрагменте:  
  
 [!code-vb[VbVbalrErrorHandling#18](../../../visual-basic/language-reference/statements/codesnippet/VisualBasic/on-error-statement_2.vb)]  
  
 Здесь код обработки ошибок имеет `Exit Sub` инструкции и перед `End Sub` позволяет отделить его от основной части процедуры. Код обработки ошибок можно разместить в любом месте в процедуре.  
  
## <a name="untrapped-errors"></a>Неперехваченные ошибки  
 Неперехваченные ошибки в объектах возвращаются управляющее приложение, если объект выполняется как исполняемый файл. В среде разработки неперехваченные ошибки возвращаются в управляющее приложение только в том случае, если установлены соответствующие параметры. Документации ведущего приложения, описание которого параметры должны быть установлены во время отладки, способ их настройки и ли узле можно создавать классы.  
  
 При создании объекта, который обращается к другим объектам, можно попытаться обработать любые необработанные ошибки, возвращаемые. Если не удается сопоставьте коды ошибок в `Err.Number` одно из пользовательских ошибок и последующая передача их обратно в вызывающий объект. Следует определить свою ошибку, добавив код ошибки для `VbObjectError` константой. Например если код ошибки 1052, присвойте ее следующим образом:  
  
 [!code-vb[VbVbalrErrorHandling#19](../../../visual-basic/language-reference/statements/codesnippet/VisualBasic/on-error-statement_3.vb)]  
  
> [!CAUTION]
>  Системные ошибки во время вызовов Windows библиотек динамической компоновки (DLL) не вызывайте исключения и не может выполняться с помощью Visual Basic сообщение об ошибке. При вызове функций библиотек DLL, необходимо проверять каждое возвращаемое значение успешное выполнение или сбой (в соответствии со спецификациями API) и в случае сбоя, проверьте значение `Err` объекта `LastDLLError` свойство.  
  
## <a name="example"></a>Пример  
 В этом примере сначала используется `On Error GoTo` инструкцию, чтобы указать расположение подпрограммы обработки ошибок в процедуре. В примере попытка деления на ноль приводит к возникновению ошибки с номером 6. Ошибка обрабатывается в процедуру обработки ошибок и управление возвращается оператору, который вызвал ошибку. `On Error GoTo 0` Инструкция отключает сообщение об ошибке. Затем `On Error Resume Next` можно отложить перехват ошибок, чтобы контекст для ошибки, возникающие из следующего оператора может быть известен некоторые инструкции. Обратите внимание, что `Err.Clear` используется для очистки `Err` свойств объекта после завершения обработки ошибки.  
  
 [!code-vb[VbVbalrErrorHandling#20](../../../visual-basic/language-reference/statements/codesnippet/VisualBasic/on-error-statement_4.vb)]  
  
## <a name="requirements"></a>Требования  
 **Пространство имен:** [Microsoft.VisualBasic](../../../visual-basic/language-reference/runtime-library-members.md)  
  
 **Сборка:** Visual Basic Runtime Library (Microsoft.VisualBasic.dll)  
  
## <a name="see-also"></a>См. также  
 <xref:Microsoft.VisualBasic.Information.Err%2A>  
 <xref:Microsoft.VisualBasic.ErrObject.Number%2A>  
 <xref:Microsoft.VisualBasic.ErrObject.Description%2A>  
 <xref:Microsoft.VisualBasic.ErrObject.LastDllError%2A>  
 [Оператор End](../../../visual-basic/language-reference/statements/end-statement.md)  
 [Оператор Exit](../../../visual-basic/language-reference/statements/exit-statement.md)  
 [Оператор Resume](../../../visual-basic/language-reference/statements/resume-statement.md)  
 [Сообщения об ошибках](../../../visual-basic/language-reference/error-messages/index.md)  
 [Оператор Try...Catch...Finally](../../../visual-basic/language-reference/statements/try-catch-finally-statement.md)
