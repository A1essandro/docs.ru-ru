---
title: "Устранение неполадок взаимодействия (Visual Basic) | Документы Microsoft"
ms.custom: 
ms.date: 2015-07-20
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology:
- devlang-visual-basic
ms.topic: article
dev_langs:
- VB
helpviewer_keywords:
- interop, deploying assemblies
- assemblies [Visual Basic]
- interop, installing assemblies that share components
- COM objects, troubleshooting
- interop, sharing components
- troubleshooting interoperability
- interoperability, troubleshooting
- COM interop, troubleshooting
- assemblies [Visual Basic], deploying
- troubleshooting Visual Basic, interoperability
- interop assemblies
- interoperability, sharing components
- shared components, using with assemblies
ms.assetid: b324cc1e-b03c-4f39-aea6-6a6d5bfd0e37
caps.latest.revision: 21
author: dotnet-bot
ms.author: dotnetcontent
translation.priority.ht:
- cs-cz
- de-de
- es-es
- fr-fr
- it-it
- ja-jp
- ko-kr
- pl-pl
- pt-br
- ru-ru
- tr-tr
- zh-cn
- zh-tw
ms.translationtype: Machine Translation
ms.sourcegitcommit: 9f5b8ebb69c9206ff90b05e748c64d29d82f7a16
ms.openlocfilehash: f4a906b685ac02e89eb1dd94d538be3288b03ca1
ms.contentlocale: ru-ru
ms.lasthandoff: 04/12/2017

---
# <a name="troubleshooting-interoperability-visual-basic"></a><span data-ttu-id="15cc4-102">Устранение неполадок взаимодействия (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="15cc4-102">Troubleshooting Interoperability (Visual Basic)</span></span>
<span data-ttu-id="15cc4-103">При взаимодействии между COM и управляемым кодом [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)], могут появиться один или несколько из следующих распространенных проблем.</span><span class="sxs-lookup"><span data-stu-id="15cc4-103">When you interoperate between COM and the managed code of the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)], you may encounter one or more of the following common issues.</span></span>  
  
##  <span data-ttu-id="15cc4-104"><a name="vbconinteroperabilitymarshalinganchor1"></a>Маршалинг взаимодействия</span><span class="sxs-lookup"><span data-stu-id="15cc4-104"><a name="vbconinteroperabilitymarshalinganchor1"></a> Interop Marshaling</span></span>  
 <span data-ttu-id="15cc4-105">В некоторых случаях может потребоваться использование типов данных, которые не являются частью [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)].</span><span class="sxs-lookup"><span data-stu-id="15cc4-105">At times, you may have to use data types that are not part of the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)].</span></span> <span data-ttu-id="15cc4-106">Сборки взаимодействия выполняют большую часть работы с объектами COM, но может возникнуть необходимость управления типы данных, которые используются, когда управляемые объекты предоставляются COM.</span><span class="sxs-lookup"><span data-stu-id="15cc4-106">Interop assemblies handle most of the work for COM objects, but you may have to control the data types that are used when managed objects are exposed to COM.</span></span> <span data-ttu-id="15cc4-107">Например, структуры в библиотеках класса необходимо указать `BStr` неуправляемый тип для строк, отправляемых в объекты COM, созданные Visual Basic 6.0 и более ранних версий.</span><span class="sxs-lookup"><span data-stu-id="15cc4-107">For example, structures in class libraries must specify the `BStr` unmanaged type on strings sent to COM objects created by Visual Basic 6.0 and earlier versions.</span></span> <span data-ttu-id="15cc4-108">В таких случаях можно использовать <xref:System.Runtime.InteropServices.MarshalAsAttribute>атрибут, чтобы управляемые типы предоставлялись как неуправляемые типы.</xref:System.Runtime.InteropServices.MarshalAsAttribute></span><span class="sxs-lookup"><span data-stu-id="15cc4-108">In such cases, you can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute to cause managed types to be exposed as unmanaged types.</span></span>  
  
##  <span data-ttu-id="15cc4-109"><a name="vbconinteroperabilitymarshalinganchor2"></a>Экспорт строк фиксированной длины в неуправляемый код</span><span class="sxs-lookup"><span data-stu-id="15cc4-109"><a name="vbconinteroperabilitymarshalinganchor2"></a> Exporting Fixed-Length Strings to Unmanaged Code</span></span>  
 <span data-ttu-id="15cc4-110">В Visual Basic 6.0 и более ранних версиях строки экспортировались COM-объекты как последовательности байтов без знака с нулем.</span><span class="sxs-lookup"><span data-stu-id="15cc4-110">In Visual Basic 6.0 and earlier versions, strings are exported to COM objects as sequences of bytes without a null termination character.</span></span> <span data-ttu-id="15cc4-111">Для обеспечения совместимости с другими языками [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] при экспорте строк включает завершающий знак.</span><span class="sxs-lookup"><span data-stu-id="15cc4-111">For compatibility with other languages, [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] includes a termination character when exporting strings.</span></span> <span data-ttu-id="15cc4-112">Лучший способ решить проблему несовместимости — экспортировать строки без завершающего знака как массивы `Byte` или `Char`.</span><span class="sxs-lookup"><span data-stu-id="15cc4-112">The best way to address this incompatibility is to export strings that lack the termination character as arrays of `Byte` or `Char`.</span></span>  
  
##  <span data-ttu-id="15cc4-113"><a name="vbconinteroperabilitymarshalinganchor3"></a>Экспорт иерархий наследования</span><span class="sxs-lookup"><span data-stu-id="15cc4-113"><a name="vbconinteroperabilitymarshalinganchor3"></a> Exporting Inheritance Hierarchies</span></span>  
 <span data-ttu-id="15cc4-114">Управляемого класса выравниваются иерархий при представляются в виде COM-объектов.</span><span class="sxs-lookup"><span data-stu-id="15cc4-114">Managed class hierarchies flatten out when exposed as COM objects.</span></span> <span data-ttu-id="15cc4-115">Например если определить базовый класс с элементом и затем наследовать базовый класс в производном классе, который предоставляется как объект COM, клиенты, использующие производный класс в объекте COM будет невозможно использовать унаследованные члены.</span><span class="sxs-lookup"><span data-stu-id="15cc4-115">For example, if you define a base class with a member, and then inherit the base class in a derived class that is exposed as a COM object, clients that use the derived class in the COM object will not be able to use the inherited members.</span></span> <span data-ttu-id="15cc4-116">Члены базового класса из COM-объектов может осуществляться только как экземпляры базового класса, а затем только в том случае, если базовый класс также создан как COM-объект.</span><span class="sxs-lookup"><span data-stu-id="15cc4-116">Base class members can be accessed from COM objects only as instances of a base class, and then only if the base class is also created as a COM object.</span></span>  
  
## <a name="overloaded-methods"></a><span data-ttu-id="15cc4-117">Перегруженные методы</span><span class="sxs-lookup"><span data-stu-id="15cc4-117">Overloaded Methods</span></span>  
 <span data-ttu-id="15cc4-118">Хотя можно создать перегруженные методы с помощью [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)], они не поддерживаются COM.</span><span class="sxs-lookup"><span data-stu-id="15cc4-118">Although you can create overloaded methods with [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)], they are not supported by COM.</span></span> <span data-ttu-id="15cc4-119">Когда класс, содержащий перегруженные методы предоставляется как объект COM, новые имена методов создаются для перегруженных методов.</span><span class="sxs-lookup"><span data-stu-id="15cc4-119">When a class that contains overloaded methods is exposed as a COM object, new method names are generated for the overloaded methods.</span></span>  
  
 <span data-ttu-id="15cc4-120">Например, рассмотрим класс, имеющий две перегрузки `Synch` метод.</span><span class="sxs-lookup"><span data-stu-id="15cc4-120">For example, consider a class that has two overloads of the `Synch` method.</span></span> <span data-ttu-id="15cc4-121">Когда класс выставлен как объект COM, новые созданные имена методов могут быть `Synch` и `Synch_2`.</span><span class="sxs-lookup"><span data-stu-id="15cc4-121">When the class is exposed as a COM object, the new generated method names could be `Synch` and `Synch_2`.</span></span>  
  
 <span data-ttu-id="15cc4-122">Переименование может вызвать две проблемы для потребителей COM-объекта.</span><span class="sxs-lookup"><span data-stu-id="15cc4-122">The renaming can cause two problems for consumers of the COM object.</span></span>  
  
1.  <span data-ttu-id="15cc4-123">Клиенты могут не ожидать созданных имен методов.</span><span class="sxs-lookup"><span data-stu-id="15cc4-123">Clients might not expect the generated method names.</span></span>  
  
2.  <span data-ttu-id="15cc4-124">Имена созданных методов в классе, выставленном как COM-объект можно изменить при добавлении новых перегрузок к классу или его базовый класс.</span><span class="sxs-lookup"><span data-stu-id="15cc4-124">The generated method names in the class exposed as a COM object can change when new overloads are added to the class or its base class.</span></span> <span data-ttu-id="15cc4-125">Это может вызвать проблемы управления версиями.</span><span class="sxs-lookup"><span data-stu-id="15cc4-125">This can cause versioning problems.</span></span>  
  
 <span data-ttu-id="15cc4-126">Для решения обоих проблем, присвойте каждому методу уникальное имя вместо использования перегрузки при разработке объектов, которые будут предоставлены в виде COM-объектов.</span><span class="sxs-lookup"><span data-stu-id="15cc4-126">To solve both problems, give each method a unique name, instead of using overloading, when you develop objects that will be exposed as COM objects.</span></span>  
  
##  <span data-ttu-id="15cc4-127"><a name="vbconinteroperabilitymarshalinganchor4"></a>Использование объектов COM с помощью сборок взаимодействия</span><span class="sxs-lookup"><span data-stu-id="15cc4-127"><a name="vbconinteroperabilitymarshalinganchor4"></a> Use of COM Objects Through Interop Assemblies</span></span>  
 <span data-ttu-id="15cc4-128">Сборки взаимодействия используются почти как если бы они были управляемым кодом, заменяющим объекты COM, которые они представляют.</span><span class="sxs-lookup"><span data-stu-id="15cc4-128">You use interop assemblies almost as if they are managed code replacements for the COM objects they represent.</span></span> <span data-ttu-id="15cc4-129">Тем не менее поскольку они являются обертками, а не фактические COM-объекты, существуют некоторые различия в использовании сборок взаимодействия и обычных сборок.</span><span class="sxs-lookup"><span data-stu-id="15cc4-129">However, because they are wrappers and not actual COM objects, there are some differences between using interop assemblies and standard assemblies.</span></span> <span data-ttu-id="15cc4-130">Эти различия касаются раскрытие классов и типов данных параметров и возвращаемых значений.</span><span class="sxs-lookup"><span data-stu-id="15cc4-130">These areas of difference include the exposure of classes, and data types for parameters and return values.</span></span>  
  
##  <span data-ttu-id="15cc4-131"><a name="vbconinteroperabilitymarshalinganchor5"></a>Классы, предоставляемые и как интерфейсы и классы</span><span class="sxs-lookup"><span data-stu-id="15cc4-131"><a name="vbconinteroperabilitymarshalinganchor5"></a> Classes Exposed as Both Interfaces and Classes</span></span>  
 <span data-ttu-id="15cc4-132">В отличие от классов в обычных сборках классы COM представлены в сборках взаимодействия как интерфейс и класс, представляющий COM-класса.</span><span class="sxs-lookup"><span data-stu-id="15cc4-132">Unlike classes in standard assemblies, COM classes are exposed in interop assemblies as both an interface and a class that represents the COM class.</span></span> <span data-ttu-id="15cc4-133">Имя интерфейса идентична COM-класса.</span><span class="sxs-lookup"><span data-stu-id="15cc4-133">The interface's name is identical to that of the COM class.</span></span> <span data-ttu-id="15cc4-134">Имя класса взаимодействия же, что и исходный класс COM, но слово «Class» добавлением.</span><span class="sxs-lookup"><span data-stu-id="15cc4-134">The name of the interop class is the same as that of the original COM class, but with the word "Class" appended.</span></span> <span data-ttu-id="15cc4-135">Например предположим, что у вас есть проект со ссылкой на сборку взаимодействия для COM-объекта.</span><span class="sxs-lookup"><span data-stu-id="15cc4-135">For example, suppose you have a project with a reference to an interop assembly for a COM object.</span></span> <span data-ttu-id="15cc4-136">Если COM-класс назван `MyComClass`, IntelliSense и обозреватель объектов покажет интерфейс с именем `MyComClass` и класс с именем `MyComClassClass`.</span><span class="sxs-lookup"><span data-stu-id="15cc4-136">If the COM class is named `MyComClass`, IntelliSense and the Object Browser show an interface named `MyComClass` and a class named `MyComClassClass`.</span></span>  
  
##  <span data-ttu-id="15cc4-137"><a name="vbconinteroperabilitymarshalinganchor6"></a>Создание экземпляров класса .NET Framework</span><span class="sxs-lookup"><span data-stu-id="15cc4-137"><a name="vbconinteroperabilitymarshalinganchor6"></a> Creating Instances of a .NET Framework Class</span></span>  
 <span data-ttu-id="15cc4-138">Как правило, создается экземпляр [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] класса `New` инструкции с именем класса.</span><span class="sxs-lookup"><span data-stu-id="15cc4-138">Generally, you create an instance of a [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] class using the `New` statement with a class name.</span></span> <span data-ttu-id="15cc4-139">Наличие класса COM, представленного сборкой взаимодействия — это тот случай, в котором можно использовать `New` инструкции с интерфейсом.</span><span class="sxs-lookup"><span data-stu-id="15cc4-139">Having a COM class represented by an interop assembly is the one case in which you can use the `New` statement with an interface.</span></span> <span data-ttu-id="15cc4-140">Только при использовании COM-класса с `Inherits` инструкции, интерфейс можно использовать так же, как и класс.</span><span class="sxs-lookup"><span data-stu-id="15cc4-140">Unless you are using the COM class with an `Inherits` statement, you can use the interface just as you would a class.</span></span> <span data-ttu-id="15cc4-141">Следующий код демонстрирует создание `Command` объекта в проекте, который содержит ссылку на библиотеку Microsoft ActiveX данных объектов 2.8 COM-объект:</span><span class="sxs-lookup"><span data-stu-id="15cc4-141">The following code demonstrates how to create a `Command` object in a project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object:</span></span>  
  
 <span data-ttu-id="15cc4-142">[!code-vb[VbVbalrInterop&20;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_1.vb)]</span><span class="sxs-lookup"><span data-stu-id="15cc4-142">[!code-vb[VbVbalrInterop#20](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_1.vb)]</span></span>  
  
 <span data-ttu-id="15cc4-143">Однако при использовании COM-класса как основа для производного класса, необходимо использовать класс взаимодействия, представляющий класс COM, как показано в следующем коде:</span><span class="sxs-lookup"><span data-stu-id="15cc4-143">However, if you are using the COM class as the base for a derived class, you must use the interop class that represents the COM class, as in the following code:</span></span>  
  
 <span data-ttu-id="15cc4-144">[!code-vb[VbVbalrInterop&#21;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_2.vb)]</span><span class="sxs-lookup"><span data-stu-id="15cc4-144">[!code-vb[VbVbalrInterop#21](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_2.vb)]</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="15cc4-145">Сборки взаимодействия неявно реализуют интерфейсы, которые представляют COM-классов.</span><span class="sxs-lookup"><span data-stu-id="15cc4-145">Interop assemblies implicitly implement interfaces that represent COM classes.</span></span> <span data-ttu-id="15cc4-146">Не следует пытаться использовать `Implements` приведет к инструкции для реализации этих интерфейсов или ошибку.</span><span class="sxs-lookup"><span data-stu-id="15cc4-146">You should not try to use the `Implements` statement to implement these interfaces or an error will result.</span></span>  
  
##  <span data-ttu-id="15cc4-147"><a name="vbconinteroperabilitymarshalinganchor7"></a>Типы данных параметров и возвращаемых значений</span><span class="sxs-lookup"><span data-stu-id="15cc4-147"><a name="vbconinteroperabilitymarshalinganchor7"></a> Data Types for Parameters and Return Values</span></span>  
 <span data-ttu-id="15cc4-148">В отличие от элементов обычных сборок члены сборки взаимодействия могут иметь типы данных, которые отличаются от используемых в исходном объявлении объекта.</span><span class="sxs-lookup"><span data-stu-id="15cc4-148">Unlike members of standard assemblies, interop assembly members may have data types that differ from those used in the  original object declaration.</span></span> <span data-ttu-id="15cc4-149">Несмотря на то, что сборки взаимодействия неявно преобразуют типы COM в совместимые типы среды выполнения, следует обратить внимание на типы данных, которые используются с обеих сторон для предотвращения ошибок во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="15cc4-149">Although interop assemblies implicitly convert COM types to compatible common language runtime types, you should pay attention to the data types that are used by both sides to prevent runtime errors.</span></span> <span data-ttu-id="15cc4-150">Например, в COM-объекты, созданные в Visual Basic 6.0 и более ранних версиях, значения типа `Integer` предполагается [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] эквивалентный тип `Short`.</span><span class="sxs-lookup"><span data-stu-id="15cc4-150">For example, in COM objects created in Visual Basic 6.0 and earlier versions, values of type `Integer` assume the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] equivalent type, `Short`.</span></span> <span data-ttu-id="15cc4-151">Рекомендуется использовать обозреватель объектов для проверки характеристик импортированных элементов перед их использованием.</span><span class="sxs-lookup"><span data-stu-id="15cc4-151">It is recommended that you use the Object Browser to examine the characteristics of imported members before you use them.</span></span>  
  
##  <span data-ttu-id="15cc4-152"><a name="vbconinteroperabilitymarshalinganchor8"></a>Методы COM уровня модуля</span><span class="sxs-lookup"><span data-stu-id="15cc4-152"><a name="vbconinteroperabilitymarshalinganchor8"></a> Module level COM methods</span></span>  
 <span data-ttu-id="15cc4-153">Большинство объектов COM используются путем создания экземпляра класса COM с помощью `New` ключевое слово и затем вызывает методы этого объекта.</span><span class="sxs-lookup"><span data-stu-id="15cc4-153">Most COM objects are used by creating an instance of a COM class using the `New` keyword and then calling methods of the object.</span></span> <span data-ttu-id="15cc4-154">Единственным исключением из этого правила включает COM-объекты, содержащие `AppObj` или `GlobalMultiUse` COM-классов.</span><span class="sxs-lookup"><span data-stu-id="15cc4-154">One exception to this rule involves COM objects that contain `AppObj` or `GlobalMultiUse` COM classes.</span></span> <span data-ttu-id="15cc4-155">Такие классы напоминают методы уровня модуля в [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] классы.</span><span class="sxs-lookup"><span data-stu-id="15cc4-155">Such classes resemble module level methods in [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] classes.</span></span> <span data-ttu-id="15cc4-156">Visual Basic 6.0 и более ранних версиях неявно создает экземпляры таких объектов при первом вызове одного из их методов.</span><span class="sxs-lookup"><span data-stu-id="15cc4-156">Visual Basic 6.0 and earlier versions implicitly create instances of such objects for you the first time that you call one of their methods.</span></span> <span data-ttu-id="15cc4-157">Например, в Visual Basic 6.0 можно добавить ссылку на библиотека объектов Microsoft DAO 3.6 и вызов `DBEngine` без предварительного создания экземпляра:</span><span class="sxs-lookup"><span data-stu-id="15cc4-157">For example, in Visual Basic 6.0 you can add a reference to the Microsoft DAO 3.6 Object Library and call the `DBEngine` method without first creating an instance:</span></span>  
  
```  
Dim db As DAO.Database  
' Open the database.  
Set db = DBEngine.OpenDatabase("C:\nwind.mdb")  
' Use the database object.  
```  
  
 [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)]<span data-ttu-id="15cc4-158">необходимо всегда создавать экземпляры COM-объектов, перед использованием их методов.</span><span class="sxs-lookup"><span data-stu-id="15cc4-158"> requires that you always create instances of COM objects before you can use their methods.</span></span> <span data-ttu-id="15cc4-159">Чтобы использовать эти методы в [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)], объявите переменную нужного класса и используйте ключевое слово new присвойте объект для переменной объекта.</span><span class="sxs-lookup"><span data-stu-id="15cc4-159">To use these methods in [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)], declare a variable of the desired class and use the new keyword to assign the object to the object variable.</span></span> <span data-ttu-id="15cc4-160">`Shared` Ключевое слово может использоваться при необходимости убедитесь, что только один экземпляр класса создается.</span><span class="sxs-lookup"><span data-stu-id="15cc4-160">The `Shared` keyword can be used when you want to make sure that only one instance of the class is created.</span></span>  
  
 <span data-ttu-id="15cc4-161">[!code-vb[VbVbalrInterop&#23;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_3.vb)]</span><span class="sxs-lookup"><span data-stu-id="15cc4-161">[!code-vb[VbVbalrInterop#23](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_3.vb)]</span></span>  
  
##  <span data-ttu-id="15cc4-162"><a name="vbconinteroperabilitymarshalinganchor9"></a>Необработанные ошибки в обработчиках событий</span><span class="sxs-lookup"><span data-stu-id="15cc4-162"><a name="vbconinteroperabilitymarshalinganchor9"></a> Unhandled Errors in Event Handlers</span></span>  
 <span data-ttu-id="15cc4-163">Одна из общих проблем взаимодействия касается ошибок в обработчики событий, которые обрабатывают события COM-объектов.</span><span class="sxs-lookup"><span data-stu-id="15cc4-163">One common interop problem involves errors in event handlers that handle events raised by COM objects.</span></span> <span data-ttu-id="15cc4-164">Такие ошибки игнорируются, если специально проверки на наличие ошибок с помощью `On Error` или `Try...Catch...Finally` инструкции.</span><span class="sxs-lookup"><span data-stu-id="15cc4-164">Such errors are ignored unless you specifically check for errors using `On Error` or `Try...Catch...Finally` statements.</span></span> <span data-ttu-id="15cc4-165">Например, следующий пример взят из [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] проект содержит ссылку на библиотеку Microsoft ActiveX данных объектов 2.8 COM-объекта.</span><span class="sxs-lookup"><span data-stu-id="15cc4-165">For example, the following example is from a [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object.</span></span>  
  
 <span data-ttu-id="15cc4-166">[!code-vb[VbVbalrInterop&#24;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_4.vb)]</span><span class="sxs-lookup"><span data-stu-id="15cc4-166">[!code-vb[VbVbalrInterop#24](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_4.vb)]</span></span>  
  
 <span data-ttu-id="15cc4-167">Этот пример выдает ошибку, как ожидалось.</span><span class="sxs-lookup"><span data-stu-id="15cc4-167">This example raises an error as expected.</span></span> <span data-ttu-id="15cc4-168">Тем не менее если один и тот же пример без `Try...Catch...Finally` блока, ошибка обрабатывается, как если бы вы использовали `OnError Resume Next` инструкции.</span><span class="sxs-lookup"><span data-stu-id="15cc4-168">However, if you try the same example without the `Try...Catch...Finally` block, the error is ignored as if you used the `OnError Resume Next` statement.</span></span> <span data-ttu-id="15cc4-169">Без обработки ошибок деление на ноль вызовет неявную ошибку.</span><span class="sxs-lookup"><span data-stu-id="15cc4-169">Without error handling, the division by zero silently fails.</span></span> <span data-ttu-id="15cc4-170">Поскольку такие ошибки никогда не вызывают ошибку необработанного исключения, важно использовать определенные виды обработки исключений в обработчики событий, обрабатывающие события из COM-объектов.</span><span class="sxs-lookup"><span data-stu-id="15cc4-170">Because such errors never raise unhandled exception errors, it is important that you use some form of exception handling in event handlers that handle events from COM objects.</span></span>  
  
### <a name="understanding-com-interop-errors"></a><span data-ttu-id="15cc4-171">Основные сведения об ошибках взаимодействия COM</span><span class="sxs-lookup"><span data-stu-id="15cc4-171">Understanding COM interop errors</span></span>  
 <span data-ttu-id="15cc4-172">Без обработки ошибок вызовы взаимодействия часто создают ошибки, которые предоставляют немного информации.</span><span class="sxs-lookup"><span data-stu-id="15cc4-172">Without error handling, interop calls often generate errors that provide little information.</span></span> <span data-ttu-id="15cc4-173">По возможности следует используйте структурированную обработку для предоставления дополнительных сведений о проблемах, при их возникновении ошибок.</span><span class="sxs-lookup"><span data-stu-id="15cc4-173">Whenever possible, use structured error handling to provide more information about problems when they occur.</span></span> <span data-ttu-id="15cc4-174">Это может быть особенно полезно при отладке приложений.</span><span class="sxs-lookup"><span data-stu-id="15cc4-174">This can be especially helpful when you debug applications.</span></span> <span data-ttu-id="15cc4-175">Например:</span><span class="sxs-lookup"><span data-stu-id="15cc4-175">For example:</span></span>  
  
 <span data-ttu-id="15cc4-176">[!code-vb[VbVbalrInterop&#25;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_5.vb)]</span><span class="sxs-lookup"><span data-stu-id="15cc4-176">[!code-vb[VbVbalrInterop#25](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_5.vb)]</span></span>  
  
 <span data-ttu-id="15cc4-177">Можно найти сведения, такие как описание ошибки, HRESULT и источник ошибок COM. Проверка содержимого объекта исключения.</span><span class="sxs-lookup"><span data-stu-id="15cc4-177">You can find information such as the error description, HRESULT, and the source of COM errors by examining the contents of the exception object.</span></span>  
  
##  <span data-ttu-id="15cc4-178"><a name="vbconinteroperabilitymarshalinganchor10"></a>Проблемы управления ActiveX</span><span class="sxs-lookup"><span data-stu-id="15cc4-178"><a name="vbconinteroperabilitymarshalinganchor10"></a> ActiveX Control Issues</span></span>  
 <span data-ttu-id="15cc4-179">Большинство элементов управления ActiveX, которые работают с Visual Basic 6.0 работать с [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] без проблем.</span><span class="sxs-lookup"><span data-stu-id="15cc4-179">Most ActiveX controls that work with Visual Basic 6.0 work with [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] without trouble.</span></span> <span data-ttu-id="15cc4-180">Большинство исключений — это контейнерные элементы управления или элементы управления, которые визуально содержат другие элементы управления.</span><span class="sxs-lookup"><span data-stu-id="15cc4-180">The main exceptions are container controls, or controls that visually contain other controls.</span></span> <span data-ttu-id="15cc4-181">Некоторые примеры старых элементов управления, которые не работают с [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs_md.md)] выглядят следующим образом:</span><span class="sxs-lookup"><span data-stu-id="15cc4-181">Some examples of older controls that do not work correctly with [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs_md.md)] are as follows:</span></span>  
  
-   <span data-ttu-id="15cc4-182">Управление Microsoft Forms 2.0 кадров</span><span class="sxs-lookup"><span data-stu-id="15cc4-182">Microsoft Forms 2.0 Frame control</span></span>  
  
-   <span data-ttu-id="15cc4-183">Управления вверх / вниз, также известный как счетчик</span><span class="sxs-lookup"><span data-stu-id="15cc4-183">Up-Down control, also known as the spin control</span></span>  
  
-   <span data-ttu-id="15cc4-184">Sheridan вкладок</span><span class="sxs-lookup"><span data-stu-id="15cc4-184">Sheridan Tab Control</span></span>  
  
 <span data-ttu-id="15cc4-185">Существует способов обойти проблемы с неподдерживаемыми элементами управления ActiveX мало.</span><span class="sxs-lookup"><span data-stu-id="15cc4-185">There are only a few workarounds for unsupported ActiveX control problems.</span></span> <span data-ttu-id="15cc4-186">Можно выполнить миграцию существующих элементов управления [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs_md.md)] Если вы являетесь владельцем исходного кода.</span><span class="sxs-lookup"><span data-stu-id="15cc4-186">You can migrate existing controls to [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs_md.md)] if you own the original source code.</span></span> <span data-ttu-id="15cc4-187">В противном случае можно проверить с поставщиками программного обеспечения для обновления. NET-совместимой версии элементов управления для замены неподдерживаемые элементы управления ActiveX.</span><span class="sxs-lookup"><span data-stu-id="15cc4-187">Otherwise, you can check with software vendors for updated .NET-compatible versions of controls to replace unsupported ActiveX controls.</span></span>  
  
##  <span data-ttu-id="15cc4-188"><a name="vbconinteroperabilitymarshalinganchor11"></a>Передача свойства ReadOnly ByRef элементов управления</span><span class="sxs-lookup"><span data-stu-id="15cc4-188"><a name="vbconinteroperabilitymarshalinganchor11"></a> Passing ReadOnly Properties of Controls ByRef</span></span>  
 [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)]<span data-ttu-id="15cc4-189">иногда вызывает ошибки COM, такие как «Ошибка 0x800A017F CTL_E_SETNOTSUPPORTED» при передаче `ReadOnly` свойства некоторых старых элементов управления ActiveX, как `ByRef` параметров других процедур.</span><span class="sxs-lookup"><span data-stu-id="15cc4-189"> sometimes raises COM errors such as "Error 0x800A017F CTL_E_SETNOTSUPPORTED" when you pass `ReadOnly` properties of some older ActiveX controls as `ByRef` parameters to other procedures.</span></span> <span data-ttu-id="15cc4-190">Аналогично, процедура, вызванная в Visual Basic 6.0, не вызывает ошибки, и параметры обрабатываются так, как если бы они передавались по значению.</span><span class="sxs-lookup"><span data-stu-id="15cc4-190">Similar procedure calls from Visual Basic 6.0 do not raise an error, and the parameters are treated as if you passed them by value.</span></span> <span data-ttu-id="15cc4-191">Сообщение об ошибке содержатся в [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] является COM-объектом, сообщение о том, что вы пытаетесь изменить свойство, которое не имеет свойство `Set` процедуры.</span><span class="sxs-lookup"><span data-stu-id="15cc4-191">The error message you see in [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] is the COM object reporting that you are trying to change a property that does not have a property `Set` procedure.</span></span>  
  
 <span data-ttu-id="15cc4-192">При наличии доступа к вызываемой процедуре можно предотвратить эту ошибку, используя `ByVal` ключевое слово для объявления параметров, принимающих `ReadOnly` свойства.</span><span class="sxs-lookup"><span data-stu-id="15cc4-192">If you have access to the procedure being called, you can prevent this error by using the `ByVal` keyword to declare parameters that accept `ReadOnly` properties.</span></span> <span data-ttu-id="15cc4-193">Например:</span><span class="sxs-lookup"><span data-stu-id="15cc4-193">For example:</span></span>  
  
 <span data-ttu-id="15cc4-194">[!code-vb[VbVbalrInterop&#26;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_6.vb)]</span><span class="sxs-lookup"><span data-stu-id="15cc4-194">[!code-vb[VbVbalrInterop#26](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_6.vb)]</span></span>  
  
 <span data-ttu-id="15cc4-195">Если нет доступа к исходному коду для вызываемой процедуры, можно принудительно свойство передается по значению, добавив дополнительный набор скобок в вызывающей процедуре.</span><span class="sxs-lookup"><span data-stu-id="15cc4-195">If you do not have access to the source code for the procedure being called, you can force the property to be passed by value by adding an extra set of brackets around the calling procedure.</span></span> <span data-ttu-id="15cc4-196">Например в проекте, который содержит ссылку на библиотеку Microsoft ActiveX данных объектов 2.8 COM-объекта, можно использовать:</span><span class="sxs-lookup"><span data-stu-id="15cc4-196">For example, in a project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object, you can use:</span></span>  
  
 <span data-ttu-id="15cc4-197">[!code-vb[VbVbalrInterop&#27;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_7.vb)]</span><span class="sxs-lookup"><span data-stu-id="15cc4-197">[!code-vb[VbVbalrInterop#27](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_7.vb)]</span></span>  
  
##  <span data-ttu-id="15cc4-198"><a name="vbconinteroperabilitymarshalinganchor12"></a>Развертывание сборок, предоставляющих взаимодействие</span><span class="sxs-lookup"><span data-stu-id="15cc4-198"><a name="vbconinteroperabilitymarshalinganchor12"></a> Deploying Assemblies That Expose Interop</span></span>  
 <span data-ttu-id="15cc4-199">Развертывание сборок, которые предоставляют интерфейсы COM, связаны особые проблемы.</span><span class="sxs-lookup"><span data-stu-id="15cc4-199">Deploying assemblies that expose COM interfaces presents some unique challenges.</span></span> <span data-ttu-id="15cc4-200">Например потенциальная проблема возникает, когда различные приложения ссылаются на одной и той же сборки COM.</span><span class="sxs-lookup"><span data-stu-id="15cc4-200">For example, a potential problem occurs when separate applications reference the same COM assembly.</span></span> <span data-ttu-id="15cc4-201">Эта ситуация типична при установке новой версии сборки, а старая версия сборки по-прежнему используется другим приложением.</span><span class="sxs-lookup"><span data-stu-id="15cc4-201">This situation is common when a new version of an assembly is installed and another application is still using the old version of the assembly.</span></span> <span data-ttu-id="15cc4-202">При удалении сборки, использующего библиотеку DLL, вы можете оказаться недоступность для других сборок.</span><span class="sxs-lookup"><span data-stu-id="15cc4-202">If you uninstall an assembly that shares a DLL, you can unintentionally make it unavailable to the other assemblies.</span></span>  
  
 <span data-ttu-id="15cc4-203">Во избежание этой проблемы следует устанавливать совместно используемые сборки в глобальный кэш сборок (GAC) и использовать MergeModule для этого компонента.</span><span class="sxs-lookup"><span data-stu-id="15cc4-203">To avoid this problem, you should install shared assemblies to the Global Assembly Cache (GAC) and use a MergeModule for the component.</span></span> <span data-ttu-id="15cc4-204">Если не удается установить приложение в глобальный кэш СБОРОК, он должен устанавливаться в CommonFilesFolder в подкаталоге конкретных версий.</span><span class="sxs-lookup"><span data-stu-id="15cc4-204">If you cannot install the application in the GAC, it should be installed to CommonFilesFolder in a version-specific subdirectory.</span></span>  
  
 <span data-ttu-id="15cc4-205">Сборки, которые не являются общими должны быть расположены рядом друг с другом в каталоге с вызывающим приложением.</span><span class="sxs-lookup"><span data-stu-id="15cc4-205">Assemblies that are not shared should be located side by side in the directory with the calling application.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="15cc4-206">См. также</span><span class="sxs-lookup"><span data-stu-id="15cc4-206">See Also</span></span>  
 <span data-ttu-id="15cc4-207"><xref:System.Runtime.InteropServices.MarshalAsAttribute></xref:System.Runtime.InteropServices.MarshalAsAttribute></span><span class="sxs-lookup"><span data-stu-id="15cc4-207"><xref:System.Runtime.InteropServices.MarshalAsAttribute></span></span>   
<span data-ttu-id="15cc4-208"> [Взаимодействие COM](../../../visual-basic/programming-guide/com-interop/index.md) </span><span class="sxs-lookup"><span data-stu-id="15cc4-208"> [COM Interop](../../../visual-basic/programming-guide/com-interop/index.md) </span></span>  
<span data-ttu-id="15cc4-209"> [Tlbimp.exe (программа импорта библиотек типов)](http://msdn.microsoft.com/library/ec0a8d63-11b3-4acd-b398-da1e37e97382) </span><span class="sxs-lookup"><span data-stu-id="15cc4-209"> [Tlbimp.exe (Type Library Importer)](http://msdn.microsoft.com/library/ec0a8d63-11b3-4acd-b398-da1e37e97382) </span></span>  
<span data-ttu-id="15cc4-210"> [Tlbexp.exe (программа экспорта библиотек типов)](http://msdn.microsoft.com/library/a487d61b-d166-467b-a7ca-d8b52fbff42d) </span><span class="sxs-lookup"><span data-stu-id="15cc4-210"> [Tlbexp.exe (Type Library Exporter)](http://msdn.microsoft.com/library/a487d61b-d166-467b-a7ca-d8b52fbff42d) </span></span>  
<span data-ttu-id="15cc4-211"> [Пошаговое руководство: Реализация наследования с использованием COM-объектов](../../../visual-basic/programming-guide/com-interop/walkthrough-implementing-inheritance-with-com-objects.md) </span><span class="sxs-lookup"><span data-stu-id="15cc4-211"> [Walkthrough: Implementing Inheritance with COM Objects](../../../visual-basic/programming-guide/com-interop/walkthrough-implementing-inheritance-with-com-objects.md) </span></span>  
<span data-ttu-id="15cc4-212"> [Оператор Inherits](../../../visual-basic/language-reference/statements/inherits-statement.md) </span><span class="sxs-lookup"><span data-stu-id="15cc4-212"> [Inherits Statement](../../../visual-basic/language-reference/statements/inherits-statement.md) </span></span>  
<span data-ttu-id="15cc4-213"> [Глобальный кэш сборок](http://msdn.microsoft.com/library/cf5eacd0-d3ec-4879-b6da-5fd5e4372202)</span><span class="sxs-lookup"><span data-stu-id="15cc4-213"> [Global Assembly Cache](http://msdn.microsoft.com/library/cf5eacd0-d3ec-4879-b6da-5fd5e4372202)</span></span>
