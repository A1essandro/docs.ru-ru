---
title: "Пошаговое руководство: Вызов Windows API (Visual Basic) | Документы Microsoft"
ms.custom: 
ms.date: 2015-07-20
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology:
- devlang-visual-basic
ms.topic: article
dev_langs:
- VB
helpviewer_keywords:
- DLLs, calling
- Windows API, walkthroughs
- platform invoke, walkthroughs
- API calls, walkthroughs [Visual Basic]
- Windows API, calling
- walkthroughs [Visual Basic], API calls
- DllImport attribute, calling Windows API
- Declare statement, declaring DLL functions
ms.assetid: 9280ca96-7a93-47a3-8d01-6d01be0657cb
caps.latest.revision: 20
author: dotnet-bot
ms.author: dotnetcontent
translation.priority.ht:
- cs-cz
- de-de
- es-es
- fr-fr
- it-it
- ja-jp
- ko-kr
- pl-pl
- pt-br
- ru-ru
- tr-tr
- zh-cn
- zh-tw
ms.translationtype: Machine Translation
ms.sourcegitcommit: 9f5b8ebb69c9206ff90b05e748c64d29d82f7a16
ms.openlocfilehash: ae1ef60e6e27658c872689f5bfe2779493d42e7a
ms.contentlocale: ru-ru
ms.lasthandoff: 04/12/2017

---
# <a name="walkthrough-calling-windows-apis-visual-basic"></a><span data-ttu-id="884ef-102">Пошаговое руководство. Вызов API Windows (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="884ef-102">Walkthrough: Calling Windows APIs (Visual Basic)</span></span>
<span data-ttu-id="884ef-103">Интерфейсы Windows API являются библиотек динамической компоновки (DLL), которые являются частью операционной системы Windows.</span><span class="sxs-lookup"><span data-stu-id="884ef-103">Windows APIs are dynamic-link libraries (DLLs) that are part of the Windows operating system.</span></span> <span data-ttu-id="884ef-104">Они используются для выполнения задач, когда сложно написать собственную соответствующую процедуру.</span><span class="sxs-lookup"><span data-stu-id="884ef-104">You use them to perform tasks when it is difficult to write equivalent procedures of your own.</span></span> <span data-ttu-id="884ef-105">Например, в Windows есть функция с именем `FlashWindowEx` , позволяющая изменять строку заголовка приложения между светлые и темные оттенки.</span><span class="sxs-lookup"><span data-stu-id="884ef-105">For example, Windows provides a function named `FlashWindowEx` that lets you make the title bar for an application alternate between light and dark shades.</span></span>  
  
 <span data-ttu-id="884ef-106">Преимущество применения интерфейсов Windows API в коде — что они может сократить время разработки, так как они содержат множество полезных функций, которые уже записаны и ожидания для использования.</span><span class="sxs-lookup"><span data-stu-id="884ef-106">The advantage of using Windows APIs in your code is that they can save development time because they contain dozens of useful functions that are already written and waiting to be used.</span></span> <span data-ttu-id="884ef-107">Недостатком является то, что API-интерфейсов Windows может быть трудно работать с и они не допускают при неправильном.</span><span class="sxs-lookup"><span data-stu-id="884ef-107">The disadvantage is that Windows APIs can be difficult to work with and unforgiving when things go wrong.</span></span>  
  
 <span data-ttu-id="884ef-108">Интерфейсы Windows API представляют собой специальную категорию взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="884ef-108">Windows APIs represent a special category of interoperability.</span></span> <span data-ttu-id="884ef-109">Интерфейсы Windows API не используют управляемый код, не имеют встроенных библиотек и используют типы данных, отличные от тех, которые используются в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="884ef-109">Windows APIs do not use managed code, do not have built-in type libraries, and use data types that are different than those used with Visual Studio.</span></span> <span data-ttu-id="884ef-110">Из-за этих различий и потому, что интерфейсы Windows API не являются объектами COM, взаимодействие с интерфейсами API Windows и [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] выполняется с помощью вызова неуправляемого кода, или PInvoke.</span><span class="sxs-lookup"><span data-stu-id="884ef-110">Because of these differences, and because Windows APIs are not COM objects, interoperability with Windows APIs and the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] is performed using platform invoke, or PInvoke.</span></span> <span data-ttu-id="884ef-111">Вызов неуправляемого кода — это служба, позволяющая управляемому коду вызывать неуправляемые функции, реализованные в библиотеках DLL.</span><span class="sxs-lookup"><span data-stu-id="884ef-111">Platform invoke is a service that enables managed code to call unmanaged functions implemented in DLLs.</span></span> <span data-ttu-id="884ef-112">Дополнительные сведения см. в разделе [использование неуправляемых функций DLL](http://msdn.microsoft.com/library/eca7606e-ebfb-4f47-b8d9-289903fdc045).</span><span class="sxs-lookup"><span data-stu-id="884ef-112">For more information, see [Consuming Unmanaged DLL Functions](http://msdn.microsoft.com/library/eca7606e-ebfb-4f47-b8d9-289903fdc045).</span></span> <span data-ttu-id="884ef-113">Можно использовать PInvoke в [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] с помощью `Declare` инструкции или применение `DllImport` атрибут к пустой процедуре.</span><span class="sxs-lookup"><span data-stu-id="884ef-113">You can use PInvoke in [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] by using either the `Declare` statement or applying the `DllImport` attribute to an empty procedure.</span></span>  
  
 <span data-ttu-id="884ef-114">Вызовы Windows API были важной частью [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] программирование в прошлом, но редко бывают необходимости [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)].</span><span class="sxs-lookup"><span data-stu-id="884ef-114">Windows API calls were an important part of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] programming in the past, but are seldom necessary with [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)].</span></span> <span data-ttu-id="884ef-115">По возможности следует использовать управляемый код из [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] для выполнения задач, а не вызовы Windows API.</span><span class="sxs-lookup"><span data-stu-id="884ef-115">Whenever possible, you should use managed code from the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] to perform tasks, instead of Windows API calls.</span></span> <span data-ttu-id="884ef-116">Это пошаговое руководство содержит сведения для ситуаций, в которых использование API-интерфейсов Windows не требуется.</span><span class="sxs-lookup"><span data-stu-id="884ef-116">This walkthrough provides information for those situations in which using Windows APIs is necessary.</span></span>  
  
[!INCLUDE[note_settings_general](../../../csharp/language-reference/compiler-messages/includes/note_settings_general_md.md)]  
  
## <a name="api-calls-using-declare"></a><span data-ttu-id="884ef-117">Вызовы API с помощью объявления</span><span class="sxs-lookup"><span data-stu-id="884ef-117">API Calls Using Declare</span></span>  
 <span data-ttu-id="884ef-118">Наиболее распространенный способ вызова интерфейса Windows API — с помощью `Declare` инструкции.</span><span class="sxs-lookup"><span data-stu-id="884ef-118">The most common way to call Windows APIs is by using the `Declare` statement.</span></span>  
  
#### <a name="to-declare-a-dll-procedure"></a><span data-ttu-id="884ef-119">Объявление процедуры DLL</span><span class="sxs-lookup"><span data-stu-id="884ef-119">To declare a DLL procedure</span></span>  
  
1.  <span data-ttu-id="884ef-120">Определите имя функции, которую необходимо вызвать, ее аргументы, типы аргументов и возвращают значение, а также имя и расположение библиотеки DLL, которая его содержит.</span><span class="sxs-lookup"><span data-stu-id="884ef-120">Determine the name of the function you want to call, plus its arguments, argument types, and return value, as well as the name and location of the DLL that contains it.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="884ef-121">Полные сведения о функции Windows API см. в документации Win32 SDK в Platform SDK Windows API.</span><span class="sxs-lookup"><span data-stu-id="884ef-121">For complete information about the Windows APIs, see the Win32 SDK documentation in the Platform SDK Windows API.</span></span> <span data-ttu-id="884ef-122">Дополнительные сведения о константах, используемых Windows API просмотрите файлы заголовков, такие как Windows.h, входящий в состав пакета Platform SDK.</span><span class="sxs-lookup"><span data-stu-id="884ef-122">For more information about the constants that Windows APIs use, examine the header files such as Windows.h included with the Platform SDK.</span></span>  
  
2.  <span data-ttu-id="884ef-123">Откройте новый проект приложения Windows, щелкнув **New** на **файл** , а затем выберите **проекта**.</span><span class="sxs-lookup"><span data-stu-id="884ef-123">Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**.</span></span> <span data-ttu-id="884ef-124">Откроется диалоговое окно **Новый проект** .</span><span class="sxs-lookup"><span data-stu-id="884ef-124">The **New Project** dialog box appears.</span></span>  
  
3.  <span data-ttu-id="884ef-125">Выберите **приложения Windows** из списка [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] шаблонов проектов.</span><span class="sxs-lookup"><span data-stu-id="884ef-125">Select **Windows Application** from the list of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] project templates.</span></span> <span data-ttu-id="884ef-126">Откроется новый проект.</span><span class="sxs-lookup"><span data-stu-id="884ef-126">The new project is displayed.</span></span>  
  
4.  <span data-ttu-id="884ef-127">Добавьте следующие `Declare` работать либо в класс или модуль, в котором требуется использование DLL:</span><span class="sxs-lookup"><span data-stu-id="884ef-127">Add the following `Declare` function either to the class or module in which you want to use the DLL:</span></span>  
  
     <span data-ttu-id="884ef-128">[!code-vb[VbVbalrInterop №&9;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_1.vb)]</span><span class="sxs-lookup"><span data-stu-id="884ef-128">[!code-vb[VbVbalrInterop#9](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_1.vb)]</span></span>  
  
### <a name="parts-of-the-declare-statement"></a><span data-ttu-id="884ef-129">Части оператор Declare</span><span class="sxs-lookup"><span data-stu-id="884ef-129">Parts of the Declare Statement</span></span>  
 <span data-ttu-id="884ef-130">`Declare` Инструкция включает в себя следующие элементы.</span><span class="sxs-lookup"><span data-stu-id="884ef-130">The `Declare` statement includes the following elements.</span></span>  
  
#### <a name="auto-modifier"></a><span data-ttu-id="884ef-131">Модификатор Auto</span><span class="sxs-lookup"><span data-stu-id="884ef-131">Auto modifier</span></span>  
 <span data-ttu-id="884ef-132">`Auto` Модификатор инструктирует среду выполнения о необходимости преобразования строки на основе имени метода в соответствии с общих правил языка среды выполнения (или псевдоним, если указан).</span><span class="sxs-lookup"><span data-stu-id="884ef-132">The `Auto` modifier instructs the runtime to convert the string based on the method name according to common language runtime rules (or alias name if specified).</span></span>  
  
#### <a name="lib-and-alias-keywords"></a><span data-ttu-id="884ef-133">Ключевые слова lib и псевдоним</span><span class="sxs-lookup"><span data-stu-id="884ef-133">Lib and Alias keywords</span></span>  
 <span data-ttu-id="884ef-134">Следующее имя `Function` ключевое слово — это имя, программа использует для доступа к импортируемой функции.</span><span class="sxs-lookup"><span data-stu-id="884ef-134">The name following the `Function` keyword is the name your program uses to access the imported function.</span></span> <span data-ttu-id="884ef-135">Он может совпадать с реальным именем вызываемой функции, или можно использовать любое недопустимое имя процедуры и затем используют `Alias` слово настоящее имя вызываемой функции.</span><span class="sxs-lookup"><span data-stu-id="884ef-135">It can be the same as the real name of the function you are calling, or you can use any valid procedure name and then employ the `Alias` keyword to specify the real name of the function you are calling.</span></span>  
  
 <span data-ttu-id="884ef-136">Укажите `Lib` ключевое слово, и имя и расположение библиотеки DLL, которая содержит вызываемой функции.</span><span class="sxs-lookup"><span data-stu-id="884ef-136">Specify the `Lib` keyword, followed by the name and location of the DLL that contains the function you are calling.</span></span> <span data-ttu-id="884ef-137">Необходимо указать путь для файлов, расположенных в каталогах системы Windows.</span><span class="sxs-lookup"><span data-stu-id="884ef-137">You do not need to specify the path for files located in the Windows system directories.</span></span>  
  
 <span data-ttu-id="884ef-138">Используйте `Alias` ключевое слово, если имя вызываемой функции не является допустимым [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] имя процедуры или конфликтует с именем других элементов в приложении.</span><span class="sxs-lookup"><span data-stu-id="884ef-138">Use the `Alias` keyword if the name of the function you are calling is not a valid [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] procedure name, or conflicts with the name of other items in your application.</span></span> <span data-ttu-id="884ef-139">`Alias`Указывает правильное имя вызываемой функции.</span><span class="sxs-lookup"><span data-stu-id="884ef-139">`Alias` indicates the true name of the function being called.</span></span>  
  
#### <a name="argument-and-data-type-declarations"></a><span data-ttu-id="884ef-140">Аргумент и объявления типов данных</span><span class="sxs-lookup"><span data-stu-id="884ef-140">Argument and Data Type Declarations</span></span>  
 <span data-ttu-id="884ef-141">Объявите аргументы и их типы данных.</span><span class="sxs-lookup"><span data-stu-id="884ef-141">Declare the arguments and their data types.</span></span> <span data-ttu-id="884ef-142">Эта часть может оказаться сложной задачей, поскольку типы данных, которые использует Windows не соответствуют типам данных Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="884ef-142">This part can be challenging because the data types that Windows uses do not correspond to Visual Studio data types.</span></span> [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]<span data-ttu-id="884ef-143">выполняет большой объем работы за разработчика, преобразуя аргументы в совместимые типы данных, процесс, называемый *маршалинг*.</span><span class="sxs-lookup"><span data-stu-id="884ef-143"> does a lot of the work for you by converting arguments to compatible data types, a process called *marshaling*.</span></span> <span data-ttu-id="884ef-144">Можно явным образом управлять маршалингом аргументов с помощью <xref:System.Runtime.InteropServices.MarshalAsAttribute>атрибуту, определенному в <xref:System.Runtime.InteropServices>имен.</xref:System.Runtime.InteropServices> </xref:System.Runtime.InteropServices.MarshalAsAttribute></span><span class="sxs-lookup"><span data-stu-id="884ef-144">You can explicitly control how arguments are marshaled by using the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute defined in the <xref:System.Runtime.InteropServices> namespace.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="884ef-145">Предыдущие версии [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] может объявлять параметры `As Any`, это означает, что данные любого типа могут использоваться.</span><span class="sxs-lookup"><span data-stu-id="884ef-145">Previous versions of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] allowed you to declare parameters `As Any`, meaning that data of any data type could be used.</span></span> [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]<span data-ttu-id="884ef-146">необходимо использовать определенный тип данных для всех `Declare` инструкции.</span><span class="sxs-lookup"><span data-stu-id="884ef-146"> requires that you use a specific data type for all `Declare` statements.</span></span>  
  
#### <a name="windows-api-constants"></a><span data-ttu-id="884ef-147">Константы Windows API</span><span class="sxs-lookup"><span data-stu-id="884ef-147">Windows API Constants</span></span>  
 <span data-ttu-id="884ef-148">Некоторые аргументы являются сочетаниями констант.</span><span class="sxs-lookup"><span data-stu-id="884ef-148">Some arguments are combinations of constants.</span></span> <span data-ttu-id="884ef-149">Например `MessageBox` API, приведенных в этом руководстве принимает целочисленный аргумент под названием `Typ` , определяет, как отображается в окне сообщения.</span><span class="sxs-lookup"><span data-stu-id="884ef-149">For example, the `MessageBox` API shown in this walkthrough accepts an integer argument called `Typ` that controls how the message box is displayed.</span></span> <span data-ttu-id="884ef-150">Можно определить числовое значение этих констант, изучив `#define` инструкций в файле WinUser.h.</span><span class="sxs-lookup"><span data-stu-id="884ef-150">You can determine the numeric value of these constants by examining the `#define` statements in the file WinUser.h.</span></span> <span data-ttu-id="884ef-151">Числовые значения обычно отображаются в шестнадцатеричном формате, поэтому можно воспользоваться калькулятором для их сложения и преобразования в десятичное.</span><span class="sxs-lookup"><span data-stu-id="884ef-151">The numeric values are generally shown in hexadecimal, so you may want to use a calculator to add them and convert to decimal.</span></span> <span data-ttu-id="884ef-152">Например, если требуется объединить константы стиля восклицания `MB_ICONEXCLAMATION` 0x00000030 и Да/Нет стиля `MB_YESNO` 0x00000004, можно сложить эти числа и получить результат 0x00000034, или 52 десятичное число.</span><span class="sxs-lookup"><span data-stu-id="884ef-152">For example, if you want to combine the constants for the exclamation style `MB_ICONEXCLAMATION` 0x00000030 and the Yes/No style `MB_YESNO` 0x00000004, you can add the numbers and get a result of 0x00000034, or 52 decimal.</span></span> <span data-ttu-id="884ef-153">Несмотря на то, что можно использовать непосредственно десятичное число, лучше объявить эти значения в приложении как константы и сочетать их с помощью `Or` оператор.</span><span class="sxs-lookup"><span data-stu-id="884ef-153">Although you can use the decimal result directly, it is better to declare these values as constants in your application and combine them using the `Or` operator.</span></span>  
  
###### <a name="to-declare-constants-for-windows-api-calls"></a><span data-ttu-id="884ef-154">Объявление констант для вызовов интерфейса Windows API</span><span class="sxs-lookup"><span data-stu-id="884ef-154">To declare constants for Windows API calls</span></span>  
  
1.  <span data-ttu-id="884ef-155">Обратитесь к документации для вызываемой функции Windows.</span><span class="sxs-lookup"><span data-stu-id="884ef-155">Consult the documentation for the Windows function you are calling.</span></span> <span data-ttu-id="884ef-156">Определите имя константы, которую она использует и имя h-файл, содержащий числовые значения для этих констант.</span><span class="sxs-lookup"><span data-stu-id="884ef-156">Determine the name of the constants it uses and the name of the .h file that contains the numeric values for these constants.</span></span>  
  
2.  <span data-ttu-id="884ef-157">Используйте текстовый редактор, например Блокнот, чтобы просмотреть содержимое файла заголовка (h) и найти значения, связанные с константы, которые вы используете.</span><span class="sxs-lookup"><span data-stu-id="884ef-157">Use a text editor, such as Notepad, to view the contents of the header (.h) file, and find the values associated with the constants you are using.</span></span> <span data-ttu-id="884ef-158">Например `MessageBox` API использует константу `MB_ICONQUESTION` чтобы показать знак вопроса в окне сообщения.</span><span class="sxs-lookup"><span data-stu-id="884ef-158">For example, the `MessageBox` API uses the constant `MB_ICONQUESTION` to show a question mark in the message box.</span></span> <span data-ttu-id="884ef-159">Определение `MB_ICONQUESTION` в WinUser.h и выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="884ef-159">The definition for `MB_ICONQUESTION` is in WinUser.h and appears as follows:</span></span>  
  
     `#define MB_ICONQUESTION             0x00000020L`  
  
3.  <span data-ttu-id="884ef-160">Добавьте соответствующие `Const` инструкций в ваш класс или модуль, чтобы сделать эти константы доступными для приложения.</span><span class="sxs-lookup"><span data-stu-id="884ef-160">Add equivalent `Const` statements to your class or module to make these constants available to your application.</span></span> <span data-ttu-id="884ef-161">Пример:</span><span class="sxs-lookup"><span data-stu-id="884ef-161">For example:</span></span>  
  
     <span data-ttu-id="884ef-162">[!code-vb[VbVbalrInterop&11;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_2.vb)]</span><span class="sxs-lookup"><span data-stu-id="884ef-162">[!code-vb[VbVbalrInterop#11](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_2.vb)]</span></span>  
  
###### <a name="to-call-the-dll-procedure"></a><span data-ttu-id="884ef-163">Вызов процедуры DLL</span><span class="sxs-lookup"><span data-stu-id="884ef-163">To call the DLL procedure</span></span>  
  
1.  <span data-ttu-id="884ef-164">Добавьте кнопку с именем `Button1` для запуска формы для проекта и дважды щелкните его для просмотра его кода.</span><span class="sxs-lookup"><span data-stu-id="884ef-164">Add a button named `Button1` to the startup form for your project, and then double-click it to view its code.</span></span> <span data-ttu-id="884ef-165">Обработчик событий для кнопки отображается.</span><span class="sxs-lookup"><span data-stu-id="884ef-165">The event handler for the button is displayed.</span></span>  
  
2.  <span data-ttu-id="884ef-166">Добавьте код для `Click` обработчик событий для кнопки, который был добавлен, чтобы вызвать процедуру и предоставьте соответствующие аргументы:</span><span class="sxs-lookup"><span data-stu-id="884ef-166">Add code to the `Click` event handler for the button you added, to call the procedure and provide the appropriate arguments:</span></span>  
  
     <span data-ttu-id="884ef-167">[!code-vb[VbVbalrInterop&#12;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_3.vb)]</span><span class="sxs-lookup"><span data-stu-id="884ef-167">[!code-vb[VbVbalrInterop#12](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_3.vb)]</span></span>  
  
3.  <span data-ttu-id="884ef-168">Запустите проект, нажав клавишу F5.</span><span class="sxs-lookup"><span data-stu-id="884ef-168">Run the project by pressing F5.</span></span> <span data-ttu-id="884ef-169">Отображает окно сообщения с обоих **Да** и **нет** кнопками.</span><span class="sxs-lookup"><span data-stu-id="884ef-169">The message box is displayed with both **Yes** and **No** response buttons.</span></span> <span data-ttu-id="884ef-170">Нажмите одну из них.</span><span class="sxs-lookup"><span data-stu-id="884ef-170">Click either one.</span></span>  
  
#### <a name="data-marshaling"></a><span data-ttu-id="884ef-171">Маршалинг данных</span><span class="sxs-lookup"><span data-stu-id="884ef-171">Data Marshaling</span></span>  
 [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]<span data-ttu-id="884ef-172">автоматически преобразует типы данных параметров и возвращаемых значений вызовов интерфейса Windows API, но можно использовать `MarshalAs` атрибут, чтобы явно указать неуправляемые типы данных, ожидаемые интерфейсом API.</span><span class="sxs-lookup"><span data-stu-id="884ef-172"> automatically converts the data types of parameters and return values for Windows API calls, but you can use the `MarshalAs` attribute to explicitly specify unmanaged data types that an API expects.</span></span> <span data-ttu-id="884ef-173">Дополнительные сведения о маршалинге взаимодействия см. в разделе [маршалинг взаимодействия](http://msdn.microsoft.com/library/115f7a2f-d422-4605-ab36-13a8dd28142a).</span><span class="sxs-lookup"><span data-stu-id="884ef-173">For more information about interop marshaling, see [Interop Marshaling](http://msdn.microsoft.com/library/115f7a2f-d422-4605-ab36-13a8dd28142a).</span></span>  
  
###### <a name="to-use-declare-and-marshalas-in-an-api-call"></a><span data-ttu-id="884ef-174">Для использования в вызове API Declare и MarshalAs</span><span class="sxs-lookup"><span data-stu-id="884ef-174">To use Declare and MarshalAs in an API call</span></span>  
  
1.  <span data-ttu-id="884ef-175">Определите имя функции, необходимо вызвать, ее аргументы, типы данных и возвращаемое значение.</span><span class="sxs-lookup"><span data-stu-id="884ef-175">Determine the name of the function you want to call, plus its arguments, data types, and return value.</span></span>  
  
2.  <span data-ttu-id="884ef-176">Чтобы упростить доступ к `MarshalAs` атрибута, добавьте `Imports` инструкции в начало класса или модуля, как показано в следующем примере кода:</span><span class="sxs-lookup"><span data-stu-id="884ef-176">To simplify access to the `MarshalAs` attribute, add an `Imports` statement to the top of the code for the class or module, as in the following example:</span></span>  
  
     <span data-ttu-id="884ef-177">[!code-vb[VbVbalrInterop&#13;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]</span><span class="sxs-lookup"><span data-stu-id="884ef-177">[!code-vb[VbVbalrInterop#13](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]</span></span>  
  
3.  <span data-ttu-id="884ef-178">Добавьте прототип функции для импортированной функции в класс или модуль, вы используете и применить `MarshalAs` атрибут параметры или возвращаемое значение.</span><span class="sxs-lookup"><span data-stu-id="884ef-178">Add a function prototype for the imported function to the class or module you are using, and apply the `MarshalAs` attribute to the parameters or return value.</span></span> <span data-ttu-id="884ef-179">В следующем примере вызов API, который ожидает тип `void*` маршалируется как `AsAny`:</span><span class="sxs-lookup"><span data-stu-id="884ef-179">In the following example, an API call that expects the type `void*` is marshaled as `AsAny`:</span></span>  
  
     <span data-ttu-id="884ef-180">[!code-vb[VbVbalrInterop&#14;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_5.vb)]</span><span class="sxs-lookup"><span data-stu-id="884ef-180">[!code-vb[VbVbalrInterop#14](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_5.vb)]</span></span>  
  
## <a name="api-calls-using-dllimport"></a><span data-ttu-id="884ef-181">Вызовы API, с помощью DllImport</span><span class="sxs-lookup"><span data-stu-id="884ef-181">API Calls Using DllImport</span></span>  
 <span data-ttu-id="884ef-182">`DllImport` Атрибут содержит второй способ вызова функций в DLL без библиотек типов.</span><span class="sxs-lookup"><span data-stu-id="884ef-182">The `DllImport` attribute provides a second way to call functions in DLLs without type libraries.</span></span> <span data-ttu-id="884ef-183">`DllImport`с помощью примерно соответствует `Declare` инструкции, но обеспечивает больший контроль над процессом вызова функций.</span><span class="sxs-lookup"><span data-stu-id="884ef-183">`DllImport` is roughly equivalent to using a `Declare` statement but provides more control over how functions are called.</span></span>  
  
 <span data-ttu-id="884ef-184">Можно использовать `DllImport` с большинством API Windows вызывает при условии, что вызов связан общий (иногда называется *статического*) метод.</span><span class="sxs-lookup"><span data-stu-id="884ef-184">You can use `DllImport` with most Windows API calls as long as the call refers to a shared (sometimes called *static*) method.</span></span> <span data-ttu-id="884ef-185">Нельзя использовать методы, которым требуется экземпляр класса.</span><span class="sxs-lookup"><span data-stu-id="884ef-185">You cannot use methods that require an instance of a class.</span></span> <span data-ttu-id="884ef-186">В отличие от `Declare` инструкций, `DllImport` вызовы нельзя использовать `MarshalAs` атрибута.</span><span class="sxs-lookup"><span data-stu-id="884ef-186">Unlike `Declare` statements, `DllImport` calls cannot use the `MarshalAs` attribute.</span></span>  
  
#### <a name="to-call-a-windows-api-using-the-dllimport-attribute"></a><span data-ttu-id="884ef-187">Для вызова API Windows, используя атрибут DllImport</span><span class="sxs-lookup"><span data-stu-id="884ef-187">To call a Windows API using the DllImport attribute</span></span>  
  
1.  <span data-ttu-id="884ef-188">Откройте новый проект приложения Windows, щелкнув **New** на **файл** , а затем выберите **проекта**.</span><span class="sxs-lookup"><span data-stu-id="884ef-188">Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**.</span></span> <span data-ttu-id="884ef-189">Откроется диалоговое окно **Новый проект** .</span><span class="sxs-lookup"><span data-stu-id="884ef-189">The **New Project** dialog box appears.</span></span>  
  
2.  <span data-ttu-id="884ef-190">Выберите **приложения Windows** из списка [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] шаблонов проектов.</span><span class="sxs-lookup"><span data-stu-id="884ef-190">Select **Windows Application** from the list of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] project templates.</span></span> <span data-ttu-id="884ef-191">Откроется новый проект.</span><span class="sxs-lookup"><span data-stu-id="884ef-191">The new project is displayed.</span></span>  
  
3.  <span data-ttu-id="884ef-192">Добавьте кнопку с именем `Button2` форму запуска.</span><span class="sxs-lookup"><span data-stu-id="884ef-192">Add a button named `Button2` to the startup form.</span></span>  
  
4.  <span data-ttu-id="884ef-193">Дважды щелкните `Button2` чтобы открыть представление кода для формы.</span><span class="sxs-lookup"><span data-stu-id="884ef-193">Double-click `Button2` to open the code view for the form.</span></span>  
  
5.  <span data-ttu-id="884ef-194">Чтобы упростить доступ к `DllImport`, добавьте `Imports` инструкции в начало кода класса формы запуска:</span><span class="sxs-lookup"><span data-stu-id="884ef-194">To simplify access to `DllImport`, add an `Imports` statement to the top of the code for the startup form class:</span></span>  
  
     <span data-ttu-id="884ef-195">[!code-vb[VbVbalrInterop&#13;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]</span><span class="sxs-lookup"><span data-stu-id="884ef-195">[!code-vb[VbVbalrInterop#13](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]</span></span>  
  
6.  <span data-ttu-id="884ef-196">Объявите пустую функцию выше `End Class` инструкции для формы и имя функции `MoveFile`.</span><span class="sxs-lookup"><span data-stu-id="884ef-196">Declare an empty function preceding the `End Class` statement for the form, and name the function `MoveFile`.</span></span>  
  
7.  <span data-ttu-id="884ef-197">Применить `Public` и `Shared` модификаторы объявления функции и задать параметры для `MoveFile` на основе аргументов, использует функции Windows API:</span><span class="sxs-lookup"><span data-stu-id="884ef-197">Apply the `Public` and `Shared` modifiers to the function declaration and set parameters for `MoveFile` based on the arguments the Windows API function uses:</span></span>  
  
     <span data-ttu-id="884ef-198">[!code-vb[VbVbalrInterop №&16;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_6.vb)]</span><span class="sxs-lookup"><span data-stu-id="884ef-198">[!code-vb[VbVbalrInterop#16](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_6.vb)]</span></span>  
  
     <span data-ttu-id="884ef-199">Функция может иметь любое допустимое имя процедуры; `DllImport` атрибут указывает имя библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="884ef-199">Your function can have any valid procedure name; the `DllImport` attribute specifies the name in the DLL.</span></span> <span data-ttu-id="884ef-200">Он также управляет маршалингом взаимодействия для параметров и возвращаемых значений, поэтому можно выбрать типы данных Visual Studio, которые похожи на данные типы использует API.</span><span class="sxs-lookup"><span data-stu-id="884ef-200">It also handles interoperability marshaling for the parameters and return values, so you can choose Visual Studio data types that are similar to the data types the API uses.</span></span>  
  
8.  <span data-ttu-id="884ef-201">Применить `DllImport` атрибута пустой функции.</span><span class="sxs-lookup"><span data-stu-id="884ef-201">Apply the `DllImport` attribute to the empty function.</span></span> <span data-ttu-id="884ef-202">Первый параметр — имя и расположение библиотеки DLL, содержащей функцию, который вы вызываете.</span><span class="sxs-lookup"><span data-stu-id="884ef-202">The first parameter is the name and location of the DLL containing the function you are calling.</span></span> <span data-ttu-id="884ef-203">Необходимо указать путь для файлов, расположенных в каталогах системы Windows.</span><span class="sxs-lookup"><span data-stu-id="884ef-203">You do not need to specify the path for files located in the Windows system directories.</span></span> <span data-ttu-id="884ef-204">Второй параметр — именованный аргумент, который задает имя функции в Windows API.</span><span class="sxs-lookup"><span data-stu-id="884ef-204">The second parameter is a named argument that specifies the name of the function in the Windows API.</span></span> <span data-ttu-id="884ef-205">В этом примере `DllImport` атрибут приводит вызовы `MoveFile` пересылать `MoveFileW` в KERNEL32. БИБЛИОТЕКА DLL.</span><span class="sxs-lookup"><span data-stu-id="884ef-205">In this example, the `DllImport` attribute forces calls to `MoveFile` to be forwarded to `MoveFileW` in KERNEL32.DLL.</span></span> <span data-ttu-id="884ef-206">`MoveFileW` Метод копирует файл из пути `src` путь `dst`.</span><span class="sxs-lookup"><span data-stu-id="884ef-206">The `MoveFileW` method copies a file from the path `src` to the path `dst`.</span></span>  
  
     <span data-ttu-id="884ef-207">[!code-vb[VbVbalrInterop&17;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_7.vb)]</span><span class="sxs-lookup"><span data-stu-id="884ef-207">[!code-vb[VbVbalrInterop#17](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_7.vb)]</span></span>  
  
9. <span data-ttu-id="884ef-208">Добавьте код для `Button2_Click` обработчик событий для вызова функции:</span><span class="sxs-lookup"><span data-stu-id="884ef-208">Add code to the `Button2_Click` event handler to call the function:</span></span>  
  
     <span data-ttu-id="884ef-209">[!code-vb[VbVbalrInterop&18;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_8.vb)]</span><span class="sxs-lookup"><span data-stu-id="884ef-209">[!code-vb[VbVbalrInterop#18](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_8.vb)]</span></span>  
  
10. <span data-ttu-id="884ef-210">Создайте файл с именем Test.txt и поместите его в каталог C:\Tmp на жестком диске.</span><span class="sxs-lookup"><span data-stu-id="884ef-210">Create a file named Test.txt and place it in the C:\Tmp directory on your hard drive.</span></span> <span data-ttu-id="884ef-211">При необходимости создайте каталог Tmp.</span><span class="sxs-lookup"><span data-stu-id="884ef-211">Create the Tmp directory if necessary.</span></span>  
  
11. <span data-ttu-id="884ef-212">Нажмите клавишу F5 для запуска приложения.</span><span class="sxs-lookup"><span data-stu-id="884ef-212">Press F5 to start the application.</span></span> <span data-ttu-id="884ef-213">Появится главная форма.</span><span class="sxs-lookup"><span data-stu-id="884ef-213">The main form appears.</span></span>  
  
12. <span data-ttu-id="884ef-214">Щелкните **Button2**.</span><span class="sxs-lookup"><span data-stu-id="884ef-214">Click **Button2**.</span></span> <span data-ttu-id="884ef-215">Сообщение «файл был перемещен успешно» отображается в том случае, если файл можно переместить.</span><span class="sxs-lookup"><span data-stu-id="884ef-215">The message "The file was moved successfully" is displayed if the file can be moved.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="884ef-216">См. также</span><span class="sxs-lookup"><span data-stu-id="884ef-216">See Also</span></span>  
 <span data-ttu-id="884ef-217"><xref:System.Runtime.InteropServices.DllImportAttribute></xref:System.Runtime.InteropServices.DllImportAttribute></span><span class="sxs-lookup"><span data-stu-id="884ef-217"><xref:System.Runtime.InteropServices.DllImportAttribute></span></span>   
 <span data-ttu-id="884ef-218"><xref:System.Runtime.InteropServices.MarshalAsAttribute></xref:System.Runtime.InteropServices.MarshalAsAttribute></span><span class="sxs-lookup"><span data-stu-id="884ef-218"><xref:System.Runtime.InteropServices.MarshalAsAttribute></span></span>   
<span data-ttu-id="884ef-219"> [Оператор Declare](../../../visual-basic/language-reference/statements/declare-statement.md) </span><span class="sxs-lookup"><span data-stu-id="884ef-219"> [Declare Statement](../../../visual-basic/language-reference/statements/declare-statement.md) </span></span>  
<span data-ttu-id="884ef-220"> [Авто](../../../visual-basic/language-reference/modifiers/auto.md) </span><span class="sxs-lookup"><span data-stu-id="884ef-220"> [Auto](../../../visual-basic/language-reference/modifiers/auto.md) </span></span>  
<span data-ttu-id="884ef-221"> [Псевдоним](../../../visual-basic/language-reference/statements/alias-clause.md) </span><span class="sxs-lookup"><span data-stu-id="884ef-221"> [Alias](../../../visual-basic/language-reference/statements/alias-clause.md) </span></span>  
<span data-ttu-id="884ef-222"> [Взаимодействие COM](../../../visual-basic/programming-guide/com-interop/index.md) </span><span class="sxs-lookup"><span data-stu-id="884ef-222"> [COM Interop](../../../visual-basic/programming-guide/com-interop/index.md) </span></span>  
<span data-ttu-id="884ef-223"> [Создание прототипов в управляемом коде](http://msdn.microsoft.com/library/ecdcf25d-cae3-4f07-a2b6-8397ac6dc42d) </span><span class="sxs-lookup"><span data-stu-id="884ef-223"> [Creating Prototypes in Managed Code](http://msdn.microsoft.com/library/ecdcf25d-cae3-4f07-a2b6-8397ac6dc42d) </span></span>  
<span data-ttu-id="884ef-224"> [Маршалинг делегата как метода обратного вызова](http://msdn.microsoft.com/library/6ddd7866-9804-4571-84de-83f5cc017a5a)</span><span class="sxs-lookup"><span data-stu-id="884ef-224"> [Marshaling a Delegate as a Callback Method](http://msdn.microsoft.com/library/6ddd7866-9804-4571-84de-83f5cc017a5a)</span></span>
