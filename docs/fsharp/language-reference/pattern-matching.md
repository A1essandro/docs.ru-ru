---
title: Сопоставление шаблонов (F#)
description: 'Узнайте, как шаблоны используются в языке F # для сравнения данных с логическими структурами, разложения данных на составные части или извлечения информации из данных.'
ms.date: 05/16/2016
ms.openlocfilehash: 64f5b2534190552db71a67b30ece41bafed3d16e
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
---
# <a name="pattern-matching"></a>Сопоставление шаблонов

Шаблоны — это правила для преобразования входных данных. Они используются в языке F # для сравнения данных с логической структурой или структурами, разложения данных на составные части или извлечения информации из данных различными способами.


## <a name="remarks"></a>Примечания
Шаблоны используются во многих языковых конструкций, таких как `match` выражение. Они используются при обработке аргументов для функций в `let` привязок, лямбда-выражения и в обработчиках исключений, связанных с `try...with` выражения. Дополнительные сведения см. в разделе [выражениях сопоставления](match-expressions.md), [привязки let](functions/let-bindings.md), [лямбда-выражения: `fun` ключевое слово](functions/lambda-expressions-the-fun-keyword.md), и [исключения: `try...with` Выражение](exception-handling/the-try-with-expression.md).

Например, в `match` выражение, *шаблон* является то, что следует за символом вертикальной черты.

```fsharp
match expression with
| pattern [ when condition ] -> result-expression
...
```

Каждый шаблон выступает в качестве правила для преобразования входных данных каким-либо образом. В `match` выражение каждого шаблона в свою очередь исследуется на предмет того, если входные данные — совместим с шаблоном. Если найдено совпадение, выполняется результирующее выражение. Если совпадение не найдено, проверяется следующее правило-шаблон. Обязательно при *условие* часть описан в [выражениях сопоставления](match-expressions.md).

Поддерживаемые шаблоны приведены в следующей таблице. Во время выполнения входных данных сравниваются с каждым из следующих шаблонов в порядке, указанном в таблице и шаблоны применяются рекурсивно из сначала осуществляется до места последнего появления в коде и слева направо для шаблонов в каждой строке.

|name|Описание|Пример|
|----|-----------|-------|
|Шаблон константы|Любой числовой, символ, или строковый литерал, константа перечисления или определенный литеральный идентификатор|`1.0`, `"test"`, `30`, `Color.Red`|
|Шаблон идентификатора|Значение варианта размеченного объединения, метка исключения или ветвь активного шаблона|`Some(x)`<br /><br />`Failure(msg)`|
|Шаблон переменной|*identifier*|`a`|
|`as` Шаблон|*шаблон* как *идентификатор*|`(a, b) as tuple1`|
|ИЛИ шаблон|*pattern1* &#124; *pattern2*|<code>([h] &#124; [h; _])</code>|
|И шаблон|*pattern1* &amp; *pattern2*|`(a, b) & (_, "test")`|
|Шаблон cons-списка|*Идентификатор* :: *идентификатор списка*|`h :: t`|
|Шаблон списка|[ *шаблон_1*;...; *pattern_n* ]|`[ a; b; c ]`|
|Шаблон массива|[&#124; *шаблон_1*;..; *pattern_n* &#124;]|<code>[&#124; a; b; c &#124;]</code>|
|Шаблон в круглых скобках|( *шаблон* )|`( a )`|
|Шаблон кортежа|( *шаблон_1*,..., *pattern_n* )|`( a, b )`|
|Шаблон записи|{ *идентификатор1* = *шаблон_1*;...; *identifier_n* = *pattern_n* }|`{ Name = name; }`|
|Шаблон подстановочного знака|_|`_`|
|Шаблон вместе с аннотацией типа|*шаблон* : *типа*|`a : int`|
|Шаблон проверки типа|:? *Тип* [как *идентификатор* ]|`:? System.DateTime as dt`|
|Шаблон NULL|null|`null`|

## <a name="constant-patterns"></a>Шаблоны констант
Шаблоны констант — это числовые, символов и строковых литералов, констант перечисления (включая имя типа перечисления). Объект `match` выражение, содержащее только шаблоны констант могут сравниваться с оператором case в других языках. Входные данные сравниваются с литеральным значением и соответствует шаблону, если значения равны. Тип литерала должен быть совместим с типом входных данных.

В следующем примере демонстрируется использование литеральных шаблонов и также использует шаблон переменной и или модели.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4801.fs)]

Другой пример литерального шаблона — шаблон, основанный на константы перечисления. Необходимо указать имя типа перечисления, при использовании константы перечисления.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4802.fs)]

## <a name="identifier-patterns"></a>Шаблоны идентификаторов
Если шаблон строку символов, которая формирует является допустимым идентификатором, форма идентификатора определяет, как сравнивается шаблон. Если идентификатор длиннее одного символа и начинается с символа верхнего регистра, компилятор пытается найти соответствие шаблону идентификатора. Идентификатор для этого шаблона может быть помечена как атрибут-литерал, размеченного объединения, идентификатор исключения или ветвь активного шаблона значение. Если нет совпадающий идентификатор не найден, проверка оказывается неудачной и следующее правило-шаблон, шаблон переменной, сравнивается с входных данных.

Шаблоны размеченных объединений могут быть простыми именованные классы либо могут иметь значение или кортеж, содержащий несколько значений. Если имеется значение, необходимо указать идентификатор для значения. В случае кортежа вы должны предоставить шаблон кортежа с идентификатором для каждого элемента кортежа или идентификатор с именем поля для одного или нескольких именованных полей в объединении. См. в примерах кода в этом разделе примеры.

`option` Тип — размеченного объединения, имеющее два варианта `Some` и `None`. Один вариант (`Some`) имеет значение, а другой (`None`) представляет собой просто именованные ветвь. Таким образом `Some` должен иметь переменную для значения, связанного с `Some` , однако `None` должен отображаться самостоятельно. В следующем коде переменной `var1` присваивается значение, полученное путем сравнения с `Some` регистр.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4803.fs)]

В следующем примере `PersonName` размеченного объединения содержит смесь строк и символов, представляющих возможные формы имен. Приведены случаи размеченного объединения `FirstOnly`, `LastOnly`, и `FirstLast`.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4804.fs)]

Размеченные объединения, которые имена полей можно использовать знак равенства (=) для извлечения значение именованного поля. Например рассмотрим размеченного объединения с объявлением следующим образом.

```fsharp
type Shape =
    | Rectangle of height : float * width : float
    | Circle of radius : float
```

Указанных полей в выражении можно использовать следующим образом.

```fsharp
let matchShape shape =
    match shape with
    | Rectangle(height = h) -> printfn "Rectangle with length %f" h
    | Circle(r) -> printfn "Circle with radius %f" r
```

Использование именованного поля необязательно, поэтому в предыдущем примере оба `Circle(r)` и `Circle(radius = r)` действуют одинаково.

При указании нескольких полей, используйте точку с запятой (;) в качестве разделителя.

```
match shape with
| Rectangle(height = h; width = w) -> printfn "Rectangle with height %f and width %f" h w
| _ -> ()
```

Активные шаблоны позволяют определять более сложные сопоставления пользовательских шаблонов. Дополнительные сведения об активных шаблонах см. в разделе [активные шаблоны](active-patterns.md).

Так, в которой идентификатор является исключением используется в шаблона в контексте обработчиков исключений. Сведения о подборе шаблона при обработке исключений см. в разделе [исключения: `try...with` выражение](exception-handling/the-try-with-expression.md).


## <a name="variable-patterns"></a>Шаблоны переменных
Шаблон переменной присваивает сравниваемое значение имени переменной, которое затем становится доступным для использования в выражении справа от выполнения `->` символов. Сама по себе шаблон переменной соответствует любым входным данным, однако шаблоны переменных часто используются внутри других шаблонов, что более сложные структуры, таких как кортежи и массивы, чтобы разложить на переменные.

В следующем примере показано шаблон переменной внутри шаблона кортежа.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4805.fs)]

## <a name="as-pattern"></a>AS-шаблон
`as` Шаблон — это шаблон, который имеет `as` предложение, добавленным к нему. `as` Предложение привязывает совпадающее значение имени, которое может использоваться в выражении выполнения `match` выражения, или в случае, когда этот шаблон используется в `let` привязки, имя добавляется в качестве привязки в локальную область видимости.

В следующем примере используется `as` шаблон.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4806.fs)]

## <a name="or-pattern"></a>ИЛИ шаблон
Шаблон OR используется в том случае, когда входные данные могут соответствовать нескольким шаблонам, необходимо выполнить в результате тот же код. Типы обеих сторон шаблона OR должны быть совместимыми.

Ниже приведен пример шаблона OR.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4807.fs)]

## <a name="and-pattern"></a>И шаблон
Шаблон AND требует, что входные данные соответствовали двум шаблонам. Типы обеих сторон шаблона должны быть совместимыми.

Следующий пример аналогичен `detectZeroTuple` показано [шаблон кортежа](https://msdn.microsoft.com/library/#tuple) далее в этом разделе, но здесь одновременно `var1` и `var2` получаются как значения с помощью шаблона.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4808.fs)]

## <a name="cons-pattern"></a>Шаблон cons-списка
Шаблон cons-списка используется для разложения списка на первый элемент, *head*и список, содержащий остальные элементы *заключительного*.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4809.fs)]

## <a name="list-pattern"></a>Шаблон списка
Шаблон списка позволяет списки, чтобы разложить на количество элементов. Сам по себе шаблон списка может соответствовать только списки ряд элементов.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4810.fs)]

## <a name="array-pattern"></a>Шаблон массива
Шаблон массива сходен с шаблоном списка и может использоваться для разложения массивов определенной длины.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4811.fs)]

## <a name="parenthesized-pattern"></a>Шаблон в круглых скобках
Можно группировать круглые скобки вокруг шаблонов для достижения требуемой ассоциативности. В следующем примере круглые скобки используются для управления ассоциативностью между шаблоном AND и шаблоном cons-списка.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4812.fs)]

## <a name="tuple-pattern"></a>Шаблон кортежа
Шаблон кортежа соответствует входным данным в форме кортежа и позволяет разложить на его составляющие элементы с помощью сопоставления переменных для каждой позиции в кортеже шаблона кортеж.

В следующем примере демонстрируется шаблон кортежа и также использует литеральных шаблонов, шаблоны переменных и Шаблон подстановочного знака.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4813.fs)]

## <a name="record-pattern"></a>Шаблон записи
Шаблон записи используется для разложения записей с целью извлечения значения полей. Шаблон не должен ссылаться на все поля в записи; пропущенные поля просто не участвуют в сравнении и не извлекаются.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4814.fs)]

## <a name="wildcard-pattern"></a>Шаблон подстановочного знака
Шаблон подстановочного знака представляется символ подчеркивания (`_`) символов и соответствует любым входным данным, так же, как шаблон переменной, за исключением того, что входные данные удаляются, а не присваивается переменной. Шаблон подстановочного знака часто используется внутри других шаблонов в качестве заполнителя для значений, которые не требуются в выражении справа от `->` символов. Шаблон подстановочного знака также часто используются для сопоставления всех несопоставленных входных данных в конце списка шаблонов. Многие примеры кода в этом разделе демонстрируется шаблон подстановочного знака. См. предыдущий код для примера.


## <a name="patterns-that-have-type-annotations"></a>Шаблоны, имеющие аннотации типов
Шаблоны могут иметь аннотации типа. Они ведут себя как другие аннотации типов и способствуют в определении типа. Круглые скобки необходимы для аннотации типов в шаблонах. Ниже приведен шаблон, имеющий аннотацию типа.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4815.fs)]

## <a name="type-test-pattern"></a>Шаблон проверки типа
Шаблон проверки типа используется для сопоставления входных данных с типом. Если входным типом является сопоставления (или производный тип) типа, указанного в шаблоне, сопоставление выполняется успешно.

В следующем примере показано шаблон проверки типа.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4816.fs)]

## <a name="null-pattern"></a>Шаблон NULL
Шаблон null соответствует значению null, которое может появиться при работе с типами, допускающими значение null. Шаблоны NULL часто используются при взаимодействии с кодом .NET Framework. Например, значение, возвращаемое .NET API может быть входными данными для `match` выражение. Можно управлять выполнением программы на основе ли возвращаемое значение равно null, а также другие характеристики возвращаемого значения. Шаблон null можно использовать для предотвращения распространения для остальной части программы значения null.

В следующем примере используется шаблон null и шаблон переменной.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet4817.fs)]

## <a name="see-also"></a>См. также
[Выражения match](match-expressions.md)

[Активные шаблоны](active-patterns.md)

[Справочник по языку F#](index.md)
